<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Sets-and-Dictionaries.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"ClassOrganizer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ClassOrganizer&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;globalComment commentVector groupVector&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;default &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>ClassOrganizers contain the formatting information for printing classes.  Each String in commentVector describes a category comprising the messages contained in the Vector which is the corresponding entry in groupVector.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[default &larr; &rsquo;As yet unclassified&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: sortedVec<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self globalComment &larr; &rsquo;This class has not yet been commented&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector &larr; &rsquo;As yet unclassified&rsquo; inVector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector &larr; sortedVec inVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">| v t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; Stream new of: (Vector new: 200).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t from: groupVector do⦂ [v append: t].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑v contents asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">categories </span><span style="font: 10pt serif">[⇑commentVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">category: str </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; commentVector find: str.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i=0⇒[user notify: &rsquo;No such category: &rsquo;+str]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑groupVector◦i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classify: selector under: heading </span><span style="font: 10pt serif">| s h n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector is: Vector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ s from: selector do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self classify: s under: heading]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; commentVector find: heading.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s&gt;0 and⦂ (groupVector◦s has: selector)⇒[⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[h &larr; self invert: selector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[heading=default⇒[⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; commentVector find: h.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> groupVector◦n &larr; groupVector◦n delete: selector]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s=0⇒ [s &larr; self insert: heading]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector◦s &larr; groupVector◦s insertSorted: selector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; commentVector find: default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n&gt;0 and⦂ (groupVector◦n) length=0⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self deleteCategory: n]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: selector </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"delete this from all categories"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: groupVector length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[groupVector◦i has: selector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[groupVector◦i &larr; (groupVector◦i) delete: selector.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(groupVector◦i) length=0 and⦂ commentVector◦i=default⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self deleteCategory: i]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">deleteCategory: index<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[groupVector &larr; groupVector without: index.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector &larr; commentVector without: index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">globalComment </span><span style="font: 10pt serif">[⇑globalComment asParagraph text]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">globalCommentItself </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">used only by </span><span style="font: bold 10pt serif">Class archiveOn:changesOnly:</span><span style="font: 10pt serif">" ⇑globalComment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">globalComment &larr; globalComment </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">String or RemoteParagraph</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">has: sel </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ t from: groupVector do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t has: sel⇒[⇑true]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: heading </span><span style="font: 10pt serif">| di dgroup hi  </span><span style="font: italic 10pt serif">"force default category to end, delete if empty"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(di&larr;commentVector find: default)&gt;0⇒ [dgroup &larr; groupVector◦di]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector &larr; (commentVector without: di), heading.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector &larr; (groupVector without: di), (Vector new: 0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">hi &larr; commentVector length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">di=0 or⦂ dgroup length=0⇒ [⇑hi]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector &larr; commentVector, default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector &larr; groupVector, dgroup.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑hi]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invert: selector </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: groupVector length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[groupVector◦i has: selector⇒[⇑commentVector◦i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion to text</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraph </span><span style="font: 10pt serif">| s i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s print: self globalComment.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: commentVector length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s cr; print: ((commentVector◦i) inVector concat: groupVector◦i)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromParagraph: para </span><span style="font: 10pt serif">| t i j g<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user displayoffwhile⦂<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; para asVector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self globalComment &larr; t◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector &larr; Vector new: t length-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector &larr; Vector new: t length-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: t length-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[g &larr; t◦(i+1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">commentVector◦i &larr; g◦1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ 0=(j&larr; g find: ↪&larr;) do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"reconstitute &larr; suffixes"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[g &larr; g replace: j-1 to: j by: (g◦(j-1)+&rsquo;&larr;&rsquo;) unique inVector]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">groupVector◦i &larr; (g copy: 2 to: g length) sort]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪ClassOrganizer under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">ClassOrganizer classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Dict"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Dict&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>a model for dictionary-index classes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: initialSize </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">default is to ignore</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Name-Value Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name </span><span style="font: 10pt serif">| entry ["</span><span style="font: italic 10pt serif">find</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">entry &larr; self find: name⇒ [⇑entry value]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name &larr; value </span><span style="font: 10pt serif">[ "</span><span style="font: italic 10pt serif">replace or insert</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self write: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: name with: value </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self insert: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lookup: name </span><span style="font: 10pt serif">[⇑self◦name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: name with: value </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self replace: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Entry Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">[⇑self match: &rsquo;*&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">create: entry </span><span style="font: 10pt serif">[⇑self insert: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Delete: entry.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;not deleted (not found)&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">exists: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">doesn&rsquo;t initialize too much</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self Find: (self makeEntry: entry)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">find: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [⇑self found: entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;not found&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">found: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">found, fill it in from dictionary</span><span style="font: 10pt serif">" ⇑self nextEntry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">get: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">find or insert</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [⇑self found: entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Insert: entry.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;not inserted (already found)&rsquo; entry: entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Insert: entry.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">list </span><span style="font: 10pt serif">[self list: &rsquo;*&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">list: entries </span><span style="font: 10pt serif">[self match: entries to: user]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">match: entries </span><span style="font: 10pt serif">| set [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">set &larr; Set new vector: 50.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self match: entries to: set.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑set contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">match: entries to: strm </span><span style="font: 10pt serif">| entry nentries [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return a Set of entries which match those in entries<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">(can include exact values and patterns and ranges)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(entries is: Vector) or⦂ (entries Is: Set)⇒ [] entries &larr; entries inVector].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nentries &larr; Set new vector: entries length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ entry from: entries do⦂ [nentries next &larr; self makeEntry: entry].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self Match: nentries to: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read: entry </span><span style="font: 10pt serif">[⇑self find: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rename: entry newName: name </span><span style="font: 10pt serif">| nentry ["not tested"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (nentry &larr; self makeEntry: name)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;already exists&rsquo; error: nentry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Rename: entry from: nentry.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;not found&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Replace: entry.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: &rsquo;not replaced (not found)&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">retrieve: entry </span><span style="font: 10pt serif">[⇑self find: entry "match:?"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">store: entry </span><span style="font: 10pt serif">[⇑self write: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">write: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">replace or insert</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self Find: (entry &larr; self makeEntry: entry)⇒ [self Replace: entry]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Insert: entry].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Stream Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">append: dict </span><span style="font: 10pt serif">| entry [for⦂ entry from: dict do⦂ [self write: entry]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">leave position where it is</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return next entry or false</span><span style="font: 10pt serif">" <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self nextEntry: self newEntry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">current position (name)</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position &larr; name </span><span style="font: 10pt serif">[⇑self Position &larr; self makeEntry: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Position &larr; entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">position to name, or position to insert place and return false if not found.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">subclass had better define position&larr; or Position&larr; (preferably)<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">otherwise circularity results!!!</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self position &larr; entry name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">position to beginning</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Entry Creation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entryClass </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">a subclass of DictionaryEntry</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">makeEntry: entry </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">entry or name</span><span style="font: 10pt serif">" | cl [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cl &larr; self entryClass.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cl≡false or⦂ (entry Is: cl)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"entry should not be converted or is the correct type" ⇑entry]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"convert entry from a name to an entry with that name"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self newEntry name: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newEntry </span><span style="font: 10pt serif">[⇑[(self entryClass new) dictionary: self; init]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextEntry: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return next name and value in entry, or false.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">if insert or delete occurs after previous next, may be problem</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Entry Operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Delete: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">entry found (next), delete it</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entrySize: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">storage size of entry, constant or variable</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error: e entry: entry </span><span style="font: 10pt serif">["entry error: e" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Find: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">is entry in dictionary?</span><span style="font: 10pt serif">" ⇑self Position &larr; entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Insert: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">entry not found, insert it (next)</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Match: entries to: strm </span><span style="font: 10pt serif">| entry pat ents [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">default (unordered) is to compare entire dictionary with entries</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ entry from: self do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ents &larr; entries asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (ents and⦂ (pat &larr; ents next)) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pat match: entry⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ents &larr; false.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; entry<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Rename: entry from: nentry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Delete: entry; Insert: (entry name: nentry name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Replace: entry </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">entry found (next), replace it&rsquo;s value</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>File-Based dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">possible cleanup before a release</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self file⇒ [self file close]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self release]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">return my file</span><span style="font: 10pt serif">" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">obsolete </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">is my information obsolete (should I regenerate it)?</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self file⇒ [⇑self file obsolete]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">obsolete and deallocate storage, especially if connected to an external view,<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">e.g. a File</span><span style="font: 10pt serif">" [self file⇒ [self file release]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reopen </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">reinitialize, especially if a File is involved</span><span style="font: 10pt serif">" self open]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Dict under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"DictionaryEntry"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;DictionaryEntry&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>a model for entries --what to retrieve with and store in dictionaries</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary: dict</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name: name</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Other</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">what dictionary did I come from?</span><span style="font: 10pt serif">" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">match: entry </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">does self (some kind of pattern) match entry?</span><span style="font: 10pt serif">" self subError] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fileSize </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">size in characters for filing</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readFrom: file </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">inverse of </span><span style="font: bold 10pt serif">storeOn:</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">storeOn: file </span><span style="font: 10pt serif">["store </span><span style="font: bold 10pt serif">self</span><span style="font: 10pt serif"> as </span><span style="font: bold 10pt serif">fileSize</span><span style="font: 10pt serif"> characters on </span><span style="font: bold 10pt serif">file</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪DictionaryEntry under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"HashSet"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;HashSet&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;objects&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>HashSets are pure sets of objects with no associated values.  However, since they allow callers to determine the location of objects in the hash table, subclasses such as Dictionary and MessageDict can provide parallel tables to hold values.  Such subclasses must intercept growto: and reorder their own tables then.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: italic 10pt serif">"⇑ a copy of me"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self class new copyfrom: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyfrom: hset </span><span style="font: italic 10pt serif">"take on state of hset"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects &larr; hset objects copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self init: 4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects &larr; Vector new: (size max: 2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self contents asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">| obj strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; (Vector new: objects length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ obj from: objects do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[obj≡nil⇒[] strm next&larr; obj]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">size </span><span style="font: 10pt serif">[⇑objects length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">find: obj </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"⇑index if found, else false"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findornil: obj.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦i=obj⇒[⇑i] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findorerror: name </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findornil: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦i=name⇒ [⇑i]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"allow the user to put a correct value into i"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: name asString+&rsquo; cannot be found&rsquo;. ⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">has: obj<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑objects◦(self findornil: obj)=obj]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Insertion and deletion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: obj </span><span style="font: 10pt serif">| i j l<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[obj is: Vector⇒[for⦂ i from: obj do⦂ [self delete: i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr; self findorerror: obj.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦i&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">l&larr; objects length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ objects◦(i&larr; [i=l⇒[1] i+1])≡nil do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i=(j&larr; self findornil: objects◦i)⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self swap: i with: j]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: obj </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self findorinsert: obj. ⇑obj]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertall: objs </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ x from: objs do⦂ [self insert: x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Growing and shrinking</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">packprobes </span><span style="font: 10pt serif">| tot n l i obj t</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"⇑(fullness, avg #probes)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tot &larr; n &larr; 0. l &larr; objects length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: l do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(obj&larr; objects◦i)≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; obj hash \ l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tot &larr; tot + [i &lt; t⇒ [l - t + i] i - t].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n&larr; n+1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=0⇒[⇑(1,1)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑((n asFloat/l) , (tot asFloat/n))]<br></span><span style="font: italic 10pt serif">"Class md packprobes(0.4921875 2.53968255 )"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">shrink </span><span style="font: 10pt serif">| table oldtable<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldtable &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">table &larr; oldtable growto: (2 max: oldtable size/2).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ table size=oldtable size do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(oldtable size-table size) print.  user show: &rsquo; &rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldtable &larr; table.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">table &larr; oldtable growto: (2 max: oldtable size/2)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑table]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findorinsert: obj </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"insert if not found, "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findornil: obj.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦i=obj⇒[⇑i]  </span><span style="font: italic 10pt serif">"found it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self sparse⇒[objects◦i &larr; obj. ⇑i]  </span><span style="font: italic 10pt serif">"insert if room"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self growto: objects length*2.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"grow"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self findorinsert: obj </span><span style="font: italic 10pt serif">"and insert"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findornil: obj </span><span style="font: 10pt serif">| i loc</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"⇑index if found or available slot"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[loc &larr; obj hash\objects length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[loc &larr; [loc=objects length⇒[1] loc+1].</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦loc ≡ nil⇒ [⇑loc]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects◦loc = obj⇒ [⇑loc]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑1 </span><span style="font: italic 10pt serif">"table full - caller must check for hit"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: t1 </span><span style="font: 10pt serif">| t2 t3  "faster insert for growing"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t2 &larr; self class new init: t1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t1 &lt; objects length ⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t3 from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t2 insert: t3]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t3 from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t2 rawinsert: t3]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects &larr; t2 objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">objects </span><span style="font: 10pt serif">[⇑objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">objects&larr; objects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rawinsert: t1 </span><span style="font: 10pt serif">| t2 "assumes there </span><span style="font: bold 10pt serif">is</span><span style="font: 10pt serif"> room for the new one"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t2 &larr; self findornil: t1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects ◦ t2 &larr; t1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rehash </span><span style="font: 10pt serif">| i copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; HashSet new init: self size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> copy insert: objects◦i]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">objects &larr; copy objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sparse </span><span style="font: 10pt serif">| i n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"⇑true if (1 max: 1/4 of table) is nil"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; objects length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒[(n&larr;n-4)≤0⇒[⇑true]]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap: i with: j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪HashSet under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Dictionary"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Dictionary&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: HashSet<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;values&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Dictionaries are sets with associated values.  They are very handy but not terribly efficient.  Most of their work is done by HashSet.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyfrom: dict<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self objects &larr; dict objects copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">values &larr; dict values copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[values &larr; Vector new: size. super init: size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑values◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑values◦(self findorerror: name) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lookup: name </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; self find: name⇒ [⇑values◦x] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Inserting and Deleting</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clean </span><span style="font: 10pt serif">| name</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"release unreferenced entries"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ name from: self do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"slick, huh"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self◦name) refct = 1 ⇒ [self delete: name]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[name is: Vector⇒[super delete: name]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">values◦(self findorerror: name)&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super delete: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: name with: value<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self insert: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">values◦(self findorerror: name) &larr; value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertall: names</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"default value is nil"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self insertall: names with: (Vector new: names length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertall: names with: vals </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"insert many entries"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: names length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self insert: names◦i with: vals◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tally: name </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; self find: name⇒ [⇑values◦x&larr; values◦x+1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self insert: name with: 1. ⇑1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">with: names values: vals </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: names length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self insert: names◦i with: vals◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: size </span><span style="font: 10pt serif">| name copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; self class new init: size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy of the new size"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ name from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy insert: name with: self◦name]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rehash </span><span style="font: 10pt serif">| i copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; Dictionary new init: self size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> copy insert: objects◦i with: values◦i]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap: i with: j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[values swap: i with: j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">values </span><span style="font: 10pt serif">[⇑values]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Inversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInvertedVector </span><span style="font: 10pt serif">| s i v  </span><span style="font: italic 10pt serif">"in form ((value, object), ...)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (Vector new: objects length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; Vector new: 2. v◦1&larr;values◦i. v◦2&larr;objects◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s next &larr; v].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invert<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self invertto: (Dictionary new init: objects length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invert: obj </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: values length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[values◦i=obj⇒ [⇑objects◦i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invertto: dict </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dict insert: values◦i with: objects◦i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑dict]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Dictionary under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"MessageDict"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;MessageDict&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: HashSet<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;methods "&lt;Vector of Strings&gt; which are the compiled methods for each message"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">literals "&lt;Vector of Vectors&gt; which hold pointers to literals used in the methods"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">code "&lt;Vector of Strings&gt; which are the source text for each message"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">backpointers "&lt;Vector of Vectors&gt; which are the tables of text location vs pc for each message"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>MessageDicts hold the source code and compiled methods for each message to a class.  The source code is a packed paragraph (see Paragraph packIntoString).  The methods contain pointers to literals, and must be specially freed.  If a method is being executed during its redefinition, its release must be delayed (its literals gets held in CodeKeeper).  Finally, MessageDicts must be copied to be grown, so that current use is not disturbed.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyfrom: dict<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self objects &larr; dict objects copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">methods &larr; dict methods copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; dict code copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[methods &larr; Vector new: size.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; Vector new: size.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super init: size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Inserting and Deleting</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"recycle all code and literals pointed to"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: methods length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[methods◦i≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self freeMethod: methods◦i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self init]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: name </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findorerror: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self freeMethod: methods◦i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">methods◦i&larr; code◦i&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super delete: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: name method: m literals: l<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">code: c backpointers: b </span><span style="font: 10pt serif">| i copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self find: name⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"if name is already there"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self freeMethod: methods◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self holdLiterals: l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">methods◦i &larr; m. code◦i &larr; c]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"then insert it, and return self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">copy &larr; [self sparse⇒[self] <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self growto: methods length*2].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Otherwise, copy if necessary"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">copy objects◦(copy findornil: name) &larr; name.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"and insert"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑copy insert: name method: m literals: l<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">code: c backpointers: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">purge: sel </span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"demand purging invalidates checkpointing"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">code<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑code]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">code: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑code◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">code: name &larr; str<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑code◦(self findorerror: name) &larr; str]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invert: method </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: methods length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[methods◦i≡method⇒ [⇑objects◦i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">literals: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self literalsIn: methods◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">method: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑methods◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">methodorfalse: name </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self find: name⇒[⇑methods◦i] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">methods<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑methods]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Code aspect of Strings</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">freeLiterals: v </span><span style="font: 10pt serif">| m i t</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"lower refct of all literals"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v length=0⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; v nail.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; mem◦(m+i-1). v◦i &larr; nil. mem◦(m+i-1) &larr; t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">freeMethod: m </span><span style="font: 10pt serif">| v c i t</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"method pointed to by some vector (dict or keeper)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">and (upon entry) by m.  If any other owners, refct will be &gt;2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">*Expects Interpreter to nil args on callers stack*"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[m refct&gt;2⇒[MethodKeeper next&larr; m]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"keep it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v&larr; self literalsIn: m.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"free its literals"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v length=0⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; v nail.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"fasten seat belts"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: v length do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"lower refct of each literal"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; mem◦(c+i-1). v◦i &larr; nil. mem◦(c+i-1) &larr; t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">freeMethods </span><span style="font: 10pt serif">| v i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Free kept methods no longer used"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v&larr; MethodKeeper contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MethodKeeper&larr; (Vector new: 10) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self freeMethod: v◦i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">holdLiterals: v </span><span style="font: 10pt serif">| m i t</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"raise refct of all literals"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v≡nil⇒[] v length=0⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; v nail.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; v◦i. mem◦(m+i-1) &larr; ¬1. v◦i &larr; t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">holdMethods: v </span><span style="font: 10pt serif">| i </span><span style="font: italic 10pt serif">"a random insertion just to make it legal form"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self insert: i method: v◦i literals: nil code: nil backpointers: nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">literalsIn: method </span><span style="font: 10pt serif">| i v</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return the literal vector imbedded in this method"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[method≡nil⇒[⇑Vector new: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">method length&lt;8⇒[⇑Vector new: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">method◦2=41⇒[⇑Vector new: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; Vector new: method◦6-6/2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v◦i &larr; (method word: 3+i) asObject]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: size </span><span style="font: 10pt serif">| name copy i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; MessageDict new init: size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy of the new size"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ name from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findorerror: name.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">copy &larr; copy insert: name method: methods◦i<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">literals: [literals≡nil⇒[nil] literals◦i]  code: code◦i backpointers: nil]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap: i with: j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[methods swap: i with: j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code swap: i with: j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪MessageDict under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"SymbolTable"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;SymbolTable&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Dictionary<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I associate each of my objects with an object reference</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ref: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑super◦name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ref: name &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑super◦name &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(super◦name) value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allCallsOn: selector from: classNames </span><span style="font: 10pt serif">| className s w cl sel<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[selector is: Vector⇒ [] selector &larr; selector inVector].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ className from: classNames do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cl &larr; self◦className.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ sel from: selector do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[w &larr; cl whosends: sel. w length=0⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s append: className; append: &rsquo;⇒&rsquo;; append: w asString; cr]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allRefs  </span><span style="font: italic 10pt serif">"what methods reference my variables (I am probably &rsquo;Undeclared&rsquo;)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self allRefsTo: self contents from: user classNames]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allRefsTo: symbol from: classNames </span><span style="font: 10pt serif">| s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[symbol is: Vector⇒ [] symbol &larr; symbol inVector].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Smalltalk allCallsOn: (symbol transform⦂ s to⦂ (self ref: s)) from: classNames]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invert: obj </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: values length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nil≡(values◦i)⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">obj ≡ (values◦i) value ⇒[⇑objects◦i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invertRef: obj </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: values length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[obj≡(values◦i)⇒[⇑objects◦i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lookup: name </span><span style="font: 10pt serif">| r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r&larr;super lookup: name⇒[⇑r value] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lookupRef: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑super lookup: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Insertion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ name &larr; x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(super◦name) value &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">declare: name</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Take ref(s) and value(s) from Undeclared, if name(s) there"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self declare: name from: Undeclared]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">declare: name as: x </span><span style="font: 10pt serif">| a s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[name is: Vector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; x asStream. for⦂ a from: name do⦂ [self declare: a as: s next]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self declare: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦name &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">declare: name from: symTab </span><span style="font: 10pt serif">| a </span><span style="font: italic 10pt serif">"take name(s), ref(s) and value(s) from symTab"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[name is: Vector⇒ [for⦂ a from: name do⦂ [self declare: a from: symTab]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self has: name⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">symTab has: name⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[super insert: name with: (symTab ref: name).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">symTab delete: name]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self insert: name with: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">define: name as: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"synonym"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self declare: name as: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: name with: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[self has: name⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">super insert: name with: ObjectReference new].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦name &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: name withref: ref<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[super insert: name with: ref]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Growing and shrinking</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: size </span><span style="font: 10pt serif">| name copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; self class new init: size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy of the new size"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ name from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy insert: name withref: (self ref: name)]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rehash </span><span style="font: 10pt serif">| i copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[copy &larr; SymbolTable new init: self size.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create a copy"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: objects length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[objects◦i≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> copy insert: objects◦i withref: values◦i]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"hash each entry into it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪SymbolTable under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"SystemOrganizer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;SystemOrganizer&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: ClassOrganizer<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Provides an organization for the classes in the system just as ClassOrganizer organizes the messages within a class.  (In fact, the only difference is the filout/printing messages.)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filout and printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filoutAll </span><span style="font: 10pt serif">| cat<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ cat from: commentVector do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self filoutCategory: cat]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filoutCategory: cat </span><span style="font: 10pt serif">| all a [user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">all &larr; self superclassOrder: cat.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp1 file: (cat+&rsquo;.st.&rsquo;) asFileName) filoutclass: all.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a from: all do⦂ [(Smalltalk◦a) noChanges]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printAll </span><span style="font: 10pt serif">| cat<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ cat from: commentVector do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self printCategory: cat]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printCategory: cat </span><span style="font: 10pt serif">[user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp0 file: (cat+&rsquo;.press&rsquo;) asFileName) printoutclass: (self superclassOrder: cat)]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">superclassOrder: cat </span><span style="font: 10pt serif">| all lis a i c sup  "Arrange classes in superclass order so they can be filed in"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[lis&larr; (self category: cat) copy. all &larr; (Vector new: lis length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ lis length&gt;0 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i&larr; 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a&larr; lis◦i. sup&larr; c&larr; Smalltalk◦a.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ "Make sure it doesn&rsquo;t have an as yet unprinted superclass"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sup&larr; sup superclass.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sup≡nil⇒[true]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lis has: sup title unique]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sup≡nil]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [i&larr; i+1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">all next &larr; a.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lis&larr; lis delete: a].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑all contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪SystemOrganizer under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
