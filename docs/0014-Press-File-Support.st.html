<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Press-File-Support.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"ParagraphScanner"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ParagraphScanner&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;para "&lt;Paragraph&gt;"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">style "&lt;TextStyle&gt;"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">press "&lt;PressFile&gt; for output"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">runstrm "&lt;Stream&gt; of paragraph runs"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">textstrm "&lt;Stream&gt; of paragraph text"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">font "&lt;WidthTable&gt; current font"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">ascent "&lt;Integer&gt; max ascent"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">descent "&lt;Integer&gt; negative max descent"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">width "&lt;Integer&gt; total width"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">spaces "&lt;Integer&gt; number of spaces"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">rect "&lt;Rectangle&gt; for printing"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">tabpos "&lt;Stream&gt; (text position, new X position) of tabs"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Scans through a paragraph computing the dimensions of a partial line of text.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">in: rect</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ascent &larr; descent &larr; width &larr; spaces &larr; 0. tabpos reset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: para to: press style: style<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[textstrm &larr; &rsquo;&rsquo; asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runstrm &larr; para runs asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tabpos &larr; (Vector new: 10) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position </span><span style="font: 10pt serif">[⇑textstrm position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">width </span><span style="font: 10pt serif">[⇑width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Scanning</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">backup<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[textstrm skip: ¬1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scan </span><span style="font: italic 10pt serif">"Scan up to a zero-width character, back up to last blank if width exceeded"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| maxw sp char t<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Save state" spos slim srunpos sasc sdesc swidth ssp sfont stpos<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[textstrm end and⦂ self newrun≡false⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">maxw &larr; rect width.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ascent &larr; ascent max: font ascent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">descent &larr; descent max: font descent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sp &larr; font space.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; font scan: textstrm until: width exceeds: maxw.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(char &larr; t◦1) ≡ true⇒ [] width &larr; t◦2].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char = 040] do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">["Save state"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">spos &larr; textstrm position. slim &larr; textstrm limit.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">srunpos &larr; runstrm position. stpos &larr; tabpos position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sasc &larr; ascent. sdesc &larr; descent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">swidth &larr; width. ssp &larr; spaces. sfont &larr; font.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">spaces &larr; spaces+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">width &larr; width+sp].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(char≡true and⦂ nil≠spos) and⦂ (2*ascent ≤ rect height)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Back up to just past last blank (if another line fits)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">textstrm of: para text from: spos+1 to: slim.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">runstrm position &larr; srunpos. tabpos position &larr; stpos.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ascent &larr; sasc. descent &larr; sdesc.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">width &larr; swidth. spaces &larr; ssp. font &larr; sfont.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑040]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑char]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self newrun]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> do⦂ [].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[spaces &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tabpos next &larr; textstrm position;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next &larr; (width &larr; width + font tab | font tab)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printfrom: charpos aligned: align skip: n </span><span style="font: italic 10pt serif">"Returns false if goes below bottom"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| ybot a b ix iy px xs sp rs len tpos ts ntab rval ifont w ps [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">this code basically writes the EL (entity list) for a line</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"bottom of character -- ascent not really ascent but height"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(ybot &larr; rect corner y - ascent) &lt; rect origin y ⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">won&rsquo;t fit</span><span style="font: 10pt serif">" ⇑false]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; charpos + 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b &larr; textstrm position - n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a &gt; b ⇒ [</span><span style="font: italic 10pt serif">"No text"</span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ts &larr; tabpos viewer.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tpos &larr; ts next.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">px &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">xs &larr; rect width - width.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ix &larr; rect minX + ["</span><span style="font: italic 10pt serif">left margin offset</span><span style="font: 10pt serif">" align=2⇒ [xs/2]; =4⇒[xs] 0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">set baseline of character.  do setx before showchars</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">press sety: (iy &larr; ybot + descent).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sp &larr; font space "kludge?".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[align=1⇒ ["</span><span style="font: italic 10pt serif">do setspacex before showchars</span><span style="font: 10pt serif">"] press setspacex: sp].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rs &larr; (para run: a to: b) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (len &larr; rs next) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press selectfont: (press fontindex: (rval &larr; rs next) style: style) - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">b &larr; a+len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(rval land: 4) = 0⇒ ["no underlining"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"unfortunately, we must rescan this part of line to find out how wide it is"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ifont &larr; press codefont: rval style: style "a WidthTable".<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ps &larr; (para◦(a to: b-1)) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">w &larr; true, 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ w◦1 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">w &larr; ifont scan: ps until: w◦2 exceeds: rect width.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">w◦1 = 040⇒ [w◦2 &larr; w◦2 + ifont space];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=011⇒ [w◦2 &larr; w◦2 + ifont tab | ifont tab]].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[px⇒ ["use current x position"] press setx: ix].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"change y position to show rectangle, then change y back again"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press sety: iy-40; showrectwidth: w◦2 height: 30; sety: iy].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ntab &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (tpos and⦂ tpos&lt;b) do⦂ [</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Put out tabs"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tpos = a⇒ ["</span><span style="font: italic 10pt serif">no text between this tab and last</span><span style="font: 10pt serif">"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">put out accumulated tabs or initial x</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ntab&gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press skipchars: ntab; setx: px.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ntab &larr; 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">px⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press setx: (px &larr; ix)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press showchars: tpos-a].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ntab &larr; ntab+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">px &larr; ix + ts next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; tpos+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tpos &larr; ts next].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ntab&gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press skipchars: ntab;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setx: px]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">px⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press setx: (px &larr; ix)].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[align=1 and⦂ tpos≡false ⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Reset space width"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[spaces=0⇒ [] press setspacex: xs/spaces+sp].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">align &larr; 0]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rs end⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for more compactness, maybe</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press showchars: b-a skip: n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ybot]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press showchars: b-a.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; b]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n &gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">skip over ending blank or carriage return</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press skipchars: n]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ybot]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private scanning</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newrun </span><span style="font: 10pt serif">| len pos [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; runstrm next⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pos &larr; textstrm position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">textstrm of: para text from: pos+1 to: pos+len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">font &larr; press codefont: (runstrm next) style: style]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪ParagraphScanner under: &rsquo;Press File Support&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"PressFile"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;PressFile&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;DL "&lt;File&gt; stores data list"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">EL "&lt;Set&gt; accumulates entity list"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">parts "&lt;Set&gt; accumulates part directory"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">DLstart "&lt;Integer&gt; position of current entity in DL"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">ELstart "&lt;Integer&gt; word position of current entity in EL"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">Pstart "&lt;Integer&gt; record position of current page in DL"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">eorigin "&lt;Point&gt;"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">scale "&lt;Integer&gt; micas per Alto screen dot"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">boundbox "&lt;Rectangle&gt; bounding box for current page"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fontcodes "&lt;Vector&gt; of run codes corresponding to current fonts"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fontdefs "&lt;Vector of WidthTables&gt; corresponding to fontcodes"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">estate "&lt;Vector&gt; of some entity state"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">FL "&lt;Set&gt; accumulates strings for Ext. File part" &rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;prevstyle SMentity recordsize printers printerMenu &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>There are two levels of code in this class: the low-level Press commands and the high level user commands.  At the moment, only text, lines and bitmaps are supported (see Paragraph presson:in: and class ParagraphScanner for the former).  ignores bounding box stuff. limited reading.<br><br>see &lt;GR-DOCS&gt;PressFormat.Press and PressFormat-figure.Press for more details</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: DL </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL &larr; Set new string: 200.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FL &larr; Set new string: 40.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts &larr; Set new string: 40.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontcodes &larr; Vector new: 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontdefs &larr; Vector new: 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate &larr; Vector new: 3 "font, spacex, spacey, ...".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">prevstyle&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self scale: PressScale;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">startPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL readwriteshorten; reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self of: DL]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scale: scale</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">defaultPrinterName </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[currentProfile ≡ nil⇒ [PrinterName] currentProfile printerName]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name </span><span style="font: 10pt serif">[⇑DL name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scale </span><span style="font: 10pt serif">[⇑scale]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Entity/Page/File Commands</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">box: rect hue: hue sat: sat bright: bright containing⦂ expr | w r</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self entity: (self transrect: (w&larr; rect inset: ¬2)) containing⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ r from: (w minus: rect) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self showrect: r color: 0].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ColorPrint⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self hue: hue; saturation: sat;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">showrect: rect color: bright; brightness: 0]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">expr eval]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clip: boundingbox</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">| p i font [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL writing≡false⇒ [DL close]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self closePage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts≡false or⦂ parts empty⇒ []<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"if present, include the external file part  --- added Sept 80"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[FL empty⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self part⦂ [DL append: FL] code: 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FL reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self padpage].<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"put font names and descriptions into font directory (part)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self part⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: fontdefs length do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">font &larr; fontdefs ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword&larr; 16; nextword&larr; i-1;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next &larr; font min; next &larr; font max.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Bcpl: font name pad: 20.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL next &larr; font face; next &larr; font min;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; font pointsize; nextword&larr; 0]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">code: 1.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">write part directory. Pstart is current page position</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL append: parts asReadStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self padpage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; self recordnum.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">document directory</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword&larr; 27183; </span><span style="font: italic 10pt serif">"press password"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; p + 1 </span><span style="font: italic 10pt serif">"number of records"</span><span style="font: 10pt serif">;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; parts position / 8 </span><span style="font: italic 10pt serif">"number of parts"</span><span style="font: 10pt serif">;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; Pstart; </span><span style="font: italic 10pt serif">"part dir and length"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; p - Pstart;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; ¬1; "</span><span style="font: italic 10pt serif">backpointer to obsolete doc dir</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: user timewords; "2 time words"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; 1; </span><span style="font: italic 10pt serif">"first and last copies"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; 1;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword&larr; ¬1; </span><span style="font: italic 10pt serif">"first and last pages"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; ¬1;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; &rsquo;S&rsquo;◦1 "</span><span style="font: italic 10pt serif">solid color (looked at by color printers)</span><span style="font: 10pt serif">";<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next: 2*(0177-12) &larr; 0377.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; user now.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Bcpl: self name pad: 52;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Bcpl: [currentProfile≡nil⇒ [dp0 diskID◦1] currentProfile printedBy] pad: 32;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Bcpl: [((String new: 40) asStream) print: p◦1; space; print: p◦2; contents] pad: 40;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">padpage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts reset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entity: box containing⦂ expr </span><span style="font: 10pt serif">| v [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self startEntity.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">boundbox &larr; box.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; expr eval.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self closeEntity.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entityorigin: eorigin</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">page </span><span style="font: 10pt serif">[self closePage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pictureinit </span><span style="font: 10pt serif">[self pictureinit: user screenrect scale: PressScale]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pictureinit: rect scale: scale<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[boundbox &larr; boundbox include: (self transrect: rect).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self somefont]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">screenout: rect scale: scale<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"puts a bit map image onto the PressFile.  The standard<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">scaling is 32 micas per Alto dot.  22 looks better, Dover only<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">works with 32"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self somefont; setp: (self transrect: rect) origin; bitmap: rect bits: false; close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectPrinter </span><span style="font: 10pt serif">[⇑self selectPrinter: self defaultPrinterName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectPrinter: oldName </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr; show: &rsquo;select a printer (currently &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">show: [oldName≡false or⦂ oldName empty⇒ [&rsquo;none&rsquo;] oldName]; show: &rsquo;)&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cursorloc &larr; user screenrect center; restoredisplay.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ t = 0 do⦂ [t &larr; printerMenu wbug].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[t ≤ printers length⇒ [printers◦t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t = (printers length+1)⇒ ["same" oldName] "none" false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">toPrinter </span><span style="font: 10pt serif">[self toPrinter: self defaultPrinterName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">toPrinter: ndest </span><span style="font: 10pt serif">"a printer name" | psocket dest np t perr [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ndest ≡ false⇒ ["don&rsquo;t try to print" ⇑false]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">E ≡ nil⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"use O.S. if Smalltalk ethercode not alive"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; (String new: 100) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t append: &rsquo;Empress. &rsquo;; append: self name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ndest length &gt; 0⇒ [t space; append: ndest; append: &rsquo;/H&rsquo;]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t append: &rsquo;; Resume.~ Small.Boot&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user quitThen: t asReadStream]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dest &larr; &rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">perr &larr; psocket &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">np &larr; printers length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL readonly.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ndest do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">perr or⦂ ndest empty⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">perr &larr; false.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ndest &larr; self selectPrinter: dest]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dest = ndest⇒ ["to same printer"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dest &larr; ndest.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"close previous socket"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">psocket⇒ [psocket close. psocket &larr; false]].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[psocket⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"create new socket"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">psocket &larr; EFTPSender new hostName: dest⇒ [psocket wakeup]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr; show: &rsquo;name lookup failure&rsquo;].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"send file"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">psocket and⦂ (user displayoffwhile⦂ [psocket send: DL reset])⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"success--stop" ndest &larr; false]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"failure--switch servers?"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">perr &larr; true].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"cleanup after success or abort"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">psocket⇒ [psocket close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Fonts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">codefont: code style: style<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑fontdefs◦(self fontindex: code style: style)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fontindex: code style: style </span><span style="font: 10pt serif">| ix font n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"return index if in font dictionary"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; code land: 0363.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Remove underline and strikeout"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[style=prevstyle⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(ix &larr; fontcodes find: code) &gt; 0 ⇒ [⇑ix]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontcodes all&larr; nil. "invalid across style change"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">prevstyle&larr; style].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; code / 16 + 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">font &larr; (WidthTable new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">named: (style fontfamily: n)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pointsize: (style fontsize: n)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">face: (code / 2 land: 1) + (code * 2 land: 2))<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> lookup.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(ix&larr; fontdefs find: font)&gt;0⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[fontcodes◦ix&larr; code. ⇑ix]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"add entry to font dictionary"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontdefs length=16⇒[user notify: &rsquo;too many fonts&rsquo;. ⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontcodes &larr; fontcodes, code.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fontdefs &larr; fontdefs, font.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑fontcodes length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectfont: f </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦1 = f⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0160 + (estate◦1 &larr; f)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">somefont</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"fool self into writing non-empty fontdir"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self fontindex: 5*16 style: DefaultTextStyle]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Transformations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">transpt: p<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ Point new x: (p x * scale) asInteger y: (25400 - (p y * scale)) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">transrect: rect<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ Rectangle new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">origin: (self transpt: rect minX ⌾ rect maxY)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">corner: (self transpt: rect maxX ⌾ rect minY)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>EL commands</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">brightness: b </span><span style="font: 10pt serif">[EL next&larr; 0370; next&larr; b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hue: b </span><span style="font: 10pt serif">[EL next&larr; 0371; next&larr; b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">onlyoncopy: n </span><span style="font: 10pt serif">[EL next &larr; 0355; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">resetspace </span><span style="font: 10pt serif">[EL next &larr; 0366]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">saturation: s </span><span style="font: 10pt serif">[EL next&larr; 0372; next&larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setp: p </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self setx: p x; sety: p y"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0356; nextword &larr; p x;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next &larr; 0357; nextword &larr; p y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setspacex: x </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦2 = x⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦2 &larr; x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x ≥ 0 and⦂ x ≤ 2047⇒ ["</span><span style="font: italic 10pt serif">short form</span><span style="font: 10pt serif">" EL nextword &larr; 060000 + x]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0364; nextword &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setspacey: y </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦3 = y⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦3 &larr; y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">y ≥ 0 and⦂ y ≤ 2047⇒ ["</span><span style="font: italic 10pt serif">short form</span><span style="font: 10pt serif">" EL nextword &larr; 064000 + y]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0365; nextword &larr; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setx: x </span><span style="font: 10pt serif">[EL next &larr; 0356; nextword &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sety: y </span><span style="font: 10pt serif">[EL next &larr; 0357; nextword &larr; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showchar: char </span><span style="font: 10pt serif">["immediate" EL next &larr; 0363; next &larr; char]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showchars: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=0⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n ≥ 1 and⦂ n ≤ 32⇒ ["</span><span style="font: italic 10pt serif">short form</span><span style="font: 10pt serif">" EL next &larr; n-1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0360; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showchars: n skip: t </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=1 and⦂ (n ≥ 1 and⦂ n ≤ 32)⇒ [EL next &larr; 0100 + n-1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self showchars: n; skipchars: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showdots: nwords </span><span style="font: 10pt serif">[EL next &larr; 0374; nextNumber: 4 &larr; nwords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showdotsopaque: nwords </span><span style="font: 10pt serif">[EL next &larr; 0375; nextNumber: 4 &larr; nwords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showrect: rect </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setp: rect origin.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0376;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; rect width;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; rect height]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showrect: rect color: c </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ColorPrint⇒ [self brightness: c]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self showrect: (self transrect: rect)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showrectwidth: w height: h </span><span style="font: 10pt serif">[EL next &larr; 0376; nextword &larr; w; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipchars: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=0⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n ≥ 1 and⦂ n ≤ 32⇒ ["</span><span style="font: italic 10pt serif">short form</span><span style="font: 10pt serif">" EL next  &larr; 040 + n-1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0361; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipcontrol: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"immediate"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0353; next &larr; n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"now put n bytes in EL"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipcontrol: n type: t </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"n bytes have been put in DL"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0362; nextword &larr; n; next &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space </span><span style="font: 10pt serif">[EL next &larr; 0367]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Bitmaps/Dots</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">AIS: file width: w height: h croprect: r at: pt scale: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self setp: (self transpt: pt); dots⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self setcoding: 8 "byte samples" dots: w lines: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setmode: 3 "to right and to bottom of page";<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setsizewidth: (s*r width*scale) asInteger height: (s*r height*scale) asInteger;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setwindowwidth: r width height: r height skipdots: r minX skiplines: r minY;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dotsfromAIS: file]]<br>"<br>(dp0 pressfile: &rsquo;pix.press&rsquo;) somefont; AIS: &rsquo;girl.ais&rsquo; width: 512 height: 512 croprect: (50⌾50 rect: 500⌾500) at: 36⌾80 scale: 0.65; close.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bitmap: rect bits: bits </span><span style="font: 10pt serif">| w w16 h</span><span style="font: italic 10pt serif"> </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">some pecularities of spruce:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">scale must be 32, and multiples of 16 for width (maybe extra stuff prints)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">w &larr; rect width.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">w16 &larr; w + 15 | 16 "</span><span style="font: italic 10pt serif">width to next word boundary</span><span style="font: 10pt serif">".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h &larr; rect height.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">origin should be set earlier</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self dots⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setcoding: 0 "</span><span style="font: italic 10pt serif">bitmap</span><span style="font: 10pt serif">" dots: w16 lines: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setmode: 3 "</span><span style="font: italic 10pt serif">to right and to bottom of page</span><span style="font: 10pt serif">";<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setsizewidth: scale * w16 height: scale * h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setwindowwidth: [ColorPrint⇒ [w] w16] height: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dotsfollow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">bits⇒["</span><span style="font: italic 10pt serif">bits supplied</span><span style="font: 10pt serif">" DL append: bits]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">else from screen</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect bitsOntoStream: DL]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dots⦂ exp </span><span style="font: 10pt serif">| dlpos [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dlpos &larr; self padword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp eval.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self showdots: DL wordposition - dlpos]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dotsfollow </span><span style="font: 10pt serif">[DL nextword &larr; 3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dotsfromAIS: file </span><span style="font: 10pt serif">| f<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f&larr;file length inString+file+[file length even⇒[&rsquo; &rsquo;]&rsquo;&rsquo;]. "BCPLize"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword &larr; 4; nextword &larr; 4; append: f. FL append: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setcoding: c dots: d lines: l </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL next &larr; 1; next &larr; c;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; d; nextword &larr; l]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setmode: m </span><span style="font: 10pt serif">[DL next &larr; 2; next &larr; m]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setsizewidth: w height: h </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword &larr; 2; nextword &larr; w; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setwindowwidth: w height: h </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setwindowwidth: w height: h skipdots: 0 skiplines: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setwindowwidth: w height: h skipdots: sd skiplines: sl<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[DL nextword &larr; 1;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; sd; nextword &larr; w;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; sl; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Lines/Objects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">drawcurve: v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v length ≠ 12⇒ [user notify: &rsquo;illegal drawcurve&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword &larr; 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ v from: v do⦂ [DL nextword &larr; v]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">drawdiscat: pt radius: radius | dx dy i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[radius ≤ 16 ⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> dx &larr; ↪(5 4 3 1 ¬1 ¬3 ¬4 ¬5 ¬5 ¬4 ¬3 ¬1 1 3 4 5).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> dy &larr; ↪(1 3 4 5 5 4 3 1 ¬1 ¬3 ¬4 ¬5 ¬5 ¬4 ¬3 ¬1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self showobject⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self moveto: pt + ((dx◦16*radius/5) ⌾ (dy◦16*radius/5)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 16 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self drawto: pt + ((dx◦i*radius/5) ⌾ (dy◦i*radius/5))]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">drawlinefrom: p1 to: p2 width: width | d length t1 t2<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(d &larr; p2-p1) = (0⌾0) ⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d x&larr; d x asFloat. d y&larr; d y asFloat. width &larr; width asFloat.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">length &larr; ((d x*d x)+(d y*d y)) sqrt.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d x&larr; (d x*width/length) asInteger.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d y&larr; (d y*width/length) asInteger.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t1 &larr; d y ⌾ (0 - d x).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t2 &larr; 0 - d y ⌾ d x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self showobject⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self moveto: p1 + t1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self drawto: p2 + t1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self drawto:  p2 + t2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self drawto:  p1 + t2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self drawto:  p1 + t1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self drawdiscat: p2 radius: width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">drawlinefromscreen: p1 to: p2 width: width<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self drawlinefrom: (self transpt: p1) to: (self transpt: p2) width: (width*scale)] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">drawto: p </span><span style="font: 10pt serif">[DL nextword &larr; 1; nextPoint &larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">moveto: p </span><span style="font: 10pt serif">[DL nextword &larr; 0; nextPoint &larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">object⦂ expr atScreen: p <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self showobject⦂ [self objectGotoScreen: p pen: 0. expr eval]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">objectGotoScreen: p pen: pen </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword&larr; pen; nextPoint &larr; (self transpt: p)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showobject⦂ exp </span><span style="font: 10pt serif">| p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; self padword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"expression containing moveto, drawto, drawcurve"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp eval.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; 0373; nextword &larr; DL wordposition - p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">append: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑DL append: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Bcpl: s pad: n </span><span style="font: 10pt serif">| slen [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">write a Bcpl string and padding to fill n bytes (used by close)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">slen &larr; s length min: n-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL next &larr; slen; append: s◦(1 to: slen); next: n-(slen+1) &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">| a p ["PressFile classInit."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk declare: ↪PressScale as: 32.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">recordsize &larr; 512.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SMentity &larr; 5.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; (String new: 250) asStream.<br>"from [Maxc1]&lt;Altodocs&gt;NetTopology.Press, October 1980. in order of net number"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">printers &larr; ↪(<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"net #"</span><span class="tab" val="79"></span><span style="font: 10pt serif">"printer names"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" 1"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Navajo&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"HENRIETTA"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" 3"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Menlo&rsquo; &rsquo;Clover&rsquo; &rsquo;Lilac&rsquo; "PARC: BLDG 35, FLOOR 2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" 5"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Kanji&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"PARC:  BLDG 34"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" 6"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Wonder&rsquo; &rsquo;Quake&rsquo;</span><span class="tab" val="79"></span><span style="font: 10pt serif">"PARC: BLDG 35, FLOOR 1&3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"10"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Puff&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"A&E"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"12"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;White&rsquo; &rsquo;Colorado&rsquo;</span><span class="tab" val="79"></span><span style="font: 10pt serif">"PASADENA"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"14"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Niagara&rsquo; &rsquo;Tioga&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"WEBSTER"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"20"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Yoda&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"PARC: BLDG 32"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"21"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Lily&rsquo; </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"SPG"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"23"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Ranger&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"DALLAS"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"26"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Windfall&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"DC"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"27"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Genesee&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"WEBSTER"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"33"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Amarok&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"TORONTO"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"34"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Yankee&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"STAMFORD"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"36"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Cyclops&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"LEESBURG"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"54"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Rover&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"A&E"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"55"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;SPGEng&rsquo; &rsquo;Emperor&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"A&E"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"56"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Thud&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"A&E"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"60"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Adelie&rsquo; &rsquo;Daisy&rsquo; &rsquo;RockHopper&rsquo; </span><span class="tab" val="79"></span><span style="font: 10pt serif">"BAYHILL"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"62"</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;Bud&rsquo;</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"?"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ p from: printers do⦂ [a append: p; cr].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a append: &rsquo;same printer&rsquo;; cr; append: &rsquo;no printer&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">printerMenu &larr; Menu new string: a contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closeEntity </span><span style="font: 10pt serif">[self closeEntity: SMentity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closeEntity: etype </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL wordposition = ELstart⇒ []<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Put a trailer into the EL"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL</span><span class="tab" val="79"></span><span style="font: 10pt serif">padNext &larr; 0377;</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"word-pad EL with &lt;Nop&gt;"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next &larr; etype;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next&larr; 0; </span><span style="font: italic 10pt serif">"fontset"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"dlstart relative to DL location in file"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextNumber: 4 &larr; DLstart - (Pstart*recordsize);<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextNumber: 4 &larr; DL position - DLstart;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPoint&larr; eorigin; </span><span style="font: italic 10pt serif">"entity origin"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPoint&larr; boundbox origin;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextPoint&larr; boundbox extent.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL nextword &larr; EL wordposition - ELstart + 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self startEntity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closePage </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self closeEntity.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL empty⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL</span><span class="tab" val="79"></span><span style="font: 10pt serif">padNext &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: EL asReadStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self part: 0 start: Pstart]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">data </span><span style="font: 10pt serif">["slightly dangerous" ⇑DL]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">padpage </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">words of padding to end of page</span><span style="font: 10pt serif">" ⇑(DL pad: recordsize with: 0) / 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">padword </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"make object (lines or dots) start on word boundary"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[DL padNext &larr; 0⇒ [self skipchars: 1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑DL wordposition]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">part⦂ exp code: c </span><span style="font: 10pt serif">| fp [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self closePage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fp &larr; self recordnum.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp eval.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self part: c start: fp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">part: type start: start </span><span style="font: 10pt serif">| padding</span><span style="font: bold 10pt serif"> </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">padding &larr; self padpage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts nextword &larr; type;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; start;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; self recordnum - start;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; padding.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self startPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recordnum </span><span style="font: 10pt serif">[⇑DL positionSize: recordsize]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipcode: code data: s </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">called by </span><span style="font: bold 10pt serif">hidePress:complete:</span><span style="font: italic 10pt serif">. s is a String</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; s length+1) &lt; 256⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">immediate, in EL</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self skipcontrol: t.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; code; append: s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">in DL</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL next &larr; code; append: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self skipcontrol: t type: SMentity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">startEntity </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DLstart &larr; DL position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ELstart &larr; EL wordposition.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">boundbox &larr; 0 asRectangle.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">eorigin &larr; 0⌾0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate all &larr; ¬1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate◦1 &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">startPage </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Pstart &larr; self recordnum.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self startEntity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filin </span><span style="font: 10pt serif">| p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self open.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (p &larr; self nextParagraph) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">FilinSource &larr; self.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user print: nilⓢ p text; space].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FilinSource &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextControl </span><span style="font: 10pt serif">| command t entity [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return the next skip-control information</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ true do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(estate and⦂ command)≡false⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">either or both false. get next entity</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; EL next⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate &larr; EL next viewer. command &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t◦1 ≠ SMentity⇒ ["ignore this entity" estate &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DLstart &larr; (t◦(3 to: 6)) asStream nextNumber: 4.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL position &larr; Pstart*recordsize + DLstart]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">no more entities on current part (page)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readPart⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">no more pages</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">entity &larr; estate.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (command &larr; entity next) do⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">some stuff arranged by probable frequency</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0100⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">show-characters-short</span><span style="font: 10pt serif"> (0-037)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">skip-characters-short</span><span style="font: 10pt serif"> (040-077)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL skip: (command land: 037) +1];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0356⇒ ["</span><span style="font: bold 10pt serif">set-x"</span><span style="font: 10pt serif"> entity nextword];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0357⇒ ["</span><span style="font: bold 10pt serif">set-y</span><span style="font: 10pt serif">" entity nextword];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0140⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">show-characters-and-skip</span><span style="font: 10pt serif"> (0100-0137)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL skip: (command land: 037) +2];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0160⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">set-space-x-short</span><span style="font: 10pt serif"> (0140-0147)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">set-space-y-short</span><span style="font: 10pt serif">  (0150-0157)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"(command land: 7)*256 +" entity next];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0200⇒ ["</span><span style="font: bold 10pt serif">font</span><span style="font: 10pt serif">" "command land: 017"];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0362⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">skip-control-bytes</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; entity nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">entity next≠SMentity⇒ ["ignore" DL skip: t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑DL next: t];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0360⇒ ["</span><span style="font: bold 10pt serif">show-characters</span><span style="font: 10pt serif">" DL skip: entity next];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0377⇒ ["</span><span style="font: bold 10pt serif">nop</span><span style="font: 10pt serif">"];<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0353⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">available</span><span style="font: 10pt serif"> (0200-0237)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">spare</span><span style="font: 10pt serif"> (0240-0352)"];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0353⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">skip-control-bytes-immediate</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑entity next: entity next];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0354⇒ ["</span><span style="font: bold 10pt serif">alternative</span><span style="font: 10pt serif">" entity skipwords: 5];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0355⇒ ["</span><span style="font: bold 10pt serif">only-on-copy</span><span style="font: 10pt serif">" entity next];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0361⇒ ["</span><span style="font: bold 10pt serif">skip characters</span><span style="font: 10pt serif">" DL skip: entity next];<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0363⇒ ["</span><span style="font: bold 10pt serif">show-character-immediate</span><span style="font: 10pt serif">" entity next];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0366⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">set-space-x</span><span style="font: 10pt serif"> (0364)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">set-space-y</span><span style="font: 10pt serif"> (0365)" entity nextword];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0370⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">reset-space</span><span style="font: 10pt serif"> (0366)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">space</span><span style="font: 10pt serif"> (0367)" ];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0373⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">set-brightness</span><span style="font: 10pt serif"> (0370)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">set-hue</span><span style="font: 10pt serif"> (0371)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">set-saturation</span><span style="font: 10pt serif"> (0372)" entity next];<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0373⇒ ["</span><span style="font: bold 10pt serif">show-object</span><span style="font: 10pt serif">" DL skipwords: entity nextword];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt; 0376⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: bold 10pt serif">show-dots</span><span style="font: 10pt serif"> (0374)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">show-dots-opaque</span><span style="font: 10pt serif"> (0375)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL skipwords: (entity nextNumber: 4)];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0376⇒ ["</span><span style="font: bold 10pt serif">show-rectangle</span><span style="font: 10pt serif">" entity skipwords: 2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextParagraph </span><span style="font: 10pt serif">| s p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self nextControl⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; s asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; Paragraph new.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s next = p pressCode⇒ [⇑p fromPress: self value: s]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read the parts (and font directory?)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL readonly; "reopen?" settoend; skip: 0 - recordsize.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL nextword = 27183 and⦂ DL nextword = (self recordnum + 1)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; DL nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL position: DL nextword size: recordsize.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts &larr; (DL next: t*8) viewer.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readPart]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;not a press file&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readPart </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read parts until we find a printed page or end</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (t &larr; parts nextword) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Pstart &larr; parts nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t ≠ 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">not a printed page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">parts skip: 4.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t&gt; 0⇒ ["font or other part"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">a non-standard part. let document (estate?) interpret</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"DL position &larr; Pstart*recordsize.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">estate fromPress: self name: t value: DL"]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">go to end of last record of entity list, ignoring padding</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; parts nextword "</span><span style="font: italic 10pt serif">length</span><span style="font: 10pt serif">".<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL position &larr; Pstart+t * recordsize - ((1 + parts nextword) * 2).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL &larr; Set new vector: 50.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">scan backwards for beginning of entity list, reading entities</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (t &larr; DL nextword) &gt; 0 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &lt; 12⇒ [user notify: &rsquo;illegal entity&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL skipwords: 0-t.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read entity and trailer (last 12 words of entity)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; DL next: t-12 *2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">EL next &larr; DL next: 24.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">DL skipwords: ¬1 - t].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">now reverse:  trailer, entity (1st), ... (last)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑EL &larr; (EL asArray◦(EL length to: 1 by: ¬1)) asStream]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪PressFile under: &rsquo;Press File Support&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">PressFile classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"WidthTable"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;WidthTable&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;name "&lt;String&gt; name of font family"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">pointsize "&lt;Integer&gt; size in points"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">face "&lt;Integer&gt; Press face code"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">min "&lt;Integer&gt; min character code in font"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">max "&lt;integer&gt; max character code in font"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">"Ascent, descent, and width are in micas"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">ascent "&lt;Integer&gt; max ascent of characters in font"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">descent "&lt;Integer&gt; NEGATIVE max descent of characters in font"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">widths "&lt;Vector of Integers&gt; widths of characters"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;tab WidthDict &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Holds font parameters and width table for a Press font.  It knows how to load itself from FONTS.WIDTHS.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[WidthDict &larr; Dictionary init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tab &larr; 500]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lookup </span><span style="font: 10pt serif">| key font i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">key &larr; name + pointsize asString + (↪(&rsquo;&rsquo; &rsquo;I&rsquo; &rsquo;B&rsquo; &rsquo;BI&rsquo;)◦(face+1)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">font &larr; WidthDict lookup: key⇒ [⇑font]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fontfrom: (dp0 oldFile: &rsquo;Fonts.Widths&rsquo;) readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: ↪(011 015 040) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i ≥ min and⦂ i ≤ max ⇒ [widths◦(i-min+1) &larr; 0]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">WidthDict insert: key with: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">named: name pointsize: pointsize face: face</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ascent </span><span style="font: 10pt serif">[⇑ascent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">descent </span><span style="font: 10pt serif">[⇑descent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">face </span><span style="font: 10pt serif">[⇑face]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">max </span><span style="font: 10pt serif">[⇑max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">min </span><span style="font: 10pt serif">[⇑min]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name </span><span style="font: 10pt serif">[⇑name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pointsize </span><span style="font: 10pt serif">[⇑pointsize]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scan: strm until: width exceeds: maxw </span><span style="font: 10pt serif">| char w [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (char &larr; strm next) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char &lt; min ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char=040 or⦂ (char=015 or⦂ char=011) ⇒ [⇑char, width]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;char too low&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char &gt; max ⇒ [user notify: &rsquo;char too high&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(w &larr; widths◦(char+1-min)) = 0 ⇒ [⇑char, width]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(width &larr; width + w) &gt; maxw ⇒ [⇑true, width]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false, width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space </span><span style="font: 10pt serif">[⇑150]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab </span><span style="font: 10pt serif">[⇑tab]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab &larr; t </span><span style="font: 10pt serif">[tab &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading FONTS.WIDTHS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findfield: n on: file </span><span style="font: 10pt serif">| IXH [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">IXH &larr; file nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(IXH bits: (0 to: 3)) "type"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0 ⇒ [user notify: &rsquo;field not found&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">≠ n]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[file skipwords: (IXH land: 07777 "length") - 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fontfrom: file </span><span style="font: 10pt serif">| i code fam fmin fmax start len found w scale<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"find code for font family"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file reset. fam &larr; &rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (fam = name) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self findfield: 1 on: file.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; file nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fam &larr; file next: (len &larr; file next).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">file skip: 19 - len].<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"now search for proper face"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">found &larr; false.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Convert from points to micas"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">scale &larr; (pointsize asFloat * 2540 / 72) asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ found do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self findfield: 4 on: file.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">found &larr; [file next = code].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[file next ≠ face ⇒ [found &larr; false]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fmin &larr; file next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fmax &larr; file next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; file nextword. [i ≠ scale and: i ≠ 0 ⇒ [found &larr; false]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">file skip: 4. start &larr; file nextword. file skip: 4].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">scale &larr; [i ≠ 0 ⇒ [1 </span><span style="font: italic 10pt serif">"don&rsquo;t need to scale"</span><span style="font: 10pt serif">] pointsize asFloat * 254 / 7200].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">min &larr; fmin. max &larr; fmax.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"get bb and x-tables"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file wordposition&larr; start+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">descent &larr; 0 - (scale * file nextword) asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file nextword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ascent &larr; (scale * file nextword) asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file nextword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">widths &larr; Vector new: (max 