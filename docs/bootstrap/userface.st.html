<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>/Users/swhite/st76-bootstrap/userface.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">TERMINAL I/O</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Class new title: &rsquo;UserView&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;screenrect </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Rectangle&gt; current screen size</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">vtab </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer=0mod2&gt; offset from hardware top</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">htab </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer=0mod16&gt; offset from hardware left</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">scale </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer=1 or 2&gt; 2 means double bits mode</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">color </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer=0 or 1&gt; 1 means reverse field</span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">screenfile </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;File&gt; for saving current bitmap</span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">disp </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Dispframe&gt; default message stream</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">sched </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;PriorityScheduler&gt; tasks for this view</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">&rsquo;<br></span><span style="font: 10pt greek"><br>↪</span><span style="font: italic 10pt serif">screen overlays</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">install</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user close.  self reconfigure.  user &larr; self open]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">reconfigure</span><span style="font: 10pt greek"> [] primitive: 62&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">tell OOZE and others</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">close</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[screenfile open.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">write out the old bitmap</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">screenfile write: screenrect height*(screenrect width+15/16)/256<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">from:   mem◦066.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">screenfile close]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">open</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[screenfile open.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">read in the new bitmap</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">screenfile read: screenrect height*(screenrect width+15/16)/256<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">to:   mem◦066.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">screenfile close]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">terminal interaction</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">kbd</span><span style="font: 10pt greek"> [!kbMap◦self rawkbd]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">kbck</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self rawkbck?[!kbMap◦self rawkbck] !false ]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">rawkbd</span><span style="font: 10pt greek"> [] primitive: 63&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">rawkbck</span><span style="font: 10pt greek"> [] primitive: 64&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">buttons</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!7-(mem◦0177030 land: 7)]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">redbug</span><span style="font: 10pt greek"> [!self buttons=4]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">yellowbug</span><span style="font: 10pt greek"> [!self buttons=1]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bluebug</span><span style="font: 10pt greek"> [!self buttons=2]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">anybug</span><span style="font: 10pt greek"> [!self buttons&gt;0]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">keyset</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!037-((mem◦0177030 lshift: ¬3) land: 37)]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">mp</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: mem◦0424-htab y: mem◦0425-vtab]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">cursorloc</span><span style="font: 10pt greek"> &larr; pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[mem◦0426 &larr; pt x+htab. mem◦0427 &larr; pt y+vtab]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">display control</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">loadcursorbitsfrom:</span><span style="font: 10pt greek"> bitstr | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: 16 do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[mem◦(0430+i) &larr; bitstr word: i]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">displayoffwhile⦂</span><span style="font: 10pt greek"> expr | t v<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; mem◦067. mem◦067 &larr; 60.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">v &larr; expr eval. mem◦067 &larr; t. !v]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">restoredisplay</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[mem◦067 &larr; screenrect height/2]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">screenextent:</span><span style="font: 10pt greek"> extent </span><span style="font: 10pt greek; text-decoration: underline">tab:</span><span style="font: 10pt greek"> tab<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[mem◦065 &larr; (0400*(tab x/16))+(extent x/16|2).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">mem◦067 &larr; extent y/2. mem◦063 &larr; tab y/2.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">htab &larr; tab x|16. vtab &larr; tab y|2.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">screenrect &larr; 0@0 rect: (extent x|32)@(extent y|2).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self reconfigure]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">system messages</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ev</span><span style="font: 10pt greek"> [disp ev]&rsquo;<br>UserView understands: &rsquo;request: s [!disp request: s]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">show:</span><span style="font: 10pt greek"> str<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[disp append: str; show]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">cr</span><span style="font: 10pt greek"> [disp </span><span style="font: 10pt greek; text-decoration: underline">cr</span><span style="font: 10pt greek">]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">clearshow:</span><span style="font: 10pt greek"> str<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[disp clear; append: str; show]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">notify:</span><span style="font: 10pt greek"> str<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self restoredisplay. disp append: str; cr; show.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">disp append: thisContext sender trace; show.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">thisContext sender debug. self restart]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">restart</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self restart⦂ [disp ev]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">restart⦂</span><span style="font: 10pt greek"> code<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[code sender &larr; nil.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">thisContext sender &larr; nil.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">release caller chain</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">CodeKeeper &larr; (Vector new: 10) asStream.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">release held code</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">disp cr; append: &rsquo;&rsquo; ** restart&rsquo;&rsquo;; show.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ true do⦂ [code eval]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">screenrect</span><span style="font: 10pt greek"> [!screenrect]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">window scheduling</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">schedule:</span><span style="font: 10pt greek"> window<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[sched≡nil?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[(sched &larr; Vector new: 1)◦1 &larr; window]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">sched &larr; sched , window]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">unschedule:</span><span style="font: 10pt greek"> window<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[0&lt;(t&larr; sched find: window)?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[sched &larr; sched◦(1 to: t-1) concat: sched◦(t+1 to: sched length)]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">sched</span><span style="font: 10pt greek"> [!sched]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">run</span><span style="font: 10pt greek"> | s<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[while⦂ (screenrect has: user mp) do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ s from: sched do⦂ [s startup]]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: &rsquo;&rsquo;a UserView&rsquo;&rsquo;]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">OOZE save/load</span><span style="font: 10pt greek">↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">OutLd</span><span style="font: 10pt greek"> [] primitive: 85&rsquo;<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪returns true from call; false from OS resume↪<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">InLd:</span><span style="font: 10pt greek"> fileid<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;file problem&rsquo;&rsquo;] primitive: 86&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">overlay:</span><span style="font: 10pt greek"> fileid<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self OutLd?[self InLd: fileid]]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">quit</span><span style="font: 10pt greek"> | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; Vector new: 5; all &larr; 0.  self overlay: t]&rsquo;<br>UserView understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">Swat</span><span style="font: 10pt greek"> [] primitive: 90&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek"><br>↪</span><span style="font: bold 12pt serif">PARAGRAPH EDITOR</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: 10pt greek">Smalltalk define "Peditorstuff as "Peditorstuff &larr; SymbolTable new.<br>Peditorstuff insertall: "(bs del esc doit paste typing editmenu<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">Scrap Deletion ctlchars runvals p1 p2 selon oldpara oldheight)<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">with: "(010 0177 033 036 02 typing editmenu<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">Scrap Deletion ctlchars runvals p1 p2 selon oldpara oldheight).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ParagraphEditor&rsquo;;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">subclassof: Textframe;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">fields: &rsquo;loc1 loc2&rsquo;;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">sharing: &rsquo;Peditorstuff&rsquo;<br></span><span style="font: 10pt greek">ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">enter:</span><span style="font: 10pt greek"> window<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame &larr; window inset: 4 @ 2 and: 2 @ 2.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">oldpara &larr; oldheight &larr; false. self show]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">leave</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self comp: p1 to: p2]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">kbd:</span><span style="font: 10pt greek"> boss | more char<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[more &larr; Stream default.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">while⦂ user kbck do⦂<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(char &larr; user kbd)=del? []<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">char=bs? [more empty?[loc1 &larr; 1 max: loc1-1].</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪backspace↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">more skip: ¬1]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">more next&larr; char].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">self replace: more contents]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">redbug:</span><span style="font: 10pt greek"> boss | a t drag2<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[t &larr; self charnearpt: user mp.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">t=loc1 and: loc1=loc2 ? [self selectword]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ double-bug ↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[loc1=t?[drag2 &larr; false]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">drag2 &larr; true. loc2=t?[]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ pick up old selection ↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self comp: p1 to: p2. loc1 &larr; loc2 &larr; t.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ start new selection ↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">p2 &larr; 1@0 + (p1 &larr; reply1).<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self comp: p1 to: p2].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">while⦂ user redbug do⦂</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ draw out selection ↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[a &larr; reply1.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[loc1=loc2?[drag2 &larr; t≥loc2]].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[drag2? [ [t&lt;loc1?[t&larr;loc1. a&larr;self ptofchar: t]].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self comp: a to: p2. loc2 &larr; t. p2 &larr; a]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[t&gt;loc2?[t&larr;loc2. a&larr;self ptofchar: t]].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self comp: p1 to: a. loc1 &larr; t. p1 &larr; a].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[p1=p2?[self comp: p1 to: (p2 &larr; 1@0 + p1)]].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">t &larr; self charnearpt: user mp]]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">replace:</span><span style="font: 10pt greek"> t<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[</span><span class="tab" val="18"></span><span style="font: 10pt greek">[oldpara?[] oldpara &larr; para].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">para &larr; para replace: loc1 to: loc2-1 by: t.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">loc1 &larr; loc2 &larr; loc1 + t length.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">self show]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">selection</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[!para copy: loc1 to: loc2-1]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">show</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[super show.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[loc1≡nil? [loc1&larr;loc2&larr;1]].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user kbck?[] self select]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">select</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[p1 &larr; self ptofchar: loc1.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">p2 &larr; [loc2=loc1?[1@0 + p1] self ptofchar: loc2].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">self comp: p1 to: p2]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">comp:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> b | t</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪complement from a to b↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[</span><span class="tab" val="18"></span><span style="font: 10pt greek">[a y&lt;b y?[] </span><span style="font: 10pt serif">(a y=b y) and: (a</span><span style="font: 10pt greek"> x&lt;b x)?[] t&larr;a. a&larr;b. b&larr;t].</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪in case they were reversed↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[a y &lt; b y?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(a rect: (window corner x-4) @ (a y+self lineheight)) comp.</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪top line↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek"> a &larr; (window origin x+4) @ (a y+self lineheight).<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek"> a y &lt; b y?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(a rect: (window corner x-4) @ b y) comp]</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪middle (if any)↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">]].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a y &gt; b y?[]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">(a x @ b y rect: b x @ (b y + self lineheight)) comp.</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪bottom (or only)↪]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">selectword</span><span style="font: 10pt greek"> | a b dir t level open close<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self comp: p1 to: p2.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">a&larr; b&larr; dir&larr; ¬1.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">open &larr; &rsquo;&rsquo;([{&lt; &rsquo;&rsquo;&rsquo;&rsquo;↪<br>&rsquo;&rsquo;.</span><span class="tab" val="18"></span><span style="font: 10pt greek">close &larr; &rsquo;&rsquo;)]}&gt; &rsquo;&rsquo;&rsquo;&rsquo;↪<br>&rsquo;&rsquo;.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[loc1&gt;para length?[]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">loc1≤1?[dir&larr;1]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">t&larr;open find: (a&larr;para◦(loc1-1)). t&gt;0?</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪delim on left↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[dir&larr;1. b&larr;close</span><span style="font: 10pt serif">◦t</span><span style="font: 10pt greek">.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪match to the right↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a=b?[a&larr;¬2]]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪non-nesting↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">t&larr;close find: (a&larr;para◦loc1). t&gt;0?</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪delim on right↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[dir&larr;¬1. b&larr;open</span><span style="font: 10pt serif">◦t</span><span style="font: 10pt greek">.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪match to the left↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a=b?[a&larr;¬2]]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪non-nesting↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a&larr; ¬1].</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪no delims - select a token↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">t&larr;loc1-1. level&larr;1.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">until⦂ [t≤1?[] t≥para length?[] level=0?[] false] do⦂<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[para◦(t&larr; t+dir) = b? [level&larr; level-1];</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪leaving nest↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">= a? [level&larr; level+1].</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪entering nest↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a=¬1?[(para</span><span style="font: 10pt serif">◦t</span><span style="font: 10pt greek">) tokenish?[]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪token check goes left ↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">dir=¬1?[loc1 &larr; t+1. dir&larr;1. t&larr;loc2]</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪then right↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">level&larr; 0]]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[dir=1?[loc2&larr; t] loc1&larr; t+1].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">self select]&rsquo;<br>Integer understands: &rsquo;tokenish</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪test for token-chars↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self isletter?[!true]</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪lower-case↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek"> self isdigit?[!true]</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪digits↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek"> !&rsquo;&rsquo;¬.:⦂&rsquo;&rsquo; has: self]&rsquo;</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪also high-minus and dot↪<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek"><br>↪</span><span style="font: bold 12pt serif">CLASS EDITOR</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ClassEditor&rsquo;;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">subclassof: ParagraphEditor;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">fields: &rsquo;class selector&rsquo;<br></span><span style="font: 10pt greek">ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">firsttime</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[window has: user mp?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[window outline. self enter: window]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">!false]&rsquo;<br>ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">eachtime</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[window has: user mp?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user kbck?[self kbd: nil]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user anybug?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user redbug?[!self redbug: nil]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user yellowbug?[self yellowbug: nil]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user bluebug?[window &larr; Rectangle new fromuser.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self firsttime]]]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user yellowbug?[self close. !false]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user anybug?[self leave. !false]]&rsquo;<br>ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lasttime</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self leave]&rsquo;<br><br>ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">class:</span><span style="font: 10pt greek"> class </span><span style="font: 10pt greek; text-decoration: underline">selector:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek; text-decoration: underline">para:</span><span style="font: 10pt greek"> para </span><span style="font: 10pt greek; text-decoration: underline">window:</span><span style="font: 10pt greek"> window<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[para &larr; para asParagraph. style &larr; DefaultTextStyle.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">self enter: window]&rsquo;<br>ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">yellowbug:</span><span style="font: 10pt greek"> boss<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[class understands: para]&rsquo;<br>ClassEditor understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">close</span><span style="font: 10pt greek"><br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(window inset: ¬2 @ ¬2) clear: backround.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user unschedule: self]&rsquo;<br><br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">edit:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user schedule: (ClassEditor new class: self selector: selector<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">para: (self code: selector) window: Rectangle new fromuser)]&rsquo;<br><br>Dispframe understands: &rsquo;firsttime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[text window has: user mp?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[text window outline. self cr; append: &rsquo;&rsquo;&#64257;&rsquo;&rsquo;; show]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">!false]&rsquo;<br>Dispframe understands: &rsquo;eachtime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[text window has: user mp?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user kbck?[t&larr; self read.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self print: [t≡nil?[self doit] nilⓢt].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self cr; append: &rsquo;&rsquo;&#64257;&rsquo;&rsquo;; show]]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user anybug?[!false]]&rsquo;<br>Dispframe understands: &rsquo;lasttime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self skip: [¬2 max: 0-position]; show]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span style="font: 10pt greek"><br>******  NOT DONE BEYOND HERE ******<br><br>↪OTHER PARAGRAPH STUFF↪<br>ParagraphEditor understands: &rsquo;kbdlook | t c<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(c&larr; user rawkbck)&gt;170?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[t&larr; ctlchars find: c.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">t&gt;0?[kbd. changed &larr; true.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">para changestyle: runvals◦t from: loc1+1 to: loc2]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!false]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">!false]&rsquo;<br>Peditorstuff insertall: "(ctlchars runvals) with: "(<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">(226 233 224 173 242</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ctl-  b i ... - r↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">176 177 178 179 180 181 182 183 184 185</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ctl-  0 thru 9↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">193 194 195 196 197 198)</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪ctl-  A thru F↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">(1 2 4 8 ¬1<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">0 1 2 3 4 5 6 7 8 9<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">10 11 12 13 14 15)<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">).<br>"t &larr; Peditorstuff◦"runvals.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">for i &larr; 6 to t length do<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">(t[a] &larr; 16*t[a]).</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪font number left 4 bits↪<br><br>ParagraphEditor understands: &rsquo;readchange<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self cleanup. changed&larr;false. !para]&rsquo;<br>ParagraphEditor understands: &rsquo;fixframe: x<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[!x]&rsquo;<br>ParagraphEditor understands: &rsquo;close: x []&rsquo;<br>ParagraphEditor understands: &rsquo;outside: x [!false]&rsquo;<br>ParagraphEditor understands: &rsquo;asParagraph</span><span class="tab" val="18"></span><span style="font: 10pt greek">[!para]&rsquo;<br>ParagraphEditor understands: &rsquo;changed</span><span class="tab" val="18"></span><span style="font: 10pt greek">[!changed]&rsquo;<br>ParagraphEditor understands: &rsquo;selection</span><span class="tab" val="18"></span><span style="font: 10pt greek">[!para copy: loc1 to: loc2-1]&rsquo;<br><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek"><br>↪</span><span style="font: bold 12pt serif">WINDOW FRAME AND CONTROL</span><span style="font: 10pt greek">↪<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;UserWindow&rsquo;;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">fields: &rsquo;frame contents title&rsquo;;<br></span><span class="tab" val="18"></span><span style="font: bold 12pt serif">sharing: Userstuff<br></span><span style="font: 10pt greek">UserWindow understands: &rsquo;frame: f contents: contents<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame &larr; contents fixframe f. self show]&rsquo;<br>UserWindow understands: &rsquo;of: c<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self frame: Rectangle new fromuser contents: c]&rsquo;<br>UserWindow understands: &rsquo;show<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[self showin: user screenrect]&rsquo;<br>UserWindow understands: &rsquo;showin: r | a<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[(a &larr; frame intersect: r) empty? []<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a color: dkgray mode: storing.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">((frame inset: p1 and: p2) intersect: r) color: white mode: storing.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">contents enter: r.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">whitey show: contents title clipped: r]<br><br>UserWindow understands: &rsquo;firsttime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame has: user mp? [self show] !false]&rsquo;<br>UserWindow understands: &rsquo;eachtime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame has: user mp?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user buttonck?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[user redbug?[!contents redbug: self]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user yellowbug?[!contents yellowbug: self]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user bluebug?[!contents bluebug: self]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user kbck?[contents kbd: self]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">user keysetck?[contents keyset: self]]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">contents outside: self?[]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user buttonck?[frame has mp?[] !false]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">user kbck?[user kbd; user flash] ↪flush typing outside↪]&rsquo;<br>UserWindow understands: &rsquo;lasttime<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[!contents leave]&rsquo;<br><br>UserWindow understands: &rsquo;newframe<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[while⦂ user buttonck do⦂ [].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame &larr; Rectangle new origin: (a&larr; user mp) corner: a.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">while⦂ user buttonck do⦂ <br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame color: dkgray mode: xoring.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame &larr; contents fixframe: (frame growto: user mp). <br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame color: dkgray mode: xoring].<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame color: dkgray mode: storing.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">whitey show: contents title.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">windowSched fillholes: (oldframe nonintersect: frame).<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">!frame]&rsquo;<br>UserWindow understands: &rsquo;close<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[contents close: self]&rsquo;<br>UserWindow understands: &rsquo;movegrow<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[frame color: white mode: storing.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame &larr; self newframe.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">"a &larr; frame inset p1 p2.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">a paint 12 white.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">contents enter a inset p3 p4]&rsquo;<br>↪***↪<br>UserWindow evals ["p1 &larr; point 3 fontheight+4. "p2 &larr; point 3 3.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"p3 &larr; point 4 2. "p4 &larr; point 4 0. "p5 &larr; point 3 2.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"whitey &larr; textframe rectangle p1 p1]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek"><br>↪</span><span style="font: bold 12pt serif">FORMATTED TEXT</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">Paragraph understands: &rsquo;runfind b | a</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**index into run**↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[a&larr;1.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">while⦂ true do⦂<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[runs◦a≥b? [!a , b]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪return run, index↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">b &larr; b-(runs◦a). a &larr; a+2]]&rsquo;<br>Paragraph understands: &rsquo;runs</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**subrange of run**↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[%[?["a &larr; :.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪indexed by text, not run↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%to?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">["b &larr; [%end?["c&larr;runs length-1. point c runs[c]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self runfind :]. %].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a&gt;text length?[!&rsquo;&rsquo;] "a &larr; self runfind a.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"c &larr; runs[a x to b x+1].</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪copy the sub-run↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">c length=0?[!c]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a x = b x?[0= c[1]&larr; 1+ b y-a y ?[!&rsquo;&rsquo;] !c]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">c[1] &larr; 1+runs[a x] - a y.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪trim the end lengths↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">c[c length-1] &larr; b y.  !c]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%]. !runs[self runfind a x+1]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!runs]&rsquo;<br>string understands "runcat</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**concatenate runs**↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["x&larr;:. x length=0?[] self length=0?[!x]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">self[self length]=x[2]?<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[!self[1 to self length-2]+<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[makerun self[self length-1]+x[1] x[2]]+<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">x[3 to x length]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!self + x]&rsquo;<br>Paragraph understands: &rsquo;asString [!text]&rsquo;<br>Paragraph understands: &rsquo;[</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**subranges and subscripting of text**↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["a&larr;:.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%to?["b&larr;:. %].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%replace?["c&larr;:.</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**alters self; doesn&rsquo;t copy↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"runs &larr; self runs[1 to a-1]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">runcat [c is string?[makerun c length self runs[b]] c runs]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">runcat self runs[b+1 to end].<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"text &larr; text[a to b] replace<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[c is string?[c] c text]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%changestyle?["c&larr;:.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"runs &larr; self runs[1 to a-1]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">runcat [self mergestyle c into self runs[a to b]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">runcat self runs[b+1 to end]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%&larr;?[%all?[text[a to b] &larr; all :]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">text[a to b] &larr; :]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!paragraph with text[a to b] self runs[a to b]]↪**copy align**↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">%]. %&larr;?[!text[a]&larr;:]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!text[a]]&rsquo;<br>Paragraph understands: &rsquo;mergestyle<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["a&larr;:. %into. "b&larr;:.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">for c&larr; 2 to b length by 2 do<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[b[c] &larr; [a=¬1? [0]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪reset↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">0&lt;a≤017? [a &- b[c]]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪toggle emphasis↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">a+017 &* b[c]]].</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪new font↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!b]<br><br>"makerun &larr; function [run len str] ["len&larr;:. "run&larr;:.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">len=0?[!&rsquo;&rsquo;] "str&larr;stream. repeat do<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[run&lt;256?[str&larr;len. str&larr;run. !str contents]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">str&larr;255. str&larr;run. "len&larr;len-255]]&rsquo;<br>paragraphⓢinitcode &larr;<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["alignment &larr; 0. %with?["text &larr; :.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"runs &larr; [%onerun?[makerun text length :] :]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">"text &larr; string 0]&rsquo;<br>Paragraph understands: &rsquo;runshow | strm i</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪**print a run**↪<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">[strm &larr; stream. for⦂ i from: (1 to: runs length by: 2) do⦂<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[strm append: (runs◦i) asString; append: &rsquo;.&rsquo;.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">strm append: (runs◦(i+1)) asString; append: &rsquo;, &rsquo;]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">!strm contents]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek"><br>↪</span><span style="font: bold 12pt serif">MENUS</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">"menu &larr; class [[pt i bits][str text thisline frame but][pt2][]] [] [] []&rsquo;<br><br>menuⓢinitcode &larr;<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["str&larr;:. "but&larr;:.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">"text &larr; textframe rectangle "pt&larr;point 0 0 point 1000 1000 with str.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">for i to str length+1 do<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">["pt &larr; pt max text ptofchar i]<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">textⓢframe growto pt+point 4 text fontheight.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">textⓢpara center.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">"frame &larr; textⓢframe inset "pt2&larr;point ¬2 ¬2 pt2.<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">"thisline&larr;rectangle textⓢ frameⓢorigin<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">point textⓢframeⓢextent x text fontheight]&rsquo;<br>menu understands: &rsquo;bug<br></span><span class="tab" val="18"></span><span style="font: 10pt greek">["pt&larr;mp-thisline center.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪center prev item on mouse↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">textⓢframe moveby pt. thisline moveby pt.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame moveby pt. "bits &larr; frame makebuff.</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪save background↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame paint 12 ¬1. text show.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">0=mouse 7?[frame loadbuff bits. !0]</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪accidental bug returns 0↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">thisline comp.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">repeat do [<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame has "pt&larr;mp?</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪in the menu↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[button but?</span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪button still down↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">[thisline has pt?[]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">text charnearpt pt. "pt&larr;text reply.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">thisline comp. thisline moveto</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪selection follows mouse↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek"> point textⓢframeⓢorigin x pt y.<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">thisline comp]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame loadbuff bits.</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪restore background, return index↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">!1+[thislineⓢorigin-frameⓢorigin]y/text fontheight]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">thisline comp. </span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">↪he left the menu↪<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">repeat do [button but?[frame has mp?[thisline comp. done]]<br></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span class="tab" val="18"></span><span style="font: 10pt greek">frame loadbuff bits. !0]</span><span class="tab" val="18"></span><span style="font: 10pt greek">↪retur