<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>bootstrap.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br><br>The<br>New<br>Improved<br>SMALLTALK<br>System<br>Definition<br></span><span style="font: 10pt serif">June 12, 1977</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif"><br><br>This is the new SYSDEFS</span></div>
<div style="width: 405pt; margin-left: 121pt; margin-top: 0pt; text-align: justify">
<span style="font: italic 10pt serif">This is &lt;INGALLS&gt;bootstrap.st.  The read routine, compiler and file system(draft) appear in a separate file called bootstrap2.st.  The user interface(draft) is in userface.st.  The objects which are initially needed get created in the file launch.ft.  A complete simulator exists in simulate.ft, and old-system defs of the new classes are in genclass.ft</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">RAW MATERIALS</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Object&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: nil;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">abstract<br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Object is the superclass of all classes.  It is an abstract class, meaning that it has no instance state, and its main function is to provide a foundation message protocol for its subclasses.  Three instances of this class are defined, namely: nil, true, and false.</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br><br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">primitives</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≡</span><span style="font: 10pt greek"> x [] primitive: 4&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">test for identical pointers</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Font will be edited so this looks like </span><span style="font: 10pt math">W</span><span style="font: italic 10pt serif">, meaning eq</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">hash</span><span style="font: 10pt greek"> [] primitive: 46&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">pointer as an Integer</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asOop</span><span style="font: 10pt greek"> [] primitive: 46&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Dont override this</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">refct</span><span style="font: 10pt greek"> [] primitive: 45&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">current reference count</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">class</span><span style="font: 10pt greek"> [] primitive: 27&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">class of this object</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">instfield:</span><span style="font: 10pt greek"> n [] primitive: 38&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">subscript any objct</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">instfield:</span><span style="font: 10pt greek"> n </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val [] primitive: 39&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">boolean connectives</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">or:</span><span style="font: 10pt greek"> x [self?[!true] !x]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">and:</span><span style="font: 10pt greek"> x [self?[!x] !false]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">xor:</span><span style="font: 10pt greek"> x [x?[!self≡false] !self]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">eqv:</span><span style="font: 10pt greek"> x [x?[!self] !self≡false]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">following don&rsquo;t evaluate their arg unless necessary.<br>They are built for comfort, not for speed.</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">or⦂</span><span style="font: 10pt greek"> x [self?[!true] !x eval]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">and⦂</span><span style="font: 10pt greek"> x [self?[!x eval] !false]&rsquo;<br><br>↪</span><span style="font: italic 10pt serif">default protocol</span><span style="font: 10pt greek">↪<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self≡nil? [strm append: &rsquo;&rsquo;nil&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self≡false? [strm append: &rsquo;&rsquo;false&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self≡true? [strm append: &rsquo;&rsquo;true&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self class print: self on: strm]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asString</span><span style="font: 10pt greek"> | strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm &larr; Stream default.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self printon: strm. !strm contents]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">print</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user show: self asString]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> x [!self≡x]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≠</span><span style="font: 10pt greek"> x [!self=x≡false]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">is:</span><span style="font: 10pt greek"> x [!self class≡x]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">,</span><span style="font: 10pt greek"> x | v<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[v &larr; Vector new: 2.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">v◦1 &larr; self. v◦2 &larr; x.  !v]&rsquo;<br>Object understands: &rsquo;startup</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪loopless scheduling↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self firsttime?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[while⦂ self eachtime do⦂ [].<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self lasttime]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">canunderstand:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self class canunderstand: selector]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">create new copy of self</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self class copy: self]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">recursively copy whole structure</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self class recopy: self]&rsquo;<br>Object understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">error</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;Message not understood.&rsquo;&rsquo;]&rsquo;<br>Object understands: &rsquo;ⓢ code<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self class understands: &rsquo;&rsquo;doit [![&rsquo;&rsquo; + code + &rsquo;&rsquo;]]&rsquo;&rsquo;.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self doit]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">FUNDAMENTAL ORGANIZATION</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Class&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;title</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;String&gt; for identification, printing</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">myinstvars </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;String&gt; partnames for compiling, printing (includes comments)</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">instsize </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer&gt; for storage management</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">messagedict </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;MessageDict&gt; for communication, compiling</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">monitors </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Dictionary/nil&gt; compiler checks here</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">superclass </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Class&gt; for execution of inherited behavior</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">environment </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector of SymbolTables&gt; for external references</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fieldtype&rsquo;; </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer&gt; encodes field size, if bits</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">veryspecial: 1<br></span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">order of messages, just to make things simpler:<br></span><span class="tab" val="24"></span><span style="font: 10pt serif; text-decoration: underline">title</span><span style="font: 10pt serif"> insystem subclassof </span><span style="font: 10pt serif; text-decoration: underline">fields/abstract</span><span style="font: 10pt serif"> (</span><span style="font: 10pt serif; text-decoration: underline">required</span><span style="font: 10pt serif">)<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">sharing bytesize veryspecial (any order)</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">title:</span><span style="font: 10pt greek"> title<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self title: title insystem: Smalltalk]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">title:</span><span style="font: 10pt greek"> title </span><span style="font: 10pt greek; text-decoration: underline">insystem:</span><span style="font: 10pt greek"> system<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[system define: title unique as: self.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">superclass &larr; Object]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subclassof:</span><span style="font: 10pt greek"> superclass&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">abstract</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self fields: nullString]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">fields:</span><span style="font: 10pt greek"> myinstvars</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">list of instance variables</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[fieldtype &larr; 16.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">instsize &larr; self instvars length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">instsize&gt;16?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;too many instance variables&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">messagedict &larr; MessageDict default.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">environment &larr; Vector new: 1. environment◦1 &larr; Smalltalk]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">instvars</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[superclass≡nil ? [!myinstvars asVector]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!superclass instvars concat: myinstvars asVector]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">understands:</span><span style="font: 10pt greek"> code</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">install method</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user displayoffwhile⦂ [Compiler new compile: code in: self]]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">canunderstand:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!messagedict has: selector]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">derstands:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[messagedict &larr; messagedict delete: selector]&rsquo;<br>Class understands: </span><span style="font: 10pt greek; text-decoration: underline">&rsquo;install:</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">method:</span><span style="font: 10pt greek"> method </span><span style="font: 10pt greek; text-decoration: underline">literals:</span><span style="font: 10pt greek"> literals<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek; text-decoration: underline">code:</span><span style="font: 10pt greek"> code </span><span style="font: 10pt greek; text-decoration: underline">backpointers:</span><span style="font: 10pt greek"> backpointers<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[</span><span class="tab" val="24"></span><span style="font: 10pt greek">[messagedict has: name? [CodeKeeper next&larr; messagedict literals: name]].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">messagedict &larr; messagedict insert: name method: method<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">literals: literals code: code backpointers: backpointers]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">code:</span><span style="font: 10pt greek"> selector<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!messagedict code: selector]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">new</span><span style="font: 10pt greek"> [] primitive: 28&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">creation of instances</span><span style="font: 10pt greek">↪<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: title]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">allinstances</span><span style="font: 10pt greek"> [] primitive: 60&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">enumeration</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">If Ted cant do it, nobody can...</span><span style="font: 10pt greek">↪<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bytesize:</span><span style="font: 10pt greek"> n</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">non-pointer declaration</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[fieldtype &larr; 32+ [n=8? [8] 16]]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">vanilla or chocolate only</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">veryspecial:</span><span style="font: 10pt greek"> n</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">for ClassClasses</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[instsize &larr; instsize+n]&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">secret freelist fields</span><span style="font: 10pt greek">↪<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">superclass</span><span style="font: 10pt greek"> [!superclass]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">environment</span><span style="font: 10pt greek"> [!environment]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">print:</span><span style="font: 10pt greek"> inst </span><span style="font: 10pt greek; text-decoration: underline">on:</span><span style="font: 10pt greek"> strm | ivars i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[ivars &larr; myinstvars asVector.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm append: &rsquo;&rsquo;(&rsquo;&rsquo;; append: title; append: &rsquo;&rsquo; new &rsquo;&rsquo;.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: instsize do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: ivars◦i; append: &rsquo;&rsquo;: &rsquo;&rsquo;;<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">print: </span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">inst instfield: i</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek">; space]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm append: &rsquo;&rsquo;)&rsquo;&rsquo;]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif; text-decoration: underline">init</span><span style="font: italic 10pt serif"> and </span><span style="font: italic 10pt serif; text-decoration: underline">default</span><span style="font: italic 10pt serif"> get propagated to instances</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self new init]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">default</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self new default]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy:</span><span style="font: 10pt greek"> inst | t i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; self new.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: instsize do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t instfield: i &larr; inst instfield: i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!t]&rsquo;<br>Class understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy:</span><span style="font: 10pt greek"> inst | t i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; self new.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: instsize do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t instfield: i &larr; </span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">inst instfield: i</span><span style="font: 10pt serif">) recopy</span><span style="font: 10pt greek">]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!t]&rsquo;<br>Class understands: &rsquo;ed: selector | c s<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[c&larr; self code: selector. user clearshow: c.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ (s&larr; user request: &rsquo;&rsquo;substitute: &rsquo;&rsquo;) do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[c &larr; c subst: s for: (user request: &rsquo;&rsquo;for: &rsquo;&rsquo;).<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">user clearshow: c]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self understands: c]&rsquo;<br></span><span style="font: 10pt serif"><br></span><span style="font: bold 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;VariableLengthClass&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Class;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">veryspecial: 20<br></span><span style="font: 10pt greek">VariableLengthClass understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">new:</span><span style="font: 10pt greek"> length<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[length ≥ 020000 ?[length print. user notify: &rsquo;&rsquo; is too large&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">length &lt; 0 ?[length print. user notify: &rsquo;&rsquo; is too small&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self new: length asInteger] primitive: 29&rsquo;<br>VariableLengthClass understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">new</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;use new: &lt;Integer=length&gt; here.&rsquo;&rsquo;]&rsquo;<br>VariableLengthClass understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy:</span><span style="font: 10pt greek"> inst | t i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; self new: inst length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: inst length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t◦i &larr; inst◦i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!t]&rsquo;<br>VariableLengthClass understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy:</span><span style="font: 10pt greek"> inst | t i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; self new: inst length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: inst length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t◦i &larr; (inst◦i</span><span style="font: 10pt serif">) recopy</span><span style="font: 10pt greek">]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!t]&rsquo;<br></span><span style="font: 10pt serif"><br></span><span style="font: bold 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Context&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;sender </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Context&gt; from which this message was sent</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">receiver </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Object&gt; to which this message was sent</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">mclass </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Class&gt; in which a method was found</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">method </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;String&gt;, the encoded method</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">tempframe </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector&gt; to hold temporaries and a stack</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">pc </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer&gt; marks progress of execution in method</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">stackptr </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Integer&gt; offset of stack top in tempframe</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">&rsquo;<br></span><span style="font: 10pt greek">Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">eval</span><span style="font: 10pt greek"> [] primitive: 30&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">sender:</span><span style="font: 10pt greek"> sender </span><span style="font: 10pt greek; text-decoration: underline">receiver:</span><span style="font: 10pt greek"> receiver </span><span style="font: 10pt greek; text-decoration: underline">mclass:</span><span style="font: 10pt greek"> mclass<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek; text-decoration: underline">method:</span><span style="font: 10pt greek"> method </span><span style="font: 10pt greek; text-decoration: underline">tempframe:</span><span style="font: 10pt greek"> tempframe </span><span style="font: 10pt greek; text-decoration: underline">pc:</span><span style="font: 10pt greek"> pc </span><span style="font: 10pt greek; text-decoration: underline">stackptr:</span><span style="font: 10pt greek"> stackptr&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">remoteCopy</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Context new sender: sender receiver: receiver mclass: mclass<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">method: method tempframe: tempframe pc: pc+2 stackptr: stackptr]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">sender</span><span style="font: 10pt greek"> [!sender]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">sender&larr;</span><span style="font: 10pt greek"> sender []&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[receiver class printon: strm. sender≡nil? []<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm append: &rsquo;&rsquo;◦&rsquo;&rsquo;; print: sender thisop]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">trace</span><span style="font: 10pt greek"> | strm a<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm &larr; Stream default. self printon: strm.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">a &larr; sender. until⦂ a≡nil do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm cr. a printon: strm. a &larr; a sender]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!strm contents]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">thisop</span><span style="font: 10pt greek"> | a<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[a &larr; method◦pc.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">a≥0320? [!self litof: a-0320]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">a≥0260? [!self specialops◦(1+a-0260)]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!"something]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">litof:</span><span style="font: 10pt greek"> a<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(method word: a+4) asObject]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">specialops</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!"(+ - &lt; &gt; ≤ ≥ = ≠<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">* / \ | min: max: land: lor:<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">◦ '&#771;&rsquo;◦&larr;&rsquo;&rsquo; atomize) next '&#771;&rsquo;next&larr;&rsquo;&rsquo; atomize) length ≡ nil nil<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">class and: or: new new: to: oneToMeAsStream asStream)]&rsquo;<br>Context understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">debug</span><span style="font: 10pt greek"> | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user cr. self print.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ [t &larr; user request: &rsquo;&rsquo;<br>*&rsquo;&rsquo;] do⦂ [user show: (selfⓢt) asString]]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">NUMBERS</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Number&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">abstract</span><span style="font: 10pt serif"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Numbers in general</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">min:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&gt;arg?[!arg]]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">max:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&lt;arg?[!arg]]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">@</span><span style="font: 10pt greek"> y<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: self y: y]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Interval new from: self to: x by: 1]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">by:</span><span style="font: 10pt greek"> y<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Interval new from: self to: x by: y]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> a<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!a◦self asInteger]&rsquo;<br>Number understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!a◦self asInteger &larr; val]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Integer&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">16-bit integers</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Number;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">bytesize: 16;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">veryspecial: 1</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">instance state not currently accessible</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">+</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self + arg asInteger] primitive: 6&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">-</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self - arg asInteger] primitive: 7&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">*</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self * arg asInteger] primitive: 21&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">/</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self / arg asInteger] primitive: 22&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">&lt;</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self &lt; arg asInteger] primitive: 8&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self = arg asInteger] primitive: 9&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">&gt;</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self &gt; arg asInteger] primitive: 10&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≤</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≤ arg asInteger] primitive: 11&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≠</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≠ arg asInteger] primitive: 12&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≥</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≥ arg asInteger] primitive: 13&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lshift:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self lshift: arg asInteger] primitive: 25&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">land:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self land: arg asInteger] primitive: 23&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lor:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self lor: arg asInteger] primitive: 24&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">xor:</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self xor: arg asInteger] primitive: 35&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">field:</span><span style="font: 10pt greek"> fld<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self field: fld asInteger] primitive: 36&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">field:</span><span style="font: 10pt greek"> fld &larr; val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self field: fld asInteger &larr; val asInteger] primitive: 37&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">\</span><span style="font: 10pt greek"> arg</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪mod↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self \ arg asInteger] primitive: 26&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">|</span><span style="font: 10pt greek"> arg</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪truncate↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self/arg*arg]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&lt;0?[strm append: &rsquo;&rsquo;¬&rsquo;&rsquo;. (0-self) absprinton: strm]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self absprinton: strm]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">absprinton:</span><span style="font: 10pt greek"> strm | rem<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[rem &larr; self\10.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&gt;9? [self/10 absprinton: strm]].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm next &larr; rem+060]&rsquo;<br>Integer understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asInteger</span><span style="font: 10pt greek"> [!self]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asFloat</span><span style="font: 10pt greek"> [] primitive: 34&rsquo;<br>Integer understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">oneToMeAsStream</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪used by for-loops↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Stream new of: (Interval new from: 1 to: self by: 1)]&rsquo;<br>Integer understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy</span><span style="font: 10pt greek"> [!self]&rsquo;<br>Integer understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy</span><span style="font: 10pt greek"> [!self]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isletter</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self ≥ 0141?</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ a ↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≤ 0172]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ z ↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self ≥ 0101?</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ A ↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≤ 0132]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ Z ↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isdigit </span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self ≥ 060?</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ 0 ↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self ≤ 071]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ 9 ↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br><br>↪Following two must be failures from Array subscripting: ↪<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> a<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;Subscript out of bounds: &rsquo;&rsquo; + self asString]&rsquo;<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;Subscript out of bounds: &rsquo;&rsquo; + self asString]&rsquo;<br><br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">purge</span><span style="font: 10pt greek"> [] primitive: 44&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">write this oop to disk</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪Warning: The Surgeon General has determined that the following message<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">may be hazardous to the health of your system.↪<br>Integer understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asObject</span><span style="font: 10pt greek"> [] primitive: 81&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">makes a pointer</span><span style="font: 10pt greek">↪<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Float&rsquo;</span><span style="font: 10pt serif">;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Floating-Point</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Number;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">bytesize: 16;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">veryspecial: 3</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">instance state not currently accessible</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">+</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self+arg asFloat] primitive: 67&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">-</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self-arg asFloat] primitive: 68&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">*</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self*arg asFloat] primitive: 69&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">/</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self/arg asFloat] primitive: 70&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">&lt;</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self&lt;arg asFloat] primitive: 71&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self=arg asFloat] primitive: 72&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≤</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self≤arg asFloat] primitive: 73&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">&gt;</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self&gt;arg asFloat] primitive: 74&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≥</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self≥arg asFloat] primitive: 75&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≠</span><span style="font: 10pt greek"> arg<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self≠arg asFloat] primitive: 76&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">fpart</span><span style="font: 10pt greek"> [] primitive: 77&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ipart</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self-self fpart]&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">NOTE this isnt an Integer</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asInteger</span><span style="font: 10pt greek"> [] primitive: 78&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">this IS an Integer</span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">sqrt</span><span style="font: 10pt greek"> [] primitive: 79&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ipow:</span><span style="font: 10pt greek"> x</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">fixed powers in log n steps</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x=0? [!1.0]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x=1? [!self]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x&gt;1? [!((self*self) ipow: x/2)*(self ipow: x\2)]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!1.0/(self ipow: 0-x)]&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">epart:</span><span style="font: 10pt greek"> base | x</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">gives floor log.base self</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&lt;base? [!0]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">self assumed positive</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self&lt;(base*base)? [!1]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x &larr; 2*(self epart: base*base).</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">binary recursion like ipow</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!x + ((self/(base ipow: x)) epart: base)]&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self&lt;0.0? [strm append: &rsquo;&rsquo;¬&rsquo;&rsquo;. (0.0-self) absprinton: strm]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self absprinton: strm]&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">absprinton:</span><span style="font: 10pt greek"> strm | x y q i fuzz<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[fuzz &larr; 5.0e¬9.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">fuzz tracks significance</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">y &larr; [self&lt;1.0? [0-(10.0/self epart: 10.0)] self epart: 10.0].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x &larr; self/(10.0 ipow: y)+fuzz.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">normalize x</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x≥10.0? [y &larr; y+1. x &larr; x/10.0]].</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">y = exponent</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[y&lt;6 and: y&gt;¬4?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[q &larr; 0.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">decimal notation</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">y&lt;0? [strm append: &rsquo;&rsquo;0.0000&rsquo;&rsquo;◦(1 to: 1-y)]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">fuzz &larr; fuzz * 10.0 ipow: y].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">q &larr; y. y &larr; 0].</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">scientific notation</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: 9 do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm next &larr; 060+x ipart.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">x &larr; 10.0 * x fpart.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">0&gt;(y &larr; y-1)?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x&lt;(fuzz &larr; fuzz*10.0)?[↪done - fix↪]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">y=¬1? [strm append: &rsquo;&rsquo;.&rsquo;&rsquo;]]]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[y=¬1?[strm append: &rsquo;&rsquo;.0&rsquo;&rsquo;]].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">q≠0?[strm append: &rsquo;&rsquo;e&rsquo;&rsquo;; print: q]]&rsquo;<br>Float understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asFloat</span><span style="font: 10pt greek">&rsquo;</span><span style="font: 10pt serif"><br></span><span style="font: 10pt greek">Float understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy</span><span style="font: 10pt greek"> [!self]&rsquo;<br>Float understands: </span><span style="font: 10pt serif">&rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy</span><span style="font: 10pt greek"> [!self]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">ARRAYS</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Array&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">abstract</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">arrays in general</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt greek">Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">length</span><span style="font: 10pt greek"> [] primitive: 16&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!x subscripts: self] primitive: 38&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!x subscripts: self &larr; val] primitive: 39&rsquo;<br>↪</span><span style="font: italic 10pt serif">Note that subscripting by an integer is primitive.  A subscript of another class will be called with the message subscripts: array, in the hopes that it knows how to behave as a subscript.</span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif"><br></span><span style="font: 10pt greek">Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> x</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪subarrays↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Substring new data: x map: self]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subscripts:</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪subrange replacement↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self length≠val length?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;lengths not commensurate&rsquo;&rsquo;]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">val copyto: (Substring new data: x map: self).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!val]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">all &larr;</span><span style="font: 10pt greek"> val | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: self length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self◦i &larr; val]]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> arg | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self length ≠ arg length? [!false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ x to: self length do⦂ <br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[(self◦x) = (arg◦x)? [] !false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!true]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">find:</span><span style="font: 10pt greek"> x | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: self length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self◦i=x? [!i]].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!0]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">findnon:</span><span style="font: 10pt greek"> x | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: self length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self◦i≠x? [!i]].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!0]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">has:</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!0≠(self find: x)]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">reverse</span><span class="tab" val="24"></span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Substring new data: self map: (self length to: 1 by: ¬1)]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">concat:</span><span style="font: 10pt greek"> arg | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; self species new: self length + arg length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x◦(1 to: self length) &larr; self.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x◦(self length+1 to: x length) &larr; arg.  !x]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self copyto: (self species new: self length)]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copyto:</span><span style="font: 10pt greek"> t | i s<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[s &larr; t asStream.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[s next&larr; i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!t]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">replace:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> b </span><span style="font: 10pt greek; text-decoration: underline">by:</span><span style="font: 10pt greek"> s | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; self species new: self length+s length -(1+b-a).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x◦(1 to: a-1) &larr; self◦(1 to: a-1).  t&larr;a+s length-1.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x◦(a to: t) &larr; s.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x◦(t+1 to: x length) &larr; self◦(b+1 to: self length).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!x]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">growby:</span><span style="font: 10pt greek"> n<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self copyto: (self species new: self length+n)]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">grow</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self copyto: (self species new: (4 max: self length*2))]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">last</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self◦self length]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">last &larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self◦self length &larr; val]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">species</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Vector]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">read<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self new asStream read]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asStream</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Stream new of: self]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isIntervalBy1</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!false]&rsquo;<br>Array understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">swap:</span><span style="font: 10pt greek"> i </span><span style="font: 10pt greek; text-decoration: underline">with:</span><span style="font: 10pt greek"> j | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; self◦i. self◦i &larr; self◦j. self◦j &larr; t]&rsquo;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif"><br><br></span><span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;Vector&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: 10pt serif">Array</span><span style="font: italic 10pt serif"> of objects</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span style="font: 10pt greek">Vector understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">,</span><span style="font: 10pt greek"> x | v<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[v &larr; self growby: 1.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">use a stream if youre in a hurry</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">v last &larr; x. !v]&rsquo;<br>Vector understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: &rsquo;&rsquo;(&rsquo;&rsquo;.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: self length-1 do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm print: self◦i; append: &rsquo;&rsquo;, &rsquo;&rsquo;].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm print: self last; append: &rsquo;&rsquo;)&rsquo;&rsquo; ]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;String&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Array of 8-bit bytes</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">bytesize: 8<br></span><span style="font: 10pt greek">String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">word:</span><span style="font: 10pt greek"> x</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">read word in String</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self◦(2*x) + (self◦(2*x-1) lshift: 8)]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">word:</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> y</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">write word in String</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self◦(2*x) &larr; y land: 0377.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self◦(2*x-1) &larr; y lshift: ¬8. !y]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm | x</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">print inside string quotes</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm next&larr; 047.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ x from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm next&larr; x.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">x=047?[strm next&larr; x]]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">imbedded quotes get doubled</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">strm next&larr; 047]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">species</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!String]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asVector</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self asStream asVector]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asParagraph</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Paragraph new text: self alignment: 0]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">recopy</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self copy]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">subst:</span><span style="font: 10pt greek"> repl </span><span style="font: 10pt greek; text-decoration: underline">for:</span><span style="font: 10pt greek"> key | key1 i nskip result<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[nskip &larr; 0. key1 &larr; key◦1. result &larr; Stream default.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: self length do⦂</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪ </span><span style="font: italic 10pt serif">the Boyer Slow string replacement</span><span style="font: 10pt greek"> ↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[nskip&gt;0? [nskip &larr; nskip-1]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self◦i = key1?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self◦(i to: (self length min: i+key length-1)) = key?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[result append: repl. nskip &larr; key length-1]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">result next&larr; self◦i]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">result next&larr; self◦i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!result contents]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">unique</span><span style="font: 10pt greek"> | u</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">copy and intern</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[u &larr; UniqueString new: self length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!u of: self]&rsquo;<br>String understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">hash</span><span style="font: 10pt greek"> | x h</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">not great, but compatible with FT atom hashing</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[h &larr; 13131.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ x from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[h &larr; x * h.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">h &larr; (h lshift: ¬1)+(h lshift: 15)]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!h]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;UniqueString&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">allows fast compare (eq) for tables</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: String;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">bytesize: 8</span><span style="font: 10pt serif"></span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">of:</span><span style="font: 10pt greek"> s | i a v <br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[a &larr; self intern: s hash: (i&larr;s hash)? [!a]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">i &larr; 1+(i lshift: ¬8).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">v &larr; USTable◦i.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">USTable◦i &larr; Vector new: 2*v length.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">grow that hash bucket</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ a from: v do⦂</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">copy all its contents</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[a≡nil? []<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self intern: a hash: a stringhash]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self of: s]&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">and try again... </span><span style="font: 10pt greek">↪<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">intern:</span><span style="font: 10pt greek"> s </span><span style="font: 10pt greek; text-decoration: underline">hash:</span><span style="font: 10pt greek"> h| i j v n<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[v &larr; USTable◦(1+(h lshift: ¬8)).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: v length do⦂</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">interning compatible with FT atoms - change it soon</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[h &larr; h\v length+1.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">v◦h≡nil?</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">empty slot</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[s is: UniqueString? [!v◦h &larr; s]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">(when growing)</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">n&larr; 0.  for⦂ j from: v do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[j≡nil? [n &larr; n+1]]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">count # empty slots</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">4*n &lt; v length?[!false]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">grow if not 1/4</span><span style="font: 10pt greek"> ↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ j to: s length do⦂</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">copy string</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[super◦j &larr; s◦j]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">where there-s a will there-s a way</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">!v◦h &larr; self]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">and install self as the atom</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">s=(v◦h)?[!v◦h]]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">user notify: &rsquo;&rsquo;USTable jammed (UniqueString)&rsquo;&rsquo;]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">stringhash</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!super hash]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek">x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;UniqueStrings are not for writing into&rsquo;&rsquo;]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: self]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isinfix</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">one-char non-alpha</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self length≠1? [!false]  !(self◦1) isletter≡false]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">iskeyword</span><span style="font: 10pt greek"> | x</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">ends with open or closed colon</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self length≤1? [!false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x &larr; self◦self length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x=072?[!true] !x=03]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isuneval</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">ends with open colon</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self◦self length=03]&rsquo;<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> x [!self≡x]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">pointer compare</span><span style="font: 10pt greek">↪<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">hash</span><span style="font: 10pt greek"> [] primitive: 46&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">just the object pointer</span><span style="font: 10pt greek">↪<br>UniqueString understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">unique</span><span style="font: 10pt greek">&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Substring&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪Substring</span><span style="font: italic 10pt serif">s and permutations</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;data map</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">data:</span><span style="font: 10pt greek"> data </span><span style="font: 10pt greek; text-decoration: underline">map:</span><span style="font: 10pt greek"> map&rsquo;<br>Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!data◦(map◦x)]&rsquo;<br>Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!data◦(map◦x) &larr; val]&rsquo;<br>Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">length</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!map length]&rsquo;<br>Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">species</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!data species]&rsquo;<br>Substring understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asStream</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[map isIntervalBy1?</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">direct stream for simple substrings</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Stream new of: data from: map start to: map stop]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!Stream new of: self from: 1 to: map length]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Interval&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Intervals - Integer or Float</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;start stop step length</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">from:</span><span style="font: 10pt greek"> start </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> stop </span><span style="font: 10pt greek; text-decoration: underline">by:</span><span style="font: 10pt greek"> step<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[length &larr; 1+(stop-start/step)]&rsquo;<br>Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x&lt;1? [!nil]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">x&gt;length? [!nil]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!start+(x-1*step)]&rsquo;<br>Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: &rsquo;&rsquo;Intervals are not for writing into&rsquo;&rsquo;]&rsquo;<br>Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">length</span><span style="font: 10pt greek"> [!length]&rsquo;<br>Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">isIntervalBy1</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!step=1]&rsquo;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">start</span><span style="font: 10pt greek"> [!start]&rsquo;<br>Interval understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">stop</span><span style="font: 10pt greek"> [!stop]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;CoreLocs&rsquo;;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Proceed at your own risk...</span><span style="font: 10pt greek">↪</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;base length</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">CoreLocs understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">base:</span><span style="font: 10pt greek"> base </span><span style="font: 10pt greek; text-decoration: underline">length:</span><span style="font: 10pt greek"> length&rsquo;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">CoreLocs understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x [] primitive: 42&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">contents of memory location x</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">CoreLocs understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr; val</span><span style="font: 10pt greek"> [] primitive: 43&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">stores into memory location x</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt greek">CoreLocs understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">length</span><span style="font: 10pt greek"> [!length]&rsquo;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
</div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">STREAMS</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Stream&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;array position limit</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">of:</span><span style="font: 10pt greek"> array<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position &larr; 0. limit &larr; array length]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">of:</span><span style="font: 10pt greek"> array </span><span style="font: 10pt greek; text-decoration: underline">from:</span><span style="font: 10pt greek"> position </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> limit<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position &larr; position-1]&rsquo;<br>Stream understands: &rsquo;default<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self of: (String new: 8)]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">next</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">simple result</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self myend? [!self pastend]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!array◦(position &larr; position+1)] primitive: 17&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">next &larr;</span><span style="font: 10pt greek"> x</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">simple arg</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self myend? [!self pastend &larr; x]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!array◦(position &larr; position+1) &larr; x] primitive: 18&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">append:</span><span style="font: 10pt greek"> x | i</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Array arg</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i from: x do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self next &larr; i].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!x]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">myend</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!position≥limit]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pastend</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!false]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pastend &larr;</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[array &larr; array grow. limit &larr; array length.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self next &larr; x]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">into:</span><span style="font: 10pt greek"> x | i</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Array result</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: x length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x◦i &larr; self next].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!x]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">contents</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(array◦(1 to: position)) copy]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">skip:</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position &larr; position+x]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">reset</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position &larr; 0]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">end</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!position≥limit]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">position</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!position]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">loc</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">synonym for compiler</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!position]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">empty</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!position=0]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">peek</span><span style="font: 10pt greek"> | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x&larr; self next? [position &larr; position-1.  !x]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">peek at next element</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">%</span><span style="font: 10pt greek"> x | y<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[y&larr; self next?</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">peek for matching element</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x=y? [!y]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">gobble it if found</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">position &larr; position-1. !false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pop</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">use it as a LIFO</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position&lt;1? [!false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">position &larr; position-1. !array◦</span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">position+1</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek">]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pop:</span><span style="font: 10pt greek"> n | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position&lt;n? [!false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">t &larr; self last: n.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">position &larr; position-n. !t]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">last</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!array◦position]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">last:</span><span style="font: 10pt greek"> n<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(array◦(position-n+1 to: position)) copy]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">dequeue</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">use it as a FIFO</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self dequeue: 1]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">dequeue</span><span style="font: 10pt greek; text-decoration: underline">:</span><span style="font: 10pt greek"> n | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[position&lt;n? [!false]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">t &larr; (array◦(1 to: n)) copy.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">array◦(1 to: position-n) &larr; array◦(n+1 to: position).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">position &larr; position-n. !t]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">upto:</span><span style="font: 10pt greek"> x | y s<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[s &larr; Stream default.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">until⦂ [x = (y &larr; self next)] do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[s next &larr; y].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self skip: ¬1.  !s contents]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> val<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!array◦x &larr; val]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!array◦x]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">space</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self next &larr; 040]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">tab</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self next &larr; 011]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">cr</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self next &larr; 015]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">print:</span><span style="font: 10pt greek"> obj<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[obj printon: self]&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asStream</span><span style="font: 10pt greek">&rsquo;<br>Stream understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asVector</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(Reader new of: self) read]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">GRAPHICAL OBJECTS</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Point&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;x y</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">x:</span><span style="font: 10pt greek"> x </span><span style="font: 10pt greek; text-decoration: underline">y:</span><span style="font: 10pt greek"> y&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">x &larr;</span><span style="font: 10pt greek"> x&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">x</span><span class="tab" val="24"></span><span style="font: 10pt greek"> [!x]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">y &larr;</span><span style="font: 10pt greek"> y&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">y</span><span style="font: 10pt greek"> [!y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">=</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!x=pt x and: y=pt y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">&lt;</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!x&lt;pt x and: y&lt;pt y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">≤</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!x≤pt x and: y≤pt y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">+</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: x+pt x y: y+pt y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">-</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: x-pt x y: y-pt y]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">*</span><span style="font: 10pt greek"> scale<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: x*scale y: y*scale]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">/</span><span style="font: 10pt greek"> scale<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: x/scale y: y/scale]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">|</span><span style="font: 10pt greek"> grid<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: x|grid y: y|grid]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">max:</span><span style="font: 10pt greek"> t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: (x max: t x) y: (y max: t y)]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">min:</span><span style="font: 10pt greek"> t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Point new x: (x min: t x) y: (y min: t y)]&rsquo;<br>Point understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">rect:</span><span style="font: 10pt greek"> p</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">infix creation of rectangles</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!Rectangle new origin: self corner: p]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: 10pt greek">Smalltalk insertall: "(black white gray ltgray dkgray backround <br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">storing oring xoring erasing)<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">with: "(0177777  0  055132  0101202  076575 055132  <br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">0 1 2 3).<br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Rectangle&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;origin corner</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">origin:</span><span style="font: 10pt greek"> origin </span><span style="font: 10pt greek; text-decoration: underline">corner:</span><span style="font: 10pt greek"> corner&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">origin</span><span style="font: 10pt greek"> [!origin]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">origin &larr;</span><span style="font: 10pt greek"> origin&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">corner</span><span style="font: 10pt greek"> [!corner]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">corner &larr;</span><span style="font: 10pt greek"> corner&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">extent</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!corner-origin]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">extent &larr;</span><span style="font: 10pt greek"> extent<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[corner &larr; origin+extent. !extent]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">has:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!origin≤pt and: pt&lt;corner]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">width</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!corner x - origin x]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">height</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!corner y - origin y]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">blt:</span><span style="font: 10pt greek"> dest </span><span style="font: 10pt greek; text-decoration: underline">mode:</span><span style="font: 10pt greek"> mode [] primitive: 47&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bltcomp:</span><span style="font: 10pt greek"> dest </span><span style="font: 10pt greek; text-decoration: underline">mode:</span><span style="font: 10pt greek"> mode [] primitive: 48&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">brush:</span><span style="font: 10pt greek"> dest </span><span style="font: 10pt greek; text-decoration: underline">mode:</span><span style="font: 10pt greek"> mode </span><span style="font: 10pt greek; text-decoration: underline">color:</span><span style="font: 10pt greek"> color [] primitive: 49&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">color:</span><span style="font: 10pt greek"> color </span><span style="font: 10pt greek; text-decoration: underline">mode:</span><span style="font: 10pt greek"> mode [] primitive: 50&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">clear:</span><span style="font: 10pt greek"> color<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self color: color mode: storing]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">clear</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">default is backround</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self color: backround mode: storing]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">comp</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self color: black mode: xoring]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">dragto:</span><span style="font: 10pt greek"> dest | b<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self blt: dest mode: storing.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">copy to new destination</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">b &larr; corner+dest-origin.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">and clear non-intersecting source</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[(origin max: dest) ≤ (corner min: b)?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[[dest x&gt;origin x?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[</span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">origin rect: dest x@corner y</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek"> clear]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">dest x&lt;origin x?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[</span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">b x@origin y rect: corner</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek"> clear]].<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[dest y&gt;origin y?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[(origin rect: corner x@dest y</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek"> clear]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">dest y&lt;origin y?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[</span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">origin x@b y rect: corner</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek"> clear]] ]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self clear]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">origin &larr; dest. corner &larr; b]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">inset:</span><span style="font: 10pt greek"> p1 </span><span style="font: 10pt greek; text-decoration: underline">and:</span><span style="font: 10pt greek"> p2<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!origin+p1 rect: corner-p2]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">inset:</span><span style="font: 10pt greek"> p1<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!origin+p1 rect: corner-p1]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">moveto:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[corner &larr; corner+pt-origin. origin&larr;pt]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">moveby:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[origin &larr; origin+pt. corner &larr; corner+pt]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">growto:</span><span style="font: 10pt greek"> corner &rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">center</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!origin+corner/2]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">outline:</span><span style="font: 10pt greek"> thick | t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; (¬1@¬1)*thick.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">(self inset: t) clear: black.  self clear: white]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">outline</span><span style="font: 10pt greek"> </span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">default border is two thick</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self outline: 2]&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">one thick is two thin</span><span style="font: 10pt greek">↪<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bitsIntoString</span><span style="font: 10pt greek"> | extent str<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[extent &larr; corner-origin.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">str &larr; String new: 2 * extent y * (extent x+15/16).<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self  bitsIntoString: str]&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bitsIntoString:</span><span style="font: 10pt greek"> str [] primitive: 51&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">bitsFromString:</span><span style="font: 10pt greek"> str [] primitive: 52&rsquo;<br>Rectangle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">fromuser</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[↪redbugcursor showwhile⦂ [↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ user anybug do⦂ [].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">until⦂ user anybug do⦂ [origin &larr; user mp].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ user anybug do⦂ [corner &larr; user mp. self comp. self comp].<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪]↪ ]&rsquo;<br></span><span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Turtle&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;pen ink width dir x xf y yf frame</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[ink &larr; ¬3. pen &larr; width &larr; 1. dir &larr; 270.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">frame &larr; user screenrect.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self place: frame center]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">go:</span><span style="font: 10pt greek"> length [] primitive: 53&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">goto:</span><span style="font: 10pt greek"> pt [] primitive: 54&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">turn:</span><span style="font: 10pt greek"> angle<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[dir &larr; dir+angle \ 360] primitive: 55&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">put:</span><span style="font: 10pt greek"> char </span><span style="font: 10pt greek; text-decoration: underline">font:</span><span style="font: 10pt greek"> font [] primitive: 56&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">show:</span><span style="font: 10pt greek"> str </span><span style="font: 10pt greek; text-decoration: underline">font:</span><span style="font: 10pt greek"> font | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ x from: str do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self put: x font: font]]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">place:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; pt x. y &larr; pt y. xf &larr; yf &larr; 0]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">width:</span><span style="font: 10pt greek"> width&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pen:</span><span style="font: 10pt greek"> pen&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ink:</span><span style="font: 10pt greek"> ink&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">up</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[dir &larr; 270]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">pendn</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[pen &larr; 1]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">penup</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[pen &larr; 0]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">black</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[ink &larr; ¬3]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">white</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[ink &larr; ¬1]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">xor</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[ink &larr; ¬2]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">home</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self place: frame center. dir &larr; 270]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">erase</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[frame clear: 0]&rsquo;<br>Turtle understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">frame:</span><span style="font: 10pt greek"> frame&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">TEXT DISPLAY</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Textframe&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;frame para style reply1 reply2 window</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">para:</span><span style="font: 10pt greek"> para </span><span style="font: 10pt greek; text-decoration: underline">frame:</span><span style="font: 10pt greek"> frame<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[window &larr; frame.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">reply1 &larr; reply1 &larr; 0.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">style &larr; DefaultTextStyle]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">show</span><span style="font: 10pt greek"> [] primitive: 57&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">show:</span><span style="font: 10pt greek"> para<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[para &larr; para asParagraph. self show]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">charofpt:</span><span style="font: 10pt greek"> pt [] primitive: 58&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">charnearpt:</span><span style="font: 10pt greek"> pt [] primitive: 58&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪synonym↪<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">selectchar:</span><span style="font: 10pt greek"> char<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self selectchar: char asInteger] primitive: 59&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ptofchar:</span><span style="font: 10pt greek"> char<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self selectchar: char. !reply1]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">rectofchar:</span><span style="font: 10pt greek"> char<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self selectchar: char. !reply1 rect: reply2]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">comp</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[window comp]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lineheight</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!style lineheight]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">scrolln:</span><span style="font: 10pt greek"> n<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self charofpt: frame origin+(0 @ (n+1*style lineheight))]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lastshown</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!reply1]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">window</span><span style="font: 10pt greek"> [!window]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">put:</span><span style="font: 10pt greek"> para </span><span style="font: 10pt greek; text-decoration: underline">at:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self put: para at: pt centered: false]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">put:</span><span style="font: 10pt greek"> para </span><span style="font: 10pt greek; text-decoration: underline">centered:</span><span style="font: 10pt greek"> pt<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self put: para at: pt centered: true]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">put:</span><span style="font: 10pt greek"> para </span><span style="font: 10pt greek; text-decoration: underline">at:</span><span style="font: 10pt greek"> pt </span><span style="font: 10pt greek; text-decoration: underline">centered:</span><span style="font: 10pt greek"> center<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[para &larr; para asParagraph.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">window&larr; frame&larr; pt rect: 1000◦1000.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self ptofchar: para length+1.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">find corner of text</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">window growto: reply2.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[center? [window moveby: pt-window center]].</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">center it</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self show]&rsquo;<br>Textframe understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: &rsquo;&rsquo;a Textframe&rsquo;&rsquo;]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Paragraph&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Array;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;text runs alignment</span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 12pt serif"><br></span><span style="font: 10pt greek">Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">text:</span><span style="font: 10pt greek"> text&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">text:</span><span style="font: 10pt greek"> text </span><span style="font: 10pt greek; text-decoration: underline">runs:</span><span style="font: 10pt greek"> runs&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">text:</span><span style="font: 10pt greek"> text </span><span style="font: 10pt greek; text-decoration: underline">alignment:</span><span style="font: 10pt greek"> alignment&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">text:</span><span style="font: 10pt greek"> text </span><span style="font: 10pt greek; text-decoration: underline">runs:</span><span style="font: 10pt greek"> runs </span><span style="font: 10pt greek; text-decoration: underline">alignment:</span><span style="font: 10pt greek"> alignment&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">flushleft</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[alignment &larr; 0]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">justify</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[alignment &larr; 1]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">center</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[alignment &larr; 2]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">flushright</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[alignment &larr; 4]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asParagraph</span><span style="font: 10pt greek">&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">replace:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> b </span><span style="font: 10pt greek; text-decoration: underline">by:</span><span style="font: 10pt greek"> s</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪no run support↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[text &larr; text replace: a to: b by: s.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">runs &larr; nil]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copy:</span><span style="font: 10pt greek"> a </span><span style="font: 10pt greek; text-decoration: underline">to:</span><span style="font: 10pt greek"> b</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪no run support↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(text◦(a to: b)) copy]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asVector</span><span style="font: 10pt greek"> [!text asVector]&rsquo;<br>Paragraph understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">length</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!text length]&rsquo;<br>Paragraph understands: &rsquo;◦</span><span style="font: 10pt greek; text-decoration: underline">x</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!text◦x]&rsquo;<br><br></span><span style="font: 10pt serif"><br>C</span><span style="font: bold 12pt serif">lass new title: &rsquo;TextStyle&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;fonts </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Vector of Strings or Integers&gt; which are the fonts.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">An integer entry has a vertical offset in the high 8 bits, a 1 in<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">the 200-bit for descent, and another font number (zero-relative)<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">in the bottom 4 bits↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">t</span><span style="font: bold 12pt serif">abandspace </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Integer&gt; =256*tabwidth + spacewidth↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">m</span><span style="font: bold 12pt serif">axascent </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Integer&gt; max ascent for this fontset↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">m</span><span style="font: bold 12pt serif">axdescent </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Integer&gt; max descent for this fontset↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">m</span><span style="font: bold 12pt serif">ode </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Integer&gt; =0 for normal, =4 for white-on-black↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: italic 10pt serif">f</span><span style="font: bold 12pt serif">ontnames </span><span style="font: italic 10pt serif">↪</span><span style="font: 10pt greek">&lt;</span><span style="font: italic 10pt serif">Vector of Strings&gt; corresponding to the fonts↪</span><span style="font: 10pt greek">&rsquo;</span><span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">T</span><span style="font: 10pt greek">extStyle understands: &rsquo;f</span><span style="font: 10pt greek; text-decoration: underline">onts </span><span style="font: 10pt greek">[!fonts]&rsquo;<br>TextStyle understands: &rsquo;l</span><span style="font: 10pt greek; text-decoration: underline">ineheight<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!maxascent+maxdescent]&rsquo;<br>TextStyle understands: &rsquo;d</span><span style="font: 10pt greek; text-decoration: underline">efault<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self mode: 0; tab: 20; space: 5]&rsquo;<br>TextStyle understands: &rsquo;t</span><span style="font: 10pt greek; text-decoration: underline">ab: </span><span style="font: 10pt greek">t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[tabandspace &larr; tabandspace field: leftbyte &larr; t]&rsquo;<br>TextStyle understands: &rsquo;s</span><span style="font: 10pt greek; text-decoration: underline">pace: </span><span style="font: 10pt greek">t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[tabandspace &larr; tabandspace field: rightbyte &larr; t]&rsquo;<br>TextStyle understands: &rsquo;m</span><span style="font: 10pt greek; text-decoration: underline">ode: </span><span style="font: 10pt greek">mode&rsquo;<br>TextStyle understands: &rsquo;s</span><span style="font: 10pt greek; text-decoration: underline">etfont: </span><span style="font: 10pt greek">n n</span><span style="font: 10pt greek; text-decoration: underline">ame: </span><span style="font: 10pt greek">str | name f</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪s</span><span style="font: italic 10pt serif">hould update max-a/de-scent↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[FontDict has: (</span><span style="font: 10pt serif">n</span><span style="font: 10pt greek">ame&larr; str unique)</span><span style="font: 10pt serif">?</span><span style="font: 10pt greek"> [fonts◦n &larr; FontDict◦name]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">f &larr; File new old named: str + &rsquo;&rsquo;.strike&rsquo;&rsquo;.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">f? [FontDict insert: name with: (fonts◦n &larr; f intostring)]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">user notify: &rsquo;&rsquo;Font &rsquo;&rsquo; +</span><span style="font: 10pt serif"> </span><span style="font: 10pt greek">str +</span><span style="font: 10pt serif"> </span><span style="font: 10pt greek">&rsquo;&rsquo;.strike not on this disk&rsquo;&rsquo;]&rsquo;<br>TextStyle understands: &rsquo;s</span><span style="font: 10pt greek; text-decoration: underline">etoffsetfont: </span><span style="font: 10pt greek">n f</span><span style="font: 10pt greek; text-decoration: underline">rom: </span><span style="font: 10pt greek">m b</span><span style="font: 10pt greek; text-decoration: underline">y: </span><span style="font: 10pt greek">d<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[fonts◦n &larr; m + [d&lt;0? [0200] 0] + (</span><span style="font: 10pt serif">d</span><span style="font: 10pt greek"> lshift: 8)</span><span style="font: 10pt serif">]</span><span style="font: 10pt greek">&rsquo;<br><br></span><span style="font: 10pt serif"><br>C</span><span style="font: bold 12pt serif">lass new title: &rsquo;Dispframe&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Stream;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;text&rsquo;</span><span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">D</span><span style="font: 10pt greek">ispframe understands: &rsquo;r</span><span style="font: 10pt greek; text-decoration: underline">ect: </span><span style="font: 10pt greek">r<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[text &larr; Textframe new para: nil frame: r.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self of: (</span><span style="font: 10pt serif">S</span><span style="font: 10pt greek">tring new: 16)</span><span style="font: 10pt serif">.</span><span style="font: 10pt greek"> self clear]&rsquo;<br>Dispframe understands: &rsquo;s</span><span style="font: 10pt greek; text-decoration: underline">how<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[text show: self contents.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">until⦂ text lastshown≥self position do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self dequeue: (text scrolln: 2).<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">text show: self contents]]&rsquo;<br>Dispframe understands: &rsquo;e</span><span style="font: 10pt greek; text-decoration: underline">v </span><span style="font: 10pt greek">| t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[while⦂ [t &larr; self request: &rsquo;&rsquo;<br>&#64257;&rsquo;&rsquo;] do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t≡nil? [self print: nil doit; show]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪redo↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self print: nil ⓢt; show]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>Dispframe understands: &rsquo;r</span><span style="font: 10pt greek; text-decoration: underline">equest: </span><span style="font: 10pt greek">s<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self append: s. !self read]&rsquo;<br>Dispframe understands: &rsquo;r</span><span style="font: 10pt greek; text-decoration: underline">ead </span><span style="font: 10pt greek">| n t<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self show. n &larr; 0.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">while⦂ true do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[t &larr; user kbd.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">t=4? [self skip: 0-n; append: &rsquo;&rsquo;done&rsquo;&rsquo;; show. !false]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪c</span><span style="font: italic 10pt serif">tl-d for done↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">t=8? [n=0?[self show]. self skip: ¬1. n &larr; n-1.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">user kbck?[]. self show]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪b</span><span style="font: italic 10pt serif">ackspace↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">t=2? [self skip: ¬1-n. !nil]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪r</span><span style="font: italic 10pt serif">edo↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">t=30? [t &larr; self last: n.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪d</span><span style="font: italic 10pt serif">o-it↪</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self next &larr; 30; cr; show. !t]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">t=24?[self reset; append: &rsquo;&rsquo;&#64257;&rsquo;&rsquo;; show. n&larr;0]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self next &larr; t. n &larr; n+1.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">user kbck? [] self show]]&rsquo;<br>Dispframe understands: &rsquo;c</span><span style="font: 10pt greek; text-decoration: underline">lear<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self reset. self show]&rsquo;<br>Dispframe understands: &rsquo;o</span><span style="font: 10pt greek; text-decoration: underline">utline<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[text window outline]&rsquo;<br>Dispframe understands: &rsquo;m</span><span style="font: 10pt greek; text-decoration: underline">oveto: </span><span style="font: 10pt serif">pt<br></span><span class="tab" val="24"></span><span style="font: 10pt serif">[(text window inset: ¬2@¬2) dragto: pt-(¬2@¬2)]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">SETS AND DICTIONARIES</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;HashSet&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;objects&rsquo;<br></span><span style="font: 10pt greek">HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">default</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self init: 4]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">default initial size</span><span style="font: 10pt greek">↪<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self init: 4]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">obsolete</span><span style="font: 10pt greek">↪<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init:</span><span style="font: 10pt greek"> size<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[objects &larr; Vector new: (size max: 4)]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insert:</span><span style="font: 10pt greek"> obj | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self findorinsert: obj. !obj]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">has:</span><span style="font: 10pt greek"> obj<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self find: obj? [!true] !false]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">findorinsert:</span><span style="font: 10pt greek"> obj | i</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">insert if not found, </span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[i &larr; self findornil: obj? [objects◦i &larr; obj. !i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self growto: objects length*2.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">may cause table to grow</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self findorinsert: obj]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">find:</span><span style="font: 10pt greek"> obj | i</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">!index if found, else false</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[i &larr; self findornil: obj?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[objects◦i≡nil? [!false] !i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">findornil:</span><span style="font: 10pt greek"> obj | i loc</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">!index if found or if room, else false</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[loc &larr; obj hash\objects length+1.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">does this match the ucode</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">objects◦loc ≡ nil? [!loc]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">objects◦loc = obj? [!loc]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">first probe cheap</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i to: (4 max: objects length / 4) do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[loc &larr; loc\objects length+1.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">better delta later if necess</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">objects◦loc ≡ nil? [!loc]<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">objects◦loc = obj? [!loc]]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!false]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">delete:</span><span style="font: 10pt greek"> obj | i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[i &larr; self find: obj?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[objects◦i &larr; nil.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">delete, then rehash</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">!self growto: objects length]]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">returns result of growto</span><span style="font: 10pt greek">↪<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">growto:</span><span style="font: 10pt greek"> size | copy i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[copy &larr; self class new init: size.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">create a copy</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ i from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[copy insert: i]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">hash each entry into it</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">objects &larr; copy objects]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">then take on all its state</span><span style="font: 10pt greek">↪<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">objects</span><span style="font: 10pt greek"> [!objects]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">objects&larr;</span><span style="font: 10pt greek"> objects&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">contents</span><span style="font: 10pt greek"> | obj strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm &larr; (Vector new: objects length) asStream.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ obj from: objects do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[obj≡nil? [] strm next&larr; obj]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!strm contents]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">asStream</span><span style="font: 10pt greek"><br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!self contents asStream]&rsquo;<br>HashSet understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">notthere:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[user notify: name asString+&rsquo;&rsquo; not found.&rsquo;&rsquo;]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;Dictionary&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: HashSet;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;values&rsquo;<br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Dictionaries have the same lookup properties as Sets, except that they also associate a value with each object present.</span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif"><br></span><span style="font: 10pt greek">Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init:</span><span style="font: 10pt greek"> size<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[values &larr; Vector new: size. super init: size]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insert:</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">with:</span><span style="font: 10pt greek"> value<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self insert: name.  values◦(self find: name) &larr; value]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> name | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; self find: name? [!values◦x]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self notthere: name]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> value | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; self find: name? [!values◦x &larr; value]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self notthere: name]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">lookup:</span><span style="font: 10pt greek"> name | x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[x &larr; self find: name? [!values◦x] !false]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">growto:</span><span style="font: 10pt greek"> size | name copy<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[copy &larr; self class new init: size.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪create a copy of the new size↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ name from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[copy insert: name with: self◦name]</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪hash each entry into it↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self copyfrom: copy]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪then take on all its state↪<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">copyfrom:</span><span style="font: 10pt greek"> dict<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self objects &larr; dict objects copy.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">values &larr; dict values copy]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">values</span><span style="font: 10pt greek"> [!values]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">clean</span><span style="font: 10pt greek"> | name</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">release unreferenced entries</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ name from: self do⦂</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">slick, huh</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[(self◦name) refct = 1 ? [self delete: name]]]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insertall:</span><span style="font: 10pt greek"> names </span><span style="font: 10pt greek; text-decoration: underline">with:</span><span style="font: 10pt greek"> vals | i</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">insert many entries</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[for⦂ i to: names length do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self insert: names◦i with: vals◦i]]&rsquo;<br>Dictionary understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insertall:</span><span style="font: 10pt greek"> names</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">default value is nil</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self insertall: names with: (Vector new: names length)]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;SymbolTable&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: Dictionary;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields:&rsquo;&rsquo;<br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">SymbolTables have the same properties as Dictionaries, except that an indirect reference is interposed between the value entries and the actual values.  This allows compiled code to point directly at a reference which remains valid although the value changes.  Notice that the define message checks in Undefined for unresolved references which the compiler may have placed there previously.</span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif"><br></span><span style="font: 10pt greek">SymbolTable understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insert:</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">with:</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[super insert: name with: </span><span style="font: 10pt serif">(</span><span style="font: 10pt greek">ObjectReference new value&larr; x</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek">]&rsquo;<br>SymbolTable understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(super◦name) value]&rsquo;<br>SymbolTable understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">◦</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">&larr;</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!(super◦name) value &larr; x]&rsquo;<br>SymbolTable understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">ref:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!super◦name]&rsquo;<br>SymbolTable understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">define:</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">as:</span><span style="font: 10pt greek"> x<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[self has: name? [self◦name &larr; x]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">Undeclared has: name?<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[super insert: name with: (</span><span style="font: 10pt serif">U</span><span style="font: 10pt greek">ndeclared ref: name</span><span style="font: 10pt serif">)</span><span style="font: 10pt greek">.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self◦name &larr; x.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">Undeclared delete: name]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">self insert: name with: x]&rsquo;<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;MessageDict&rsquo;;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">subclassof: HashSet;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;methods </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector of Strings&gt; which are the compiled methods for each message</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">literals </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector of Vectors&gt; which hold pointers to literals used in the methods</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">code </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector of Strings&gt; which are the source text for each message</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif"><br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">backpointers </span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">&lt;Vector of Vectors&gt; which are the tables of text location vs pc for each message</span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">&rsquo;<br></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Note that insertion and deletion return the updated dictionary.  This is because Smalltalk may be executing out of the dictionary.  The final switch to the new dictionary is made in Class with one atomic assignment.</span><span style="font: 10pt greek">↪<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">init:</span><span style="font: 10pt greek"> size<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[methods &larr; Vector new: size.  literals &larr; Vector new: size.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">code &larr; Vector new: size.  </span><span class="tab" val="24"></span><span style="font: 10pt greek">backpointers &larr; Vector new: size.<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">super init: size]&rsquo;<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">insert:</span><span style="font: 10pt greek"> name </span><span style="font: 10pt greek; text-decoration: underline">method:</span><span style="font: 10pt greek"> m </span><span style="font: 10pt greek; text-decoration: underline">literals:</span><span style="font: 10pt greek"> l<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek; text-decoration: underline">code:</span><span style="font: 10pt greek"> c </span><span style="font: 10pt greek; text-decoration: underline">backpointers:</span><span style="font: 10pt greek"> b | i copy<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[i &larr; self findornil: name?</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">if name is already there</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[methods◦i &larr; m. literals◦i &larr; l. code◦i &larr; c. backpointers◦i &larr; b.<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">self objects◦i &larr; name]</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">then do it, and return self</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">copy &larr; self growto: methods length*2.</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">Otherwise, copy</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">copy insert: name method: m literals: l<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">code: c backpointers: b.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">and insert</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!copy]&rsquo;</span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">and return the new dict without altering old</span><span style="font: 10pt greek">↪<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">method:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!methods◦(self find: name)]&rsquo;<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">literals:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!literals◦(self find: name)]&rsquo;<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">code:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!code◦(self find: name)]&rsquo;<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">backpointers:</span><span style="font: 10pt greek"> name<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!backpointers◦(self find: name)]&rsquo;<br>MessageDict understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">growto:</span><span style="font: 10pt greek"> size | name copy i<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[copy &larr; self class new init: size.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">create a copy of the new size</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">for⦂ name from: self do⦂<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">[i &larr; self find: name.</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">hash each entry into it</span><span style="font: 10pt greek">↪<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">copy insert: name method: methods◦i literals: literals◦i<br></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span class="tab" val="24"></span><span style="font: 10pt greek">code: code◦i backpointers: backpointers◦i]<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">!copy]&rsquo;</span><span class="tab" val="24"></span><span style="font: 10pt greek">↪</span><span style="font: italic 10pt serif">copy new parts</span><span style="font: 10pt greek">↪<br><br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: 10pt serif"><br></span><span style="font: 10pt greek">↪</span><span style="font: bold 12pt serif">INDIRECT REFERENCES</span><span style="font: 10pt greek">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;ObjectReference&rsquo;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;object&rsquo;<br></span><span style="font: 10pt greek">ObjectReference understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">value</span><span style="font: 10pt greek"> [!object]&rsquo;<br>ObjectReference understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">value &larr;</span><span style="font: 10pt greek"> object&rsquo;<br>ObjectReference understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">printon:</span><span style="font: 10pt greek"> strm<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[strm append: &rsquo;&rsquo;-&gt;&rsquo;&rsquo;; space; print: object class]&rsquo;<br></span><span style="font: 10pt serif"><br></span><span style="font: bold 12pt serif">Class new title: &rsquo;FieldReference&rsquo;<br></span><span class="tab" val="24"></span><span style="font: bold 12pt serif">fields: &rsquo;object offset&rsquo;<br></span><span style="font: 10pt greek">FieldReference understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">value</span><span style="font: 10pt greek"> [!object instfield: offset]&rsquo;<br>FieldReference understands: &rsquo;</span><span style="font: 10pt greek; text-decoration: underline">value &larr;</span><span style="font: 10pt greek"> value<br></span><span class="tab" val="24"></span><span style="font: 10pt greek">[!object instfield: offset &larr; value]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
</div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
