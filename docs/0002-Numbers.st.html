<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Numbers.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 10:39:18 pm.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"Natural"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;Natural&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: String<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;Naturalzero &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">bytesize: 8;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A Natural consists of digits between 0 and 255. Accessing beyond the end gives zeroes. This Class is intended to be used by people who implement nicer numbers such as LargeInteger or Rational, thus some of the messages are hard to use because they smash existing Naturals. These messages are only used on Naturals that were created by the programmer using the message.<br>Since we want to eventually have the result of a LargeInteger operation to return a SmallInteger if possible, Natural numbers do not respond to the same set of arithmetic messages as Integers. All of the messages for Natural numbers are preceeded by "nat".</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natadd: arg </span><span style="font: 10pt serif">| shorter longer i z sum<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["returns a Natural number"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length &lt; arg length  ⇒ [longer &larr; arg. shorter &larr; self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">longer &larr; self. shorter &larr; arg].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sum &larr; Natural new: (longer length).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: longer length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z increaseby: longer ◦ i. z increaseby: shorter ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sum ◦ i &larr; z extract].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z low ≠ 0 ⇒ [ sum &larr; sum growby: 1. sum last &larr; z low]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natcompare: arg </span><span style="font: 10pt serif">| i len<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"speeded up for Integer args, same speed for LargeInteger (Natural) args"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[len &larr; self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arg length &lt; len⇒ [⇑3]; &gt; len⇒[⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(arg◦i) &lt; (self◦i)⇒[⇑3];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt; (self◦i)⇒[⇑1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natdiv: arg </span><span style="font: 10pt serif">| quo rem ql d div dh dnh z z2 dl q i j k l carry digit flag<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["returns a vector of (quotient, remainder)"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; ((self length) - (arg length) + 1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[l≤0 ⇒[⇑(Naturalzero, self)]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; 8 - (arg last hibit).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; self natnormalize: d. "makes a copy and shifts"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">div &larr; arg natnormalize: d. "shifts so high order word is &gt;127"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">quo &larr; Natural new: l.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dl &larr; div length - 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ql &larr; l.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dh &larr; div◦dl.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dnh &larr; [dl=1 ⇒[0](div◦(dl-1))].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 &larr; MachineDouble new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ k to: ql do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"maintain quo*arg+rem=self"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[j &larr; rem length + 1 - k.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z high &larr; rem◦j.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z high = dh ⇒ [q &larr; ¬1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z low &larr; rem◦(j-1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">q &larr; z mdiv: dh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z low &larr; [j&lt;3⇒[0]rem◦(j-2)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 gets: q mtimes: dnh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">flag &larr; true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((z &lt; z2) and⦂ flag) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[q &larr; q unsignedadd: ¬1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> z2 decreaseby: dnh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [z2 high &lt; dh ⇒ [flag &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 high &larr; z2 high - dh]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; j - dl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 init.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">carry &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: div length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z gets: q mtimes: (div◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 increaseby: rem◦l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 decreaseby: carry.  "subtract q * div from rem"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z2 decreaseby: z low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">carry &larr; z high.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem◦l &larr; z2 extract.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; l+1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z2 low = 255 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[q &larr; q unsignedadd: ¬1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; j - dl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z init.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: div length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z increaseby: rem◦l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z increaseby: (div◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem◦l &larr; z extract.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; l+1]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">quo◦(quo length + 1 - k) &larr; q.].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; rem natunnormalize: d lookfirst: dl.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[quo last = 0 ⇒ [ql&lt;2⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">quo &larr; quo growby: ¬1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(quo,rem)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natdivideandCarry: arg extra: pair </span><span style="font: 10pt serif">| i len z<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["arg is an integer &lt; 256 - returns remainder, smashes self to quotient - pair is a 2-vector of len (index of high order non-zero word in self) and a MachineDouble - be careful!!!"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z &larr; pair ◦ 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z high &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; pair ◦ 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z low &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ◦ i &larr; (z mdiv: arg)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self ◦ len = 0 ⇒[len &larr; len - 1. len=0⇒[len &larr; 1]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pair ◦ 1 &larr; len.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑z high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natnormalize: n </span><span style="font: 10pt serif">| x i r f digit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["n is the number of bits to shift by. The Natural number returned will be written over repeatedly, so we must make a new one."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; (Natural new: (self length+1)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f &larr; n-8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: r length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digit &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r◦i &larr; (digit lshift: n) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; digit lshift: f.].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natsubtract: arg </span><span style="font: 10pt serif">| shorter longer i z sum sl al ng lastdigit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["returns an Integer that is created by this operation"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> sl &larr; self length. al &larr; arg length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [sl = al ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; sl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (((self ◦i)=(arg◦i)) and⦂ (i&gt;1)) do⦂ [i &larr; i - 1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sl &larr; i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦i unsignedlessthan: arg◦i ⇒[longer &larr; arg. ng &larr; true. shorter &larr; self]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">longer &larr; self. shorter &larr; arg. ng &larr; false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  sl &lt; al  ⇒ [longer &larr; arg. shorter &larr; self. ng &larr; true. sl &larr; al]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  longer &larr; self. shorter &larr; arg. ng &larr; false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> sum &larr; Natural new: longer length. lastdigit &larr; 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i to: longer length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z increaseby: longer ◦ i. z decreaseby: shorter ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> (sum ◦ i &larr; z extract)≠0⇒[lastdigit&larr;i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [lastdigit=longer length⇒[] z &larr; (Natural new: lastdigit).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: lastdigit do⦂ [z◦i &larr; sum◦i]. sum &larr; z].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑LargeInteger new bytes: sum neg: ng]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nattimes: arg </span><span style="font: 10pt serif">| prod z pl carry digit i j k<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[((self length) = 1) and⦂ ((self◦1) = 0) ⇒ [⇑Naturalzero]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pl &larr; (self length) + arg length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">prod &larr; (Natural new: pl).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z &larr; MachineDouble new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: pl do⦂ [prod ◦ i &larr; 0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[k &larr; i - 1. carry &larr; 0. digit &larr; self ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">digit ≠ 0 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ j to: arg length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[z gets: digit mtimes: (arg ◦ j).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z increaseby: carry. k &larr; k + 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">z increaseby: (prod ◦ k).  "k=i+j-1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">prod◦k&larr; z low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">carry &larr; z high]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">prod◦(k+1)&larr;carry]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(prod◦pl) = 0 ⇒ [⇑ prod growby: ¬1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑prod]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natunnormalize: n lookfirst: a </span><span style="font: 10pt serif">| x i r f digit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n &larr; 0 - n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f &larr; n+8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; a.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">digit &larr; self◦i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((((digit lshift: n) lor: x)=0) and⦂ (i≠1)) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; digit lshift: f.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; i - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">digit &larr; self ◦ i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; (Natural new: i).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; (self◦1) lshift: n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: a do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digit &larr; self ◦ (i+1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r◦i &larr; (digit lshift: f) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; digit lshift: n.].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[super length &lt; n ⇒ [⇑0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑(super◦n)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInteger<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length=1⇒[⇑self◦1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑LargeInteger new bytes: self neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Naturalzero&larr;Natural new: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> Naturalzero◦1&larr;0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isLarge<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[self printon: strm base: 10]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm base: b </span><span style="font: 10pt serif">| p z n b2 x "only works if b≤10"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[p &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">z &larr; (self length, MachineDouble new).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; Natural new: super length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b2 &larr; b*b.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyto: n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (((z ◦ 1) = 1) and⦂ ((n◦1)&lt;b2)) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; (n natdivideandCarry: b2 extra: z).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> p next&larr; (x\b)+060.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> p next&larr; (x/b)+060].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(n◦1) printon: strm base: b.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: p contents reverse]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Natural]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Natural under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Natural classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Number"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Number&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Numbers in general</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≠ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑((self=arg) ≡ false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; n </span><span style="font: 10pt serif">[⇑self - n &lt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= n </span><span style="font: 10pt serif">[⇑self - n = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; n </span><span style="font: 10pt serif">[⇑self - n &gt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">abs </span><span style="font: 10pt serif">[self&lt;0⇒[⇑self * ¬1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">between: min and: max<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑[min≤self and⦂ self≤max]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compare: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self &lt; i⇒ [⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self = i⇒ [⇑2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">factorial  </span><span style="font: italic 10pt serif">"I only work for positive integer values"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self=0⇒[⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self * (self-1) factorial]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">log2 </span><span style="font: 10pt serif">| i cnt </span><span style="font: italic 10pt serif">"floor of log base 2"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self &lt; 0 ⇒[⇑(self * ¬1) log2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self &lt; 1 ⇒[⇑((self/self) / self) log2 * ¬1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; 1. cnt &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ self ≥ i do⦂ [i &larr; i+i. cnt &larr; cnt+1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑cnt-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">max: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;arg⇒[⇑arg]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">min: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&gt;arg⇒[⇑arg]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sign<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑[self=0⇒ [0]; &lt;0⇒ [¬1] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asPoint<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return a Point with me as both coordinates."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self ⌾ self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asPtX </span><span style="font: italic 10pt serif">"pretend to be a Point for Point +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asPtY </span><span style="font: italic 10pt serif">"pretend to be a Point for Point +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRectangle<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return a Rectangle with me as all coordinates."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self ⌾ self rect: self ⌾ self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRectCorner </span><span style="font: italic 10pt serif">"pretend to be a Rectangle for Rectangle +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRectOrigin </span><span style="font: italic 10pt serif">"pretend to be a Rectangle for Rectangle +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">base8 </span><span style="font: 10pt serif">| s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default. s append: &rsquo;0&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self printon: s base: 8. ⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">base: b </span><span style="font: 10pt serif">| s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self printon: s base: b. ⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[self printon: strm base: 10]</span><span class="tab" val="79"></span><span style="font: 10pt serif">"default print radix"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Subscripts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cansubscript: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asInteger cansubscript: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑a◦self asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: a &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑a◦self asInteger &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Intervals, Points</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">⌾ y<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Point new x: self y: y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">for: n </span><span style="font: 10pt serif">[⇑Interval new from: self to: self+(n-1) by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">to: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Interval new from: self to: x by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">to: x by: y<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Interval new from: self to: x by: y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">within: int </span><span style="font: 10pt serif">[⇑int start ≤ self and⦂ self ≤ int stop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">~ x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"synonym for </span><span style="font: bold 10pt serif">to:</span><span style="font: 10pt serif"> "</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Interval new from: self to: x by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isLarge<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isNumber</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Number under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Date"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Date&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Number<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;day year&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;monthnames secsinday &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Implements dates. (Steve Weyer)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">monthnames &larr; ↪(<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">January February March April May June<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">July August September October November December).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">secsinday &larr; 24*60*60]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Setting state</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">day: day month: month year: year </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[year &lt; 100⇒ [year &larr; 1900 + year]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(month &larr; self whichmonth: month)≡false⇒ [user notify: &rsquo;illegal month&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">day &lt; 1 or⦂ day &gt; (self daysinmonth: month)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;illegal day in month&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">day &larr; day + (self monthday: month)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">day: day year: year </span><span style="font: 10pt serif">| d<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ day &gt; (d &larr; self daysinyear) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">year &larr; year + 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">day &larr; day - d].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ day ≤ 0 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">year &larr; year - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">day &larr; day + self daysinyear].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">today</span><span style="font: 10pt serif">" ⇑user now◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromDays: d </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">d = days since Jan 1 1901. There are 1461 days in a 4-year cycle.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">2000 is a leap year, so no extra correction is necessary.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">day:year: will fix things up</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; d asInteger intdiv: 1461.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self day: 1+ (d◦2) asSmall year: 1901+ ((d◦1) asSmall *4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSeconds </span><span style="font: 10pt serif">"Seconds since the beginning of time (local time)" [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑secsinday * (self - (Date new day: 1 year: 1901))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">day </span><span style="font: 10pt serif">[⇑day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dayinmonth </span><span style="font: 10pt serif">[⇑day - (self monthday: self month)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dayinyear </span><span style="font: 10pt serif">[⇑day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">daysinmonth </span><span style="font: 10pt serif">[⇑self daysinmonth: self month]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">daysinmonth: m </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑↪(31 28 31 30 31 30 31 31 30 31 30 31)◦m + [m=2⇒ [self leap] 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">daysinyear </span><span style="font: 10pt serif">[⇑365 + self leap]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">daysleft </span><span style="font: 10pt serif">[⇑self daysinyear - day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">day&larr; day</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[⇑(year lshift: 3) lxor: day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leap </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">year \ 4 = 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">year \ 100 = 0⇒ [year \ 400 = 0⇒ [⇑1] ⇑0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">month </span><span style="font: 10pt serif">| m leap [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">leap &larr; self leap.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m from: 12 to: 1 by: ¬1 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(↪(0 31 59 90 120 151 181 212 243 273 304 334)◦m +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[m &gt; 2⇒ [leap] 0] "self monthday: m") &lt; day⇒ [⇑m]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;illegal month&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">monthday: m </span><span style="font: italic 10pt serif">"Return first day-in-year of m&rsquo;th month"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑↪(0 31 59 90 120 151 181 212 243 273 304 334)◦m +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[m &gt; 2⇒ [self leap] 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">monthname </span><span style="font: 10pt serif">[⇑monthnames◦self month]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">weekday </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑↪(Tuesday Wednesday Thursday Friday Saturday Sunday Monday)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">◦self weekdayIndex]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">weekdayIndex | a d </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[day ≤ (self monthday: 3)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; year-1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; 306]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; year.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; ¬59 - self leap].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Tuesday=1,..., Monday=7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑d + day + a + (a/4) + (a/400) - (a/100) \ 7 + 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">whichmonth: m </span><span style="font: 10pt serif">| a </span><span style="font: italic 10pt serif">"M may be a (partial) month name, or a number.  Return the month number, or false"</span><span style="font: 10pt serif"> [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m Is: String⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; m + &rsquo;*&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a to: 12 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"first partial match"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">m match: monthnames◦a⇒ [⇑a]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑m ≥ 1 and⦂ m ≤ 12]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">year </span><span style="font: 10pt serif">[⇑year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">year&larr; year</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">+ days </span><span style="font: 10pt serif">| t [</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">days &larr; day + days.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; Date new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">days &gt; 0 and⦂ days &lt; 366⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">same year</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t day &larr; days; year &larr; year.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t day: days year: year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">- date<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[date is: Date⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">year = date year⇒ [⇑day - date day]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(year-1 / 4) - (date year / 4) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">day + date daysleft + (year-1 - date year * 365)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self + (0 - date)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; date </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">year = date year⇒ [⇑day &lt; date day]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑year &lt; date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= date </span><span style="font: 10pt serif">[⇑day = date day and⦂ year = date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; date </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">year = date year⇒ [⇑day &gt; date day]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑year &gt; date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">previous: di </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"e.g. previous: 6 (Sunday) returns Date which is previous closest Sunday.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">note: di=self weekdayIndex returns self+0"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self + (0 - (7 + self weekdayIndex - di \ 7))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing and reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">from: s </span><span style="font: 10pt serif">[self readfrom: s asVector "asSet" viewer format: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[self printon: strm format: ↪(1 2 3 040 3 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm format: f </span><span style="font: 10pt serif">| i m [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">f is print format.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">1-3</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">positions to print day,month,year respectively<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">4</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">character separator<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">5</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">month format (1 month #, 2 first 3 chars, 3 entire name)<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">6</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">year format (1 year #, 2 year #\100)</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; self month.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 3 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f◦i<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=1⇒ [day - (self monthday: m) printon: strm];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f◦5<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=1⇒ [m printon: strm];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2⇒ [strm append: monthnames◦m◦(1 to: 3)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: monthnames◦m]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">([f◦6=1⇒ [year] year\100]) printon: strm].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&lt;3⇒ [strm next &larr; f◦4 "</span><span style="font: italic 10pt serif">separator</span><span style="font: 10pt serif">"]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readfrom: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self readfrom: strm format: ↪(1 2 3)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readfrom: strm format: order </span><span style="font: 10pt serif">| dmy i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm ∢ ↪today⇒ [⇑self default]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[order ≡ nil⇒ [order &larr; ↪(1 2 3)]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dmy &larr; Vector new: 3.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 3 "dmy length" do⦂ [dmy◦(order◦i) &larr; strm next].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self day: dmy◦1 month: dmy◦2 year: dmy◦3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Date under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Date classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Float"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Float&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Number<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;halfpi sqrt2 twopi fourthpi degreesPerRadian pi radiansPerDegree ln2 &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">bytesize: 16;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">veryspecial: 3;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>These floating-point numbers are good for about 8 or 9 digits of accuracy, and the range is between plus and minus 10&uarr;4000.  Here are some valid floating-point examples:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">8.0   13.3   0.3   2.5e6   1.27e¬300   ¬12.987654e2412<br>Mainly: use shift-minus, no imbedded blanks, little e for tens power, and a digit on both sides of the decimal point.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≤ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≤arg asFloat] primitive: 73</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≠ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≠arg asFloat] primitive: 76</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≥ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≥arg asFloat] primitive: 75</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">* arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self*arg asFloat] primitive: 69</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">+ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self+arg asFloat] primitive: 67</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">- arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self-arg asFloat] primitive: 68</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">/ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0.0=arg⇒[user notify: &rsquo;Attempt to divide by 0.0&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self/arg asFloat] primitive: 70</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self&lt;arg asFloat] primitive: 71</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg isNumber⇒ [⇑self = arg asFloat] ⇑false] primitive: 72</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self&gt;arg asFloat] primitive: 74</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[⇑(self fpart * 100) asInteger lxor: self ipart asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">near: n </span><span style="font: 10pt serif">[⇑self near: n within: 1.0e¬4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">near: n within: eps </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"for testing near equality, e.g. error convergence"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self - n) abs ≤ eps]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">negated </span><span style="font: 10pt serif">[⇑0.0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sameAs: arg  </span><span style="font: italic 10pt serif">"arg assumed to be of same class as self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self=arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">\ arg</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"By analogy with integers"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0.0⇒[⇑(self/arg) ipart+1.0*arg+self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self-((self/arg) ipart*arg)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">| arg</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"By analogy with integers"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self/arg) ipart*arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asDegrees</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"self assumed to be in radians"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self / radiansPerDegree]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asDirection </span><span style="font: 10pt serif">[⇑self cos ⌾ self sin]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFloat</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInteger</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Return an Integer = self ipart"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asLarge] primitive: 78</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asLarge </span><span style="font: 10pt serif">| me digits nat i "convert to LargeInteger"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0⇒[⇑(0.0-self) asLarge negated]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> digits &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [self=0.0⇒[digits next&larr; 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  me &larr; self ipart.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  while⦂ me≥1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digits next &larr; (me\256.0) asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span class="tab" val="79"></span><span style="font: 10pt serif"> me &larr; me/256.0]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> digits &larr; digits contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> nat &larr; Natural new: digits length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i to: digits length do⦂ [nat◦i &larr; digits◦i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑LargeInteger new bytes: nat neg: false]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRadians</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"self assumed to be in degrees"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self * radiansPerDegree]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fpart </span><span style="font: 10pt serif">[user croak] primitive: 77</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ipart</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Returns a Float with zero fractional part"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self-self fpart]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">round<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self + [self &lt; 0⇒ [¬0.5] 0.5]) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Math functions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">arctan </span><span style="font: 10pt serif">| theta term y eps i  "return angle in degrees good to .02 degrees."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self = 1.0 ⇒ [⇑ 45.0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self = ¬1.0 ⇒ [⇑ ¬45.0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [self*self &gt;1.0 ⇒[theta &larr; halfpi. y &larr; ¬1.0/(self*self).  term &larr; ¬1.0/(self abs).]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">theta &larr; 0.0. y &larr; 0.0 - (self*self).  term &larr; self abs].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; 1.  eps &larr; 0.0001. <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ term abs &gt; eps do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[theta &larr; theta + term.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> term &larr; term*y*(i asFloat)/((i+2) asFloat).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> i &larr; i+2].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">theta &larr; (self sign asFloat)*theta* 360.0 / twopi.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ theta] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cos  </span><span style="font: italic 10pt serif">"for angles in radians"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0.0⇒[⇑(self+halfpi) sin]</span><span style="font: italic 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(halfpi-self) sin]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">exp </span><span style="font: 10pt serif">| a n1 x x2 P Q [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"see Computer Approximations, pp. 96-104, p. 205 (EXPB 1065)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self abs &gt; 9212.0 "1.0e4001 ln"⇒ [user notify: &rsquo;exp overflow&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self / ln2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(n1 &larr; Float new "2.0 ipow: x asInteger")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">instfield: 1 &larr; x asInteger * 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(x &larr; x fpart) ≥ 0.5⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n1 &larr; n1 * sqrt2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; x - 0.5]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"compute 2.0 power: x"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">P &larr; Q &larr; 0.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"↪(0.25250428525576241933744e4 0.28875563776168927289e2) reverse copy"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a from: ↪(28.875564 2525.0429) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">P &larr; (P*x2) + a].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"↪(0.72857336028361108885189e4 0.375021654220866600213e3 0.1e1) reverse copy"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a from: ↪(1.0 375.02165 7285.7336) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Q &larr; (Q*x2) + a].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑n1 * ((Q + (x*P))/(Q - (x*P)))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ipow: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"fixed powers in log n steps"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x=0⇒ [⇑1.0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x=1⇒ [⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x&gt;1⇒ [⇑((self*self) ipow: x/2)*(self ipow: x\2)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑1.0/(self ipow: 0-x)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ln </span><span style="font: 10pt serif">| a x x2 n P [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"see Computer Approximations, pp. 105-111, p. 227 (LOGE 2663)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ≤ 0.0⇒ [user notify: &rsquo;ln not valid for &rsquo; + self asString]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self + 0.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"exponent"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; ln2 * (((x instfield: 1) / 2) asFloat - 0.5).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"mantissa between 0.5 and 1.0".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x instfield: 1 &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; x * sqrt2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; (x - 1.0) / (x + 1.0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">P &larr; 0.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"↪(0.2000000000046727e1 0.666666635059382 0.4000059794795<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">0.28525381498 0.2376245609) reverse copy"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a from: ↪(0.23762456 0.28525381 0.40000598 0.66666664 2.0) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">P &larr; (P*x2) + a].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑n + (x * P)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">log: base </span><span style="font: 10pt serif">[⇑self ln / base asFloat ln]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">neg</span><span style="font: bold italic 10pt serif"> </span><span style="font: italic 10pt serif">"Obsolete - use </span><span style="font: bold 10pt serif">negated,</span><span style="font: italic 10pt serif"> which is uniform for all Numbers"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self negated]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sin </span><span style="font: 10pt serif">| x x2 sum const  </span><span style="font: italic 10pt serif">"for angles in radians"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0.0⇒[⇑self negated sin negated];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" normalize to 0≤self≤(pi/4) "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;twopi⇒[⇑(self\twopi) sin];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;pi⇒[⇑(self-pi) sin negated];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;halfpi⇒[⇑(pi-self) sin]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sum &larr; x &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ const from:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Now compute the series"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(¬0.1666666664 0.0083333315 ¬1.98409e¬4 2.7526e¬6 ¬2.39e¬8)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [sum &larr; const*(x &larr; x*x2)+sum]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sqrt </span><span style="font: 10pt serif">| guess i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≤0.0⇒[self=0.0⇒[⇑0.0] user notify: &rsquo;sqrt invalid for x&lt;0.&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guess &larr; self+0.0.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"copy x"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guess instfield: 1 &larr; (guess instfield: 1)/4*2.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"and halve expt for first guess"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 5 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[guess &larr; (self-(guess*guess)) / (guess*2.0) + guess]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑guess]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tan </span><span style="font: 10pt serif">| x x2 sum const  </span><span style="font: italic 10pt serif">"for angles in radians"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0.0⇒[⇑self negated tan negated];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" normalize to 0≤self≤(pi/4) "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;pi⇒[⇑(self\pi) tan];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;halfpi⇒[⇑(self-halfpi) tan negated];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;fourthpi⇒[⇑1.0/(halfpi-self) tan]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sum &larr; x &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ const from:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Now compute the series"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(0.3333314036 0.1333923995 0.0533740603 0.0245650893 0.0029005250 0.0095168091)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [sum &larr; const*(x &larr; x*x2)+sum]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">absprinton: strm digits: digits   </span><span style="font: italic 10pt serif">"print me using digits significant figures"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| fuzz x exp q i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"x is myself normalized to [1.0, 10.0), exp is my exponent"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp &larr; [self&lt;1.0⇒ [0-(10.0/self epart: 10.0)] self epart: 10.0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self/(10.0 ipow: exp).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"round the last digit to be printed"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fuzz &larr; 10.0 ipow: 1-digits.  x &larr; 0.5*fuzz+x.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"check if rounding has unnormalized x"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x≥10.0⇒[x&larr;x/10.0.  exp&larr;exp+1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[exp&lt;6 and⦂ exp&gt;¬4⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[q &larr; 0.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"decimal notation"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp&lt;0⇒ [strm append: &rsquo;0.0000&rsquo;◦(1 to: 1-exp)]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">q &larr; exp. exp &larr; 0].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"scientific notation"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">use fuzz to track significance"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ x≥fuzz do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; x asInteger.  strm next &larr; 060+i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; x-i * 10.0.  fuzz &larr; fuzz*10.0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp &larr; exp-1.  exp=¬1⇒ [strm append: &rsquo;.&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">append additional zeros if necessary</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ exp≥¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm next &larr; 060.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp &larr; exp-1.  exp=¬1⇒ [strm append: &rsquo;.&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">q≠0⇒[strm append: &rsquo;e&rsquo;; print: q]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">epart: base </span><span style="font: 10pt serif">| x</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"gives floor log.base self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;base⇒ [⇑0]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"self assumed positive"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self&lt;(base*base)⇒ [⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; 2*(self epart: base*base).</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"binary recursion like ipow"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x + ((self/(base ipow: x)) epart: base)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self printon: strm digits: 8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm digits: digits   </span><span style="font: italic 10pt serif">"print me using digits significant figures"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&gt;0.0⇒[self absprinton: strm digits: digits]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self=0.0⇒[strm append: &rsquo;0.0&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;¬&rsquo;. (0.0-self) absprinton: strm digits: digits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">roundTo: d<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self/d+[self&lt;0.0⇒[¬0.5] 0.5]) ipart*d]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">constants from Computer Approximations, pp. 182-183</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi = 3.14159265358979323846264338327950288<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi/2 = 1.57079632679489661923132169163975144<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi/4 = 0.78539816339744830961566084581987572<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi*2 = 6.28318530717958647692528676655900576<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi/180 = 0.01745329251994329576923690768488612<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">2.0 ln = 0.69314718055994530941723212145817657<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">2.0 sqrt = 1.41421356237309504880168872420969808"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pi &larr; 3.141592654.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">halfpi &larr; pi/2.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fourthpi &larr; pi/4.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">twopi &larr; pi*2.0.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">radiansPerDegree &larr; pi/180.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">degreesPerRadian &larr; 180.0/pi.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ln2 &larr;0.6931471806.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sqrt2 &larr; 1.414213562]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Float under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Float classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Integer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Integer&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Number<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;digitbuffer &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">bytesize: 16;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">veryspecial: 1;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: BitMasks;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: ByteCodes;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Integers are 16-bit numbers, stored in two-s complement form.  The allowable range is from ¬32768 to +32767.  You can type them in octal by typing a leading zero, as in 0377.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≤ arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑t neg ≡ false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self ≤ t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≠ arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  t isLarge⇒[⇑true]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  ⇑self ≠ t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≥ arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑t neg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self ≥ t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">* arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg is: Integer⇒[⇑self asLarge*arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑self asLarge*arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self*t] primitive: 21</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">+ arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg is: Integer⇒[⇑self asLarge+arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑self asLarge+arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self + t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">- arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg is: Integer⇒[⇑self asLarge-arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑self asLarge-arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self - t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">/ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0=arg⇒[user notify: &rsquo;Attempt to divide by 0&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> arg isLarge⇒[⇑self asLarge/arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self / arg asInteger] primitive: 22</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[t neg ≡ false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self &lt; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  t isLarge⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  ⇑self = t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; arg </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[⇑t neg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self &gt; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compare: arg </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arg is: Integer⇒ [self &lt; arg⇒ [⇑1]; = arg⇒ [⇑2] ⇑3]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self natcompare: arg bytes "4 - (arg bytes natcompare: self)"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">even<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self land: 1) = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">intdiv: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg is: Integer ⇒[⇑(self/arg),(self\arg)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> arg is: LargeInteger ⇒ [⇑self asLarge intdiv: arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;I give up&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">negate<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">negated </span><span style="font: 10pt serif">[⇑0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sameAs: arg  </span><span style="font: italic 10pt serif">"arg assumed to be of same class as self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self=arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unsignedadd: y<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["treat numbers as unsigned 8-bit quantities."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑((self + y) land: 0377)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unsignedlessthan: y<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["treat numbers as unsigned 8-bit quantities."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self &lt; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">\ arg</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"mod"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0=arg⇒[user notify: &rsquo;Attempt to divide by 0&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> arg isLarge⇒[⇑self asLarge\arg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self \ arg asInteger] primitive: 26</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">| arg</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"truncate"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self/arg*arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Bit Manipulation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allmask: b </span><span style="font: 10pt serif">[⇑b = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">anymask: b </span><span style="font: 10pt serif">[⇑0 ≠ (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bits: int </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"int is an Interval:  0 is leftmost bit, 15 is rightmost"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self field: (int length "width" * 16) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">15 - int stop "displacement from right"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">field: fld </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; fld asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[user notify: &rsquo;Field descriptor too large&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self field: t] primitive: 36</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">field: fld &larr; val </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; fld asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t isLarge⇒[user notify: &rsquo;Field descriptor too large&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self field: t &larr; val asSmall] primitive: 37</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: italic 10pt serif">"used to find large integers in dictionaries"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hibit </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: 16 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self land: (biton◦(17-i)))≠0⇒[⇑17-i]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">land: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self land: arg asSmall] primitive: 23</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lor: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self lor: arg asSmall] primitive: 24</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lshift: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self lshift: arg asSmall] primitive: 25</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lxor: arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self lxor: arg asSmall] primitive: 35</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nomask: b </span><span style="font: 10pt serif">[⇑0 = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFloat </span><span style="font: 10pt serif">[user croak] primitive: 34</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInteger </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asLarge </span><span style="font: 10pt serif">| me digits "convert to LargeInteger"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[me &larr; self bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">digits &larr; Natural new: me length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">digits◦1 &larr; me◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digits length = 2 ⇒ [digits◦2 &larr; me◦2]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑LargeInteger new bytes: digits neg: self neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asNatural </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; Natural new: self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t◦1&larr;self◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [t length &gt; 1 ⇒ [t◦2&larr;self◦2]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asObject </span><span style="font: 10pt serif">[user croak] primitive: 81</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSmall</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">inString </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; String new: 1. t◦1 &larr; self. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">oneToMeAsStream</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"used by for-loops"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Stream new of: (Interval new from: 1 to: self by: 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unique<br></span><span style="font: 10pt serif">[<br>⇑ self inString unique.<br>]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unsigned </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self &lt; 0⇒ [⇑65536.0 + self asFloat]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self asFloat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Subscripts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cansubscript: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≥1 and⦂ self≤a length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instfield:</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"> i</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"small integer gives trouble"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i = 1 ⇒[⇑self] user notify: &rsquo;arg too big&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self cansubscript: a⇒[⇑a◦self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;Subscript out of bounds: &rsquo; + self asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: a &larr; val </span><span style="font: 10pt serif">| t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self cansubscript: a⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; val asInteger.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> (a is: String) and⦂ (t isnt: Integer)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Improper store (non-char into String?)&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑a◦self &larr; t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;Subscript out of bounds: &rsquo; + self asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">absprinton: strm </span><span style="font: 10pt serif">| rem<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rem &larr; self\10.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&gt;9⇒ [self/10 absprinton: strm]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; rem+060]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;0⇒[self=¬32768⇒[strm append: &rsquo;¬32768&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append:&rsquo;¬&rsquo;. (0-self) printon: strm base: 10]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self printon: strm base: 10]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm base: b </span><span style="font: 10pt serif">| rem i x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[0&gt;(x&larr;self)⇒[i &larr; 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">digitbuffer◦1 &larr; 040000\b*2+self-0100000\b. </span><span style="font: italic 10pt serif">"get it?"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; (040000/b*2+(self-0100000/b))]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; 0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ x≥b do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digitbuffer◦(i&larr;i+1) &larr; x\b.  x &larr; x/b].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; 060+x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ i≠0 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm next &larr; 060+(digitbuffer◦i).  i &larr; i-1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Characters</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asLowercase<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0101 ≤ self⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ≤ 0132⇒ [⇑self + 040]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asUppercase<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0141 ≤ self⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ≤ 0172⇒ [⇑self - 040]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compareChar: c </span><span style="font: 10pt serif">| a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"⇑self asLowercase compare: c asLowercase"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a&larr; self.    </span><span style="font: italic 10pt serif">"written in-line for speed"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0101≤a⇒[a≤0132⇒[a&larr;a+040]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0101≤c⇒[c≤0132⇒[c&larr;c+040]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a&lt;c⇒[⇑1] a=c⇒[⇑2] ⇑3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isalphanumeric<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self isletter⇒[⇑true]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"lower-case"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self isdigit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isdigit <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self ≥ 060⇒</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" 0 "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self ≤ 071]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" 9 "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isletter<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self ≥ 0141⇒</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" a "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self ≤ 0172]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" z "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ≥ 0101⇒</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" A "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self ≤ 0132]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" Z "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tokenish</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"test for token-chars"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self isletter⇒[⇑true]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"lower-case"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self isdigit⇒[⇑true]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"digits"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑&rsquo;¬.:⦂&rsquo; has: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Copying and Purging</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">purge </span><span style="font: 10pt serif">[user croak] primitive: 44</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: italic 10pt serif">"Initialize the digit buffer"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digitbuffer &larr; String new: 16]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compiler Bytecodes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asCompilerCode  </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">I am a byte code.  Return the corresponding compiler code</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;16⇒[⇑self+codeLoadField  "</span><span style="font: italic 10pt serif">inst field</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;32⇒[⇑self-16+codeLoadTemp  "</span><span style="font: italic 10pt serif">temp</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;64⇒[⇑self-32+codeLoadLit  "</span><span style="font: italic 10pt serif">literal</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;111⇒[⇑self-64+codeLoadLitInd  "</span><span style="font: italic 10pt serif">indirect literal</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;208⇒[⇑self  "</span><span style="font: italic 10pt serif">context relative or constant ... not all values here are legal</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;256⇒[⇑self-208+codeSendLit  "</span><span style="font: italic 10pt serif">selector</span><span style="font: 10pt serif">"]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;unexpected byte&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRemoteCode: generator<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;256⇒ [⇑super asRemoteCode: generator]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self land: 0177400)≤codeLoadTemp⇒ [⇑ParsedFieldReference new var: self];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=codeLoadLitInd⇒ [⇑ParsedObjectReference new var: self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super asRemoteCode: generator]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bfpSize<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑[self&lt;0⇒ [2]; &gt;8⇒ [2] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitBfp: code on: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[stack pop: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">0=self⇒ [code next &larr; toPop]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">1≤self and⦂ self≤8⇒ [code next &larr; self+toShortBfp-1] </span><span style="font: italic 10pt serif">"short bfp"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code emitLong: toLongBfp by: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitBytes: code  </span><span style="font: 10pt serif">| c t</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;256⇒ [code next &larr; self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; self lshift: ¬8. t &larr; self land: 0377.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(16 16 32 48 48)◦c &gt; t⇒ [code next &larr; ↪(0 16 32 64 208)◦c+t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code next &larr; toLoadFieldLong+c-1; next &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitForValue: code on: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[self=toSuper⇒ [code next &larr; toLoadSelf] self emitBytes: code].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stack push: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitJmp: code on: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0=self⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">1≤self and⦂ self≤8⇒ [code next &larr; self+toShortJmp-1] </span><span style="font: italic 10pt serif">"short jmp"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code emitLong: toLongJmp by: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitsLoad<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;256⇒ [⇑self&lt;toSmashPop] ⇑self&lt;codeSendLit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emittedVariable<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[self&lt;256⇒[self≤toSuper] self&lt;codeSendLit]⇒[] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findMacros: macros compilerTemps: compilerTemps </span><span style="font: 10pt serif">| i j assignment<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;codeLoadTemp or⦂ self&gt;(codeLoadTemp+255)⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">this temp is not compiler-generated</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">j &larr; self-codeLoadTemp+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">compilerTemps◦j≡false⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">compilerTemps◦j≡nil⇒[compilerTemps◦j &larr; false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">The temp isn&rsquo;t compiler-generated after all!!  Nil out the macro</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: macros position to: 2 by: ¬2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[assignment &larr; macros◦(i-1) ◦ (macros◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">assignment var=self⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[macros◦i &larr; nil.  macros◦(i-1) &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">compilerTemps◦j &larr; false.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑nil]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;couldnt find bad macro&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">firstPush</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isField<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≥codeLoadField and⦂ self&lt;codeLoadTemp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">jmpSize<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑[self=0⇒ [0]; &lt;0⇒ [2]; &gt;8⇒ [2] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm indent: level precedence: p forValue: v decompiler: decompiler<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v≡false⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self&lt;112⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;128⇒[strm append: ↪(&rsquo;sender&rsquo; &rsquo;self&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;¬1&rsquo; &rsquo;0&rsquo; &rsquo;1&rsquo; &rsquo;2&rsquo; &rsquo;10&rsquo; &rsquo;nil&rsquo; &rsquo;false&rsquo; &rsquo;true&rsquo;)◦(self-111)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=133⇒[strm append: &rsquo;thisContext&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=134⇒[strm append: &rsquo;super&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;167⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;208⇒[strm append: SpecialOops◦(self-166)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;256⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;512⇒[strm append: (decompiler instvar: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;768⇒[strm append: (decompiler temp: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;1024⇒[strm append: (decompiler literal: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;1280⇒[strm append: (decompiler literalIndirect: self)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: (decompiler selector: self)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sizeForValue<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self&lt;256 or⦂</span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(16 16 32 48 48)◦(self lshift: ¬8) &gt; (self land: 0177)⇒ [⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>LargeInteger Compatability</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ n | t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["behave like a Natural"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n = 1 ⇒ [self &lt; 0 ⇒ [⇑((((self land: 0377) lxor: 0377) + 1) land: 0377)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self land: 0377]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n = 2 ⇒ [self &lt; 0 ⇒ [t &larr; ((self lshift: ¬8) lxor: 0377).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self land: 0377) = 0 ⇒[⇑((t+1) land: 0377)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ self lshift: ¬8]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bytes<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["behave like a LargeInteger - negative integers behave like positive naturals"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isInt<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">last<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self◦self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["behave like a Natural"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self ≥ 256) or⦂ (self ≤ ¬256) ⇒ [⇑2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natcompare: arg </span><span style="font: 10pt serif">| i len [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arg length &lt; len⇒[⇑3]; &gt; len⇒[⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self◦i)&gt;(arg◦i)⇒[⇑3];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;(arg◦i)⇒[⇑1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">natnormalize: n </span><span style="font: 10pt serif">| x i r f digit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["n is the number of bits to shift by. The Natural number returned will be written over repeatedly, so we must make a new one."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; (Natural new: (self length+1)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f &larr; n-8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: r length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[digit &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r◦i &larr; (digit lshift: n) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; digit lshift: f.].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">neg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["behave like a LargeInteger"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self &lt; 0)⇒[⇑true]⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInt32 </span><span style="font: 10pt serif">[⇑ Int32 new high: 0 low: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">between: min and: max<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≥min and⦂ self≤max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Integer under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Integer classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"LargeInteger"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;LargeInteger&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Number<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;bytes</span><span class="tab" val="79"></span><span style="font: bold 12pt serif">"A Natural number (digits are 0 to 255)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif"> neg</span><span class="tab" val="79"></span><span style="font: bold 12pt serif">"The sign" &rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>LargeInteger is a class of Numbers with integral values of arbitrary precision. The values are stored as a Natural number that has digits between 0 and 255. The real work is done in Natural, which uses MachineDouble for single digit calculations. The first element of bytes contains the lowest precision digit.<br>All of the Bit Manipulation messages behave like the integer is represented in twos complement and then truncates the number to 16 bits before operating upon it. The value is always a Small integer.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bit: index </span><span style="font: 10pt serif">| byte<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Return bit number i in the binary representation of this number. Bit number 1 is the low order bit"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte &larr; bytes◦(1+((index-1)/8)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑(byte lshift: (0-((index-1)\8))) land: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bytes<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑bytes]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bytes: bytes neg: neg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ bytes isLarge do⦂ [bytes&larr;bytes bytes]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hibit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Return the index of the high order bit of the binary representation of this number"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑bytes last hibit+(8*(bytes length-1))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">neg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">neg &larr; neg </span><span style="font: 10pt serif">|  "Smashes sign - be careful!"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≤ arg </span><span style="font: 10pt serif">[(self compare: arg)&lt;3⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≥ arg </span><span style="font: 10pt serif">[(self compare: arg)&gt;1⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">* arg </span><span style="font: 10pt serif">| as r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; bytes nattimes: arg bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑LargeInteger new bytes: r neg: ((neg≡as)≡false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">+ arg </span><span style="font: 10pt serif">| as r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">neg ≡ as ⇒[r&larr;bytes natadd: arg bytes. ⇑LargeInteger new bytes: r neg: neg]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; bytes natsubtract: arg bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">neg ⇒ [⇑ r negate].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">- arg </span><span style="font: 10pt serif">| as r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">neg ≡ as ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; bytes natsubtract: arg bytes.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">neg ⇒ [⇑ r neg&larr; (r neg ≡ false)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r&larr;bytes natadd: arg bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑LargeInteger new bytes: r neg: neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">/ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self intdiv: arg)◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; arg </span><span style="font: 10pt serif">[(self compare: arg)=1⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self compare: arg)=2⇒[⇑self] ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; arg </span><span style="font: 10pt serif">[(self compare: arg)=3⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">abs </span><span style="font: 10pt serif">"Return the positive magnitude (absolute value) of this LargeInteger"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑LargeInteger new bytes: bytes neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compare: arg </span><span style="font: 10pt serif">| i a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(((bytes length = 1) and⦂ (bytes◦1=0)) and⦂ (arg bytes length =1)) and⦂ (arg bytes◦1=0)⇒[⇑2]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">neg⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg neg⇒[⇑arg bytes natcompare: bytes] ⇑1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arg neg⇒[⇑3]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑bytes natcompare: arg bytes]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">even </span><span style="font: 10pt serif">| <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(((bytes ◦ 1) land: 1) = 0)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">intdiv: arg </span><span style="font: 10pt serif">| quo rem ng qr z<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["returns a vector of (quotient, remainder)"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">qr &larr; bytes natdiv: arg bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">quo &larr; qr◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; (qr◦2) asInteger.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ng &larr; (neg≡arg neg)≡false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[quo last = 0 ⇒ [quo length&lt;2⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">quo &larr; quo growby: ¬1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">qr◦1&larr;(LargeInteger new bytes: quo neg: ng).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">qr◦2 &larr; [ng and⦂ 0≠rem⇒ [arg abs-rem] rem].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑qr]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">negate<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑LargeInteger new bytes: bytes neg: (neg≡false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">negated<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑LargeInteger new bytes: bytes neg: neg≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">\ arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self intdiv: arg)◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFloat</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Built for comfort, not for speed"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asString asFloat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInteger<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[bytes length&gt;2⇒[⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self≤077777 and: self≥0100000⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asSmall]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asLarge</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSmall </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; (bytes◦1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [bytes length &gt; 1 ⇒ [t &larr; (t field: 0210 &larr; (bytes◦2))]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> neg ⇒[t = ¬32768⇒[⇑¬32768] ⇑0-t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isLarge</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm base: b<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[neg ⇒ [strm append: &rsquo;¬&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bytes printon: strm base: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Bit Manipulation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allmask: b </span><span style="font: 10pt serif">[⇑b = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">anymask: b </span><span style="font: 10pt serif">[⇑0 ≠ (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">field: n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asSmall field: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">field: n &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asSmall field: n &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[⇑bytes hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">land: n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asSmall land: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lshift: n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asSmall lshift: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nomask: b </span><span style="font: 10pt serif">[⇑0 = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪LargeInteger under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"MachineDouble"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;MachineDouble&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Number<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;high low&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;low4 low8 high4 high8 &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>MachineDouble is intended to be used by people who are implementing multiple precision arithmetic. It is hard to use - be careful! These are not ordinary numbers.<br>A MachineDouble behaves like a double precision register on an 8-bit machine. Accessing and setting the high and low words of the register are legitimate. Extract returns the low word and shifts the register right by one word, while propagating the sign. This turns out to be very convenient for addition and subtraction to propagate carries and borrows. Sometimes it does too much, but it is faster than using two other messages. Arithmetic is all unsigned, but decreaseby:, when answer is negative, uses twos complement notation to represent borrows.<br>On the NoteTaker, each half of the MachineDouble will be a complete 15-bit unsigned quantity. Obtaining the low or high half may return a negative number that should be considered to be positive (unsigned). The unsignedadd: and unsignedlessthan: messages to integers allow such numbers to be used without creating large integers.<br>This class will be Nova-coded soon.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">extract </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["returns low, moves high down and propagates sign."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; low.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">low &larr; high.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">high &larr; [(low land: 0200)=0 ⇒[0] 0377].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">high<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">high &larr; high<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">low<br>   </span><span style="font: 10pt serif">[⇑low]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">low &larr; low<br>   </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; arg<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[high = arg high⇒[⇑low &lt; arg low]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑high &lt; arg high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">decreaseby: y </span><span style="font: 10pt serif">| x "y is a positive &lt;256 integer"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; low - y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &lt; 0 ⇒[high &larr; (high-1) land: 0377]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">low &larr; x land: 0377.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">gets: x mtimes: y </span><span style="font: 10pt serif">| xh xl yh yl p1 p2<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["x and y are 8-bit positive #&rsquo;s.<br>      Does single precision unsigned multiplication<br>      returning a double precision result."<br>    xh &larr; x field: high4.<br>    xl &larr; x field: low4.<br>    yh &larr; y field: high4.<br>    yl &larr; y field: low4.<br>    low &larr; yl * xl.<br>    high &larr; yh * xh.<br>    p2 &larr; yh * xl.<br>    p1 &larr; (p2 + (yl * xh)).<br>    high &larr; high + (p1 lshift: ¬4).<br>    low &larr; ((p1 land: 017) lshift: 4) + low.<br>    [low ≥ 256 ⇒ [high &larr; high + 1. low &larr; low - 256.]].<br>    ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">increaseby: y </span><span style="font: 10pt serif">| x "y is a positive &lt;256 integer"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; low + y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &gt; 255 ⇒[high &larr; (high+1) land: 0377]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">low &larr; x land: 0377.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mdiv: y </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["Ignores y high (assumes it to be zero. Also assumes that y &gt; x high.<br>      This does a single precision unsigned divide into a double precision dividend<br>      that results in a single precision quotient (returned) and<br>      a single precision remainder(placed in self high)."<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">high &lt; 128 ⇒ [x &larr; (high lshift: 8) + low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">high &larr; x\y.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x/y.]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">high &gt; y ⇒ [user notify: &rsquo;illegal MachineDouble division&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; ((high lshift: 1) + (low lshift: ¬7)) - y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">high &larr; x lshift: ¬1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">low &larr; (low field: 027 &larr; x).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑((self mdiv: y) + 128)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInt </span><span style="font: 10pt serif">| n i "may return a negative number"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑((high lshift: 8) lor: low)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["low4 is a field description for the low order 4 bits of an Integer<br>      high4 is a field description for the high order 4 bits of an 8-bit Integer"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">low4 &larr; 0100.<br>    high4 &larr; 0104]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[low &larr; 0. high &larr; 0. ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: &rsquo;[MachineDouble 0&rsquo;.<br>     high printon: strm base: 8.<br>     strm append: &rsquo; 0&rsquo;.<br>     low printon: strm base: 8.<br>     strm append: &rsquo;]&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪MachineDouble under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">MachineDouble classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Time"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Time&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;h m s&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Implements times of day.  Still needs a lot of work.  (Steve Weyer)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Setting state</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">right now</span><span style="font: 10pt serif">" ⇑user now◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromSeconds: sec </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"seconds since midnight (adjusted for time zone and DST)"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sec &larr; sec asInteger intdiv: 3600.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h &larr; (sec◦1) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sec &larr; (sec◦2) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; sec / 60.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; sec \ 60]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hours: h</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">minutes: m</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">seconds: s</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: italic 10pt serif">"Format is h:mm:ss am/pm"</span><span style="font: 10pt serif"> [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm print: [h&gt;12⇒[h-12]; &lt;1⇒[12] h];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: [m &lt; 10⇒ [&rsquo;:0&rsquo;] &rsquo;:&rsquo;]; print: m;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: [s &lt; 10⇒ [&rsquo;:0&rsquo;] &rsquo;:&rsquo;]; print: s;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">space append: [h&lt;12⇒[&rsquo;am&rsquo;] &rsquo;pm&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSeconds </span><span style="font: 10pt serif">[⇑3600 * h + (60*m+s)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hours </span><span style="font: 10pt serif">[⇑h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Time under: &rsquo;Numbers&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
