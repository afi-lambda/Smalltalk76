<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Kernel-Classes.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 10:34:21 pm.&rsquo;&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"Object"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Object&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: nil<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Object is the superclass of all classes.  It is an abstract class, meaning that it has no state, and its main function is to provide a foundation message protocol for its subclasses.  Three instances of this class are defined: nil, true, and false.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Comparison</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≤ x </span><span style="font: 10pt serif">[⇑self&gt;x≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≡ x </span><span style="font: 10pt serif">[⇑self≡x </span><span style="font: italic 10pt serif">"In case this is reached by perform:"</span><span style="font: 10pt serif">] primitive: 4</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≠ x </span><span style="font: 10pt serif">[⇑self=x≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">≥ x </span><span style="font: 10pt serif">[⇑self&lt;x≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= x </span><span style="font: 10pt serif">[⇑self≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">and⦂ x </span><span style="font: 10pt serif">[self⇒[⇑x eval] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">and: x </span><span style="font: 10pt serif">[self⇒[⇑x] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">empty </span><span style="font: 10pt serif">[⇑self length = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eqv: x </span><span style="font: 10pt serif">[x⇒[⇑self] ⇑self≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">or⦂ x </span><span style="font: 10pt serif">[self⇒[⇑true] ⇑x eval]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">or: x </span><span style="font: 10pt serif">[self⇒[⇑true] ⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sameAs: object<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self≡object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">xor: x </span><span style="font: 10pt serif">[x⇒[⇑self≡false] ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Classification</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">class </span><span style="font: 10pt serif">[user croak] primitive: 27</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">is: x </span><span style="font: 10pt serif">[⇑self class≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Is: x  </span><span style="font: 10pt serif">"Is the class x a superclass or class of self"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self class ≡ x ⇒[⇑true]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self class Isa: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isArray<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isnt: x </span><span style="font: 10pt serif">[⇑(self class≡x) ≡ false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Isnt: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self Is: x)≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isNumber<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Construction</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">, x </span><span style="font: 10pt serif">| v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; Vector new: 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v◦1 &larr; self. v◦2 &larr; x.  ⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraph </span><span style="font: 10pt serif">[⇑self asString asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">[⇑self asVector asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asVector </span><span style="font: 10pt serif">| v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≡nil⇒[⇑Vector new: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; Vector new: 1. v◦1 &larr; self. ⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"create new copy of self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self is: Object⇒[⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self class copy: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">inVector </span><span style="font: 10pt serif">| vec<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return me as the sole element of a new Vector."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vec &larr; Vector new: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vec◦1 &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑vec]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"recursively copy whole structure"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self is: Object⇒[⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self class recopy: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asOop </span><span style="font: 10pt serif">[user croak] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">canunderstand: selector<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self class canunderstand: selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error: s </span><span style="font: 10pt serif">[⇑user notify: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fields<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return an Array of all my field names or many of my subscripts."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self class is: VariableLengthClass⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length ≤ 50⇒ [⇑1 to: self length]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (1 to: 20) concat: (self length-20 to: self length)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self class instvars]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[user croak] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">inspect<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user leaveTop; restartup: (InspectWindow new of: self)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">inspectfield: n</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"used by variable panes"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self class is: VariableLengthClass⇒ [⇑self◦(self fields◦n)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self instfield: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instfield: n </span><span style="font: 10pt serif">[user croak] primitive: 38</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instfield: n &larr; val </span><span style="font: 10pt serif">[user croak] primitive: 39</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instfields </span><span style="font: 10pt serif">| vec size  i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return an Array of all my field values or many of my elements."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self class is: VariableLengthClass⇒ [⇑self◦self fields]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">size &larr; self class instsize.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vec &larr; Vector new: size.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: size do⦂ [vec◦i &larr; self instfield: i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑vec]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">itself </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ref: index<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑FieldReference new object: self offset: index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subError </span><span style="font: 10pt serif">[self error: &rsquo;message not defined by subclass&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self class title + &rsquo;.&rsquo; + self asOop base8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFullString </span><span style="font: 10pt serif">| strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; (String new: 20) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fullprinton: strm. ⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asString </span><span style="font: 10pt serif">| strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; (String new: 16) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self printon: strm. ⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filout </span><span style="font: 10pt serif">| file<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑user displayoffwhile⦂ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[file &larr; dp0 file: self title asFileName.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fullprinton: file.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">file close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fullprint </span><span style="font: 10pt serif">| strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; Stream default. self fullprinton: strm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fullprinton: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≡nil⇒ [strm append: &rsquo;nil&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self≡false⇒ [strm append: &rsquo;false&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self≡true⇒ [strm append: &rsquo;true&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self class print: self on: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">print<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user show: self asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: [self≡nil⇒ [&rsquo;nil&rsquo;]; ≡false⇒ [&rsquo;false&rsquo;]; ≡true⇒ [&rsquo;true&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; self class title.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: [&rsquo;AEIO&rsquo; has: t◦1⇒ [&rsquo;an &rsquo;] &rsquo;a &rsquo;].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compiler Defaults</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ⓢ code<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Generator new evaluate: code asStream in: false to: self notifying: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">argsOff: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self⇒ [stack pop: 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asRemoteCode: generator<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ParsedRemote new expr: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitForEffect: code on: stack</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitForTruth: trueSkip falsity: falseSkip into: code on: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self emitForValue: code on: stack.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(trueSkip jmpSize + falseSkip) emitBfp: code on: stack.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">trueSkip emitJmp: code on: stack]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitForValue: code on: stack</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitsLoad<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emittedReceiver<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emittedVariable<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findMacros: macros compilerTemps: compilerTemps</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">firstPush<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑¬1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">interactive<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isField<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notify: errorString at: position in: stream<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self notify: errorString at: position in: stream for: self class]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notify: errorString at: position in: stream for: class </span><span style="font: 10pt serif">| syntaxWindow<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[NotifyFlag⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[syntaxWindow &larr; SyntaxWindow new of: errorString at: position in: stream for: class from: thisContext sender.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext sender &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user restartup: syntaxWindow]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user notify: errorString. ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm indent: level precedence: p forValue: v decompiler: decompiler</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">remote: generator</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">returns<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sizeForEffect: nextPush <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sizeForTruth: trueSkip falsity: falseSkip<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| jump<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[jump &larr; trueSkip jmpSize.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self sizeForValue + (jump+falseSkip) bfpSize + jump]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sizeForValue<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>System Primitives</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error </span><span style="font: 10pt serif">| sender op n args i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"after compiling execute: nil installError.  "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sender &larr; thisContext sender.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">op &larr; sender thisop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; op numArgs.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">args &larr; Vector new: n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: (n to: 1 by: ¬1) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[args◦i &larr; sender pop].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self messageNotUnderstood: op withArgs: args from: sender]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">installError </span><span style="font: 10pt serif">| code old<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[code &larr; Object md method: ↪error.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">old &larr; SpecialOops◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">old asOop≠(mem◦3)⇒ [user notify: &rsquo;Object installError failed&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mem◦3 &larr; code asOop.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">SpecialOops◦1 &larr; code]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">messageNotUnderstood: op withArgs: args from: sender<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[thisContext sender &larr; sender.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;Message not understood: &rsquo;+op]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nail </span><span style="font: 10pt serif">[user croak] primitive: 31</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Nail me in core and return my core address"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">perform: selector </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Send the unary message, selector, to self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector mustTake: 0. ⇑self performDangerously: selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">perform: selector with: arg1 </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Send the 1-argument message, selector, to self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector mustTake: 1. ⇑self performDangerously: selector with: arg1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">perform: selector with: arg1 with: arg2 </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Send the 2-argument message, selector, to self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector mustTake: 2. ⇑self performDangerously: selector with: arg1 with: arg2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">perform: selector with: arg1 with: arg2 with: arg3 </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Send the 3-argument message, selector, to self"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector mustTake: 3. ⇑self performDangerously: selector with: arg1 with: arg2 with: arg3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">perform: selector withArgs: vec<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector mustTake: vec length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self performDangerously: selector withArgs: vec]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performDangerously: selector </span><span style="font: italic 10pt serif">"Send self the message, selector; it had better be unary"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;can&rsquo;&rsquo;t perform: nil&rsquo;] primitive: 102</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performDangerously: selector with: arg1  </span><span style="font: italic 10pt serif">"selector had better take 1 arg"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;can&rsquo;&rsquo;t perform: nil with:&rsquo;] primitive: 102</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performDangerously: selector with: arg1 with: arg2  </span><span style="font: italic 10pt serif">"selector had better take 2 args"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;can&rsquo;&rsquo;t perform: nil with:with:&rsquo;] primitive: 102</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performDangerously: selector with: arg1 with: arg2 with: arg3  </span><span style="font: italic 10pt serif">"selector had better take 3 args"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;can&rsquo;&rsquo;t perform: nil with:with:with:&rsquo;] primitive: 102</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performDangerously: selector withArgs: vec<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[vec length=0⇒ [⇑self performDangerously: selector];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=1⇒ [⇑self performDangerously: selector with: vec◦1];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2⇒ [⇑self performDangerously: selector with: vec◦1 with: vec◦2];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=3⇒ [⇑self performDangerously: selector with: vec◦1 with: vec◦2 with: vec◦3]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;More than 3 args for perform:&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">PTR </span><span style="font: 10pt serif">[] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">refct </span><span style="font: 10pt serif">[user croak] primitive: 45</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">startup</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"loopless scheduling"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self firsttime⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ self eachtime do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self lasttime]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap⦂ variable </span><span style="font: 10pt serif">| x  </span><span style="font: italic 10pt serif">"assign me to variable and return its old value"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; variable value. variable value &larr; self. ⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unNail </span><span style="font: 10pt serif">[user croak] primitive: 32</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Release me from being nailed"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Object under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Class"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Class&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;title</span><span class="tab" val="79"></span><span style="font: bold 12pt serif">"&lt;String&gt; for identification, printing"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">myinstvars "&lt;String&gt; partnames for compiling, printing"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">instsize "&lt;Integer&gt; for storage management"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">messagedict "&lt;MessageDict&gt; for communication, compiling"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">classvars "&lt;Dictionary/nil&gt; compiler checks here"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">superclass "&lt;Class&gt; for execution of inherited behavior"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">environment "&lt;Vector of SymbolTables&gt; for external refs"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fieldtype&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;lastClass lastSelector lastParagraph &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">veryspecial: 1;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Classes are the molecules of Smalltalk.  The instance fields specify the number and naming of fields for each instance, and the messages define the protocol with which these objects may be communicated.  Classes inherit the fields and message protocol of their superclass.  Locally defined messages will override inherited ones of the same name, and overriden ones may be accessed through the use of super in place of self.  A typical class definition looks like:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Class new title: &rsquo;CodeEditor&rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">subclassof: Window;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">fields: &rsquo;pared class selector&rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">declare: &rsquo;editmenu&rsquo;<br>This ordering is required, though the subclassof: and declare: messages are optional.  A class definition may be re-executed but, if the fields: clause has changed, all instances of the old class will become obsolete (they will fail to respond to any messages).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">abstract<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self fields: nullString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bytesize: n</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"non-pointer declaration"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≠self realself⇒[self realself bytesize: n]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fieldtype &larr; 32+ [n=8⇒ [8] 16]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"gets propagated to a dummy instance"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self new classInit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyof: oldClass subclassof: newSubClass<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[title &larr; oldClass title.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self subclassof: newSubClass.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> classvars &larr; oldClass classvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> environment &larr; oldClass environment.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self newFieldsForSubClass: oldClass myinstvars]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">declare: v </span><span style="font: 10pt serif">| var recom</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≠self realself⇒[self realself declare: v]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [classvars≡nil⇒[classvars &larr; SymbolTable init]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> v is: String⇒[self declare: v asVector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> recom &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [v is: Vector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ var from: v do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(Smalltalk has: var) or: (Undeclared has: var)⇒[recom &larr; true]]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  (Smalltalk has: v) or: (Undeclared has: v)⇒[recom &larr; true]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [recom⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Methods recompile if you proceed, global became local&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [v is: Vector⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ var from: v do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[classvars insert: var with: nil]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  classvars insert: v with: nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> recom⇒[self compileall]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">environment &larr; environment </span><span style="font: 10pt serif">[] </span><span style="font: italic 10pt serif">"for resetting to reread sharing clauses"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fields: myinstvars </span><span style="font: 10pt serif">| r a b s h</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"list of instance variables"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[messagedict &larr; MessageDict init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r &larr; self realself.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; self instvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h&larr; HashSet init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ s from: a do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[h has: s⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: s+&rsquo; is used already (maybe in superclass)&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">h insert: s].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self=r⇒[self initClass]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> a=(b&larr; r instvars)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r environment&larr; nil; myinstvars&larr; myinstvars; subclassof: superclass]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [r howMany&gt;0⇒[user notify: &rsquo;All &rsquo;+title+&rsquo;s become obsolete if you proceed...&rsquo;]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> classvars &larr; r classvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> messagedict &larr; r md copy.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span class="tab" val="79"></span><span style="font: 10pt serif">[a length≤b length or⦂ a◦(1 to: b length)≠b⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"just adding new inst fields"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: title+ &rsquo; methods recompile if you proceed...&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self compileall]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r md init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self fixSubClassesOf: r.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r obsolete.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> Smalltalk◦title unique &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self initClass]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fixSubClassesOf: oldClass </span><span style="font: 10pt serif">| n subClass<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ n from: user classNames do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[subClass &larr; Smalltalk◦n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> subClass superclass≡oldClass⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Class new copyof: subClass subclassof: self]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initClass<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[fieldtype &larr; 16.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">instsize &larr; self instvars length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">instsize&gt;256⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;too many instance variables&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self organization]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">myinstvars &larr; myinstvars</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newFieldsForSubClass: myinstvars </span><span style="font: 10pt serif">| r a b</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"list of instance variables"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[messagedict &larr; MessageDict init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r &larr; self realself.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self=r⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;problem in class redefinition. See coment at end of method&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> (a&larr; self instvars)=(b&larr; r instvars)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;problem in class redefinition. See coment at end of method&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [r howMany&gt;0⇒[user cr show: &rsquo;All &rsquo;+title+&rsquo;s are obsolete.&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> classvars &larr; r classvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> messagedict &larr; r md copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r md init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span class="tab" val="79"></span><span style="font: 10pt serif">[a length≤b length or⦂ a◦(1 to: b length)≠b⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"changing inst fields"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user cr show: title+ &rsquo; recompiled.&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self compileall]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self fixSubClassesOf: r.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r obsolete.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> Smalltalk◦title unique &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self initClass]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Regarding the notifys in this method: It is my understanding<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> that this method will only be invoked when the conditions<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> leading to the notifys are false. If I&rsquo;m available, I&rsquo;d like to see<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> any case that results in notification.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Dave Robson"<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">obsolete</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"invalidate further communication"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[title &larr; &rsquo;AnObsolete&rsquo;+title.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">classvars &larr; nil.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"recycle class variables"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict close.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"invalidate and recycle local messages"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">environment &larr; self.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"keep me around for old instances"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">superclass &larr; Object.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"invalidate superclass messages"</span><span style="font: 10pt serif">]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">realself </span><span style="font: 10pt serif">[⇑Smalltalk◦title unique]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"as opposed to possible filin ghost"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rename: newtitle<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| name newname oldclass category<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[name &larr; title unique.  newname &larr; newtitle unique.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Smalltalk has: newname⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldclass &larr; Smalltalk◦newname.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;All &rsquo; + newtitle + &rsquo;s will become obsolete if you proceed&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldclass obsolete]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">category &larr; SystemOrganization invert: name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">AllClassNames &larr; AllClassNames insertSorted: newname.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">SystemOrganization classify: newname under: category].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk delete: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">AllClassNames &larr; AllClassNames delete: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SystemOrganization delete: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">title &larr; newtitle.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk declare: newname as: self]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sharing: table<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self≠self realself⇒[self realself sharing: table]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">environment &larr; environment asVector , table]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subclassof: superclass<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(superclass isnt: Class) and⦂ (superclass isnt: VariableLengthClass)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Superclass is not yet defined or not a Class&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title: title<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self title: (title &larr; title unique) insystem: Smalltalk]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title: name insystem: system </span><span style="font: 10pt serif">| cl<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[superclass &larr; Object.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[system has: name⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cl &larr; (system◦name) class.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">cl≡self class⇒ [⇑self]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: name + &rsquo; will change from a &rsquo; + cl title + &rsquo; to a &rsquo; + self class title + &rsquo; if you proceed...&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">system declare: name as: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">AllClassNames &larr; AllClassNames insertSorted: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SystemOrganization classify: name under: &rsquo;As yet unclassified&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title: t subclassof: s fields: f declare: d<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t◦1≠((t◦1) asUppercase)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Please capitalize each word in class title: &rsquo; + t. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self title: t; subclassof: s; fields: f; declare: d]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">veryspecial: n</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"inaccessible fields"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[instsize &larr; self instvars length + n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦x </span><span style="font: 10pt serif">[⇑classvars◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦x &larr; val </span><span style="font: 10pt serif">[⇑classvars◦x &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fieldNamesInto: collector<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[superclass≡nil⇒ [] superclass fieldNamesInto: collector].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(Reader new of: myinstvars) readInto: collector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instsize<br></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return the number of user accessable instance fields (self instvars length)."</span><span style="font: 10pt serif"><br>⇑[fieldtype≥32⇒ [0] <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self≡Class⇒ [instsize-1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self≡VariableLengthClass ⇒[instsize-20]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">instsize]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instvars<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self fieldNamesInto: FieldNameCollector default]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">invertRef: refs </span><span style="font: 10pt serif">"Refs may be a vector (to allow batching)" <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| cl env source ref inv sym t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[refs isnt: Vector⇒ [⇑(self invert: refs inVector)◦1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">env &larr; (self wholeEnvironment concat: (Undeclared, Smalltalk)) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">source &larr; Dictionary init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑refs transform⦂ ref to⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cl &larr; self. env reset.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(sym &larr; env next)≡false⇒ [inv &larr; &rsquo;unknown &rsquo; concat: ref asOop base8]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cl≠nil and⦂ sym≡cl classvars⇒ [t &larr; cl title. cl &larr; cl superclass] t &larr; false].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(inv &larr; sym invertRef: ref)≡false⇒ [false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> t &larr; source lookup: sym⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> source insert: sym with: (t &larr; Smalltalk invert: sym)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">inv &larr; (t concat: &rsquo; &rsquo;) concat: inv]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">inv]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Isa: x  </span><span style="font: italic 10pt serif">"is x on my superclass chain?"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[superclass ≡ x ⇒[⇑true]; ≡ nil ⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑superclass Isa: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">md </span><span style="font: 10pt serif">[⇑messagedict]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">myinstvars<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑myinstvars]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">superclass </span><span style="font: 10pt serif">[⇑superclass]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title </span><span style="font: 10pt serif">[⇑title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Organization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classvars </span><span style="font: 10pt serif">[⇑classvars]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clean </span><span style="font: 10pt serif">| name</span><span class="tab" val="79"></span><span style="font: 10pt serif">"release unreferenced classvars"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ name from: classvars do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[name≠↪ClassOrganization and⦂ (classvars ref: name) refct=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[classvars delete: name]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">environment<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑environment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">organization </span><span style="font: 10pt serif">| o<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[classvars ≡ nil⇒[self declare: ↪ClassOrganization]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">o &larr; classvars lookup: ↪ClassOrganization.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">o is: ClassOrganizer⇒[⇑o]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">o &larr; ClassOrganizer new init: messagedict contents sort.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">classvars insert: ↪ClassOrganization with: o.  ⇑o]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">wholeEnvironment<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(classvars asVector concat: environment asVector) concat:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[superclass≡nil⇒ [↪()] superclass wholeEnvironment]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Editing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ed: selector </span><span style="font: 10pt serif">| c s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c&larr; self code: selector. user clearshow: c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (s&larr; user request: &rsquo;substitute: &rsquo;) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c &larr; c subst: s for: (user request: &rsquo;for: &rsquo;).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user clearshow: c]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self understands: c]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">edit: selector </span><span style="font: 10pt serif">| para s v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector=↪ClassOrganization⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self organization asParagraph]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict has: selector⇒[self code: selector]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nullString asParagraph].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self edit: selector para: para formerly: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">edit: selector para: para formerly: oldpara<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user leaveTop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user restartup: (CodeWindow new class: self selector: selector para: para formerly: oldpara)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">execute: code</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"disposable methods"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self understands: &rsquo;doit [⇑&rsquo; + code + &rsquo;]&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self new doit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Message access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">archiveOn: file changesOnly: ch </span><span style="font: 10pt serif">| org m [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">this should be called only by the system releaser<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">(via </span><span style="font: bold 10pt serif">UserView file:classes:changesOnly:</span><span style="font: italic 10pt serif">) !!!<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">if you want to archive your own classes (useful only if you have stable code<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">and intend to clean up afterwards with a vmem write), see Steve.<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">write comment and method text on a FileStream for some file.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">ch⇒ [write only changes (non-remote String/Paraagraphs)] write everything</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr; show: title.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">org &larr; self organization.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">org globalComment always yields a String, so a small kludge is in order</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ch and⦂ (org globalCommentItself is: RemoteParagraph)⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">org globalComment &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(RemoteParagraph new on: file) fromString: org globalComment].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">archive in category&alphabetical rather than hash order (messagedict)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m from: org do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ch and⦂ ((messagedict code: m) is: RemoteParagraph)⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict code: m &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(RemoteParagraph new on: file) fromParagraph: (self code: m).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ch⇒ [user space; show: m]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bytesof: sel<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(messagedict method: sel) asBytes]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">canUnderstand: selector<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[messagedict has: selector⇒ [⇑self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">superclass≡nil⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑superclass canUnderstand: selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">canunderstand: selector<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑messagedict has: selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">code: sel </span><span style="font: 10pt serif">[ <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">last paragraph returned is cached (mainly for NotifyWindows)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sel ≡ lastSelector and⦂ self ≡ lastClass ⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastParagraph &larr; ([<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel = ↪ClassOrganization ⇒ [self organization]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">if left shift key is down, decompile</span><span style="font: 10pt serif">"</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user leftShiftKey⇒ [self decompile: sel]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">Paragraph or RemoteParagraph</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict code: sel]) asParagraph.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastClass &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastSelector &larr; sel].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑lastParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compileall </span><span style="font: 10pt serif">| s c "does not modify code, just compiles it"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ s from: messagedict do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c &larr; messagedict code: s.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self understands: c asParagraph.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> messagedict code: s &larr; c "leave it as a remote paragraph"].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self≡Object⇒[nil installError]]<br></span><span style="font: italic 10pt serif">"to recompile the whole system (check out big changes) execute:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">| n [for⦂ n from: AllClassNames do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">[user show: n; cr. (Smalltalk◦n) compileall.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Changes init. MessageDict new freeMethods]] "</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: sel from: class<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self copy: sel from: class classified: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: sel from: class classified: cat </span><span style="font: 10pt serif">"Useful when modifying an existing class"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| s code<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sel is: Vector⇒ [for⦂ s from: sel do⦂ [self copy: s from: class classified: cat]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel is: String⇒ [self copy: (class organization category: sel) from: class classified: cat]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; class code: sel.  code≡nil⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cat≡nil⇒ [cat &larr; class organization invert: sel]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[messagedict has: sel⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[code text=(self code: sel) text⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: title+&rsquo; &rsquo;+sel+&rsquo; will be redefined if you proceed.&rsquo;]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self understands: code classified: cat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">decompile: t1 <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑user displayoffwhile⦂ [Decompiler new decompile: t1 class: self]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">derstands: selector </span><span style="font: 10pt serif">| c</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"overstands?  undersits? - forget it"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector is: Vector⇒[for⦂ c from: selector do⦂ [self derstands: c]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(messagedict has: selector)≡false⇒[] <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict &larr; messagedict delete: selector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self organization delete: selector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastClass &larr; lastSelector &larr; lastParagraph &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Changes has: (c&larr;title+&rsquo; &rsquo;+selector)⇒ [Changes delete: c]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Changes insert: (c&larr;&rsquo;~&rsquo;+c).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑c]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">describe: method on: strm </span><span style="font: 10pt serif">| sel cls  </span><span style="font: italic 10pt serif">"append mclass and selector"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cls &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [cls≡nil⇒ [cls&larr;self. sel&larr;↪?] sel &larr; cls md invert: method] do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cls &larr; cls superclass].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: cls title; space; append: sel]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">install: name method: method literals: literals<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">code: code backpointers: backpointers | c<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[messagedict &larr; messagedict insert: name method: method<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">literals: literals code: code makeBoldPattern backpointers: backpointers.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastClass &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastSelector &larr; name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastParagraph &larr; code.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Changes insert: (c&larr;title+&rsquo; &rsquo;+name).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Changes has: (c&larr;&rsquo;~&rsquo;+c)⇒[Changes delete: c]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">messages </span><span style="font: 10pt serif">[⇑messagedict contents , ↪ClassOrganization]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">method: sel<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑messagedict methodorfalse: sel]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notify: errorString at: position in: stream<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self notify: errorString at: position in: stream for: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectors</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Return a Vector of all my selectors."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self messages]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">shrink </span><span style="font: 10pt serif">[messagedict &larr; messagedict shrink]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space </span><span style="font: 10pt serif">| a s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; 0. for⦂ a from: messagedict do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; s + (messagedict method: a) length]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">textLocal </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">makes comment and methods local</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self organization.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s globalComment &larr; s globalComment.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ s from: messagedict do⦂ [messagedict code: s &larr; self code: s]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">understands: code </span><span style="font: 10pt serif">| selector old</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"install method"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self understands: code classified: &rsquo;As yet unclassified&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">understands: code classified: heading</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"compile and install method"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Generator new compile: code asParagraph<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">in: self under: heading notifying: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">whosends: selector </span><span style="font: 10pt serif">| s l a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ a from: messagedict do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ l from: (messagedict literals: a) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector≡l⇒[s append: a; space]]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Instance access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allInstances </span><span style="font: 10pt serif">[⇑self allInstancesEver notNil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allInstancesEver </span><span style="font: 10pt serif">| indx vec PCLs i </span><span style="font: italic 10pt serif">"returns a vector containing all instances of this class mixed with nils"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Works for all classes.  Some additional instances may be created after the<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">vector is filled but before you get to use it."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">PCLs &larr; Vmem pclassesOf: self.  </span><span style="font: italic 10pt serif">"vector of PCLs"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vec &larr; Vector new: 128*PCLs length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: PCLs length do⦂ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(vec◦[i-1*128+1 to: i*128]) all&larr; PCLs◦i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext destroyAndReturn: (self fromFreelist: Class instsize fill: vec)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: inst </span><span style="font: 10pt serif">| t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self instsize do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t instfield: i &larr; inst instfield: i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self new default]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromFreelist: i fill: vec </span><span style="font: italic 10pt serif">"i = zero order index of freelist in class instance.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">vec = vector in pclasses of all possible instances."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user croak] primitive: 60</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">howMany </span><span style="font: 10pt serif">| v </span><span style="font: italic 10pt serif">"how many instances of this class are in use now?"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; self allInstancesEver.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext destroyAndReturn: v length-(v count: nil)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"init and default get propagated to instances"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self new init]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init: n</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"init and default get propagated to instances"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self new init: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">instfield:</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"> i</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"prevent user from getting freelist"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &gt; Class instsize ⇒[user notify: &rsquo;arg too big&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super instfield: i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">new </span><span style="font: 10pt serif">[user croak] primitive: 28</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">new: length </span><span style="font: 10pt serif">"To allow fixed-length classes to simulate variable-length ones"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self new init: length] "By convention"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">print: inst on: strm </span><span style="font: 10pt serif">| ivars i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ivars &larr; self instvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;(&rsquo;; append: title; append: &rsquo; new &rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: instsize do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: ivars◦i; append: &rsquo;: &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">print: (inst instfield: i); space]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;)&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: &rsquo;Class &rsquo; + title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy: inst </span><span style="font: 10pt serif">| t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self instsize do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t instfield: i &larr; (inst instfield: i) recopy]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filin and Filout</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFollows </span><span style="font: 10pt serif">| s heading selector p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self≠self realself⇒[self realself asFollows]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">heading &larr; &rsquo;As yet unclassified&rsquo;.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">handles Bravo or Press (Smalltalk generated) files</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((p &larr; FilinSource nextParagraph) and⦂ (s &larr; p text) ≠ &rsquo;'&#771;) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s◦1 = 015⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">throw away initial cr before comment and headings</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; s copy: 2 to: s length]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p runs◦2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 2 "</span><span style="font: italic 10pt serif">italic</span><span style="font: 10pt serif">"⇒ [self organization globalComment &larr; s];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0121 "</span><span style="font: bold 12pt serif">5, bold</span><span style="font: 10pt serif">"⇒ [heading &larr; s]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self canunderstand: (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">selector &larr; self understands: p classified: heading)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: selector; space. messagedict purge: selector]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: &rsquo;(an uncompiled method) &rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">changelist: cat </span><span style="font: 10pt serif">[⇑title unique, (self organization category: cat)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">definition </span><span style="font: 10pt serif">| strm</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return a string that defines me (Class new title etc.)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; (String new: 50) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self printdefon: strm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">endCategoryOn: pstrm</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">endChangesOn: pstrm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pstrm print: &rsquo;'&#771; asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filout </span><span style="font: 10pt serif">[user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp1 file: title+&rsquo;.st.&rsquo;) filoutclass: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self noChanges]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filoutCategory: cat<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(dp1 file: (title+&rsquo;-&rsquo;+cat+&rsquo;.st&rsquo;) asFileName) filout: (self changelist: cat)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filoutOrganization</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"So we can merge separate work on organization"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user show: title; cr.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(dp0 file: title+&rsquo;.org.&rsquo;)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: title+&rsquo; organization fromParagraph:&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: self organization asParagraph text asString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo;asParagraph'&#771;; close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">noChanges </span><span style="font: 10pt serif">| s t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t&larr; title+&rsquo; *&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ s from: Changes contents do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(s◦1=126 "~" and⦂ (t match: s◦(2 to: s length)))<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> or⦂ (t match: s)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Changes delete: s]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">paraprinton: strm</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Strm is actually a ParagraphPrinter"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| para frame s heading org<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para &larr; (&rsquo;"&rsquo;+title+&rsquo;"&rsquo;) asParagraph.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">para maskrunsunder: 0361 to: 0121.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Font &larr; 5, Bold"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame &larr; strm defaultframe.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm frame &larr; 15000⌾frame origin y rect: 20000⌾frame corner y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm print: para.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm frame &larr; frame.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm print: ((self definition+&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">asFollows'&#771;) asParagraph maskrunsunder: 0361 to: 0121).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">org &larr; self organization.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm print: (&rsquo;<br>&rsquo;+org globalComment) asParagraph allItalic.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ heading from: org categories do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self printCategory: heading on: strm]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self endChangesOn: strm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm print: (&rsquo;SystemOrganization classify: ↪&rsquo;+title+&rsquo; under: &rsquo;&rsquo;&rsquo;+<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(SystemOrganization invert: title unique)+&rsquo;&rsquo;&rsquo;.'&#771;) asParagraph.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self ≡ Class or: self ≡ VariableLengthClass⇒ [] self canunderstand: ↪classInit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm print: (title+&rsquo; classInit'&#771;) asParagraph]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printCategory: s on: pstrm </span><span style="font: 10pt serif">| sel<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self startCategory: s on: pstrm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ sel from: (self organization category: s) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self printMethod: sel on: pstrm].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self endCategoryOn: pstrm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printdefon: strm </span><span style="font: 10pt serif">| s</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"print my definition on strm"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: self class title;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; new title: &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"title is probably unique, but make sure. then we want it as a &rsquo;String&rsquo; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">print: title unique asString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm cr; tab; append: &rsquo;subclassof: &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: [superclass≡nil⇒[&rsquo;nil&rsquo;] superclass title].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm cr; tab; append: &rsquo;fields: &rsquo;; print: myinstvars.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm cr; tab; append: &rsquo;declare: &rsquo;&rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ s from: classvars contents do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s=↪ClassOrganization⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: s; space]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;&rsquo;&rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[fieldtype=16⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm semicrtab; append: &rsquo;bytesize: &rsquo;; print: fieldtype-32].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[instsize = (s&larr; self instvars) length⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm semicrtab; append: &rsquo;veryspecial: &rsquo;; print: instsize-s length].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[environment≡nil⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ s from: environment do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm semicrtab; append: &rsquo;sharing: &rsquo;; append: (Smalltalk invert: s)]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printMethod: sel on: pstrm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pstrm print: (self code: sel).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">messagedict purge: sel]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printout </span><span style="font: 10pt serif">[user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp0 file: title+&rsquo;.press.&rsquo;) printoutclass: self]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printoutCategory: cat<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(dp0 file: (title+&rsquo;-&rsquo;+cat+&rsquo;.press&rsquo;) asFileName) printout: (self changelist: cat)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readfrom: strm </span><span style="font: 10pt serif">[⇑self readfrom: strm format: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readfrom: strm format: f </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self new readfrom: strm format: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">startCategory: s on: pstrm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pstrm print: ((&rsquo;<br>&rsquo;+s) asParagraph maskrunsunder: 0361 to: 0121).</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Font 5, Bold"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">startChangesOn: pstrm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pstrm print: ((&rsquo;<br>&rsquo;+title+&rsquo; asFollows'&#771;) asParagraph maskrunsunder: 0361 to: 0121).</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Font 5, Bold"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>System Organization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">category </span><span style="font: 10pt serif">[⇑SystemOrganization invert: self title unique]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">category: cat<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cat is: String ⇒[SystemOrganization add: self title unique under: cat]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;Category name must be a String&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">moveFromCat: cat1 to: cat2<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(cat1 is: String) and⦂ (cat2 is: String) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[SystemOrganization move: self title unique from: cat1 to: cat2]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;Category name must be a String&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Class under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Context"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Context&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;sender "&lt;Context&gt; from which this message was sent"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">receiver "&lt;Object&gt; to which this message was sent"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">keep "&lt;true, nil&gt; nil means reclaimable"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">method "&lt;String&gt;, the encoded method"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">tempframe "&lt;Vector&gt; to hold temporaries and a stack"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">pc "&lt;Integer&gt; marks progress of execution in method"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">stackptr "&lt;Integer&gt; offset of stack top in tempframe"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;arrayFld positionFld limitFld &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A context keeps track of the progress of a method</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cleancopy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Context new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender: sender<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">method: method<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe: tempframe copy<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc: pc<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr: stackptr]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ Context new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender: sender<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">method: method<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe: tempframe<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc: pc<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr: stackptr<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sender: sender receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">method: method tempframe: tempframe pc: pc stackptr: stackptr</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">caller </span><span style="font: 10pt serif">[⇑sender]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">getPT: i  </span><span style="font: 10pt serif">[ ⇑ tempframe◦i ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mclass </span><span style="font: 10pt serif">| selector mclass</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return the class in which method was found"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sender ≡ nil ⇒ [⇑receiver class]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">selector &larr; self selector.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mclass &larr; receiver class.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ mclass ≡ nil do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(mclass method: selector) ≡ method ⇒ [⇑mclass]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">mclass &larr; mclass superclass].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑receiver class]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">method<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑method]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pc </span><span style="font: 10pt serif">[⇑pc]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">receiver<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑receiver]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selector </span><span style="font: 10pt serif">| mclass selector</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return the selector for my method"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[selector &larr; sender thisop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">selector◦(1~19)=&rsquo;performDangerously:&rsquo;⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mclass &larr; receiver class.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"special work for perform"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [mclass ≡ nil or⦂ (selector&larr;mclass md invert: method)] do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mclass &larr; mclass superclass]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">selector≡false⇒[⇑↪confused] ⇑selector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sender </span><span style="font: 10pt serif">[⇑sender]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sender&larr; sender </span><span style="font: 10pt serif">[]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setPT: i to: n  </span><span style="font: 10pt serif">[ tempframe◦i &larr; n ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">stackIndex </span><span style="font: italic 10pt serif">"Return the subscript in tempframe of my top of stack."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑stackptr+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swapSender: coroutine </span><span style="font: 10pt serif">| oldSender<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldSender &larr; sender. sender &larr; coroutine. ⇑oldSender]</span><span class="tab" val="79"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tempframe<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑tempframe]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">totalPT </span><span style="font: 10pt serif">[⇑ (method◦5)+1 ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Control structures</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">for⦂ var1 from: expr1 with⦂ var2 from: expr2 do⦂ stmt </span><span style="font: 10pt serif">| s1 s2<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s1 &larr; expr1 asStream. s2 &larr; expr2 asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [(var1 value &larr; s1 next) and⦂ (var2 value &larr; s2 next)] do⦂ stmt eval]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Debugging</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">debug </span><span style="font: 10pt serif">| t v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self print.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [user cr. t &larr; user request: &rsquo;*&rsquo;] do⦂  </span><span style="font: italic 10pt serif">"until ctrl-d"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; Generator new evaluate: t asStream in: false to: self notifying: nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪debugret=v⇒[self print] v print]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑↪debugret]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| mc<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Print the selector which invoked this Context<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">  and the class in which code was found for that selector"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> mc &larr; self mclass.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> strm append: mc title. sender≡nil⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [receiver is: mc⇒[] strm append: &rsquo;(&rsquo;+receiver class title+&rsquo;)&rsquo;].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> strm append: &rsquo;⇒&rsquo;; print: self selector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restartWith: method<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe &larr; tempframe copy: 1 to: method◦3.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self restart]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">stack </span><span style="font: 10pt serif">| a strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return a Vector of me and all my derivative contexts."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm &larr; (Vector new: 20) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; a &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">when user notifty is fixed,</span><span style="font: 10pt serif"> a sender </span><span style="font: italic 10pt serif">can become</span><span style="font: 10pt serif"> a caller"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (a&larr;a sender)≡nil do⦂ [strm next &larr; a].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑strm contents.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">thisop </span><span style="font: 10pt serif">| a</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return the message selector just sent"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a &larr; method◦pc.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a≥0320⇒ [⇑self litof: a-0320]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a≥0260⇒ [⇑SpecialOops◦(10+a-0260)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">method◦(pc-1)=0214⇒ [⇑self litof: a]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑↪confused]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trace </span><span style="font: 10pt serif">| strm a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm &larr; Stream default. self printon: strm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; sender. until⦂ a≡nil do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm cr. a printon: strm. a &larr; a sender]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">variableNamesInto: dest with: block </span><span style="font: 10pt serif">| class selector parser<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"For each method variable name, call<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">dest declaration: block name: string asArg: &lt;true or false&gt;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">If cant find source code, call dest notify: "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">class &larr; self mclass.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">selector &larr; class md invert: method⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[parser &larr; Parser new from: (class code: selector) asStream to: dest.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">parser pattern: block; temporaries: block; terminate]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dest notify: &rsquo;thisContext is not running a currently defined method&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">verifyFrames  </span><span style="font: 10pt serif">| c </span><span style="font: italic 10pt serif">"be sure frames on stack aren&rsquo;t nil"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> until⦂ c≡nil do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c tempframe≡nil⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Sorry, that stack has been released -- proceeding is impossible&rsquo;; restart]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> c &larr; c sender]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Simulation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">docode: code toclass: class </span><span style="font: 10pt serif">| i v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(i&larr;code◦2)≠ 0 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i = 1  ⇒ [⇑self];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 30 ⇒ [v &larr; self pop. v push: self. ⇑v];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 40 ⇒ [v &larr; self pop instfield: code◦5 + 1. ⇑self push: v];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 41 ⇒ [user notify: &rsquo;Field&larr; primitive unimplemented&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 87 ⇒ [⇑ receiver "PriorityInterrupt run: newContext"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 101 ⇒ [user notify: &rsquo;Doprimitive unimplemented&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 102 ⇒ [⇑self performing: code◦4 toclass: tempframe◦(stackptr+1)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> (v &larr; self doprimitive: code) ≡ ↪failed ⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> stackptr &larr; stackptr-(code◦4+1). ⇑self push: v]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self newToRun: code]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dojump: displacement<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pc &larr; pc+displacement]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dopop<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[stackptr &larr; stackptr-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doprimitive: code<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑↪failed] primitive: 101</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doremotereturn </span><span style="font: 10pt serif">| t f<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self pop. f &larr; self pop. ⇑f push: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doreturn </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; tempframe◦(stackptr+1). tempframe &larr; nil. ⇑sender push: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dostore </span><span style="font: 10pt serif">| byte<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte &larr; method◦(pc&larr; pc+1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> byte&lt;020⇒ [self smashField: byte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;040⇒ [self smashTemp: byte-020];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0100⇒ [user notify: &rsquo;Store into literal&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0160⇒ [self smashLitInd: byte-0100];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0170⇒ [self instfield: (byte-0157) &larr; tempframe◦(stackptr+1)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0210⇒ [self smashField: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0211⇒ [self smashTemp: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0213⇒ [self smashLitInd: self nextByte]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user notify: &rsquo;Illegal store&rsquo;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dosuper </span><span style="font: 10pt serif">| byte<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte &larr; self nextByte.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte=0214⇒ [byte &larr; self nextByte+0320]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">byte&lt;0260⇒ [user notify: &rsquo;non-selector after super&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self sendmess: nil byte: byte toclass: <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self litof: method◦6-8/2) value superclass]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doUnique </span><span style="font: 10pt serif">| r e "cause ◦ &larr; to be done for a UniqueString inside str: inside intern:"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; tempframe◦(2+stackptr). "receiver"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"already know class is UniqueString"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e &larr; &rsquo;bad special message in super&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(method ≡ (UniqueString md method: ↪str:)) ≡ false ⇒[user notify: e]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"ours, now put result of str: on the stack"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self push: (r &larr; r str: tempframe◦1 "arg").<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">method◦(method length) ≠ 0203 "return" ⇒[user notify: e]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"trick this method into returning"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc &larr; method length -1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">help<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["Here is how to use the Smalltalk simulator.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext runsimulated⦂ [ </span><span style="font: bold 10pt serif">place here the code you to simulate</span><span style="font: 10pt serif"> ].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Some classes in Smalltalk may not be subclassed.  Some messages<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">may not be overridden.  initSimulator tells the details. "]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initSimulator </span><span style="font: 10pt serif">| i "these class variables of Context are used by instfield: to simulate what the microcode does to objects."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["  Context declare: &rsquo;positionFld arrayFld limitFld&rsquo;.    "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Rules:  There may not be a subclass of Integer.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(This is so +, -, &lt;, &gt;, ≤, ≥, =, ≠ may not be overridden).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">The following messages may NOT be redefined by any class.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">≡ (from class Object).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">class (from class Object).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">The following messages may NOT be redefined by any VariableLengthClass.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">length (from Vector, String)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; Stream instvars.  "We need to peek inside instances of Stream"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">positionFld &larr; i find: &rsquo;position&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arrayFld &larr; i find: &rsquo;array&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">limitFld &larr; i find: &rsquo;limit&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">litof: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(method word: a+4) asObject]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newToRun: code </span><span style="font: 10pt serif">| r v i</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; self pop. v &larr; Vector new: code◦3.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i from: (code◦4 to: 1 by: ¬1) do⦂ "Move args to new tframe"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v◦i &larr; tempframe◦(2+(stackptr &larr; stackptr-1)).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe◦(stackptr+2) &larr; nil</span><span class="tab" val="79"></span><span style="font: 10pt serif">"Nil args on caller&rsquo;s stack"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self class new sender: self receiver: r method: code<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe: v pc: code◦6 stackptr: code◦5 - 1. "Allocate a new Context"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextByte<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑method◦(pc &larr; pc+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nonEmptyStack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(stackptr≠¬1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">performing: nargs toclass: class </span><span style="font: 10pt serif">| i sel<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; stackptr-nargs.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel &larr; tempframe◦(i+1).</span><span class="tab" val="79"></span><span style="font: 10pt serif">"Selector is first arg"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ i&lt;stackptr do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(i+1) &larr; tempframe◦(i+2).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; i+1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr &larr; stackptr-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self sendmess: sel byte: 0320 toclass: class]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pop<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑tempframe◦(2+ (stackptr&larr; stackptr-1))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">push: n </span><span style="font: 10pt serif">"Push n on top of stack"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(1+(stackptr&larr;stackptr+1)) &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pushField: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(1+(stackptr&larr;stackptr+1)) &larr; receiver instfield: i+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pushLit: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(1+(stackptr&larr;stackptr+1)) &larr; (method word: i+4) asObject]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pushLitInd: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(1+(stackptr&larr;stackptr+1)) &larr; (method word: i+4) asObject value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pushTemp: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(1+(stackptr&larr;stackptr+1)) &larr; tempframe◦(i+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restart<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pc &larr; method◦6. stackptr &larr; method◦5-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">runsimulated⦂ cntxt </span><span style="font: 10pt serif">| ctx b i "To use the simulator say...<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext runsimulated⦂ [your code]. "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["turn off use of BitBlt by Strings"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b &larr; String◦↪StringBlter.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">String◦↪StringBlter &larr; false.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cntxt push: self.  ctx &larr; cntxt.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ ctx≡self do⦂ [ctx &larr; ctx step].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"restore state of StringBlter"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">String◦↪StringBlter &larr; b.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self pop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sendmess: sel byte: byte toclass: class </span><span style="font: 10pt serif">| cl code</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cl &larr; class.  until⦂ cl≡nil do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[byte&lt;0320⇒ "Is it a special message?"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self specialmess: byte toclass: cl⇒ [⇑self] "Can we perform it?"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> sel &larr; SpecialOops◦(byte-0246)] "Send the special message selector"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">  sel≡nil⇒ [sel &larr; self litof: byte-0320]]. "Send the selector from the literals"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> code &larr; cl md methodorfalse: sel⇒ [⇑self docode: code toclass: cl]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  </span><span class="tab" val="79"></span><span style="font: 10pt serif"> cl &larr; cl superclass]. "Try up the superclass chain"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user notify: (&rsquo;Simulated message not understood: &rsquo; concat: sel asString)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">simulate⦂ cntxt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[cntxt push: thisContext.  ⇑cntxt inspect]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">smashField: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[receiver instfield: i+1 &larr; tempframe◦(stackptr+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">smashLitInd: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self litof: i) value &larr; tempframe◦(stackptr+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">smashTemp: i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe◦(i+1) &larr; tempframe◦(stackptr+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">specialmess: byte toclass: class </span><span style="font: 10pt serif">| "Return false if cannot do it here, else do exactly what the microcode does."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte&lt;0270⇒  "+, -, &lt;, &gt;, ≤, ≥, =, ≠"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self specialmess: byte toclassInteger: class];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0300⇒[⇑false];  "unused"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0304⇒   " ◦, ◦&larr;, next, next&larr; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self specialmess: byte toclassArray: class];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0304⇒ "length"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ [class≡String⇒[] class≡Vector⇒[] ⇑false]. self push: (self pop length)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0305⇒ "≡"  [self push: self pop≡self pop]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">specialmess: byte toclassArray: class </span><span style="font: 10pt serif">| r n d i s l easy "cause ◦, ◦&larr;, next, next&larr;  to happen"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[d &larr; stackptr.  r &larr; self pop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte=0301 or⦂ byte=0303 ⇒[n &larr; self pop]]. " ◦&larr; or next&larr; "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte&lt;0302⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[   " ◦ or ◦&larr; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[class≡Vector⇒[] class≡String⇒[] stackptr &larr; d. ⇑false].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; self pop. l &larr; r length]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">class≡Stream⇒ " next or next&larr; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; r. i &larr; (s instfield: positionFld)+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; (s instfield: limitFld). r &larr; (s instfield: arrayFld).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [r class≡Vector⇒[]; ≡String⇒[]; ≡Interval⇒[] stackptr &larr; d. ⇑false].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr &larr; d. ⇑false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">easy &larr; [r class≡Vector⇒[true]; ≡String⇒[true]; ≡Interval⇒[true] false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(i class ≡ Integer) and⦂ (l class ≡ Integer)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[1≤i and⦂ i≤l⇒  " bounds check "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[easy ⇒[byte=0301 or⦂ byte=0303⇒ "in the easy case, we cheat for speed"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r◦i &larr; n]  " ◦&larr; or next&larr; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; r◦i]  " ◦ or next "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"subclass of Vector or String"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">byte=0301 or⦂ byte =0303 ⇒[r instfield: i &larr; n] " ◦&larr; or next&larr; "<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; r instfield: i].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self push: n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [byte&gt;0301⇒[s instfield: positionFld &larr; i]]. ⇑self]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr &larr; d. ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">specialmess: byte toclassInteger: class </span><span style="font: 10pt serif">| r n "If class is Integer, do arithmetic"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[class ≡ Integer⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; self pop. n &larr; self pop.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> r class ≡ Integer⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self push: [byte<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0260⇒ [r+n];  =0261⇒ [r-n];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0262⇒ [r&lt;n];  =0263⇒ [r&gt;n]; =0264⇒ [r≤n];  =0265⇒ [r≥n];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0266⇒ [r=n];  =0267⇒ [r≠n]]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> stackptr &larr; stackptr+2. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">step </span><span style="font: 10pt serif">| byte t "Execute the next byte code and return the current Context"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte &larr; method◦(pc &larr; pc+1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[byte&lt;0200⇒ "load"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte&lt;020⇒ [self pushField: byte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;040⇒ [self pushTemp: byte-020];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0100⇒ [self pushLit: byte-040];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0160⇒ [self pushLitInd: byte-0100];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0170⇒ [self push: (self instfield: byte-0160+1)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self push: SpecialOops◦(byte-0170+2)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0220⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[byte=0200⇒ [self dostore; dopop];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0201⇒ [self dostore];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0202⇒ [self dopop];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0203⇒ [self doreturn];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0204⇒ [self doremotereturn];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0205⇒ [self push: self];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0206⇒ [self dosuper];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0210⇒ [self pushField: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0211⇒ [self pushTemp: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0212⇒ [self pushLit: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0213⇒ [self pushLitInd: self nextByte];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=0214⇒ [self sendmess: nil byte: self nextByte+0320<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> toclass: (tempframe◦(stackptr+1)) class]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user notify: &rsquo;Unimplemented instruction code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;0260⇒ "jump"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; [byte&lt;0240⇒[(byte land: 7)+1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"short, just mask off bfp bit for displacement"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> (byte land: 7)-4*256+self nextByte].</span><span class="tab" val="79"></span><span style="font: 10pt serif">"long, calculate displacement"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(byte land: 010)≠0⇒[self pop≡false⇒[self dojump: t]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"bfp, do branch if top is false"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self dojump: t].</span><span class="tab" val="79"></span><span style="font: 10pt serif">"unconditional, do the branch"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self sendmess: nil byte: byte toclass: (tempframe◦(stackptr+1)) class]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Remote evaluation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eval </span><span style="font: 10pt serif">[user croak] primitive: 30</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">remoteCopy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; RemoteContext new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender: sender<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">method: method<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe: tempframe<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc: pc+2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr: stackptr.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult initialize.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ tResult<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Interpretation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">have: receiver interpret: method<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Warning -- someone must be holding methodⓢ literals."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Warning -- do not call as self have:interpret: or cycle will result"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe &larr; (Vector new: method◦3).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self restart. ⇑self interpretFor: thisContext sender]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">interpret: objectCode with: tframe<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"interpret in new context with tempframe tframe"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Warning -- someone must be holding objectCodeⓢ literals."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Warning -- do not call as self interpret:with: or cycle will result"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(Context new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender: nil receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">method: objectCode tempframe: tframe<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc: objectCode◦6 stackptr: objectCode◦5-1)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  interpretFor: thisContext sender]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">interpretFor: sender  </span><span style="font: italic 10pt serif">"resume execution"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[PriorityInterrupt new run: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Deallocation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">destroyAndReturn: value<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[thisContext sender &larr; sender.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe all &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eraseFully<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tempframe≡nil⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe all &larr; nil. tempframe &larr; nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release | s</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"release frames to break cycles"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ [tempframe≡nil⇒[] tempframe all&larr; nil. tempframe &larr; nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">receiver&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender≡nil⇒[] <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">not sure if this works correctly</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"[sender Isnt: Context⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (sender Is: Context) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s&larr; sender instfield: 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender instfield: 5&larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s≡nil⇒[⇑self] sender&larr; s]]]."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender release]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">releaseFully </span><span style="font: 10pt serif">| c </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"nullify frames to break cycles"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c &larr; self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> until⦂ c≡nil do⦂ [c eraseFully. c &larr; c sender]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">releaseTo: pContext<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender ≡ pContext ⇒ [ sender &larr; nil. ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender releaseTo: pContext.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender &larr; nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Context under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"RemoteContext"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;RemoteContext&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Context<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo; <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fSavedPC<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fSavedStackptr<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>CONTEXT FOR REMOTE CODE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>REMOTE CONTEXT</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">caller<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ tempframe ◦ (fSavedStackptr+2)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cleancopy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; RemoteContext new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sender: sender<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">receiver: receiver<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">method: method<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe: tempframe copy<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc: pc<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr: stackptr.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult initialize.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ tResult<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initialize<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSavedPC &larr; pc.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSavedStackptr &larr; stackptr.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">releaseTo: pContext<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe ◦ (fSavedStackptr+2) ≡ pContext ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tempframe ◦ (fSavedStackptr+2) &larr; nil. ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe ◦ (fSavedStackptr+2) releaseTo: pContext.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tempframe ◦ (fSavedStackptr+2) &larr; nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restart<br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pc &larr; fSavedPC.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stackptr &larr; fSavedStackptr.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪RemoteContext under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"UserView"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;UserView&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;screenrect "&lt;Rectangle&gt; current screen size"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">vtab "&lt;Integer=0mod2&gt; offset from hardware top"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">htab "&lt;Integer=0mod16&gt; offset from hardware left"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">scale "&lt;Integer=1 or 2&gt; 2 means double bits mode"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">color "&lt;Integer=0 or 1&gt; 1 means reverse field"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">projectWindow "my representative in an overview"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">disp "&lt;dispframe&gt; default message stream"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sched "&lt;Vector&gt; Windows in this view"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;currentCursor mxoffset myoffset screenMenu &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>This is a melting-pot, incorporating the notions of user interaction (mouse, keyboard), display context (current screen view), and global operations (reading the clock, leaving the system).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Mouse, Cursor, Keys</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">anybug </span><span style="font: 10pt serif">[⇑self buttons &gt;0 or⦂ (mem◦0177100) &lt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">anykeys </span><span style="font: 10pt serif">[⇑self keyset&gt;0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bluebug </span><span style="font: 10pt serif">[⇑self buttons=2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">buttons<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑7-(mem◦0177030 land: 7)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">currentCursor </span><span style="font: 10pt serif">[⇑currentCursor]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">currentCursor: c </span><span style="font: 10pt serif">| coff oldpt [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldpt &larr; self mp.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">currentCursor &larr; c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">coff &larr; c offset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mxoffset &larr; coff x - htab.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">myoffset &larr; coff y - vtab.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self cursorloc &larr; oldpt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cursorloc &larr; pt <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mem◦0424 &larr; pt x - mxoffset*scale.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦0425 &larr; pt y - myoffset*scale]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbck </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self rawkbck⇒[⇑kbMap◦t] self purgealittle. ⇑false ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbd </span><span style="font: 10pt serif">[until⦂ self rawkbck do⦂ [self purgealittle]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑kbMap◦self rawkbd]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbd: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"stuff char into the event queue"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char is: String ⇒[char &larr; char◦1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Events next &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">UserEvent new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"event x"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">y:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self y</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"event y"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">type:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">1</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"2=up, 1=down"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stroke:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(kbMap find: char)</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"1-336"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">elapsed:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Events</span><span class="tab" val="79"></span><span style="font: 10pt serif">elapsedtime</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"1-32767 sixtieths of a sec"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">time:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Events time + Events elapsedtime.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbdnext </span><span style="font: 10pt serif">| event</span><span style="font: bold 10pt serif"> </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"returns next character (mapped) if any; otherwise false"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(event &larr; Events dequeue) or⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(event &larr; Events primitiveDequeue)] do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">event isKbdDown⇒ [⇑kbMap◦event stroke]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self rawkbck⇒ [⇑kbMap◦Events next stroke]"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">keyset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Fix a bug in sysdefs."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑037 - ((mem◦0177030 lshift: ¬3) land: 037)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leftShiftKey </span><span style="font: 10pt serif">["left shift key down?" ⇑(mem◦0177036 land: 0100) = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mp<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[scale=2⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Point new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x: mem◦0424 + mxoffset / 2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">y: mem◦0425 + myoffset / 2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Point new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x: mem◦0424 + mxoffset<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">y: mem◦0425 + myoffset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mpnext </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return next mouse point if red button or tablet is down; otherwise false</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self redbug⇒ [⇑self mp]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nobug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self anybug ≡ false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rawkbck </span><span style="font: 10pt serif">| event</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"flush event queue until down keyboard event or queue empty."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ (event &larr; Events peek) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[event isKbdDown ⇒[⇑event stroke] Events next].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"if queue empty, return false"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rawkbd </span><span style="font: 10pt serif">| stroke<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[until⦂ (stroke &larr; self rawkbck) do⦂ [].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"wait for activity"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Events next.  ⇑stroke</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"if key down, pop queue and return stroke"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">redbug </span><span style="font: 10pt serif">[⇑self buttons=4 or⦂ (mem◦0177100) &lt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tablet </span><span style="font: 10pt serif">[⇑(mem◦0177100) ≠ 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tabletabsolute </span><span style="font: 10pt serif">[mem◦0126 &larr; 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tabletbug </span><span style="font: 10pt serif">[⇑(mem◦0177100) &lt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tabletrelative </span><span style="font: 10pt serif">[mem◦0126 &larr; ¬1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">waitbug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[until⦂ self anybug do⦂ [] ⇑self mp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">waitclickbug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self waitnobug. ⇑self waitbug]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">waitnobug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ self anybug do⦂ [] ⇑self mp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">waitnokey </span><span style="font: 10pt serif">[until⦂ self keyset=0 do⦂ [self rawkbck]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">x </span><span style="font: 10pt serif">[⇑mem◦0426 - htab</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"cursorx, horiz tab adjusted"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">y </span><span style="font: 10pt serif">[⇑mem◦0427 - vtab</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"cursory, vert tab adjusted"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">yellowbug </span><span style="font: 10pt serif">[⇑self buttons=1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Screen Views</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bugScreenMenu<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["see classInit"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">screenMenu bug<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=1⇒[projectWindow≡nil⇒[] projectWindow runParent];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2⇒[user quit];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=3⇒[self restartup: ProjectWindow init];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=4⇒[self restartup: BrowseWindow default];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=5⇒[self restartup: (CodeWindow new class: UserView selector: ↪workspace<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">para: (UserView code: ↪workspace) formerly: false)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=6⇒[user displayoffwhile⦂ [self reclaim]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">color: color scale: scale</span><span class="tab" val="79"></span><span style="font: 10pt serif">[self install]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyIn: p<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑UserView new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">screenrect: screenrect copy<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">vtab: vtab htab: htab scale: scale color: color<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">projectWindow: p<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">disp: disp sched: ↪()]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">displayoffwhile⦂ expr </span><span style="font: 10pt serif">| t v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["t &larr; mem◦0420. mem◦0420 &larr; 0."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; mem◦067. mem◦067 &larr; 58 "disp text frame maxY/2 ?".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; expr eval.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦067 "0420" &larr; t. ⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">install<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self screenextent: screenrect extent tab: htab⌾vtab]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">projectWindow </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[projectWindow≡nil⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[projectWindow &larr; ProjectWindow new.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">projectWindow userview: self changes: Changes parent: projectWindow]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑projectWindow]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reconfigure </span><span style="font: 10pt serif">[] primitive: 62</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restoredisplay<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mem◦0420 &larr; 060. mem◦067 &larr; screenrect height/2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">screenextent: extent tab: tab </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦065 &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(color*040000)+[scale=2⇒[0100000] 0]+(tab x/16*0400)+(extent x/16|2).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦067 &larr; extent y*scale/2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦063 &larr; 1 max: tab y/2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">htab &larr; tab x|16.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vtab &larr; mem◦063*2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">screenrect &larr; 0⌾0 rect: (extent x|32)⌾(extent y|2).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self currentCursor: currentCursor;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">reconfigure; restore]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">screenrect </span><span style="font: 10pt serif">[⇑screenrect]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">screenrect: screenrect vtab: vtab htab: htab scale: scale color: color projectWindow: projectWindow disp: disp sched: sched</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Window Scheduling</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leaveTop</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">leave the top window if there is one</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sched length=0⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(sched◦1) leave]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">promote: window<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sched promote: window]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restart </span><span style="font: 10pt serif">| i <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[Events ≡ nil ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Events &larr; EventQueue init. </span><span style="font: italic 10pt serif">"Top init3.  initialize Event queue and Time interrupt"</span><span style="font: 10pt serif">]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">NormalCursor topage1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self restart⦂ [user run]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restart⦂ code </span><span style="font: 10pt serif">| u<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[u &larr; code cleancopy. u sender &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext sender releaseFully.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext sender &larr; nil.</span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; nil. </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"release caller chain"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">MessageDict new freeMethods.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"release held code"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">disp frame flash.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ true do⦂ [u eval]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restartup: window<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ </span><span style="font: italic 10pt serif">"Equivalent to schedule new window, restart, and redbug in window, except firsttime is already done."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext sender releaseFully. thisContext sender &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">NormalCursor topage1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self schedule: window.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext tempframe all &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self run: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restore </span><span style="font: 10pt serif">| w<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[screenrect clear.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[projectWindow≡nil⇒[] projectWindow putTitle].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ w from: (sched length to: 1 by: ¬1) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(sched◦w) show]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">run<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self run: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">run: topFlag </span><span style="font: 10pt serif">| i w forward</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"topFlag means sched◦1 already is awake"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[forward &larr; [topFlag⇒ [w&larr;sched◦1. while⦂ w eachtime do⦂ []. w lasttime] true].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ true do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i&larr;0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [(i&larr;i+1)&gt;sched length⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">w&larr; [forward⇒[sched◦i] sched◦(sched length+1-i)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">w firsttime] do⦂ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&gt;sched length⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"check for bug in empty space"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user yellowbug⇒[self bugScreenMenu]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sched promote: w.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ w eachtime do⦂ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">forward&larr; w lasttime]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sched </span><span style="font: 10pt serif">[⇑sched]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">schedule: window<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sched≡nil⇒[sched &larr; window inVector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sched &larr; window inVector concat: sched]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scheduleOnBottom: window<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sched≡nil⇒[sched &larr; window asVector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sched &larr; sched concat: window asVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">topWindow </span><span style="font: 10pt serif">[⇑sched◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unschedule: window </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[0&lt;(t&larr; sched find: window)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sched &larr; sched◦(1 to: t-1) concat: sched◦(t+1 to: sched length)]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Notify Window</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notifier: titleString level: lev interrupt: flag<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Restore the full display.  Schedule a one-paned window to notify the user that errorString happened."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self restoredisplay.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">NotifyFlag≡false⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo;NotifyFlag is false...&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; top-blank shows stack, user restart &#771;aborts,&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; tempframe &#771;shows args, ctrl-d proceeds&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: titleString; cr; show.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(Top◦lev) debug. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑NotifyWindow new of: titleString level: lev interrupt: flag]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notifier: titleString stack: stack interrupt: flag<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Restore the full display.  Schedule a one-paned window to notify the user that errorString happened."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self restoredisplay.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">NotifyFlag≡false⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo;NotifyFlag is false...&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; sender debug &#771;shows stack, user restart &#771;aborts,&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; tempframe &#771;shows args, ctrl-d proceeds&rsquo;; cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: titleString; cr; show.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stack debug. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑NotifyWindow new of: titleString stack: stack interrupt: flag]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notify: errorString </span><span style="font: 10pt serif">| notifyWindow<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Create a notify window looking at the Context stack"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notifyWindow &larr; self notifier: errorString stack: thisContext sender interrupt: false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notifyWindow⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[thisContext sender &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> Top currentPriority=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self restartup: notifyWindow]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self scheduleOnBottom: notifyWindow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> Top errorReset]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dialog Window</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clear</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"clear disp of debris and characters"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp clear]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clearshow: str<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp clear; append: str; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cr </span><span style="font: 10pt serif">[disp cr]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">croak<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self notify: &rsquo;A primitive has failed.&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ev<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp ev]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return rectangle of dialogue window"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑disp text frame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newdisp </span><span style="font: italic 10pt serif">"for when some class associated with running Dispframe  changed"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self unschedule: disp.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">disp &larr; Dispframe new rect: (8⌾0 rect: 150⌾96).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self schedule: disp ; clearshow: &rsquo;New Dialogue window created.<br>&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newdisploc: origin and: corner </span><span style="font: italic 10pt serif">"for moving disp"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"user newdisploc: 8⌾0 and: 150⌾96"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(disp text frame inset: ¬2⌾¬2) clear.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">disp text frame &larr; origin rect: corner.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">disp show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next &larr; x </span><span style="font: 10pt serif">["simulate a Vector Stream"</span><span class="tab" val="79"></span><span style="font: 10pt serif">disp cr; print: x; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">print: x </span><span style="font: 10pt serif">[disp print: x; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read </span><span style="font: 10pt serif">[⇑disp read]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">request: s</span><span style="font: 10pt serif">[⇑disp request: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show </span><span style="font: 10pt serif">[disp outline; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show: str<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp append: str; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[disp space]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab </span><span style="font: 10pt serif">[disp tab]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Time</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">convertTime: s returnSecs: format </span><span style="font: 10pt serif">| d dd t dfirst dlast m570 m571 [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">s is total seconds from midnight Jan 1 1901 GMT (Greenwich mean time).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">see maxc &lt;AltoDocs&gt;AltoTime.Press for details</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">time zone specific parameters</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">m570 &larr; mem◦0570. m571 &larr; mem◦0571.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">adjust for time zone</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; s + (([m570 ≥ 0⇒ ["</span><span style="font: italic 10pt serif">west</span><span style="font: 10pt serif">" ¬1] "</span><span style="font: italic 10pt serif">east</span><span style="font: 10pt serif">" 1]) * (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(3600 * ("</span><span style="font: italic 10pt serif">hours</span><span style="font: 10pt serif">" m570 bits: (1 to: 4))) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(60 * ("</span><span style="font: italic 10pt serif">additonal minutes</span><span style="font: 10pt serif">" m571 bits: (1 to: 6))))).<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; s intdiv: 86400.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">current day (in local standard time)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; Date new fromDays: t◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[format⇒ [] t &larr; Time new fromSeconds: t◦2].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">check for DST. correct DST parameters for nonleap years and<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">round to previous Sunday if necessary</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">day of the year on or before which DST takes effect</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dfirst &larr; m570 land: 0777 "bits: (7 to: 15)".<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[dfirst = 366⇒ ["</span><span style="font: italic 10pt serif">DST not in effect</span><span style="font: 10pt serif">" false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dd &larr; d day) ≥ (dfirst &larr; dfirst + d leap - 1)⇒ [<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">day of the year on or before which DST ends</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dlast &larr; (m571 land: 0777 "bits: (7 to: 15)") + d leap - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dd &lt; dlast "</span><span style="font: italic 10pt serif">if false, definitely after</span><span style="font: 10pt serif">" and⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dd &lt; ((Date new day: dlast year: d year) previous: 6) day]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">possibly earlier than or at beginning of range</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dd ≥ ((Date new day: dfirst year: d year) previous: 6) day]⇒ [<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">daylight savings time in effect. add an hour</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">format⇒ [s &larr; s + 3600]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t hours = 23⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d &larr; d+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t hours: 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t hours: t hours+1]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return either total seconds or Date and Time</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">format⇒ [⇑s] ⇑d,t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dateAndTime: secs </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">secs is a String of 4 characters representing seconds (in GMT) since Jan 1 1901.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">convert it to a LargeInteger (rawtotalsecs:), then return a Vector (Date, Time),<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">which is corrected for local time zone and daylight savings</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self convertTime: (self rawtotalsecs: secs) returnSecs: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">now </span><span style="font: 10pt serif">[⇑self dateAndTime: self timewords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rawtotalsecs </span><span style="font: 10pt serif">[⇑self rawtotalsecs: self timewords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rawtotalsecs: secs </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">secs is a String of 4 characters representing seconds (in GMT) since Jan 1 1901.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">copy (in reverse order) to a Natural string, then return a LargeInteger"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; Natural new: 4.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦1 &larr; secs◦4.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦2 &larr; secs◦3.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦3 &larr; secs◦2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦4 &larr; secs◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑LargeInteger new bytes: s neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ticks </span><span style="font: 10pt serif">"Return the 38.08-millisecond interval timer"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑mem◦0430]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">time </span><span style="font: 10pt serif">[⇑self now◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">time⦂ expr </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self ticks.  expr eval.  ⇑self ticks-t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">timewords </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">seconds (in GMT) since Jan 1 1901: as a String</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; String new: 4.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s word: 1 &larr; mem◦0572; word: 2 &larr; mem◦0573.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">today </span><span style="font: 10pt serif">[⇑self now◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">totalsecs </span><span style="font: 10pt serif">[⇑self totalsecs: self timewords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">totalsecs: secs </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">convert from GMT to local and correct for Daylight Savings</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self convertTime: (self rawtotalsecs: secs) returnSecs: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Changes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">changedCategories </span><span style="font: 10pt serif">| titles space str<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["return a vector of the names of class categories which have been changed"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">space &larr; &rsquo; &rsquo;◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">titles &larr; HashSet new init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ str from: Changes contents do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[titles insert: (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">SystemOrganization invert: ((Stream new of: str) upto: space) unique)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑titles contents<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">changedClasses </span><span style="font: 10pt serif">| titles space str<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["return a vector of the names of classes which have been changed"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">space &larr; &rsquo; &rsquo;◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">titles &larr; HashSet new init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ str from: Changes contents do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[titles insert: ((Stream new of: str) upto: space). "class title"].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑titles contents<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">changedMessages </span><span style="font: 10pt serif">[⇑Changes contents sort]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">noChanges </span><span style="font: 10pt serif">[Changes init]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>System quit/resume</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">backup   </span><span style="font: italic 10pt serif">"back up smalltalk on ivy and resume"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ivy open; delete: &rsquo;small.boot&rsquo;; store: &rsquo;small.boot&rsquo;; close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hasXM<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["return true if this is XM Smalltalk"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(mem◦0147)≠0 </span><span style="font: italic 10pt serif">"1 for XM, 0 for normal"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">InLd: fileid  "write out the core image, then load in OS"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;file problem&rsquo;] primitive: 85</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">overlay: fileid </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dp0 stampBoot.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self releaseExternalViews.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">put the ethernet to sleep</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[E≡nil⇒ [] E sleep].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">turn off display during quit/resume</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; mem◦0420. mem◦0420 &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self InLd: fileid.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">we start here after a resume</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">mem◦0420 &larr; t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user keyset&gt;0 do⦂ [user show: &rsquo;The keyset is stuck&rsquo;; cr]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">quit <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self quitFrom: self </span><span style="font: italic 10pt serif">"yup"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">quitFrom: controller<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self overlay: ↪(0 0 0 0 0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self hasXM⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">screenrect clear.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">controller restore]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">quitThen: str </span><span style="font: 10pt serif">| rem rest ["</span><span style="font: italic 10pt serif">quit, then have OS execute str</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; (dp0 file: &rsquo;rem.cm&rsquo;) readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rest &larr; rem next: rem length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem readwrite; reset; append: str; cr; append: rest; close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self quit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">quitThen: s continue: r </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">something for O.S. to do</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp0 oldFile: &rsquo;rem.cm.&rsquo;) settoend;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: s; append: &rsquo;; &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: [r⇒ [&rsquo;Resume.~ small.boot&rsquo;] &rsquo;Quit.~; Resume.~ small.boot&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">cr; flush]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self quit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">releaseExternalViews </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">close some things that we know about, everything else gets released</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Sources close. dp0 close. dp1 close.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">release (obsolete) some external views, usually File related</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t from: externalViews length to: 1 by: ¬1 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(externalViews◦t) release. externalViews◦t &larr; nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">externalViews reset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Swat </span><span style="font: 10pt serif">[] primitive: 90</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Misc System Stuff</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">screenMenu &larr; Menu new string:<br>&rsquo;exit to overview<br>quit<br>open a subview<br>open a browser<br>open a workspace<br>reclaim&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classNames</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"an alphabetized Vector of all Smalltalk class titles uniqued"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| classes x c<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">AllClassNames≡nil⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">classes &larr; (Vector new: 20) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ x from: Smalltalk do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; Smalltalk ◦ x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(c is: Class) or⦂ (c is: VariableLengthClass)⇒ [classes next &larr; x].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">AllClassNames &larr; classes contents sort.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑AllClassNames<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file: file classes: classes changesOnly: ch </span><span style="font: 10pt serif">| cl [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">called by </span><span style="font: bold 10pt serif">UserView release</span><span style="font: italic 10pt serif"> to write just changes or entire system on a<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">new file.  also, see comment in </span><span style="font: bold 10pt serif">Class archiveOn:changesOnly:</span><span style="font: 10pt serif">.</span><span style="font: italic 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">write class comment and message text onto a </span><span style="font: bold 10pt serif">FileStream</span><span style="font: italic 10pt serif"> (which could refer<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">to an </span><span style="font: bold 10pt serif">AltoFile, ILFile</span><span style="font: italic 10pt serif">, etc.). either just changes or everything are<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">written and replaced with </span><span style="font: bold 10pt serif">RemoteParagraph</span><span style="font: italic 10pt serif"> references</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ch⇒ [file settoend] file reset].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file readwriteshorten.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ cl from: classes do⦂ [Smalltalk◦cl archiveOn: file changesOnly: ch].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file close; readonly]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growSmalltalk: numberofdiskpages<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for preemptive growth of Small.boot on disk</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dp0 growSmalltalkBy: numberofdiskpages]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initCompiler  </span><span style="font: italic 10pt serif">"Initialize shared variables of parser and generators"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| code sel c t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk declare: ↪(TokenCodes ByteCodes).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[TokenCodes≡nil⇒ [TokenCodes&larr;SymbolTable new init: 32]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ByteCodes≡nil⇒ [ByteCodes&larr;SymbolTable new init: 32. Integer sharing: ByteCodes]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">TokenCodes<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">declare:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(aRightBrack aPeriod </span><span style="font: italic 10pt serif">"First 2 in this order"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">aLeftPar aSemicolon aCondArrow aHand aReturnArrow<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">aLeftBrack aRightPar aLeftArrow<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">aBinary </span><span style="font: italic 10pt serif">"All above must be less, all below must be greater"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">aNumber aString </span><span style="font: italic 10pt serif">"All below must be in that order"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">aKeyword aGibberish aColon aDigit aWord)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">as:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(1 2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">3 4 5 6 7<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">8 9 10<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">20<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">30 31<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">41 42 43 44 45<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ByteCodes<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">declare:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(toLoadField toLoadTemp toLoadLit toLoadLitInd<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toLoadCtxt toLoadTempframe<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toLoadConst toLoad0 toLoad1 toLoadSelf toLoadNil toLoadFalse toLoadTrue<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toSmashPop toSmash toPop toReturn toEnd toLoadThisCtxt toSuper<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toShortJmp toShortBfp toLongJmp toLongBfp<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toPlus toMinus toGtr toGeq toNext toEq toNew toAsStream<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">toSendLit)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">as:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(0 16 32 64<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">112 116<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">120 121 122 113 125 126 127<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">128 129 130 131 132 133 134<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">144 152 160 168<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">176 177 179 181 194 197 203 207<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">208).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; Dictionary new init: 16.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c insertall: ↪(&rsquo;self&rsquo; &rsquo;thisContext&rsquo; &rsquo;super&rsquo; &rsquo;nil&rsquo; &rsquo;false&rsquo; &rsquo;true&rsquo;)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">with: ↪(113 133 134 125 126 127).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ByteCodes declare: ↪stdPrimaries as: c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; Dictionary new init: 64.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; 175.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ sel from: SpecialOops ◦(10 to: SpecialOops length) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ </span><span style="font: italic 10pt serif">"Atoms not wanted here -- only strings and characters"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">code &larr; code+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel≡nil ⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel &larr; [sel length=1 and⦂ (sel◦1) isletter ≡ false ⇒ [sel◦1] sel asString].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c insert: sel with: code.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ByteCodes declare: ↪stdSelectors as: c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; Dictionary new init: 8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c insertall: ↪(&rsquo;while⦂do⦂&rsquo; &rsquo;until⦂do⦂&rsquo; &rsquo;for⦂to:do⦂&rsquo; &rsquo;for⦂from:do⦂&rsquo; &rsquo;for⦂from:to:by:do⦂&rsquo; &rsquo;for⦂from:to:do⦂&rsquo; &rsquo;if⦂then⦂else⦂&rsquo; &rsquo;if⦂then⦂&rsquo;)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">with: ↪(whiledo:args: untildo:args: fortodo:args: forfromdo:args: forfromtobydo:args: forfromtodo:args: ifthenelse:args: ifthen:args:).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ByteCodes declare: ↪inLineMsgs as: c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t from: ↪((toLoadFieldLong 0210) (toLoadTempLong 0211) (toLoadLitLong 0212)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(toLoadLitIndLong 0213) (toSendLitLong 0214)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(codeLoadField 0400) (codeLoadTemp 01000) (codeLoadLit 01400)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(codeLoadLitInd 02000) (codeSendLit 02400)) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ByteCodes declare: t◦1 as: t◦2]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">oopsToFile </span><span style="font: 10pt serif">| a c i t s cs f ts<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f &larr; dp0 file: &rsquo;oops&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cs &larr; user classNames transform⦂ a to⦂ Smalltalk◦a.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; cs transform⦂ a to⦂ a asOop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ts &larr; t permutationToSort.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: ts do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f append: (t◦i) base8; tab; append: (cs◦i) title; cr].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: cs◦ts do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f cr; append: c title; cr.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; c md contents.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"selectors"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; s transform⦂ a to⦂ (c md method: a) asOop.  </span><span style="font: italic 10pt serif">"method oops"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: t permutationToSort do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f tab; append: (t◦i) base8; tab; append: s◦i; cr]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: c title; cr]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printCrossReference: classNames on: f </span><span style="font: 10pt serif">| dict m md frame l each s class<br>"user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user printCrossReference: user classNames<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">on: (dp0 file: &rsquo;CrossReference.Press&rsquo;)].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user classNames<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(SystemOrganization category: &rsquo;xyz&rsquo;)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(class1 class2)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dict &larr; Dictionary init: 200.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m to: 32 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dict insert: SpecialOops◦(9+m) with: ↪((Primitives) ()) copy].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">classNames transform⦂ each to⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user show: each; space.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">md&larr; (Smalltalk◦each) md.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m from: md do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Tally all the UniqueString literals"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[s&larr; dict lookup: m⇒[] dict insert: m with: (s&larr; ↪(()()) copy)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦1 has: each⇒[] s◦1&larr; s◦1, each.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ l from: (md literals: m) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[l is: UniqueString⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[s&larr; dict lookup: l⇒[] dict insert: l with: (s&larr; ↪(()()) copy)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦2 has: each⇒[] s◦2&larr; s◦2, (each,m)]]]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f&larr; f asPressPrinter.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f stamp.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame&larr; f defaultframe.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Print the messages out sorted"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m from: dict contents sort do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user show: m; space.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f frame&larr; frame.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">md&larr; dict◦m.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s&larr; (String new: 200) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s append: m; append: [(md◦1) length=0⇒[&rsquo; ( - undefined -  &rsquo;] &rsquo; (&rsquo;].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ l from: (md◦1) sort do⦂ [s append: l; append: &rsquo;, &rsquo;].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s skip: ¬2; append: &rsquo;)&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f print: (s contents asParagraph maskrun: 1 to: m length under: 1 to: 1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f frame&larr; (frame minX+500)⌾frame minY rect: frame corner.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s reset.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[md◦1 has: ↪Primitives⇒[s append: &rsquo;untallied.&rsquo;. md◦2&larr; ↪()]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(md◦2) length=0⇒[s append: &rsquo;- unreferenced -&rsquo;]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">class&larr; ↪-.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ l from: (md◦2) sort do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[l◦1=class⇒[s append: &rsquo;, &rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[class≠↪-⇒[s cr]]. s append: &rsquo;(&rsquo;; append: l◦1; append: &rsquo;) &rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">class&larr; l◦1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s append: l◦2].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f print: s contents asParagraph].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close; toPrinter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">purgealittle </span><span style="font: 10pt serif">[] primitive: 89</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reclaim </span><span style="font: 10pt serif">| c cl cv</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" Should only be called from bugScreenMenu !! "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user cr; show: &rsquo;Reclaiming... &rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cl&larr; CodePane, ScrollBar, PanedWindow, ListPane, Generator, Parser, BitImage, Document, DocumentEditor, Image.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cv&larr; Context allInstances.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user print: cv length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: cv do⦂ [cl has: c mclass⇒[c release]]. cv all&larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: &rsquo; reduced to &rsquo; + Context howMany asString + &rsquo;.&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release </span><span style="font: 10pt serif">| m [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">prepare to release this version</span><span style="font: 10pt serif"> (</span><span style="font: bold 10pt serif; text-decoration: underline">after</span><span style="font: 10pt serif"> editing </span><span style="font: bold 10pt serif">UserView version</span><span style="font: 10pt serif">)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">and possibly copying Sources file (see </span><span style="font: bold 10pt serif">writeSources:</span><span style="font: 10pt serif">)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(m&larr; Undeclared contents) length&gt;0⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Undeclared contains &rsquo;+ m asString]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">either create a new Sources file (write all messages) or append only changes</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">m &larr; Sources directory checkName:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;&lt;Smalltalk&gt;Smalltalk.Sources.&rsquo; + user versionName.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"for repeated releases in same version.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">should also work for Sources local (if renamed)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user writeSources: [m = Sources name⇒ [Sources] Sources directory file: m].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">make workspace local</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">UserView md code: ↪workspace &larr; UserView code: ↪workspace.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user writeChangedMessages: (phylum file: &rsquo;&lt;Smalltalk&gt;ChangedMessages&rsquo;).].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user noChanges. user releaseMessage.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">releaseMessage </span><span style="font: 10pt serif">[user clearshow: &rsquo;Welcome to &rsquo; + user version]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">systemStartup </span><span style="font: italic 10pt serif">"To do after system flush and installation of new core image"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top top.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Window classInit.<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"The following screen extent seems to really fill the screen in x,<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">the Alto Hardware Manual to the contrary notwithstanding."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self hasXM⇒ ["</span><span style="font: italic 10pt serif">XM</span><span style="font: 10pt serif">" self screenextent: 640⌾800 tab: 0⌾2]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self screenextent: 640⌾480 tab: 0⌾50].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Sources release. dp0 release. dp1 release.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self releaseExternalViews.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[E≡nil⇒ [] "</span><span style="font: italic 10pt serif">ignore broadcasts</span><span style="font: 10pt serif">" E broadcastFilter: true].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(VirtualMemory new) thisvmem.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Vmem afterBirth]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">systemworkspace1</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for system releasers only!!!<br><br>this has been partitioned into three workspaces for editing convenience:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">systemworkspace1<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">steps 0-4: general comments, handling Sources, creating a release.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">systemworkspace2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">steps 5-7: doing a vmem write or surgery, storing finished files on Phylum<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">systemworkspace3<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">step 8: after a release, e.g. updating press files</span><span style="font: 10pt serif"><br><br><br></span><span style="font: bold 10pt serif">0.</span><span style="font: italic 10pt serif"> This boot file should be named small.boot for vmem writing, surgery, and command file purposes.  If you made changes to the Sources disk be sure to update the current versions of (Xm)Smalltalk.Run, (Xm)Smalltalk.Syms, and (Xm)Byterp.mb on [Ivy]&lt;Smalltalk&gt;. This procedure works best on a Dorado for speed and disk space reasons, and it also can be done on an Alto (double disk O.S. required for vmem write).  Microcode changes (including making non-xm versions) must(?) be done on an Alto.  Step 5 (vmem writing) assumes enough space for another boot file.  To turn off display during execution, hold down left shift key while selecting &rsquo;doit&rsquo;.<br><br>For those who want to vmem write their own versions, do not execute steps 4, 7 or 8 without further editing of file and directory names. </span><span style="font: italic 10pt serif; text-decoration: underline">Underlined items</span><span style="font: italic 10pt serif"> are typical values and normally must be edited to be useful.<br><br></span><span style="font: 10pt serif"><br></span><span style="font: bold 10pt serif">1.</span><span style="font: italic 10pt serif"> to create an xm version:  filin changes and selected goodies. Undeclared must be empty for release to work (step 4). copy the categories of classes which have changed to systemworkspace3 (for later printing) and recompile it.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dp0 filin: ↪(&rsquo;</span><span style="font: 10pt serif; text-decoration: underline">changes.st</span><span style="font: 10pt serif">&rsquo;).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum filin: ↪(&rsquo;&lt;Small-goodies&gt;</span><span style="font: 10pt serif; text-decoration: underline">xx.st</span><span style="font: 10pt serif">&rsquo;).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Undeclared contents inVector, user changedCategories<br><br><br></span><span style="font: bold 10pt serif">2.</span><span style="font: italic 10pt serif"> update version number/letter and comments in UserView version<br><br><br></span><span style="font: bold 10pt serif">3.</span><span style="font: italic 10pt serif"> the Sources file will be ordinarily be created in step 4. if only a few changes are involved, it may be somewhat faster to copy the old sources file to the new sources file (this step). then step 4 will only append changes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum store: Sources reset as: &rsquo;Smalltalk.Sources.&rsquo; + user versionName.<br><br></span><span style="font: italic 10pt serif"><br></span><span style="font: bold 10pt serif">4. </span><span style="font: italic 10pt serif">checks Undeclared, writes all or appends changed messages to Sources file, updates ChangedMessages, inits Changes, puts up greeting, and sets the default user name & password. note: this is only to be executed for releasing the Smalltalk system itself (supply the proper password!!). if you plan to do a vmem write next, better to do this as first line of step 5.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user releaseExternalViews.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum name: &rsquo;Smalltalk&rsquo; password: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">password</span><span style="font: 10pt serif">&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user release.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum name: &rsquo;Smalltalk-User&rsquo; password: &rsquo;Smalltalk&rsquo;.<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">to write out the sources for a private version, specify which directory to use (don&rsquo;t leave Smalltalk as the default) and which categories and/or classes are to be included.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| c classes. user releaseExternalViews. classes &larr; (Vector new: 50) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum name: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">name</span><span style="font: 10pt serif">&rsquo; password: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">password</span><span style="font: 10pt serif">&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: ↪(</span><span style="font: 10pt serif; text-decoration: underline">&rsquo;category1&rsquo; class1</span><span style="font: 10pt serif">) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c is: String⇒ [classes append: (SystemOrganization category: c)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">classes next &larr; c].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user file: (phylum file: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">&lt;ddd&gt;xx</span><span style="font: 10pt serif">.Sources.&rsquo; + user versionName)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">classes: classes contents changesOnly: false.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">systemworkspace2</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for system releasers only!!!<br><br><br></span><span style="font: bold 10pt serif">5.</span><span style="font: italic 10pt serif"> if no surgery or vmem write involved, skip to step 7. start here with an xm version to make a non-xm version.  specify option below:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">1 vmem write (includes xm surgery)<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">2 xm surgery<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">3 non-xm surgery<br>to make things totally automatic, edit in your valid Maxc name and password, otherwise Ftp will ask you later. in the case of surgery only, at the end you will have to hit a key after safing.<br></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| option prefix dir file.<br>option &larr; </span><span style="font: 10pt serif; text-decoration: underline">1</span><span style="font: 10pt serif">.<br>dir &larr; phylum asFtpDirectory.<br>dir directoryName: &rsquo;Smalltalk-76&rsquo;.<br>prefix &larr; [option=3⇒ [&rsquo;&rsquo;] &rsquo;Xm&rsquo;].<br>for⦂ file from: ↪(&rsquo;Smalltalk.Run&rsquo; &rsquo;Smalltalk.Syms&rsquo; &rsquo;Byterp.Mb&rsquo;) do⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir retrieve: prefix + file as: file].<br>dir closeThen: ([option=1⇒ [&rsquo;delete oldsmall.boot;<br>copy newsmall.boot &larr; small.boot; &rsquo;] &rsquo;&rsquo;]) + <br>&rsquo;ftp maxc Login/c </span><span style="font: 10pt serif; text-decoration: underline">yourname yourpassword</span><span style="font: 10pt serif"> directory/c alto retrieve/c packmu.run ramload.run;<br>Resume small.boot;<br>Ramload/N Byterp.mb/F 1000/A;<br>Smalltalk.run&rsquo;.<br><br>option=1⇒ [(VirtualMemory new) giveBirth3. user quit]<br>Vmem ramwrite: (dp0 oldFile: &rsquo;byterp.mb&rsquo;).<br>Vmem surgery: (dp0 oldFile: &rsquo;Smalltalk.run&rsquo;).<br><br><br></span><span style="font: bold 10pt serif">6</span><span style="font: italic 10pt serif">. after a successful vmem write or surgery, execute this (selecting here is tricky or type in a Dispframe)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user systemStartup.<br><br><br></span><span style="font: bold 10pt serif">7</span><span style="font: italic 10pt serif">. edit lastversion (and Smalltalk password) and execute the following, then close this window (clean up screen for non-xm?), and quit. it then renames old versions of files, stores new versions of files, e.g. remote XmSmall.Boot becomes XmSmall.Boot.5.5g and local Small.Boot becomes remote XmSmall.Boot<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| lastversion dir file remotefile.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastversion &larr; &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">5.5j</span><span style="font: 10pt serif">&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir &larr; phylum asFtpDirectory.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir login: &rsquo;Smalltalk&rsquo; password: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">password</span><span style="font: 10pt serif">&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ file from: ↪(&rsquo;Small.Boot&rsquo; &rsquo;Smalltalk.Syms&rsquo;) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">remotefile &larr; ([user hasXM⇒ [&rsquo;Xm&rsquo;] &rsquo;&rsquo;]) + file.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir rename: remotefile newName: remotefile + &rsquo;.&rsquo; + lastversion;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">store: file as: remotefile].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp0 file: &rsquo;rem.cm&rsquo;) append: dir commands; cr; close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user releaseMessage.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">systemworkspace3</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for system releasers only!!!<br></span><span style="font: 10pt serif"><br><br></span><span style="font: bold 10pt serif">8.</span><span style="font: italic 10pt serif"> to update press files for system categories or cross reference listing directly on Phylum, browse or spawn this window.  edit pf to specify a list of system categories to print, usually from step 1, e.g. user changedCategories: ↪(&rsquo;Basic Data Structures&rsquo; ...) or SystemOrganization categories (for all); delete toPrinter if you don&rsquo;t want the press files printed. edit xref to be user classNames if you want to generate a cross reference listing.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> | pf xref cat.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pf &larr; </span><span style="font: 10pt serif; text-decoration: underline">↪  (&rsquo;Text Objects&rsquo; &rsquo;Kernel Classes&rsquo; &rsquo;Press File Support&rsquo; &rsquo;IFS File System&rsquo; &rsquo;Alto File System&rsquo; &rsquo;Panes and Menus&rsquo; &rsquo;Files&rsquo; &rsquo;Juniper&rsquo; &rsquo;Windows&rsquo; &rsquo;Graphical Objects&rsquo; &rsquo;Numbers&rsquo; &rsquo;Basic Data Structures&rsquo; )</span><span style="font: 10pt serif">.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">xref &larr; </span><span style="font: 10pt serif; text-decoration: underline">↪()</span><span style="font: 10pt serif">.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user releaseExternalViews.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">phylum name: &rsquo;Smalltalk&rsquo; password: &rsquo;</span><span style="font: 10pt serif; text-decoration: underline">password</span><span style="font: 10pt serif">&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ cat from: pf do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">((phylum file: (cat + &rsquo;.Press&rsquo;) asFileName) asPressPrinter) stamp;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">printclass: (SystemOrganization category: cat); close</span><span style="font: 10pt serif; text-decoration: underline">; toPrinter</span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">xref empty⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user printCrossReference: xref on: (phylum file: &rsquo;CrossReference.Press&rsquo;).<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">version </span><span style="font: 10pt serif">[⇑&rsquo;Smalltalk </span><span style="font: bold 10pt serif">5.5k</span><span style="font: 10pt serif"> &rsquo; + [user hasXM⇒ [&rsquo;XM &rsquo;] &rsquo;&rsquo;] + &rsquo;</span><span style="font: bold 10pt serif">November 24</span><span style="font: 10pt serif">&rsquo;]<br>"user version<br><br>low level disk address calculations are more general (necessary for 14-sector Dorado/Dolphin file systems)<br>better error recovery for broken and timed out Leaf connections<br>AltoFileDirectory disk page allocation/deallocation bugs fixed<br>miscellaneous printing fixes<br>Juniper fixes (2)<br>goodie: again-del-forget.st<br>create/write dates on boot file are updated at quit time<br>primitives for reading/writing 3K CRAM<br>Phylum account changes <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">default Leaf connection is logged in to &lt;Smalltalk-User&gt;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">system release uses [Phylum]&lt;Smalltalk-76&gt; instead of [Ivy]&lt;Smalltalk&gt;<br>see UserView workspace for logging into your account on Phylum, changing default printer -- for information on [Phylum]&lt;Smalltalk&gt;Release-5.5k.Bravo, .Press<br><br></span><span style="font: bold 10pt serif">September 3, 5.5j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">duplicate packet fix<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fixes to ether (routing table, name lookup, phylum, Int32), printer names,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">files, UserView time messages, context simulation,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">replace in BitBlt & Paragraph, NotifyWindow cleanup,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Class code: always decompiles with left shift key, window printing fixes,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">SystemOrganization globalComment contains no nulls<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">the following changes files were included:<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[phylum]&lt;small-goodies&gt;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">5.5i.changes.st, notifychange.st, window-print-changes.st<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[phylum]&lt;findit&gt;5.5i.more.changes.st<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[maxc]&lt;dolbec&gt;int32change.st<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[maxc&gt;ingalls&gt;fixes.st<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ivy]&lt;kaehler&gt;context-simulation.st<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ivy]&lt;borning&gt;context-changes.st<br><br></span><span style="font: bold 10pt serif">May 1, 5.5i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">obscure file bugs eliminated; version features added (goody: File-version.st).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ifs multiple connections fixed; Ifs error numbers looked up in Ifs.Errors.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">duplicate packets eliminated at lowest level.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Int32 primitive fix. Juniper retransmit parameters increased<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Integer compare: LargeInteger now works<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CodePane/FilePane &rsquo;print&rsquo; (within a CodeWindow) now prints entire Paragraph<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rather than only part within window<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ScrollBars hide during CodePane </span><span style="font: italic 10pt serif">again & cancel</span><span style="font: 10pt serif">. </span><span style="font: italic 10pt serif">cancel</span><span style="font: 10pt serif"> saves your old text, so<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">an immediate </span><span style="font: italic 10pt serif">undo</span><span style="font: 10pt serif"> will replace the current selection with your previous text.<br><br></span><span style="font: bold 10pt serif">April 11, 5.5h<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Alto file names limited to 39 characters (&rsquo;somestring&rsquo; asFileName will fix<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">name, truncating if necessary). other misc. file, ether, simulator fixes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt fixed so that BitRects don&rsquo;t lose their bits<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt used to speedup reading&writing files, sending Press files to printers<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ParagraphScanner puts underlining into Press files<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">printer names updated (PressFile classInit). hashing-changes.st included.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">after font cataclysm, get new version of Fonts.Widths before printing<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">system release procedure modified<br><br></span><span style="font: bold 10pt serif">March 6, 5.5g</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ether, file, vmem writing fixes.  cursor clipping on screen boundary.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt used for String growing, copying, replacing<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">goodies included: display-off-after-notify.st, CodePane-doit.st,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">context-simfix2.st, ILchanges.st, string-changes.st<br><br>see [Phylum]&lt;Smalltalk&gt; for the following files.  () surround an optional prefix or suffix.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Document.Press<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">mini-guide to Smalltalk system and user interface<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">VersionHistory<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">information about versions up to 5.5g<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ChangedMessages<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a list of  messages which have changed<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">xxx.Press<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press file for CrossReference or for system category &rsquo;xxx&rsquo; in current version<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">to save paper, consider consulting the LRG alcove copies<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(Xm)Small.Boot(.version)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(Xm)Smalltalk.Syms(.version)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">older versions of .Boot and .Syms are explicitly named.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk.Sources.version<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">all Smalltalk.Sources (including the current one) are explicitly named<br><br>[Phylum]&lt;Small-Goodies&gt; contains miscellaneous bug fixes and new features (and even some documentation: goodies.bravo, .press) offered by the community of Smalltalk Users.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">versionName </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self version asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"skip Smalltalk"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s skipTo: 040.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"return version identification, e.g. 5.5f"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s upto: 040]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: center">
<span style="font: bold 10pt serif">workspace<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Not meant to be executed&rsquo;]<br>"<br></span><span style="font: 18pt monospace">XEROX</span><span style="font: 10pt serif"> - </span><span style="font: bold 10pt serif">Learning Research Group</span><span style="font: 10pt serif"><br> <br>user screenextent: 640⌾580 tab: 0⌾50.<br>NotifyFlag &larr; true.</span><span style="font: italic 10pt serif"><br></span><span style="font: 10pt serif">Changes init.<br>user changedMessages<br>user changedClasses<br>user changedCategories<br>Undeclared contents<br></span><span style="font: italic 10pt serif"><br>to set the default printer</span><span style="font: 10pt serif"><br>PrinterName&larr;&rsquo;Menlo&rsquo;.<br>PrinterName&larr;(PressFile new) selectPrinter: PrinterName.<br><br></span><span style="font: italic 10pt serif">to change phylum to access your account<br></span><span style="font: 10pt serif">user releaseExternalViews. phylum name: &rsquo;name&rsquo; password: &rsquo;password&rsquo;.<br><br>dp0 filin: ↪(&rsquo;Changes.st&rsquo;).<br>(dp0 file: &rsquo;changes.st&rsquo;) filout.<br>(dp0 file: &rsquo;xxx&rsquo;) edit.<br>dp0 pressfilin: ↪(&rsquo;xxx.press&rsquo;).<br>(dp0 filesMatching: &rsquo;*.st&rsquo;) sort<br>dp0 list. dp0 freePages<br>dp0 delete: &rsquo;old&rsquo;<br>dp0 rename: &rsquo;old&rsquo; newName: &rsquo;new&rsquo;<br><br></span><span style="font: italic 10pt serif">for reinitializing Sources and phylum<br></span><span style="font: 10pt serif">Sources release. phylum release. Sources reopen.<br><br></span><span style="font: italic 10pt serif">to make Smalltalk Sources local</span><span style="font: 10pt serif"><br> | s. s &larr; &rsquo;Smalltalk.Sources.&rsquo;.<br>(phylum asFtpDirectory) retrieve: &rsquo;&lt;Smalltalk&gt;&rsquo; + s + user versionName as: s; close.<br>Sources on: (dp0 file: s).<br><br></span><span style="font: italic 10pt serif">to switch back to remote Sources</span><span style="font: 10pt serif"><br>Sources close; on: (phylum file: &rsquo;&lt;Smalltalk&gt;Smalltalk.Sources.&rsquo; + user versionName).<br><br><br></span><span style="font: italic 10pt serif">to filin a remote Smalltalk file</span><span style="font: 10pt serif"><br>phylum filin: ↪(&rsquo;&lt;Small-goodies&gt;xxx.st&rsquo;).<br><br></span><span style="font: italic 10pt serif">to print a remote/local press file</span><span style="font: 10pt serif"><br>(phylum pressfile: &rsquo;&lt;Smalltalk&gt;xxx.press&rsquo;) toPrinter.<br>(dp0 pressfile: &rsquo;xxx.press&rsquo;) toPrinter: &rsquo;Lilac&rsquo;.<br><br>File noChanges.<br>BitRect new fromuser; edit.<br>user schedule: (defaultBitRectEditor newframe).<br><br>DocumentEditor new defaultdocument: &rsquo;test&rsquo;.<br>DocumentEditor new init: (Document new fromPress: &rsquo;test.document&rsquo;).<br><br></span><span style="font: italic 10pt serif"><br></span><span style="font: 10pt serif">user releaseExternalViews.<br>E sleep. E kill. E &larr; nil.<br>E &larr; Etherworld new. E broadcastFilter: true. E wakeup.<br>Sources reopen.<br><br></span><span style="font: italic 10pt serif">for primary Smalltalk access to file servers and printers at other sites.<br>substitute yourserver for phylum above, compile this workspace<br></span><span style="font: 10pt serif">PrinterName &larr; &rsquo;name-of-your-printer&rsquo;.<br>Smalltalk declare: ↪yourserver.<br>yourserver &larr; ILFileDirectory new directory: &rsquo;name-of-your-server&rsquo;.<br>yourserver name: &rsquo;Smalltalk-User&rsquo; password: &rsquo;Smalltalk&rsquo;.<br>Sources on: (yourserver file: &rsquo;&lt;Smalltalk&gt;Smalltalk.Sources.&rsquo; + user versionName).<br>Changes init.<br><br>user Swat.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeChangedMessages: ChangedMessages </span><span style="font: 10pt serif">| class m ms [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"append changed messages to a file (usually on [phylum])"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ChangedMessages settoend; cr; cr; asParagraphPrinter stamp.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">class &larr; &rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ m from: user changedMessages do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ms&larr; m asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(ms upto: 040)=class⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ChangedMessages append: &rsquo;, &rsquo;; append: (ms upto: 040)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ChangedMessages cr; append: m.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">class&larr; m asStream upto: 040].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ChangedMessages close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeSources: newSources </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"write a new Sources file (usually on [phylum]Smalltalk.Sources.xxx<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(i.e. xxx = user versionName))<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">if it&rsquo;s a new file or empty, write all Sources. otherwise it better be a copy of<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">the previous Sources file (only changes will be appended. do the copy with ftp)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user file: newSources classes: SystemOrganization<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">changesOnly: (newSources end ≡ false).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Sources close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Sources &larr; newSources]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪UserView under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">UserView classInit&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"VariableLengthClass"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;VariableLengthClass&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Class<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">veryspecial: 20;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am a class whose instances have numbered elements instead of named fields.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"gets propagated to a dummy instance"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self new: 1) classInit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Instance access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allInstances </span><span style="font: 10pt serif">[user notify: &rsquo;use allInstances: instead to specify the length range&rsquo;<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"the length ranges are 0,1,2,3,4,5,6,7,8 individually and groups 9 (to 16), 17 (to 32), 33 (to 64), 65, 129, 257, 513, 1025, 2049, and 4197"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allInstances: len </span><span style="font: 10pt serif">[⇑(self allInstancesEver: len) notNil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allInstancesEver: len </span><span style="font: 10pt serif">| indx vec PCLs i </span><span style="font: italic 10pt serif">"returns a vector containing all instances of this class and length mixed with nils"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"for large lengths, instances come in groups with lengths within a single power of 2"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">PCLs &larr; Vmem pclassesOf: self length: len.  </span><span style="font: italic 10pt serif">"vector of PCLs"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vec &larr; Vector new: 128*PCLs length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: PCLs length do⦂ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(vec◦[i-1*128+1 to: i*128]) all&larr; PCLs◦i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext destroyAndReturn:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self fromFreelist: (Vmem freelistOffset: len) fill: vec)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: inst </span><span style="font: 10pt serif">| t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self new: inst length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: inst length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t◦i &larr; inst◦i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">howMany: len </span><span style="font: 10pt serif">| v </span><span style="font: italic 10pt serif">"how many instances of this class and length are in use now?"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; self allInstancesEver: len.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext destroyAndReturn: v length - (v count: nil)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">new<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;use new: &lt;Integer=length&gt; here.&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">new: length<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[length&gt;16384 ⇒[user notify: length asString+<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo; is too big a String&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">length&gt;8192 ⇒[user notify: length asString+<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo; is too big a Vector&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">length&lt;0 ⇒[user notify: length asString+<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo; -- negative length is invalid&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self new: length asInteger] primitive: 29</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy: inst </span><span style="font: 10pt serif">| t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self new: inst length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: inst length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t◦i &larr; (inst◦i) recopy]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪VariableLengthClass under: &rsquo;Kernel Classes&rsquo;.&#771;</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
