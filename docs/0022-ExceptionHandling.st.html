<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/ExceptionHandling.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 11:37:58 pm.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"ExceptionHandler"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ExceptionHandler&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo; <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fDoContext<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fCode<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fTrapCode<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fTrapCondition<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fResult<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fPostTrapIndicator<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fStatusIndicator<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>EXCEPTION HANDLER  J.C. Althoff  7/79</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: bold 10pt serif">description<br></span><span style="font: 10pt serif">[<br>"</span><span style="font: 10pt monospace"><br>This class provides some exception handling capabilities that can be used in a variety of applications.  It is intended to be used in the following way:<br><br>1. An ExceptionHandler object is created to supervise the execution of a block of statements.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH &larr; ExceptionHandler new.</span><span style="font: 10pt monospace"><br>2. Each object that is capable of detecting an exception is informed of the existence of the ExceptionHandler object.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj exceptionHandler: EH.</span><span style="font: 10pt monospace"><br>3. The ExceptionHandler object is then sent the message </span><span style="font: 10pt serif">&rsquo;do⦂ pCode onTrapDo⦂ pTrapCode&rsquo;</span><span style="font: 10pt monospace">.  The parameter </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> is a block of statements that is to be supervised by the ExceptionHandler object.  The parameter </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> is a block of statements that is to be executed whenever an exception is detected.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH do⦂ [ ... ] onTrapDo⦂ [ ... ].</span><span style="font: 10pt monospace"><br>4. When an exception is detected during the execution of one of the statements in </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> the message </span><span style="font: 10pt serif">&rsquo;trap&rsquo;</span><span style="font: 10pt monospace"> can be sent to the ExceptionHandler object which will then take control.  If information about the exception is available, it can be relayed by sending the message </span><span style="font: 10pt serif">&rsquo;trap:&rsquo;</span><span style="font: 10pt monospace"> with the information specified as the parameter.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH trap. </span><span style="font: 10pt monospace"> (or)  </span><span style="font: 10pt serif">EH trap: information.</span><span style="font: 10pt monospace"><br>5. When the ExceptionHandler object gets control it saves the parameter if one was sent, then executes </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace">.  The saved parameter can be retrieved by sending the message </span><span style="font: 10pt serif">&rsquo;trapCondition&rsquo;</span><span style="font: 10pt monospace">.  The statements in </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> should take any actions necessary to handle the exception. Messages can be included in </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> that tell the ExceptionHandler object what to do when </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> completes.  The available messages are:<br></span><span class="tab" val="79"></span><span style="font: 10pt monospace">5.1 </span><span style="font: 10pt serif">&rsquo;restart&rsquo;</span><span style="font: 10pt monospace"> which restarts the execution of </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace">,<br></span><span class="tab" val="79"></span><span style="font: 10pt monospace">5.2 </span><span style="font: 10pt serif">&rsquo;continue&rsquo;</span><span style="font: 10pt monospace"> which continues </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> at the point at which </span><span style="font: 10pt serif">&rsquo;trap&rsquo; </span><span style="font: 10pt monospace">was sent,<br></span><span class="tab" val="79"></span><span style="font: 10pt monospace">5.3 </span><span style="font: 10pt serif">&rsquo;abort&rsquo;</span><span style="font: 10pt monospace"> which aborts the execution of </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> and returns control to the statement following </span><span style="font: 10pt serif">&rsquo;do⦂ pCode onTrapDo⦂ pTrapCode&rsquo;</span><span style="font: 10pt monospace">.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH restart.</span><span style="font: 10pt monospace">  (or)  </span><span style="font: 10pt serif">EH continue.</span><span style="font: 10pt monospace">  (or)  </span><span style="font: 10pt serif">EH abort.</span><span style="font: 10pt monospace"><br>6. The message </span><span style="font: 10pt serif">&rsquo;do⦂onTrapDo⦂&rsquo;</span><span style="font: 10pt monospace"> returns a result which can be specified during the execution of either  </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> or </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> by the message </span><span style="font: 10pt serif">&rsquo;result &larr; pResult&rsquo;</span><span style="font: 10pt monospace">.  This result value can be retrieved anytime after it has been specified by sending the message </span><span style="font: 10pt serif">&rsquo;result&rsquo;</span><span style="font: 10pt monospace">.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH result &larr; true.</span><span style="font: 10pt monospace"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ EH result ⇒ [ ... ] ].</span><span style="font: 10pt monospace"><br>7. If </span><span style="font: 10pt serif">pCode</span><span style="font: 10pt monospace"> is terminated abnormally from a user notify window, the message </span><span style="font: 10pt serif">&rsquo;release&rsquo;</span><span style="font: 10pt monospace"> should be sent to return the ExceptionHandler object to its initial state.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">EH release.</span><span style="font: 10pt monospace"><br>8. Special error checking is included in the ExceptionHandler object to detect calls to </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> during the execution of </span><span style="font: 10pt serif">pTrapCode</span><span style="font: 10pt monospace"> and other invalid conditions.</span><span style="font: 10pt serif"><br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">implementationNotes<br></span><span style="font: 10pt serif">[<br>"<br>FIELDS<br></span><span style="font: bold 10pt serif">fDoContext</span><span style="font: 10pt serif"> : a Context that controls the execution of the message &rsquo;do⦂onTrapDo⦂&rsquo;.<br></span><span style="font: bold 10pt serif">fCode</span><span style="font: 10pt serif"> : a Context that controls the execution of the statements passed as the first parameter to &rsquo;do⦂onTrapDo⦂&rsquo;.<br></span><span style="font: bold 10pt serif">fTrapCode</span><span style="font: 10pt serif"> : a Context that controls the execution of the statements passed as the second parameter to &rsquo;do⦂onTrapDo⦂&rsquo;.<br></span><span style="font: bold 10pt serif">fTrapCondition</span><span style="font: 10pt serif"> : the object passed as the parameter to &rsquo;trap:&rsquo;.<br></span><span style="font: bold 10pt serif">fResult</span><span style="font: 10pt serif"> : the object that is the result of &rsquo;do⦂onTrapDo⦂&rsquo;.<br></span><span style="font: bold 10pt serif">fPostTrapIndicator</span><span style="font: 10pt serif"> : an Integer specifying the action to be taken after fTrapCode is executed.<br></span><span style="font: bold 10pt serif">fStatusIndicator</span><span style="font: 10pt serif"> : an Integer specifying the status of &rsquo;do⦂onTrapDo⦂&rsquo;; nil means &rsquo;do⦂onTrapDo⦂&rsquo; has not been invoked, 1 means fCode is active, 0 means fTrapCode is active.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>CONTROL STRUCTURE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">do⦂ pCode onTrapDo⦂ pTrapCode<br></span><span style="font: 10pt serif">"...executes the set of statements in the block pCode and, conditionally, the set of statements in the block pTrapCode.  If &rsquo;trap&rsquo; or &rsquo;trap:&rsquo; is invoked during the execution of pCode, the execution is interrupted and pTrapCode is started.  When pTrapCode completes, pCode is either continued, restarted, or aborted, depending on which of &rsquo;continue&rsquo;, &rsquo;restart&rsquo;, and &rsquo;abort&rsquo; is sent during the execution of pTrapCode.  A notify window is created if &rsquo;trap&rsquo; or &rsquo;trap:&rsquo; is sent when pCode is not active, or if &rsquo;do⦂onTrapDo⦂&rsquo; is sent again before the first invocation completes."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fStatusIndicator ≠ nil ⇒ [ user notify: &rsquo;ExceptionHandler is active&rsquo;. ]  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fStatusIndicator &larr; 1.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fCode &larr; pCode.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTrapCode &larr; pTrapCode.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fDoContext &larr; thisContext.  "5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTrapCondition &larr; nil.  "6"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fResult &larr; true.  "7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fCode eval.  "8"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self release.  "9"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fResult  "10"<br>]<br>"<br>1. If fStatusIndicator ≠ nil, then the previous invocation of &rsquo;do⦂onTrapDo⦂&rsquo; has not completed properly.  Create a notify window in this case.<br>2. Set fStatusIndicator to indicate pCode is active.<br>3. Save pCode for execution and restart.<br>4. Save pTrapCode for later execution.<br>5. Save the context of &rsquo;do⦂onTrapDo⦂&rsquo; for &rsquo;restart&rsquo; and &rsquo;abort&rsquo;.<br>6. Initialize the trap condition to nil.<br>7. Initialize the result of &rsquo;do⦂onTrapDo⦂ &rsquo; to true.<br>8. Execute pCode.<br>9. Set fields to nil to release saved contexts.<br>10. Return fResult (which may have been modified during the execution of pCode or pTrapCode).<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>TRAP HANDLER</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trap<br></span><span style="font: 10pt serif">"...interrupts the execution of pCode and begins pTrapCode (from &rsquo;do⦂ pCode onTrapDo⦂ pTrapCode&rsquo;)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self trap: nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trap: pTrapCondition<br></span><span style="font: 10pt serif">"...interrupts the execution of pCode and begins pTrapCode (from &rsquo;do⦂ pCode onTrapDo⦂ pTrapCode&rsquo;).  The trap condition is set to pTrapCondition."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">|tTrapCode i<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fStatusIndicator<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">≡ nil ⇒ [ user notify: &rsquo;ExceptionHandler is not active&rsquo; ];  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0  ⇒ [ user notify: &rsquo;ExceptionHandler trap code is already active&rsquo; ]  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fStatusIndicator &larr; 0.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTrapCondition &larr; pTrapCondition.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPostTrapIndicator &larr; 0.  "5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tTrapCode &larr; fTrapCode cleancopy.  "6"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tTrapCode eval.  "7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: tTrapCode totalPT do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fTrapCode setPT: i to: (tTrapCode getPT: i). ].  "8"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fStatusIndicator &larr; 1.  "9"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fPostTrapIndicator  "10"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 0 ⇒ [ self restartCode. ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 1 ⇒ [ self abortCode. ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= 2 ⇒ [ ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. If fStatusIndicator ≡ nil, then &rsquo;do⦂onTrapDo⦂&rsquo; has not been invoked and there is no trap code to execute.<br>2. if fStatusIndicator = 0, then fTrapCode is active.  This is an invalid state.<br>3. Set fStatusIndicator to indicate fTrapCode is active.<br>4. Set the trap condition to pTrapCondition.<br>5. Set the default post trap action to &rsquo;restart&rsquo;.<br>6. Make a new copy of the context, fTrapCode.<br>7. Execute the new copy of fTrapCode.<br>8. Set the parameters and temporaries in the context, fTrapCode to those of the executed copy.  This is done so that fCode will see any changes made to these variables by fTrapCode.<br>9. Set fStatusIndicator to indicate fTrapCode is not active.<br>10. Select the terminating action from the value of fPostTrapIndicator.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>POST TRAP SPECIFICATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">abort<br></span><span style="font: 10pt serif">"...specifies that the code interrupted by &rsquo;trap&rsquo; or &rsquo;trap:&rsquo; will be aborted when the trap code completes.  Control will return to the statement that follows the invocation of &rsquo;do⦂onTrapDo⦂&rsquo;."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPostTrapIndicator &larr; 1.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">continue<br></span><span style="font: 10pt serif">"...specifies that the code interrupted by &rsquo;trap&rsquo; or &rsquo;trap:&rsquo; will be continued when the trap code completes."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPostTrapIndicator &larr; 2.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restart<br></span><span style="font: 10pt serif">"...specifies that the code interrupted by &rsquo;trap&rsquo; or &rsquo;trap:&rsquo; will be restarted when the trap code completes."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPostTrapIndicator &larr; 0.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>MISC</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">result<br></span><span style="font: 10pt serif">"...returns the result set by &rsquo;result&larr;&rsquo;."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fResult<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">result &larr; pResult<br></span><span style="font: 10pt serif">"...sets the result value of &rsquo;do⦂onTrapDo⦂&rsquo; to pResult."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fResult &larr; pResult.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trapCondition<br></span><span style="font: 10pt serif">"...returns the condition that was passed as the parameter to &rsquo;trap:&rsquo;."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fTrapCondition<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>POST TRAP ACTION (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">abortCode<br></span><span style="font: 10pt serif">"...releases the context chain and returns fResult to the caller of &rsquo;do⦂onTrapDo⦂&rsquo;."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">|tDoContextCaller<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tDoContextCaller &larr; fDoContext caller.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext caller releaseTo: tDoContextCaller.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self release.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tDoContextCaller push: fResult.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Top run: tDoContextCaller at: Top currentPriority.  "5"<br>]<br>"<br>1. Get the caller of &rsquo;do⦂onTrapDo⦂&rsquo;.<br>2. Release the context chain from the caller of thisContext up to the caller of &rsquo;do⦂onTrapDo⦂&rsquo;.<br>3. Set fields to nil to clean up pointers to unwanted contexts.<br>4. Return fResult to the caller of &rsquo;do⦂onTrapDo⦂&rsquo;.<br>5. Run the caller of &rsquo;do⦂onTrapDo⦂&rsquo;.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release<br></span><span style="font: 10pt serif">"...resets the exception handler to its initial condition."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fCode &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTrapCode &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fDoContext &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fStatusIndicator &larr; nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">restartCode<br></span><span style="font: 10pt serif">"...releases the context chain and restarts the block of statements passed as the first parameter to &rsquo;do⦂onTrapDo⦂&rsquo;."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">thisContext caller releaseTo: fCode.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fCode restart.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fCode push: fDoContext.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Top run: fCode at: Top currentPriority.  "4"<br>]<br>"<br>1. Release the context chain from the caller of thisContext up to fCode.<br>2. Resets the pc and stack pointer of fCode.<br>3. Push the return context of fCode onto its tempframe.<br>4. Run fCode.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>TEST AND DIAGNOSTIC</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">test  </span><span style="font: 10pt serif">"ExceptionHandler new test."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| guard i<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guard &larr; ExceptionHandler new.  user clear.  i &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guard do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ user show: i asString.  i &larr; i+1.  guard trap: i.  user show: &rsquo; end&rsquo;. ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">onTrapDo⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ i &lt; 10 ⇒ [ guard restart ]  guard continue ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user show: &rsquo; done.&rsquo;.  user cr.  ⇑ guard result<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">testTransaction  </span><span style="font: 10pt serif">"ExceptionHandler new testTransaction."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| e i max f<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e &larr; ExceptionHandler new.  i &larr; 0.  max &larr; 5.  dpj exceptionHandler: e.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj open.  f &larr; dpj file: &rsquo;test.test&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e do⦂ [f reset. until⦂ [ f end ] do⦂ [ user show: (f next) inString. ]. ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">onTrapDo⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ user cr;  show: &rsquo;Juniper not responding&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f release.  dpj release.  i &larr; i+1.  [ i &lt; max ⇒ [ e restart. ] e abort ]. ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr;  show: &rsquo;done&rsquo;.  f close.  dpj close.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>EXAMPLES</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">juniperTest  </span><span style="font: 10pt serif">"ExceptionHandler new juniperTest."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| e i max f<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e &larr; ExceptionHandler new.  i &larr; 0.  max &larr; 5.  dpj exceptionHandler: e.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj open.  f &larr; dpj file: &rsquo;test.test&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e do⦂ [f reset. until⦂ [ f end ] do⦂ [ user show: (f next) inString. ]. ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">onTrapDo⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ user cr;  show: &rsquo;Juniper not responding&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">f release.  dpj release.  i &larr; i+1.  [ i &lt; max ⇒ [ e restart. ] e abort ]. ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr;  show: &rsquo;done&rsquo;.  f close.  dpj close.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">loopTest  </span><span style="font: 10pt serif">"ExceptionHandler new loopTest."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| guard i<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guard &larr; ExceptionHandler new.  user clear.  i &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">guard do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ user show: i asString.  i &larr; i+1.  guard trap: i.  user show: &rsquo; end&rsquo;. ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">onTrapDo⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ i &lt; 10 ⇒ [ guard restart ]  guard continue ].<br></span><span class="tab" val="79"></span><span style="font: 10p