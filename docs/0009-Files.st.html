<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Files.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 11:02:24 pm.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"File"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;File&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Dict<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;directory type name serialNumber pageReaders pageBuffer lastpn error&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: FilePool;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A collection of FilePages usually on some device external to the virtual memory, which can be viewed and modified. File is a generalization: some examples are AltoFile and WoodstockFile. FilePage and FileDirectory are related classes. FileStream provides Stream access to Files.<br><br>Subclasses should override any superclass message implemented as [self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Documentation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">help </span><span style="font: 10pt serif">"<br><br>A common way to access a </span><span style="font: bold 10pt serif">File</span><span style="font: 10pt serif"> is through a </span><span style="font: bold 10pt serif">FileStream</span><span style="font: 10pt serif">.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">to create a FileStream on either an old or new file:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;FileStream&gt; &larr; &lt;FileDirectory&gt; </span><span style="font: bold 10pt serif">file:</span><span style="font: 10pt serif"> &lt;String&gt;. (see also </span><span style="font: bold 10pt serif">oldFile:</span><span style="font: 10pt serif"> and </span><span style="font: bold 10pt serif">newFile:</span><span style="font: 10pt serif">)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e.g. f &larr; dp0 file: &rsquo;test&rsquo;.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">The default access mode (</span><span style="font: bold 10pt serif">readwriteshorten</span><span style="font: 10pt serif">) allows you to read or write, and<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">automatically shorten a File (to its current position) upon closing).  If you want to<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">only read a file, </span><span style="font: bold 10pt serif">readonly</span><span style="font: 10pt serif"> mode is faster and safer.<br><br>Some common ways to access a FileStream (see </span><span style="font: bold 10pt serif">Stream</span><span style="font: 10pt serif"> and </span><span style="font: bold 10pt serif">FileStream</span><span style="font: 10pt serif">):<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">reading a character (an Integer between 0 and 255)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">next, ◦</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">reading a String of characters<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">upto:</span><span class="tab" val="79"></span><span style="font: bold 10pt serif">, next:, nextString, contents</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">reading other kinds of objects<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">nextword, word:, nextNumber:, nextParagraph</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">writing characters<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">next&larr;, ◦&larr;</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">writing a String of characters<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">append:, nextString&larr;</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">writing other kinds of objects<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">nextword, word:&larr;, print:</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">finding position<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">position, wordposition, length, end, positionSize:</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">changing position (besides reading/writing)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">position&larr;, skip:, skipTo:, reset, settoend, wordposition&larr;, position:size:<br></span><span style="font: 10pt serif"><br>When finished with a FileStream, &lt;FileStream&gt; </span><span style="font: bold 10pt serif">close</span><span style="font: 10pt serif">.<br><br>For information about using or creating other views of file organizations (</span><span style="font: bold 10pt serif">Btree</span><span style="font: 10pt serif">, file-based object dictionaries, Findit), about WFS and Juniper files, and general file problems, see Steve Weyer.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entryClass </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">a subclass of FilePage</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Find: page </span><span style="font: 10pt serif">[⇑page pageNumber ≤ lastpn]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">found: page </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">read an existing page</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">makeEntry: page </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">page is: self entryClass⇒ [page init; serialNumber: serialNumber. ⇑page]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[(self entryClass new) dictionary: self;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">init; pageNumber: page; serialNumber: serialNumber]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">compute lastpn</span><span style="font: 10pt serif">" self findLastPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reopen </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self sameFile⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">init and directory access</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">directory get: self init].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self open]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DictionaryEntry</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary </span><span style="font: 10pt serif">[⇑directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary: directory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init </span><span style="font: 10pt serif">[lastpn &larr; false. error &larr; nullString. serialNumber &larr; String new: 4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">match: entry </span><span style="font: 10pt serif">[⇑self name match: entry name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name </span><span style="font: 10pt serif">[⇑name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name: name</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[strm append: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">subclasses of File may want to share variables in pools.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">execute before filin:</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Smalltalk declare: ↪XFilePool as: (SymbolTable new init: 16).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">in classInit:</span><span style="font: 10pt serif"> XFilePool declare: ↪() as: ↪()"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FilePool declare: ↪(read write shorten) as: ↪(1 2 4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sameFile </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">is File&rsquo;s current internal representation the same as what is stored externally? if so, usually can avoid some initialization, directory lookup</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Name</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber </span><span style="font: 10pt serif">[⇑serialNumber]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber: s </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">stored as a String of 4 characters rather than as various Numbers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: String⇒ [serialNumber &larr; s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Substring⇒ [serialNumber &larr; s copy]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Integer⇒ [serialNumber word: 1 &larr; 0; word: 2 &larr; s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">Vector of Integers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">serialNumber word: 1 &larr; s◦1; word: 2 &larr; s◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FileDirectory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete </span><span style="font: 10pt serif">[⇑directory delete: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory </span><span style="font: 10pt serif">[⇑directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory: directory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rename: newName </span><span style="font: 10pt serif">[⇑directory rename: self newName: newName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">type </span><span style="font: 10pt serif">[⇑type]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">type: type </span><span style="font: 10pt serif">"used by different Files in different ways, e.g. read/write mode"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>File Length</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">endFile: page </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">make File end with this FilePage. false means delete all of File</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findLastPage </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">the default definitions for </span><span style="font: bold 10pt serif">findLastPage</span><span style="font: italic 10pt serif"> and </span><span style="font: bold 10pt serif">length</span><span style="font: italic 10pt serif"> are circular.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">at least one of them must be defined by a subclass"<br></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑lastpn &larr; self pageFrom: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastFullPage </span><span style="font: 10pt serif">[(self read: self lastPage) full⇒ [⇑lastpn] ⇑lastpn-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastPage </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">length in pages</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastpn⇒ [⇑lastpn] ⇑self findLastPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastPage: lastpn </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for those who know what they&rsquo;re doing</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">| page [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">length in characters</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">page &larr; self read: self lastPage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑lastpn-1 * page dataLength + page length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageFrom: len </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">compute page number for a character index</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(len-1 / self entryClass new dataLength) asSmall+ 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FilePage</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doCommand: com page: page error: s </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">execute a File command on page. if an error occurs, include<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">error &larr; &rsquo;some error message&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self error: s<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">if s is false, returns false.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">otherwise s is passed to an error routine</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error </span><span style="font: 10pt serif">[⇑error]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error: e </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">e⇒ [e &larr; [(Stream default) append: name; append: &rsquo; in &rsquo;; append: e;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo;, &rsquo;; append: error; contents].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">error &larr; nullString.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super error: e]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Get: page </span><span style="font: 10pt serif">| p pn [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pn &larr; page pageNumber.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; self Read: page⇒ [⇑p]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">current last page of the file is assumed full</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ p from: lastpn+1 to: pn-1 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">page pageNumber: p.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">page &larr; self Write: page].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return an empty last page which is not written yet</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">page pageNumber: pn; length: 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">get: pn </span><span style="font: 10pt serif">[⇑self Get: (self makeEntry: pn)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newPage </span><span style="font: 10pt serif">[⇑self makeEntry: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newPage: pn </span><span style="font: 10pt serif">[⇑self makeEntry: pn]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Read: page </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">return page or false</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read: pn </span><span style="font: 10pt serif">[⇑self Read: (self makeEntry: pn)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Write: page </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">update </span><span style="font: bold 10pt serif">lastpn</span><span style="font: italic 10pt serif">, write page and return result (maybe next page)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FileStream</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">[⇑(FileStream new) on: [self open; get: 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪File under: &rsquo;Files&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">File classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FileDirectory"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FileDirectory&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Dict<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;directory fileReaders&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: FilePool;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A collection of Files. FileDirectory is a generalization: some examples are AltoFileDirectory and WoodstockFileDirectory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checkName: s </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">default behavior is to get rid of ending period.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">subclasses can do any kind of checking they want and<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">return false if name is no good</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s empty or⦂ s last ≠ (&rsquo;.&rsquo;◦1)⇒ [⇑s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s copy: 1 to: s length-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">externalViews delete: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self release]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entryClass </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">a subclass of File</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error: e entry: file </span><span style="font: 10pt serif">[⇑file error: e]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Find: file </span><span style="font: 10pt serif">| name [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">name &larr; self checkName: file name⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">file name: name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self Position &larr; file]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file error: &rsquo;illegal name&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: file </span><span style="font: 10pt serif">| old [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"note: this changes the default behavior found in Dict.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">this creates a new version rather than generating an error if the name exists"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file &larr; self makeEntry: file.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self versionNumbers⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"ignore explicit version and directory will create a next version"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">file &larr; self makeEntry: (file name asStream upto: &rsquo;!&rsquo;◦1)]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: file⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">old &larr; self makeEntry: (file name + &rsquo;$&rsquo;).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"otherwise, if the file already exists,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rename it to name$, deleting that file first if it exists"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self Find: old⇒ [self Delete: old]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self rename: file name newName: old name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"reposition to original name"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Find: file⇒ [self error: &rsquo;insert/rename ??&rsquo; entry: file]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"file didn&rsquo;t exist"].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self Insert: file.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open </span><span style="font: 10pt serif">[externalViews insert: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: [self obsolete⇒ [&rsquo;a closed &rsquo;] &rsquo;an open &rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: self class title;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: &rsquo; on &rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self server printon: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DictionaryEntry</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary </span><span style="font: 10pt serif">[⇑directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary: directory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory: directory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>File</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allocateSN: file </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">allocate a new serial number for a File</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory </span><span style="font: 10pt serif">[⇑directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newPage </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">return a dummy FilePage from a dummy File</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self makeEntry: nullString) newPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">versionNumbers </span><span style="font: 10pt serif">["generally, version numbers are not supported" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FileStream</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file: name </span><span style="font: 10pt serif">[⇑(self get: name) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filin: s </span><span style="font: 10pt serif">[self filin: s format: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filin: s format: ft </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read Class definitions or Changes from FileStreams or PressFiles<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">ft: 1 (FileStream=Bravo), 2 (Press)</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Vector⇒ [for⦂ s from: s do⦂ [self filin: s format: ft]]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">special case for Alto and patterns</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(s is: String) and⦂ ((s has: &rsquo;*&rsquo;◦1) or⦂ (s has: &rsquo;#&rsquo;◦1))⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self filin: (self filesMatching: s) format: ft]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s is: UniqueString⇒ ["</span><span style="font: italic 10pt serif">Class name</span><span style="font: 10pt serif">" s &larr; s + [ft=1⇒ [&rsquo;.st&rsquo;] &rsquo;.press&rsquo;]]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">([ft=1⇒ [self oldFile: s] self pressfile: s]) filin]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newFile: name </span><span style="font: 10pt serif">[⇑(self insert: name) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">oldFile: name </span><span style="font: 10pt serif">[⇑(self find: name) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pressfile: name </span><span style="font: 10pt serif">[⇑PressFile new of: (self file: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pressfilin: s </span><span style="font: 10pt serif">[self filin: s format: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FTP</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFtpDirectory </span><span style="font: 10pt serif">| ftp [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"to allow convenient (kludgey) access to file servers (e.g. phylum, dpj) via Ftp"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(ftp &larr; FtpDirectory new) server: self server; open.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ftp userName empty⇒ [ftp login: self userName password: self userPassword]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ftp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">login: name </span><span style="font: 10pt serif">[⇑self login: name password: &rsquo;&rsquo; "</span><span style="font: italic 10pt serif">or prompt?</span><span style="font: 10pt serif">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">login: name password: pw </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">retrieve: s </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Vector⇒ [for⦂ t from: s do⦂ [self retrieve: t as: t]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self retrieve: s as: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">retrieve: s1 as: s2 </span><span style="font: 10pt serif">| f [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self exists: s1⇒ [f &larr; self oldFile: s1] ⇑false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">([s2 is: FileStream⇒ [s2] dp0 file: s2]) append: f; close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">server </span><span style="font: 10pt serif">[⇑directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">server: directory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">store: s </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Vector⇒ [for⦂ t from: s do⦂ [self store: t as: t]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self store: s as: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">store: s1 as: s2 </span><span style="font: 10pt serif">| f [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s1 is: FileStream⇒ [f &larr; s1] dp0 exists: s1⇒ [f &larr; dp0 oldFile: s1] ⇑false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self file: s2) append: f; close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">userName </span><span style="font: 10pt serif">[⇑[currentProfile≡nil⇒ [&rsquo;&rsquo;] currentProfile userName: self server]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">userPassword </span><span style="font: 10pt serif">[⇑[currentProfile≡nil⇒ [&rsquo;&rsquo;] currentProfile userPassword: self server]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Juniper</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closeTransaction </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">default is to do nothing</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">exceptionHandler: eh </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">default is to do nothing</span><span style="font: 10pt serif">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FileDirectory under: &rsquo;Files&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FilePage"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FilePage&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Dict<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;file page&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: FilePool;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A block, chunk, or page of information from some collection of pages (a File).  FilePage is a generalization: some examples are AltoFilePage and WoodstockFilePage</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i </span><span style="font: 10pt serif">[⇑page◦(self checkIndex: i)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i &larr; v </span><span style="font: 10pt serif">[⇑page◦(self checkIndex: i) &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">[⇑self asStream: Stream new]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reopen </span><span style="font: 10pt serif">[file reopen; makeEntry: self "</span><span style="font: italic 10pt serif">self may have been released</span><span style="font: 10pt serif">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DictionaryEntry</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary </span><span style="font: 10pt serif">[⇑file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dictionary: file</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[page≡nil⇒ ["self page:" page &larr; String new: self pageLength]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length: 0"not sure who depends on this besides FileStream read:"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name: sp </span><span style="font: 10pt serif">[self init; serialNumber: sp◦1; pageNumber: sp◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file: file</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">page: page</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>File</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doCommand: com error: s </span><span style="font: 10pt serif">[⇑file doCommand: com page: self error: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">endFile </span><span style="font: 10pt serif">[⇑file endFile: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file </span><span style="font: 10pt serif">[⇑file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">get: pn </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">recycle self</span><span style="font: 10pt serif">" self pageNumber: pn; length: 0. ⇑file Get: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read: pn </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">recycle self</span><span style="font: 10pt serif">" self pageNumber: pn; length: 0. ⇑file Read: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">write </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">some files, e.g. AltoFile, will return a last empty page instead of a full one</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑file Write: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Page</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">address </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">page address, e.g. on a disk</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">address: a </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream: s </span><span style="font: 10pt serif">| offset [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">offset &larr; self headerLength.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s of: self dataString from: offset+1 to: offset+self length "self dataEnd"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checkIndex: i </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &gt; 0 and⦂ i ≤ self length⇒ [⇑i + self headerLength]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;illegal index&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataBeginning </span><span style="font: 10pt serif">[⇑self headerLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataEnd </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">logical end of data in page</span><span style="font: 10pt serif">" ⇑self headerLength + self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataEnd: pos </span><span style="font: 10pt serif">[self length: pos - self headerLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataLength </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">physical length of data in page. default</span><span style="font: 10pt serif">" ⇑512]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataMaxEnd </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">physical end of data in page</span><span style="font: 10pt serif">" ⇑self headerLength + self dataLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataString </span><span style="font: 10pt serif">[⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">full </span><span style="font: 10pt serif">[⇑self length = self dataLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">header: n </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">return n-th header word</span><span style="font: 10pt serif">" ⇑page word: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">header: n &larr; v </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">set and return n-th header word</span><span style="font: 10pt serif">" ⇑page word: n &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">headerLength </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">length of stuff before data begins in page</span><span style="font: 10pt serif">" ⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastPage </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">is this last page in file?</span><span style="font: 10pt serif">" ⇑self pageNumber ≥ file lastPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">logical length of data in page</span><span style="font: 10pt serif">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length: len </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">page </span><span style="font: 10pt serif">[⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageLength </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">physical size of page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self headerLength + self dataLength + self trailerLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageNumber </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageNumber: pn </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber </span><span style="font: 10pt serif">[⇑file serialNumber]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber: sn </span><span style="font: 10pt serif">[self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trailerLength </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">length of stuff after data ends in page</span><span style="font: 10pt serif">" ⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: i </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">no bounds checking</span><span style="font: 10pt serif">" ⇑page word: self headerLength/2 + i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: i &larr; v </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">no bounds checking</span><span style="font: 10pt serif">" ⇑page word: self headerLength/2 + i &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FilePage under: &rsquo;Files&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"EtherFilePage"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;EtherFilePage&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: FilePage<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A FilePage which consists of an ethernet packet (Pacbuf) containing network information, header info and data</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FilePage</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataString </span><span style="font: 10pt serif">[⇑page pupString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">header: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for accessing information after pup header, e.g. file commands and parameters.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">n = 1 to (self headerLength-24)/2</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑page word: 12+n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">header: n &larr; v </span><span style="font: 10pt serif">[⇑page word: 12+n &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">headerLength </span><span style="font: 10pt serif">[⇑44 "</span><span style="font: italic 10pt serif">ethernet encap.(4), pup header(20), file label (20=default)</span><span style="font: 10pt serif">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[page≡nil⇒ ["self page:" page &larr; file allocatePage]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑page pupLength - (self headerLength - 2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length: len </span><span style="font: 10pt serif">[page pupLength &larr; len + self headerLength - 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trailerLength </span><span style="font: 10pt serif">[⇑2 "</span><span style="font: italic 10pt serif">checksum</span><span style="font: 10pt serif">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Ether</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">packet </span><span style="font: 10pt serif">[⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pupType </span><span style="font: 10pt serif">[⇑page pupType]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pupType&larr; p </span><span style="font: 10pt serif">[⇑page pupType&larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪EtherFilePage under: &rsquo;Files&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FileStream"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FileStream&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;page dirty rwmode&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: FilePool;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A Stream which windows a File. see File example</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self writing⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rwmode anymask: shorten⇒ [self shorten]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self flush]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self release (sort of)"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dirty &larr; limit &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self file close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">externalViews delete: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">file </span><span style="font: 10pt serif">[⇑page file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">obsolete </span><span style="font: 10pt serif">[⇑dirty]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dirty &larr; limit &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self file release]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reopen </span><span style="font: 10pt serif">| pos [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dirty "self obsolete"⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">reopen to current position</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: page pageNumber⇒ [position &larr; pos min: limit]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">if that page doesn&rsquo;t exist, go to last one that does.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">note that settoend would be recursive</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: (self file lastPage)⇒ [position &larr; limit]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;cannot reopen or settoend&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">on: page </span><span style="font: italic 10pt serif">"some page from a File, usually page 1, or another FileStream</span><span style="font: 10pt serif">" [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[page is: FileStream⇒ [page &larr; page page]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">page asStream: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">externalViews insert: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"obsolete flag"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dirty &larr; false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access Modes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readonly </span><span style="font: 10pt serif">[self setMode: read]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readwrite </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">allow read and write but don&rsquo;t automatically shorten</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setMode: read + write]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readwriteshorten </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">allow read and write and shorten File upon closing</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setMode: read+write+shorten]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setMode: m </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rwmode = m⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">don&rsquo;t flush if first time or not write mode or continuing write mode</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rwmode≡nil or⦂ ((rwmode nomask: write) or⦂ (m anymask: write))⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self flush].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rwmode &larr; m]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeshorten </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">allow write and shorten File upon closing. in general, this would be faster for overwriting Files since pages might not have to be read first. at present, treated same as </span><span style="font: bold 10pt serif">readwriteshorten</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setMode: write+shorten]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writing </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rwmode≡nil⇒ ["</span><span style="font: italic 10pt serif">default mode. true</span><span style="font: 10pt serif">" ⇑self readwriteshorten]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(rwmode land: write) = write]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Stream</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self position &larr; i-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i &larr; v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self position &larr; i-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">append: s </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"try to make some special cases go much faster"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s is: String⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s length &gt; 80⇒ [self writeString: s from: 1 to: s length. ⇑s]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Stream⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(s limit - s position &gt; 80) and⦂ (s asArray is: String)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writeString: s asArray from: s position+1 to: s limit. ⇑s]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: FileStream⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writeFile: s for: nil. ⇑s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super append: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">| s ["</span><span style="font: italic 10pt serif">read all of a File</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readonly; reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self next: self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">end </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &lt; limit⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: page pageNumber+1⇒ [⇑"page empty" position = limit]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">into: s endError: err </span><span style="font: 10pt serif">| charsRead len t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; s  length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[len &gt; 80⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsRead &larr; len - (self readString: s from: 1 to: len)]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"in line: super into: s endError: err"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsRead &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"read until count or stream is exhausted"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (charsRead &lt; len and⦂ (t &larr; self next)) do⦂ [s◦(charsRead &larr; charsRead+1) &larr;t]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">err⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsRead = len⇒ [⇑s]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;only read first &rsquo; + charsRead asString]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑charsRead]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">page lastPage⇒ [⇑page pageNumber-1 * page dataLength + page length]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self file length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next: n from: strm </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &gt; 80 and⦂ (strm is: FileStream)⇒ [self writeFile: strm for: n]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super next: n from: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen or⦂ (page lastPage≡false and⦂ self nextPage)⇒ [⇑self next]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend&larr; v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writing⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen⇒ [⇑self next &larr; v]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[limit &lt; page dataMaxEnd or⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self nextPage⇒ [position=limit]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;could not get page&rsquo;]⇒ [limit &larr; page dataMaxEnd]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next&larr; v]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;no writing allowed&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position </span><span style="font: 10pt serif">[⇑self positionSize: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position&larr; p </span><span style="font: 10pt serif">[⇑self position: p size: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super printon: strm.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo; on &rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self file printon: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset </span><span style="font: 10pt serif">["self position &larr; 0"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: 1⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;reset&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">settoend </span><span style="font: 10pt serif">["self position &larr; self length"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">make sure file is open so lastPage is correct</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">when writing on the last page, lastPage may be too small</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: (self file lastPage max: page pageNumber)⇒ [position &larr; limit]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;settoend???&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skip: n </span><span style="font: 10pt serif">| p plen [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=0⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; position + n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n &gt; 0⇒ [p ≥ limit]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fixEnd "</span><span style="font: italic 10pt serif">important on last page</span><span style="font: 10pt serif">".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &lt; page dataBeginning]⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">simply: self position &larr; self position + n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">however, since we are incurable optimizers...</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">plen &larr; page dataLength.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">assume p is not Large, otherwise use intdiv:</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; p - page dataBeginning.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self positionPage: (page pageNumber + [n &lt; 0⇒ [(p+1)/plen - 1] p/plen])<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">character: p \ plen⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;cannot skip &rsquo; + n asString]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">same page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: i </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self wordposition &larr; i-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self nextword]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: i &larr; v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self wordposition &larr; i-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self nextword &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">wordposition </span><span style="font: 10pt serif">[⇑self positionSize: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">wordposition&larr; w </span><span style="font: 10pt serif">[⇑self position: w size: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>File</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory </span><span style="font: 10pt serif">[⇑self file directory]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fixEnd </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writing and⦂ position &gt; page dataEnd⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">fix the end of page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">page dataEnd: (limit &larr; position)]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">flush </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ [⇑page]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fixEnd.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑page write]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name </span><span style="font: 10pt serif">[⇑self file name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextPage </span><span style="font: 10pt serif">[⇑self read: page pageNumber+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pad: size </span><span style="font: 10pt serif">| rem [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"skip to next boundary of size and return how many characters skipped"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; (([page dataLength \ size = 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position - page dataBeginning] self position]) \ size) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem = 0⇒ [⇑0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self skip: size - rem.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑size - rem]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pad: size with: val </span><span style="font: 10pt serif">| rem [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"pad to next boundary of size and return how many characters padded"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem &larr; (([page dataLength \ size = 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position - page dataBeginning] self position]) \ size) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rem = 0⇒ [⇑0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next: size - rem &larr; val.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑size - rem]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">page </span><span style="font: 10pt serif">[⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position: objpos size: size </span><span style="font: 10pt serif">| len pn c pos [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">set the current character position and the current page<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">from the position of an object of a given size (see </span><span style="font: bold 10pt serif">positionSize:</span><span style="font: italic 10pt serif">)</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; page dataLength.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[size = len⇒ ["</span><span style="font: italic 10pt serif">page size</span><span style="font: 10pt serif">" pn &larr; objpos+1. c &larr; 0]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; objpos.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[size = 1⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len \ size = 0⇒ ["</span><span style="font: italic 10pt serif">page length is a multiple of size</span><span style="font: 10pt serif">" len &larr; len / size]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; objpos * size.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">size &larr; 1].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">obtain quotient (page) and remainder (position)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; pos intdiv: len.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pn &larr; 1 + (pos◦1) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; size * (pos◦2) asSmall].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self positionPage: pn character: c⇒ [⇑objpos]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;cannot read page &rsquo; + pn asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">positionPage: pn character: c </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">normally accessed by </span><span style="font: bold 10pt serif">position:size:, skip:</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: pn⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">c assumed between 0 and page dataLength. position, limit were set in </span><span style="font: bold 10pt serif">on:</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position + c.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position ≤ limit or⦂ self writing⇒ [⇑true]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; limit.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c=0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">try end of previous page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self positionPage: pn-1 character: page dataLength]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">positionSize: size </span><span style="font: 10pt serif">| len pos [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">compute the position for an object of a given size,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">e.g. characters (1), words (2), fixed length (n),<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">from the current character position and the current page</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; page dataLength.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">size = 1 or⦂ len \ size ≠ 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; page pageNumber-1 * len + (position - page dataBeginning).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">size=1⇒ [⇑pos]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑pos / size]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">page length is a multiple of size</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑page pageNumber-1 * (len/size) + <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(position - page dataBeginning / size)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read: pn </span><span style="font: 10pt serif">| p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">normally accessed by </span><span style="font: bold 10pt serif">nextPage, position:size:, reopen, reset, settoend</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pn &lt; 1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self obsolete⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">reopen the file, (re)read the page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">page reopen.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; page read: pn⇒ [self on: p]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pn = page pageNumber and⦂ (page length &gt; 0 or⦂ position &gt; page dataBeginning)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fixEnd.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">page asStream: self]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">current page has wrong page number or is empty (possibly from error)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self writing⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[pn &gt; page pageNumber and⦂ page full≡false⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">fill up last page when positioning past it</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; page dataMaxEnd]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">otherwise, fixEnd</span><span style="font: 10pt serif">" position &gt; page dataEnd]⇒ [page dataEnd: (limit &larr; position)]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">write current page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; page write.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p pageNumber = pn⇒ ["</span><span style="font: italic 10pt serif">already have next page, e.g. at end of AltoFile</span><span style="font: 10pt serif">"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read it or create it</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; page get: pn]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p &larr; page read: pn].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p⇒ [(page &larr; p) asStream: self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">settopage: p char: c </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">mainly for compatibility, since page sizes may vary.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">in general, use </span><span style="font: bold 10pt serif">position&larr;, wordposition&larr;</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self read: p asSmall⇒ [self skip: c asSmall]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;no page&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">shorten </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">normally called by </span><span style="font: bold 10pt serif">close</span><span style="font: italic 10pt serif"> and not directly by user</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self on: [page dataEnd: (limit &larr; position); endFile].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filin/Filout</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraphPrinter </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">default format for filout etc.</span><span style="font: 10pt serif">" ⇑BravoPrinter init of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">backup </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">assume ivy open</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self directory≡dp0⇒ [ivy replace: self name]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filin </span><span style="font: 10pt serif">| p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self end⇒ [self file error: &rsquo;empty file&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (p &larr; self nextParagraph) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">FilinSource &larr; self.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user print: nilⓢ p text; space].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FilinSource &larr; nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filout </span><span style="font: 10pt serif">[self filout: Changes contents sort]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filout: source </span><span style="font: 10pt serif">[(self asParagraphPrinter) stamp; printchanges: source; close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filoutclass: class </span><span style="font: 10pt serif">[(self asParagraphPrinter) stamp; printclass: class; close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextParagraph </span><span style="font: 10pt serif">| text [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">Bravo format paragraph (or self contents if no trailer)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self end⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text &larr; self upto: 032 "</span><span style="font: italic 10pt serif">ctrl-z</span><span style="font: 10pt serif">".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑text asParagraph applyBravo: self at: 1 to: text length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Print</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asPressPrinter </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">default format for printt etc.</span><span style="font: 10pt serif">" ⇑PressPrinter init of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printout: source </span><span style="font: 10pt serif">[(self asPressPrinter) stamp; printchanges: source; close; toPrinter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printoutclass: class </span><span style="font: 10pt serif">[(self asPressPrinter) stamp; printclass: class; close; toPrinter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">toPrinter </span><span style="font: 10pt serif">| pp p [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">print an unformatted or Bravo file as a press file</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pp &larr; (self directory file: self name + &rsquo;Press&rsquo;) asPressPrinter.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (p &larr; self nextParagraph) do⦂ [pp print: p].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self close].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pp close; toPrinter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>CodePane Editor</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">edit </span><span style="font: 10pt serif">[user restartup: (CodeWindow new file: self)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Fast Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readPages: n </span><span style="font: 10pt serif">| charsLeft len s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">read n pages of characters</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; n * page dataLength.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; String new: len.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"charsRead &larr; self into: s endError: false."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; self readString: s from: 1 to: len.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft = 0⇒ ["</span><span style="font: italic 10pt serif">read len chars</span><span style="font: 10pt serif">" ⇑s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return characters read only before end of file</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s copy: 1 to: len - charsLeft]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readString: s from: start to: stop </span><span style="font: 10pt serif">| len charsLeft [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for reading a subrange of a large String from a file (quickly, if BitBlt is used);<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">called by </span><span style="font: bold 10pt serif">FileStream into:endError:</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self readonly; reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">start &larr; start - 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; stop - start.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">keep going until all of the requested characters are copied or<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">until end of file. if end of current page only, next page is read.</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (charsLeft &gt; 0 and⦂ self end ≡ false) do⦂ [<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">len = # characters of current page that will fit in String</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; limit - position min: charsLeft.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; charsLeft - len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">copy subrange of page into String</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s copy: start+1 to: start+len<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">with: array from: position+1 to: position+len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">update source and destination pointers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position+ len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">start &larr; start + len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return the number of characters not read</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑charsLeft]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">streamPosition </span><span style="font: 10pt serif">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">streamPosition&larr;position </span><span style="font: 10pt serif">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeFile: fs for: charsLeft </span><span style="font: 10pt serif">| start len maxLimit [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for copying part or all of one file to another (quickly, if BitBlt is used);<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">charsLeft ≡ nil means copy until end, otherwise a number of characters.</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">called by </span><span style="font: bold 10pt serif">FileStream append:, next:from:</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self writing⇒ [] self error: &rsquo;read only!&rsquo;].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fs readonly; reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">maxLimit &larr; page dataMaxEnd.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">keep going until all of the requested characters are copied or<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">until end of file. if end of current page only, next page is read.</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((charsLeft≡nil or⦂ charsLeft &gt; 0) and⦂ fs end ≡ false) do⦂ [<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">end of current destination page?</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position = maxLimit⇒ [self nextPage]].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">len = # characters of source page that will fit in destination page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">start &larr; fs streamPosition.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; maxLimit - position min: fs limit - start.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[charsLeft≡nil⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; len min: charsLeft.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; charsLeft - len].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">copy subrange of source page into destination page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">array copy: position+1 to: position+len<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">with: fs asArray from: start+1 to: start+len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">update source and destination pointers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fs streamPosition &larr; start + len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position + len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &gt; limit⇒ [limit &larr; position]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return the number of characters not read</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[charsLeft ≡ nil⇒ [0] charsLeft]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeString: s from: start to: stop </span><span style="font: 10pt serif">| len charsLeft maxLimit [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">for writing a subrange of a large String onto a file (quickly, if BitBlt is used);<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">called by </span><span style="font: bold 10pt serif">FileStream</span><span style="font: italic 10pt serif"> </span><span style="font: bold 10pt serif">append:</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self writing⇒ [] self error: &rsquo;read only!&rsquo;].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reopen.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">start &larr; start - 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; stop - start.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">maxLimit &larr; page dataMaxEnd.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">keep going until all of the requested characters are copied</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ charsLeft &gt; 0 do⦂ [<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">end of current page?</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position = maxLimit⇒ [self nextPage]].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">len = # characters of String that will fit in current page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; maxLimit - position min: charsLeft.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">charsLeft &larr; charsLeft - len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">copy subrange of String into page</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">array copy: position+1 to: position+len<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">with: s from: start+1 to: start+len.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">update source and destination pointers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">start &larr; start + len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position + len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &gt; limit⇒ [limit &larr; position]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FileStream under: &rsquo;Files&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FtpDirectory"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FtpDirectory&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: FileDirectory<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;command&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>an interim(?) substitute for our own ftp server</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FileDirectory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close </span><span style="font: 10pt serif">[self closeThen: &rsquo;Resume. Small.Boot&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closeThen: s </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo;; &rsquo;; append: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user quitThen: command contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self open]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">commands </span><span style="font: 10pt serif">[⇑command contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">connect: name password: pw </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Connect/C &rsquo;; append: name; space; append: pw]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: name </span><span style="font: 10pt serif">[command append: &rsquo; Delete/C &rsquo;; append: (self checkName: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directoryName: name </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"this message should be directory:, but until rewriting..."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Directory/C &rsquo;; append: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">login: name password: pw </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">name empty⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Login/C &rsquo;; append: name; space; append: pw]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command &larr; Stream new of: (String new: 100).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo;Ftp &rsquo;; append: directory.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self login: self userName password: self userPassword]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rename: oldName newName: newName </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Rename/C &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: (self checkName: oldName); space; append: (self checkName: newName)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: name </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self checkName: name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(directory compare: &rsquo;maxc&rsquo;) = 2⇒ [self delete: s; store: s]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">store as highest version (ifs only)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Store/S &rsquo;; append: s; space; append: s; append: &rsquo;!H&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">retrieve: s </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Vector⇒ [for⦂ t from: s do⦂ [self retrieve: t]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Retrieve/C &rsquo;; append: (self checkName: s)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">retrieve: remote as: local </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Retrieve/S &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: (self checkName: remote); space; append: (self checkName: local)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">store: s </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s is: Vector⇒ [for⦂ t from: s do⦂ [self store: t]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Store/C &rsquo;; append: (self checkName: s)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">store: local as: remote </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">command append: &rsquo; Store/S &rsquo;;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: (self checkName: local); space; append: (self checkName: remote)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FtpDirectory under: &rsquo;Files&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
