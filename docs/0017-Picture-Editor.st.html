<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Picture-Editor.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"BitRect"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;BitRect&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Rectangle<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;title  "&lt;String&gt; title of picture"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">stripheight  "&lt;Integer&gt; scan lines in a buffer (private)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">data  "&lt;Vector&gt; of Strings.  Saves the bits in the Rectangle"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;defaultpic &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>BitRect is a Rectangle that remembers the bits within it.<br>To create and edit one, say:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">BitRect new fromuser edit.<br>This installs a BitRectEditor in the scheduler and starts it up.<br>The editor is explained in BitRectEditor.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">the default picture is a gray rectangle</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">defaultpic &larr; BitRect new filin: &rsquo;defaultpic&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default </span><span style="font: 10pt serif">[⇑defaultpic recopy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromuser<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self title: &rsquo;BitRect&rsquo; in: Rectangle new fromuser.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self saveScreenBits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">origin: origin corner: corner title: title stripheight: stripheight data: data</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title: title in: rect </span><span style="font: 10pt serif">| nStrips i strips<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[origin&larr;rect origin.  corner&larr;rect corner.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">the strip height is chosen so that each bitstring is about 2048 bytes</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stripheight&larr;1023/((self extent x + 15)/16).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nStrips&larr;(self extent y+stripheight-1)/stripheight.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">data&larr;Vector new: nStrips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strips&larr;self strips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: nStrips do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[data◦i&larr;String new: (strips◦i) bitStringLength]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">data </span><span style="font: 10pt serif">[⇑data]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title </span><span style="font: 10pt serif">[⇑title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Rectangle Protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= x </span><span style="font: 10pt serif">[⇑self≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bitsOntoStream: strm </span><span style="font: 10pt serif">| bits<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ bits from: data do⦂ [strm append: bits]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">corner&larr;x </span><span style="font: 10pt serif">[self growby: x-corner]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">extent&larr;x </span><span style="font: 10pt serif">[self growby: x-self extent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growby: change </span><span style="font: 10pt serif">| old<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[old&larr;BitRect new origin: origin corner: corner title: title<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stripheight: stripheight data: data.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self title: title in: (origin rect: corner+change).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyBitsFrom: old]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: x </span><span style="font: 10pt serif">[self growby: x-corner]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[user croak] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">height&larr;h </span><span style="font: 10pt serif">[self growby: 0⌾(h-self extent y)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: &rsquo;a BitRect&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">width&larr;w </span><span style="font: 10pt serif">[self growby: (w-self extent x)⌾0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Editing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyBitsFrom: other<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| clippedStrip i j myStrips otherStrips myStrip otherStrip<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">copy all bits from </span><span style="font: italic 10pt serif; text-decoration: underline">other</span><span style="font: italic 10pt serif"> that are within my area</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">myStrips&larr;self strips.  otherStrips&larr;other strips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: myStrips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ j to: otherStrips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[myStrip&larr;myStrips◦i.  otherStrip&larr;otherStrips◦j.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">clippedStrip&larr;myStrip intersect: otherStrip.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">clippedStrip empty⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt init function&larr;0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">destbase&larr;data◦i;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">destraster&larr;myStrip width+15/16;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dest&larr;clippedStrip origin-myStrip origin;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">extent&larr;clippedStrip extent;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourcebase&larr;other data◦j;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceraster&larr;otherStrip width+15/16;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">source&larr;clippedStrip origin-otherStrip origin;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">checksandcall]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">edit </span><span style="font: 10pt serif">| a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user leaveTop.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a&larr;BitRectEditor new picture: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a takeCursor; enter.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user restartup: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Showing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">saveScreenBits </span><span style="font: 10pt serif">| strips i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strips&larr;self strips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strips◦i bitsIntoString: data◦i mode: storing clippedBy: nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show </span><span style="font: 10pt serif">| strips i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strips&larr;self strips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strips◦i bitsFromString: data◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">strips   </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return a vector of strips (Rectangles)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| nStrips strips stripOrigin stripExtent i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(nStrips&larr;data length)=1⇒[⇑self inVector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strips&larr;Vector new: nStrips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stripOrigin&larr;origin.  stripExtent&larr;self width⌾stripheight.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: nStrips-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strips◦i&larr;Rectangle new origin: stripOrigin extent: stripExtent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">stripOrigin&larr;stripOrigin+(0⌾stripheight)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strips◦nStrips&larr;Rectangle new origin: stripOrigin corner: corner.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑strips]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filin and filout</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filin: title </span><span style="font: 10pt serif">| f i x y rect strips  </span><span style="font: italic 10pt serif">"read bits from a file"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f&larr;dp0 oldFile: (title concat: &rsquo;.pic.&rsquo;).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f readonly.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f end⇒[f close. user notify: &rsquo;no data&rsquo;]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x&larr;f nextword.  y&larr;f nextword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect&larr;Rectangle new origin: [origin is: Point⇒[origin] 0⌾0] extent: x⌾y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self title: title in: rect.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stripheight≠f nextword⇒[user notify: &rsquo;strip heights dont match&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strips &larr; self strips.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f into: data◦i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">filout </span><span style="font: 10pt serif">| f i  "</span><span style="font: italic 10pt serif">write bits on a file</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[f &larr; dp0 file: (title concat: &rsquo;.pic.&rsquo;).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f nextword &larr; self extent x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f nextword &larr; self extent y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f nextword &larr; stripheight.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: data do⦂ [f append: i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Press</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑self bitStringLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">presson: press in: r </span><span style="font: 10pt serif">| w h hs scale w16 y [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">scale &larr; press scale.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h &larr; self height.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(hs  &larr; scale*h) &gt; r height⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"not enough room left on current page.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">assume for now that it will at least fit on an entire page"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">w &larr; self width.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">w16 &larr; w + 15 | 16 "width to next word boundary".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"with w, prints on viola but not on spruce.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">with w16, prints on spruce with garbage on end"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">press setp: 0⌾(y &larr; r corner y - hs);<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dots⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press setcoding: 1 "bitmap" dots: w16 lines: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setmode: 3 "to right and to bottom";<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setsizewidth: scale*w16 height: hs;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">setwindowwidth: w16 height: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dotsfollow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self bitsOntoStream: press data].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪BitRect under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">BitRect classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"BitRectEditor"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;BitRectEditor&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Window<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;tool  "&lt;BitRectTool&gt; the current tool"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">picture  "&lt;BitRect&gt; the picture we are working on"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">dirty  "false if picture has not been modified"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">saveActionPic saveToolPic  "buffers for saving background" &rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;tools toolpic actionbuttons actionpic windowmenu &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>BitRectEditor edits BitRects.<br>To create, say:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">BitRect new fromuser edit.<br>This installs a BitRectEditor in the scheduler and starts it up.<br>The editing tools are to the left of the picture.  (The first one looks like a doodle).  They are: draw-thin, erase, straightedge, gray-block, paintbrush, magnifier.  The actions for the tools are displayed above the picture.<br>See BitRectTool for explanations of the actions.<br><br>CAUTION: this ordering is arbitrary.  It is currently possible to set a new action for any of the tools, so that if you are not careful, the straightedge will start being a magnifier or whatever.  This should get fixed eventually.<br><br>tools = a RadioButtons. Each button owns a BitRectTool (the active one is held in tool).<br>actionbuttons = a Vector of RadioButtons.  The groups of buttons are: action, mode, pen width, gray, and grid.<br>toolpic = BitRect of icons for the tools (at side of picture).<br>actionpic = BitRect of icons for the parts of a tool (above picture)<br>windowmenu = menu for bluebug.<br><br>To edit a copy of the tool picture, say<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">newpic&larr;(BitRectEditor◦↪toolpic) recopy.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">newpic edit.<br>To install this copy as the menu picture, say<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">BitRectEditor new toolpic: newpic recopy.<br>Do the analogous thing to edit the action picture.<br>Caution: the editor blows up if you edit the tool picture itself and not a copy.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">actionpic: a </span><span style="font: 10pt serif">[actionpic &larr; a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">| t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; Vector new: 6.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: t length do⦂ [t◦i &larr; BitRectTool new init].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tools &larr; (RadioButtons new) vec: t at: 0⌾0 width: 20.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">windowmenu &larr; Menu new string: &rsquo;under<br>move<br>grow<br>close<br>filout<br>printbits&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">actionpic&larr;BitRect new filin: &rsquo;actionpic&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">toolpic&larr;BitRect new filin: &rsquo;toolpic&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self initmenu1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initmenu1 </span><span style="font: 10pt serif">| s z<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Vector new: 5. z &larr; 20.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦1 &larr; (RadioButtons new) vec: ↪(setbrush paint block draw line blowup) at: 0⌾0 height: z. "</span><span style="font: italic 10pt serif">action</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦2 &larr; (RadioButtons new) vec: (black, dkgray, gray, ltgray, white) at: 0⌾0 height: z. "</span><span style="font: italic 10pt serif">tone</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦3 &larr; (RadioButtons new) vec: (0, 1, 2, 3) at: 0⌾0 height: z. "</span><span style="font: italic 10pt serif">mode</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦4 &larr; (RadioButtons new) vec: (1, 2, 4, 8) at: 0⌾0 height: z. "</span><span style="font: italic 10pt serif">width</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦5 &larr; (RadioButtons new) vec: (1, 2, 4, 8, 16, 32) at: 0⌾0 height: z. "</span><span style="font: italic 10pt serif">grid</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">actionbuttons &larr; s.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">picture: picture<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tool &larr; tools push: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self frame: (picture origin rect: picture corner)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">toolpic: a </span><span style="font: 10pt serif">[toolpic &larr; a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Window protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bluebug </span><span style="font: 10pt serif">| <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">picture is: BitImage⇒ [ ⇑ picture fromrectangle: (picture rectangle)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">windowmenu bug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> =1 ⇒[self leave. ⇑exitflag &larr; false];  "</span><span style="font: italic 10pt serif">under</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2 ⇒[self leave; newframe; enter];  "</span><span style="font: italic 10pt serif">move</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">=3 ⇒[self grow  "</span><span style="font: italic 10pt serif">grow</span><span style="font: 10pt serif">"];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">=4 ⇒[self leave; erase.   "</span><span style="font: italic 10pt serif">close</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user unschedule: self. ⇑false];<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">=5 ⇒[self leave. picture filout. self enter];  "</span><span style="font: italic 10pt serif">filout</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">=6 ⇒[self print]</span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">press file</span><span style="font: 10pt serif">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">enter </span><span style="font: 10pt serif">| start pt b<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">Periodically check if the mouse is still in the frame.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">If not, stop showing the picture</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super show.  self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">picture show.  dirty&larr;false.  self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ b from: actionbuttons do⦂ [b reset].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">show action menu above the picture</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">start&larr;frame origin-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; start-(0⌾actionpic extent y).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">actionpic moveto: pt.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">saveActionPic&larr;actionpic bitsIntoString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">last point I can return before having to restore bits under menus</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">actionpic show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; actionbuttons◦1 moveto: pt. "</span><span style="font: italic 10pt serif">action</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; actionbuttons◦3 moveto: pt. "</span><span style="font: italic 10pt serif">mode</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; actionbuttons◦4 moveto: pt. "</span><span style="font: italic 10pt serif">width</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">show the next bank of action buttons</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; start-(0⌾(actionpic extent y+1/2)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; actionbuttons◦2 moveto: pt.  "</span><span style="font: italic 10pt serif">tone</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; actionbuttons◦5 moveto: pt.  "</span><span style="font: italic 10pt serif">grid</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tool brushpt: (pt &larr; pt+(7⌾7)).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(tool brush) moveto: pt; show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"show the tool pic"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt &larr; start-(toolpic extent x⌾0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">toolpic moveto: pt.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">saveToolPic &larr; toolpic bitsIntoString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">toolpic show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tools moveto: pt;  setvalue: tool.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tool frame: frame; showon: actionbuttons.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fixframe: r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[picture moveto: r origin.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r corner&larr;picture corner.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">grow </span><span style="font: 10pt serif">| oldframe newframe pt r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self leave.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">newframe&larr;picture origin rect: picture corner.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">CornerCursor showwhile⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pt&larr;user mp+16.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user nobug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[newframe corner&larr;pt.  newframe comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt&larr;user mp+16.  newframe comp].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user anybug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[newframe corner&larr;pt.  newframe comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pt&larr;user mp+16.  newframe comp]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">clear unused areas from old picture to background,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">and clear new picture areas to white</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldframe&larr;picture inset: ¬2⌾¬2.  "</span><span style="font: italic 10pt serif">¬2 is for erasing old border</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ r from: (oldframe minus: newframe) do⦂ [r clear: background].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ r from: (newframe minus: picture) do⦂ [r clear: white].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">picture title: picture title in: newframe; saveScreenBits.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self frame: newframe; show; takeCursor; enter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leave<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[nil≡saveActionPic⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> actionpic bitsFromString: saveActionPic.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> saveActionPic &larr; nil.].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [nil≡ saveToolPic⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> toolpic bitsFromString: saveToolPic.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> saveToolPic&larr;nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dirty⇒[picture saveScreenBits. dirty &larr; false]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame border: 3 color: white]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lostMouse </span><span style="font: 10pt serif">[⇑(frame has: user mp)≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">outside </span><span style="font: 10pt serif">| pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[toolpic has: (pt&larr;user mp)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user redbug⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tool&larr;tools bug: pt. tool frame: frame; showon: actionbuttons]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">actionpic has: pt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user redbug⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tool setfrom: actionbuttons]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">redbug </span><span style="font: 10pt serif">[dirty&larr;true.  tool redbug]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showtitle   </span><span style="font: italic 10pt serif">"The BitRectEditor have a menu where the title used to be"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">title </span><span style="font: 10pt serif">[⇑picture title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tool </span><span style="font: 10pt serif">[⇑ tool]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">yellowbug<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[picture is: BitImage⇒ [ picture yellowbug] <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪BitRectEditor under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">BitRectEditor classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"BitRectTool"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;BitRectTool&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;action "&lt;UniqueString&gt; the current action"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">pencil  "&lt;Turtle&gt; used for draw or straight-edge"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">brush  "&lt;BitRect&gt; source for painting"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">mode  "&lt;Integer&gt; how brush combines with the destination"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">tone  "&lt;Integer&gt; a spatial half-tone color (4 bits by 4 bits)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">grid  "&lt;Integer&gt; all mouse points are rounded to this"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;blowupScale graypens brushpt &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A BitRectTool paints on the screen.<br>A tool is a combination of action, mode, pen-width, gray, and grid.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">action is one of: make-brush, paint, block-of-gray, draw, straight-edge, magnify.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">mode is one of: store, or, xor, and.  (how tool is combined with picture)<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">pen-width is 1, 2, 4, or 8.  (width of the pen)<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">gray is one of: black, darkgray, gray, lightgray, white.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">grid is one of: 1, 2, 4, 8, 16, 32.   (minimum spacing of mouse points)<br>Menus for each part of a tool appear above the picture (in the same order).<br>Some actions do not use certain of the other parts of a tool.<br>(example: Block-of-gray does not use pen-width.)<br><br>brushpt = Point in the menu where brush is shown.<br>graypens = Vector of Strings of bits in pens.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Tool action</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">block </span><span style="font: 10pt serif">[self getRectangle color: tone mode: mode]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">blowup </span><span style="font: 10pt serif">| smallRect bigRectFrame<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[smallRect&larr;self getRectangle.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bigRectFrame &larr; Rectangle new origin: smallRect corner<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">extent: 4⌾4 + (smallRect  extent*blowupScale).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">smallRect empty or⦂ bigRectFrame bitStringLength&gt;4000⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pencil frame flash.  ⇑nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user screenrect has: bigRectFrame corner⇒[] <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">bigRectFrame moveto: smallRect origin-bigRectFrame extent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user screenrect has: bigRectFrame origin⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">can&rsquo;t find a space for blown up image</span><span style="font: 10pt serif">"</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pencil frame flash.  ⇑nil].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self blowup: smallRect to: bigRectFrame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">blowup: smallRect to: bigRectFrame<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| bigRect box pt i turt flag bits<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[bits &larr; bigRectFrame bitsIntoString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bigRect &larr; bigRectFrame inset: 2⌾2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">smallRect blowup: bigRect origin by: blowupScale.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">turt&larr;Turtle init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">box &larr; 0⌾0 rect: (blowupScale-1)⌾(blowupScale-1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">keep editing in blowup mode until the user presses a button<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">outside the big rect</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ flag do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[bigRect has: (pt &larr; user mp)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[box moveto: bigRect origin + (i &larr; pt-bigRect origin|blowupScale).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">turt place: smallRect origin + (i/blowupScale).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user redbug⇒[box color: black mode: storing. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">turt black; go: 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user yellowbug⇒[box color: white mode: storing. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">turt white; go: 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user bluebug⇒[bigRect flash]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user anybug ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(bigRect inset: ¬5⌾¬5) has: pt⇒[bigRect flash]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">quit</span><span style="font: 10pt serif">" flag&larr;false]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bigRectFrame bitsFromString: bits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">brush </span><span style="font: 10pt serif">[⇑brush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">brush: sourceRect   </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">use the bits in the BitRect </span><span style="font: italic 10pt serif; text-decoration: underline">sourceRect</span><span style="font: italic 10pt serif"> as a brush</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| minpt maxpt pt offset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">The inner painting loop should be fast - all the extra foliage below<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">is to move tests outside of the inner loop</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceRect moveto: brushpt; show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">minpt&larr;self frame origin.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">maxpt&larr;self frame corner-sourceRect extent.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">offset&larr;sourceRect extent/2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">If mode is storing or oring, use brush command, otherwise blt.</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Use the unclipped form of brushing  and grid=1 when possible</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[mode&lt;xoring and⦂ grid=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[minpt≤(pt&larr;user mp-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sourceRect brush: pt mode: mode color: tone]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceRect brush: pt mode: mode color: tone clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> mode≥xoring and⦂ grid=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[minpt≤(pt&larr;user mp-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sourceRect blt: pt mode: mode]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceRect blt: pt mode: mode clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> mode&lt;xoring⇒   "</span><span style="font: italic 10pt serif">grid is &gt; 1</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[minpt≤(pt&larr;self mpOnGrid-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sourceRect brush: pt mode: mode color: tone]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceRect brush: pt mode: mode color: tone clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> "</span><span style="font: italic 10pt serif">grid is &gt; 1 and mode≥xoring</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[minpt≤(pt&larr;self mpOnGrid-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sourceRect blt: pt mode: mode]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">sourceRect blt: pt mode: mode clippedBy: self frame]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">draw<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tone=white or⦂ tone=black⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pencil place: self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">grid=1⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">make drawing with grid 1 fast</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pencil goto: user mp-pencil frame origin]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pencil goto: self mpOnGrid-pencil frame origin]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self brush: graypens◦pencil width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">getRectangle </span><span style="font: 10pt serif">| rect newrect start t   </span><span style="font: italic 10pt serif">"rect must be in my frame"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">the rect-newrect stuff is so that the complementing stays<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">on for a while</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">start&larr;self mpOnGrid.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect&larr;newrect&larr;(Rectangle new origin: start corner: start)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">intersect: self frame.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">move the cursor slightly so that the user will notice the rectangle<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">being complemented</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cursorloc&larr;start+4.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user anybug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rect&larr;newrect.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t&larr;self mpOnGrid.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">newrect&larr;(Rectangle new origin: (start min: t) corner: (start max: t))<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">intersect: self frame.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect comp].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑rect]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">line </span><span style="font: 10pt serif">| start end width</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[start&larr;end&larr;self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">width&larr;pencil width.  pencil xor; width: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[end&larr;self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pencil xor; place: start; goto: end; place: start; goto: end].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tone=white⇒[pencil white] pencil black].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pencil width: width; place: start; goto: end]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mode<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ mode]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mpOnGrid   </span><span style="font: italic 10pt serif">"return mouse point rounded to </span><span style="font: italic 10pt serif; text-decoration: underline">grid</span><span style="font: italic 10pt serif">"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑user mp+(grid/2) | grid]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">paint<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self brush: brush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">redbug </span><span style="font: 10pt serif">[self perform: action]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setbrush </span><span style="font: 10pt serif">| rect<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rect&larr;self getRectangle.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect empty or⦂ 50⌾50&lt;rect extent⇒[pencil frame flash].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">brush color: white mode: storing.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">brush title: &rsquo;brush&rsquo; in: rect; saveScreenBits.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">brush moveto: brushpt; show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">action &larr; ↪paint]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">shade </span><span style="font: 10pt serif">| p1 p2 a b t p r vs "down on redbug is black place.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">up on redbug is white place.  Subsequent redbugs<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">paint a shade of gray depending on position between<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">black and white (and beyond white to black again).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Yellow or blue bug terminates."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[until⦂ user redbug do⦂ [p1 &larr; user mp]. "black"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ user nobug do⦂ [p2 &larr; user mp]. "white"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vs &larr; ↪( ¬1  ¬1025  ¬1089  ¬585  ¬4681  ¬6731  ¬22058  ¬27031   ¬26986  ¬31191  ¬32108   5160  5128  8321  1025 01 0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; 0⌾0 rect: 10⌾10.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b&larr;(p1-p2). b &larr; b x asFloat ⌾ b y asFloat.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; b x * b x + (b y * b y) /16.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (user yellowbug or⦂ user bluebug) do⦂<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user redbug ⇒[p&larr;user mp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; b* (p-p2).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; (t x + t y /a) asInteger abs min: 16.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">brush brush: p mode: mode color: vs◦(17-t)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tone<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ tone]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Tool selection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">brushpt: pt  </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">set the point at which the current brush will be shown</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[brushpt&larr;pt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame </span><span style="font: 10pt serif">[⇑pencil frame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame: f </span><span style="font: 10pt serif">[pencil frame: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setfrom: butvec </span><span style="font: 10pt serif">| pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[butvec◦1 has: (pt &larr; user mp) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[action &larr; butvec◦1 bug: pt]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦2 has: pt ⇒[tone &larr; butvec◦2 bug: pt.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tone=white ⇒[pencil white] pencil black]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦3 has: pt ⇒[mode &larr; butvec◦3 bug: pt]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦4 has: pt ⇒[pencil width: (butvec◦4 bug: pt)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦5 has: pt ⇒[grid &larr; butvec◦5 bug: pt]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showon: butvec<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[butvec◦1 setvalue: action.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦2 setvalue: tone.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦3 setvalue: mode.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦4 setvalue: pencil width.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">butvec◦5 setvalue: grid]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Class initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">| rect saveBits t i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[blowupScale&larr;4.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"make a vector of gray pens"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect &larr; 0⌾0 rect: 9⌾9.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">saveBits&larr;rect bitsIntoString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; Turtle init.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">graypens &larr; Vector new: 8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 8 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t width: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect clear: white. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t place: 4⌾4; go: 0. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">graypens◦i &larr; BitRect new title: &rsquo;graypen&rsquo; in: rect.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(graypens◦i) saveScreenBits].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">rect bitsFromString: saveBits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(pencil &larr; Turtle new) init; black; width: 2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(brush &larr; BitRect new) title: &rsquo;brush&rsquo; in: (0⌾0 rect: 16⌾16).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tone &larr; black. mode &larr; 0. grid &larr; 1. action &larr; ↪draw]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪BitRectTool under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">BitRectTool classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"RadioButtons"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;RadioButtons&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;vec  "&lt;Vector&gt; values corresponding to the buttons"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">cur  "&lt;Integer&gt; button currently selected"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">rect  "&lt;Rectangle&gt; contains all the buttons"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">size  "&lt;Integer&gt; width or height of a button"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A RadioButtons is a row or column of square regions ("buttons") on the display screen.  There is always exactly one button pushed.  (RadioButtons is a model of the station selection buttons on a car radio.)  The pushed button has a black box around it.  Each button has a value associated with it, which is returned when the button is pressed.  RadioButtons will not destroy a menu picture (BitRect) displayed in its area, but the RadioButtons has no knowledge of the picture.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Pushing a Button</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bug: pt </span><span style="font: 10pt serif">| r a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; (pt - rect origin - (1⌾1)) / size.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; r x + r y + 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self push: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">push: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self release: cur thenPush: a.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑vec◦(cur &larr; a)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setvalue: v </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"if value has been lost, set self to 1"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr;(vec find: v) max: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self push: i.  ⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Init and State</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">has: pt </span><span style="font: 10pt serif">[⇑rect has: pt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">moveto: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rect moveto: pt.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cur &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑rect corner x ⌾ rect origin y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset </span><span style="font: 10pt serif">[cur&larr;0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">value </span><span style="font: 10pt serif">[⇑vec◦cur]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">vec </span><span style="font: 10pt serif">[⇑vec]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">vec: vec at: r height: size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rect &larr; r rect: r+ ((vec length ⌾ 1)*size).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cur &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">vec: vec at: r width: size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[rect &larr; r rect: r+ ((1 ⌾ vec length)*size).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cur &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release: a thenPush: b </span><span style="font: 10pt serif">| boxer offset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a=b⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">offset &larr; [size=rect extent y⇒[size⌾0] 0⌾size].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a≠0⇒[boxer &larr; Rectangle new origin: (offset*(a-1)+rect origin+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">extent: size⌾size-1.  boxer comp.  (boxer inset: 1⌾1) comp]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b≠0⇒[boxer &larr; Rectangle new origin: (offset*(b-1)+rect origin+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">extent: size⌾size-1.  boxer comp.  (boxer inset: 1⌾1) comp]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪RadioButtons under: &rsquo;Picture Editor&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
