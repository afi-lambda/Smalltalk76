<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Juniper.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 11:35:35 pm.&rsquo;&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"JuniperFileController"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperFileController&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: File<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fLongFileHandle<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fShortFileHandle<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: gJuniperConstants;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER FILE CONTROLLER</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">implementationNotes<br></span><span style="font: 10pt serif">[<br>"<br>FIELDS<br></span><span style="font: bold 10pt serif">fLongFileHandle</span><span style="font: 10pt serif"> : a LongInteger representing the unique identifier for the file.<br></span><span style="font: bold 10pt serif">fShortFileHandle</span><span style="font: 10pt serif"> : an Integer representing the identifier for the file during a particular transaction.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FILE REDEFINITIONS (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allocatePage<br></span><span style="font: 10pt serif">"...returns a new packet (Pacbuf) to be used as the data buffer in a JuniperPageBuffer."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ((self interface) newPacket)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close<br></span><span style="font: 10pt serif">"...closes the file on the Juniper file system."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sCloseFile requestPrs: nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">endFile: pPageBuffer<br></span><span style="font: 10pt serif">"...adjusts the file length, writes pPageBuffer (a JuniperPageBuffer) on the file, and returns pPageBuffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length: ( ((pPageBuffer pageNumber)-1)*(pPageBuffer dataLength)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">+ pPageBuffer length<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ).  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writePage: pPageBuffer.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ pPageBuffer<br>]<br>"<br>1. Set the file length to the total number of bytes in the file.<br>2. Write the page on Juniper.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entryClass<br></span><span style="font: 10pt serif">"...returns the class of objects managed by JuniperFileController objects."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ JuniperPageBuffer<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Get: pPageBuffer<br></span><span style="font: 10pt serif">"...reads the data from the page whose number is that specified by pPageBuffer (a JuniperPageBuffer) if such a page exists.  Otherwise pPageBuffer should contains data to be written on the file at the appropriate place."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tNextPageNumber tNewPageNumber i<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tNewPageNumber &larr; pPageBuffer pageNumber.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tNewPageNumber ≤ lastpn and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastpn &gt; 1 or⦂ self length &gt; 0)⇒ [ ⇑ (self Read: pPageBuffer) ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tNextPageNumber &larr; lastpn + 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tNewPageNumber = tNextPageNumber ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length: (tNewPageNumber-1) * (pPageBuffer dataLength).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: tNextPageNumber to: (tNewPageNumber-1) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ pPageBuffer pageNumber: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer &larr; self writePage: pPageBuffer.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer pageNumber: tNewPageNumber.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer length: 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ pPageBuffer<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastFullPage </span><span style="font: 10pt serif">[⇑self length / self entryClass new dataLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length<br></span><span style="font: 10pt serif">"...returns the number of bytes (an Integer) in the file."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sReadLength requestPrs: nil.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (tResult longInteger: 1)  "2"<br>]<br>"<br>1. Issue a &rsquo;read length&rsquo; command to Juniper.<br>2. Return the length from the result parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length: pLength<br></span><span style="font: 10pt serif">"...sets the number of bytes in the file to the integer pLength (an Integer)."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest longInteger: 1 &larr; pLength.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sSetLength requestPrs: tRequest.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastpn &larr; self pageFrom: pLength.  "4"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the length parameter to pLength.<br>3. Issue a &rsquo;set length&rsquo; command to Juniper.<br>4. Determine the number of the last page of the file and assign it to the superClass field lastpn.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open<br></span><span style="font: 10pt serif">"...opens the file on the Juniper file system."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest tResult<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; fLongFileHandle.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; (self interface) doAction: sOpenFile requestPrs: tRequest.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fShortFileHandle &larr; tResult parameter: 1.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self findLastPage.  "5"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the long file handle parameter.<br>3. Issue an &rsquo;open file&rsquo; command to Juniper.<br>4. Set the superClass field serialNumber to the short file handle returned by Juniper in the result parameter block.<br>5. Set the number of the last page of the file.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Read: pPageBuffer<br></span><span style="font: 10pt serif">"...returns false if the page number of pPageBuffer (a JuniperPageBuffer) is greater than the page number of the last page of the file; otherwise, the data for that page is read from the Juniper file system into the packet of pPageBuffer."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest tResult pn</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ (pn &larr; pPageBuffer pageNumber) &gt; lastpn  ⇒  [ ⇑ false ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastpn=1 and⦂ self empty⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer length: 0. "⇑ self Get: pPageBuffer" ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest parameter: 1 &larr; (pn - 1).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sReadPage requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer page: (tResult packet).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pPageBuffer length: (tResult parameter: 1).  "6"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ pPageBuffer  "7"<br>]<br>"<br>1. Return false if the page number of pPageBuffer is greater than that of the last page of the file.<br>2. Create a new request parameter block.<br>3. Set the page number parameter to that of pPageBuffer less 1.  Juniper page numbers start at 0.<br>4. Issue a &rsquo;read page&rsquo; request.<br>5. Set the pPageBuffer packet to that of the result parameter block.<br>6. Set the length of pPageBuffer to that returned in the result parameter block.<br>7. Return pPageBuffer modified.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Write: pPageBuffer<br></span><span style="font: 10pt serif">"...adjusts the length of the file if pPageBuffer is the last page, sends the data buffered in pPageBuffer (a JuniperPageBuffer) to the Juniper file system, and returns pPageBuffer."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tPageNumber<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPageNumber &larr; pPageBuffer pageNumber.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tPageNumber &lt; lastpn ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tPageNumber &gt; (lastpn+1) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ ⇑ self error: &rsquo;invalid page number&rsquo; ]  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">( (tPageNumber-1)*(pPageBuffer dataLength)+(pPageBuffer length)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self writePage: pPageBuffer.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ pPageBuffer  "5"<br>]<br>"<br>1. If the page number of pPageBuffer is less than the last page number of the file, do not readjust the file length.<br>2. If the page number of pPageBuffer is greater than the next available page number for the file, invoke error handling.<br>3. If pPageBuffer is the last page of the file or will immediately follow the last page of the file, adjust the file length.<br>4. Send the data to Juniper.<br>5. Return pPageBuffer unmodified.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writePage: pPageBuffer<br></span><span style="font: 10pt serif">"...sends the data buffered in pPageBuffer (a JuniperPageBuffer) to the Juniper file system provided the buffer is not empty."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ (pPageBuffer length = 0) ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; JuniperRequestParameterBlock new.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">packet &larr; pPageBuffer page;  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 1 &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 2 &larr; 0;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">parameter: 1 &larr; ((pPageBuffer pageNumber) - 1).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sWritePage requestPrs: tRequest.  "6"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. If there is no data in pPageBuffer do nothing.<br>2. Create a new request parameter block.<br>3. Set the packet to that of pPageBuffer.  This contains the data to be written on the Juniper file.<br>4. Set the authentication key and reserved word to 0.<br>5. Set the page number parameter to that of pPageBuffer less 1.  Juniper page numbers start at 0.<br>6. Issue a &rsquo;write page&rsquo; request.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>MISC (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doAction: pAction requestPrs: pRequest<br></span><span style="font: 10pt serif">"...the specified request, pAction, (selected from gJuniperConstants) with its corresponding request parameter block, pRequest ( a JuniperRequestParameter Block), is issued to the Juniper file server (through the file interface).  If no errors are found, a JuniperResultParameterBlock is returned; otherwise, error handling is invoked.  If no request parameters are required, pRequest can be specified as nil."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ pRequest ≡ nil ⇒ [ pRequest &larr; self newRequestParameterBlock. ]  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRequest shortFileHandle &larr; fShortFileHandle.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ((self interface) doAction: pAction requestPrs: pRequest)  "3"<br>]<br>"<br>1. Create a new request parameter block if one is not specified.<br>2. Set the short file handle parameter.<br>3. Issue the request to the Juniper interface and return the result parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">interface<br></span><span style="font: 10pt serif">"...returns the JuniperInterface controlling the file."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ directory<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">longFileHandle: pLongFileHandle<br></span><span style="font: 10pt serif">"...sets the file&rsquo;s long file handle."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fLongFileHandle &larr; pLongFileHandle.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newRequestParameterBlock<br></span><span style="font: 10pt serif">"...initializes and returns a new JuniperRequestParameterBlock."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ((self interface) newRequestParameterBlock)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperFileController under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperInterface"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperInterface&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: FileDirectory<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo; <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fName<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fPassword<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fDefaultDirectory<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fJuniperSocket<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fTimer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fExceptionHandler<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fSpecialError<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fOpenIndicator<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">sharing: gJuniperConstants;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER INTERFACE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">implementationNotes<br></span><span style="font: 10pt serif">[<br>"<br>FIELDS<br></span><span style="font: bold 10pt serif">fName </span><span style="font: 10pt serif">:</span><span style="font: bold 10pt serif"> </span><span style="font: 10pt serif">a String representing the name of an account on the Juniper file system.<br></span><span style="font: bold 10pt serif">fPassword </span><span style="font: 10pt serif">: a String representing the password of the same account.<br></span><span style="font: bold 10pt serif">fDefaultDirectory</span><span style="font: 10pt serif"> : a String representing the directory to be used as the default if one is not specified as part of a file name.<br></span><span style="font: bold 10pt serif">fJuniperSocket</span><span style="font: 10pt serif"> : a JuniperSocket used to interface to the etherWorld mechanism.<br></span><span style="font: bold 10pt serif">fTimer</span><span style="font: 10pt serif"> : a Timer used to periodically send noop commands when the interface is open to prevent timeout.<br></span><span style="font: bold 10pt serif">fExceptionHandler</span><span style="font: 10pt serif"> : an ExceptionHandler to invoke when a transaction is aborted.<br></span><span style="font: bold 10pt serif">fSpecialError</span><span style="font: 10pt serif"> : an error code to ignore on a command request.<br></span><span style="font: bold 10pt serif">fOpenIndicator</span><span style="font: 10pt serif"> : the interface status: true means open; nil means not open.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>USER CALLABLE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close<br></span><span style="font: 10pt serif">"...ends the current transaction and closes the interface."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">|  tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fOpenIndicator ≡ nil ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sLogout requestPrs: nil.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">show: (tResult nextDataBlockString).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">super close.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. If the interface is not open, do nothing.<br>2. Issue a logout command.<br>3. Display the logout message returned by Juniper.<br>4. delete self from externalViews, Release timers, fields, etc.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">closeTransaction<br></span><span style="font: 10pt serif">"...closes the current transaction leaving the user logged in with all open files still open, and all read and write locks still in effect."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sCloseTransaction requestPrs: nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory: pDirectory<br></span><span style="font: 10pt serif">"...specifies the directory name to be added to any file name that does not begin with a directory name."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fDefaultDirectory &larr; pDirectory.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">exceptionHandler: pExceptionHandler<br></span><span style="font: 10pt serif">"...specifies an exception handler to be invoked if any subsequent request discovers that the expected transaction has been closed.  If no exception handler is set, a notify window is displayed."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fExceptionHandler &larr; pExceptionHandler.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">name: pName password: pPassword<br></span><span style="font: 10pt serif">"...specifies the name and password of an account on the Juniper file system.  This account will be logged into whenever the interface is opened."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fName &larr; pName.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPassword &larr; pPassword.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">obsolete </span><span style="font: 10pt serif">[⇑fOpenIndicator ≡ nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">open<br></span><span style="font: 10pt serif">"...opens the interface allowing access to files on the Juniper file system.  A new transaction is started."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fOpenIndicator ≡ true  ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">E wakeup.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self release.  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fJuniperSocket &larr; JuniperSocket new hostName: self server.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self login: (self userName) password: (self userPassword).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">show: (tResult nextDataBlockString).  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self timerOn.  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">super open.  "8"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fOpenIndicator &larr; true.  "9"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. If the interface is already open, do nothing.<br>2. Make sure that the EtherWorld mechanism is in a valid state.<br>3. Release the interface to insure a valid initial state.  (An invalid state can occur from  an error on some statement in a previous invocation of &rsquo;open&rsquo;).<br>4. Create and initialize a JuniperSocket (parameterize server name?).<br>5. Issue a login command.<br>6. Display the login message that is returned by Juniper.<br>7. Turn on a timer to issue periodic noop commands to prevent timeout.<br>8. Do predefined open operations.<br>9. Set the interface status to &rsquo;open&rsquo;.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release<br></span><span style="font: 10pt serif">"...leaves the interface in a valid state after an error."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fOpenIndicator &larr; nil.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self timerOff.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fJuniperSocket ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fJuniperSocket close.  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fJuniperSocket &larr; nil.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. Set the interface status to &rsquo;not open&rsquo;.<br>2. Turn off the timer.<br>3. Close the JuniperSocket if it exists.<br>4. Release the JuniperSocket field.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">versionNumbers </span><span style="font: 10pt serif">[⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FILE DIRECTORY (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Delete: pFile<br></span><span style="font: 10pt serif">"...deletes from the Juniper file system the file whose file name is specified by pFile (a JuniperFileController)."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sDestroyFile requestPrs: tRequest.  "3"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>3. Issue a &rsquo;destroy file&rsquo; request.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">entryClass<br></span><span style="font: 10pt serif">"...returns the file class handled by the JuniperInterface."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ JuniperFileController<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Find: pFile<br></span><span style="font: 10pt serif">"...sends a &rsquo;look up file&rsquo; request to the Juniper file server.  If the file is found, its name and long file handle are set in pFile (a JuniperFileController). Otherwise false is returned."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSpecialError &larr; sFileNotFound.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sLookupFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fSpecialError ≡ true ⇒ [ fSpecialError &larr; nil.  ⇑ false ]  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSpecialError &larr; nil.  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">name: tResult nextDataBlockString.  "7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. Set the error handling mechanism to ignore a &rsquo;file not found&rsquo; error.<br>2. Create a new request parameter block.<br>3. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>4. Issue a &rsquo;look up file&rsquo; request and get the result parameter block.<br>5. If a &rsquo;file not found&rsquo; error was encountered, reset the error handling mechanism and return false.<br>6. (no error encountered) Reset the error handling mechanism.<br>7. Set the long file handle and name (from the result parameter block) in pFile.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Insert: pFile<br></span><span style="font: 10pt serif">"...issues a &rsquo;create file&rsquo; request to the Juniper file server and sets the returned long file handle and name in pFile (a JuniperFileController)."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest longInteger: 2 &larr; 0 "user rawtotalsecs".  "1.5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; &rsquo;&rsquo;.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sCreateFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">name: tResult nextDataBlockString.  "5"<br>]<br>"<br>1. Create a new request parameter block.<br>1.5 Set creation date (to default (current) -- later some specific date&time?)<br>2. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>3. Blank the file server field of the request parameter block.<br>4. Issue a &rsquo;create file&rsquo; request and get the result parameter block.<br>5. Set the long file handle and name (from the result parameter block) in pFile.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Match: entries to: strm </span><span style="font: 10pt serif">| entry pat ents name i p lastname [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"search for Files matching patterns"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ pat from: entries do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">name &larr; self checkDirectory: pat name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; name find: &rsquo;*&rsquo;◦1. p &larr; name find: &rsquo;#&rsquo;◦1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; [p=0⇒ [i] i=0⇒ [p] i min: p].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i=0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(self Find: pat)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"exact name found"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; pat]]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"pattern match over range of first to last possible matches"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pat &larr; self makeEntry: name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">entry &larr; self makeEntry: (name copy: 1 to: i-1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastname &larr; name copy: 1 to: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lastname◦i &larr; 0377.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((entry &larr; self nextFile: entry) and⦂ entry name &lt; lastname) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pat match: entry⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next &larr; entry.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"copy entry since nextFile smashes into it"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">entry &larr; self makeEntry: entry name]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextFile: pFile<br></span><span style="font: 10pt serif">"same as LookupFile (Find:), but it pertains to the file whose name is lexically next after the fileName specified in the request.  If the file is found, its name and long file handle are set in pFile (a JuniperFileController). Otherwise (no next file) false is returned."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSpecialError &larr; sFileNotFound.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; self doAction: sNextFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fSpecialError ≡ true ⇒ [ fSpecialError &larr; nil.  ⇑ false ]  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSpecialError &larr; nil.  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">name: tResult nextDataBlockString.  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑pFile<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Rename: oldFile from: newFile<br></span><span style="font: 10pt serif">"renames a file on Juniper"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest newName</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; oldFile name.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest nextDataBlockString &larr; (newName &larr; self checkDirectory: newFile name).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self doAction: sRenameFile requestPrs: tRequest.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldFile name: newName.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">server </span><span style="font: 10pt serif">["should be an instance variable?" ⇑&rsquo;Juniper&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>JUNIPER COMMAND INTERFACE (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checkResult: pResult<br></span><span style="font: 10pt serif">"...is sent by doAction and doLogin to check the result of a Juniper request.  pResult is a result parameter block (JuniperResultParameterBlock) containing the packet (Pacbuf) returned as a result of the request."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ ((pResult packet) ≡ false or⦂ pResult pupType = 4) or⦂ (pResult resultCode = sCommandNak and⦂ (pResult parameter: 1) = sTransactionAborting) ⇒  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ [ fExceptionHandler ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fExceptionHandler trap.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">  ].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: &rsquo;No Juniper Transaction&rsquo;.  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ (pResult resultCode)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sCommandAck ⇒ [ ⇑ true ];  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sCommandNak ⇒  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ self checkRetry: (pResult parameter: 1) ⇒ [ ⇑ false ]  "8"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ (pResult parameter: 1) = fSpecialError ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fSpecialError &larr; true.  ⇑ true ]  "9"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self error: (pResult nextDataBlockString).  "10"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ true  "11"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. JuniperSocket sendRequest: and sendLogin: return false if no response is received from Juniper.<br>2. Invoke error handling if there is no response from Juniper.<br>3. Juniper returns an error pup (packet pup type  = 4) if the transaction has been aborted.<br>4. If the transaction has been aborted and there is an exception handler, then trap to the handler.<br>5. Invoke error handling if control is returned or if there is no exception handler.<br>6. Return true if a &rsquo;command acknowledged&rsquo; was returned (this means success with no result parameters).<br>7. If a &rsquo;command not acknowledged&rsquo; was returned,  an error condition exists.<br>8. Check for a retryable error and return false if so.<br>9. If the error is the same as that specified in the special error indicator, then indicate it and return true.<br>10. If not, invoke error handling.<br>11. Return true if a &rsquo;command not acknowledged&rsquo; was not returned (this means success with result parameters).<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: bold 10pt serif">checkRetry: pErrorCode<br></span><span style="font: 10pt serif">"...is sent by checkResult to test for a retryable error.  Returns true if so; false otherwise."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ pErrorCode<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sSequenceNumberGap ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sRecoveryUnderWay ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sTransactionClosing ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= sCongestion ⇒ [ ⇑ true ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ false<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doAction: pAction requestPrs: pRequest<br></span><span style="font: 10pt serif">"...corresponds to the Pine Protocol function.  The specified request, pAction, (selected from gJuniperConstants) with its corresponding request parameter block, pRequest (a JuniperRequestParameterBlock), is issued to the Juniper file server (through JuniperSocket sendRequest:). A packet is returned and inserted into a result parameter block and checked for error conditions.  If no errors are found, the result parameter block (a JuniperResultParameterBlock) is returned; otherwise, error handling is invoked.  If no request parameters are required, pRequest can be specified as nil."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fOpenIndicator ≡ nil ⇒ [ self open. ]  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ pRequest ≡ nil ⇒ [ pRequest &larr; self newRequestParameterBlock. ]  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer disable.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRequest opcode &larr; pAction.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pRequest pupType &larr; sRequest.  "5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; JuniperResultParameterBlock new.  "6"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult packet &larr; (fJuniperSocket sendRequest: (pRequest packet)).  "7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer reset.  "8"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ self checkResult: tResult ⇒ [ ⇑ tResult ]  "9"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (self doAction: pAction requestPrs: pRequest)  "10"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. Make sure the JuniperInterface is open.<br>2. Create a request parameter block if none was specified.<br>3. Disable the timer to insure that a noop command is not sent while the current request is in progress.<br>4. Set the command code in the packet.<br>5. Set the packet pup type to &rsquo;request&rsquo;.<br>6. Create a result parameter block.<br>7. Send the request to the JuniperSocket with the packet from the request parameter block; set the result packet in the result parameter block.<br>8. Reset the timer.<br>9. Check the result; if valid, return it.<br>10. If false is returned, then a retryable error was encountered so retry the command.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">doLogin: pRequest<br></span><span style="font: 10pt serif">"...is sent by login:password: with pRequest (a JuniperRequestParameter Block) set.  doLogin: issues a login request, checks for errors, and retries if necessary.  If no error occurs, a JuniperResultParameterBlock is returned; otherwise, error handling is invoked."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tResult<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult &larr; JuniperResultParameterBlock new.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tResult packet &larr; (fJuniperSocket sendLogin: (pRequest packet)).  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ self checkResult: tResult ⇒ [ ⇑ tResult ]  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (self doLogin: pRequest)  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]<br>"<br>1. Create a new result parameter block.<br>2. Issue a login request and set the result packet in the result parameter block.<br>3. Check the result and return it if there is no error.<br>4. Retry the request if there is a retryable error.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">error:  pMessage<br></span><span style="font: 10pt serif">"...is sent by checkResult if an error is encountered on a Juniper request.  (pMessage is a String containing an appropriate error message.)  The error message is formed and a notify window is displayed."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tMessage<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tMessage &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tMessage append: pMessage.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super error: (tMessage contents).<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newPacket<br></span><span style="font: 10pt serif">"...returns a new packet (Pacbuf) from the JuniperSocket."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fJuniperSocket ≡ nil ⇒ [ self open. ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (fJuniperSocket freePacket)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">newRequestParameterBlock<br></span><span style="font: 10pt serif">"...initializes and returns a new JuniperRequestParameterBlock."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequestParameterBlock</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fJuniperSocket ≡ nil ⇒ [ self open. ]  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequestParameterBlock &larr; JuniperRequestParameterBlock new.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequestParameterBlock<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">packet &larr; (fJuniperSocket freePacket);  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dataBlockLength &larr; 0;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 1 &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 2 &larr; 0.  "5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ tRequestParameterBlock  "6"<br>]<br>"<br>1. Open the interface if it is not already.<br>2. Create a new request parameter block.<br>3. Create a new packet and set it in the request parameter block.<br>4. Set the data block length to 0.<br>5. Set the authentication key and reserved word to 0.<br>6. Return the initialized request parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>TIMER (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">noOp</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">"...sends a noop command to the Juniper file server.  It&rsquo;s only effect is to reset the timout mechanism of the server."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tPacket<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPacket &larr; fJuniperSocket freePacket.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPacket pupType &larr; sNoop.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPacket dataString &larr; &rsquo;&rsquo;.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fJuniperSocket setAddressesAndComplete: tPacket; timerOff.  "4"<br>]<br>"<br>1. Get a new packet (Pacbuf).<br>2. Set packet pup type to &rsquo;noop&rsquo;.<br>3. Set the dataString to the empty string.  This has the necessary effect of setting the packet length to 0.<br>4. Send the packet.  It is necessary to bypass the normal JuniperSocket interface (sendRequest:) because no acknowledgement is returned for the noop.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">timerOff<br></span><span style="font: 10pt serif">"...disables fTimer and sets it to nil."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fTimer ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer disable.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">timerOn<br></span><span style="font: 10pt serif">"...assigns fTimer to a new timer object that wakes up every 100 seconds (6000 1/60 seconds) and issues a &rsquo;noop&rsquo; command to Juniper.  This  is used to prevent Juniper from timing out during periods of inactivity."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self timerOff.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer &larr; Timer new.  "2"  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer for: 6000 action⦂ [ self noOp.  user show: &rsquo;.&rsquo;.  fTimer reset. ].  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cr.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fTimer reset.  "4"<br>]<br>"<br>1. Make sure that the current timer is released.<br>2. Create a new timer.<br>3. Set the timer interval to 100 seconds.  The action of the timer is to send a noop, show a dot in the dispFrame, and reset.<br>4. Activate the timer.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>MISC (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checkDirectory: pFileName </span><span style="font: 10pt serif">| ps </span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">"...returns a string that has the default directory name added to the beginning of pFileName (a String) unless pFileName already begins with a directory name in which case it is returned unchanged. max length of ~58"</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ps &larr; (String new: 60) asStream.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[pFileName length &gt; 0 and⦂ (pFileName◦1) = (&rsquo;&lt;&rsquo;◦1)⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ps append: &rsquo;&lt;&rsquo;; append: self directory; append: &rsquo;&gt;&rsquo;].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ps append: pFileName.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ps last = (&rsquo;.&rsquo;◦1)⇒ [ps skip: ¬1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ps contents<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">directory<br></span><span style="font: 10pt serif">"...Returns a string specifying the default file name directory.  The default directory is fDefaultDirectory if it is not nil, otherwise it is self name"</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fDefaultDirectory ≡ nil ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ ⇑ self userName<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fDefaultDirectory<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash: pString<br></span><span style="font: 10pt serif">"...returns a hash value for pString (a String)."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tHash1 tHash2 i<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tHash1 &larr; 0.  tHash2 &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: 1 to: (pString length) by: 2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tHash1 &larr; tHash1 lxor: (UpperCase◦(pString◦i+1)).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tHash2 &larr; tHash2 lxor:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ i = (pString length) ⇒ [ 040 ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">UpperCase◦(pString◦(i+1)+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (tHash1*256 + tHash2)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">login: pName password: pPassword<br></span><span style="font: 10pt serif">"...sets the necessary request parameters and invokes doLogin to issue a login request.  pName (a String) specifies the name of an account on the Juniper file system.  pPassword (a String) specifies the password of the account."</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tRequest</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tRequest<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 3 &larr; sLogin;  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 4 &larr; 512;  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 5 &larr; 7;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">leader: 6 &larr; (self hash: pPassword);  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextDataBlockString &larr; pName;  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pupType &larr; sCustodian.  "7"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (self doLogin: tRequest)  "8"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the command to Login.<br>3. Set the number of bytes per page to 512.<br>4. Set the Juniper version number to 7 (Nov 80).<br>5. Set the hashed account password to pPassword hashed.<br>6. Set the account name to pName.<br>7. Set the packet pup type to custodian.<br>8. Issue the request and return the result.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">userName<br></span><span style="font: 10pt serif">"...returns the account name or a default (a String)."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fName ≡ nil ⇒ [ ⇑ super userName ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fName<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">userPassword<br></span><span style="font: 10pt serif">"...returns the account password or a default (a String)."</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ fPassword ≡ nil ⇒ [ ⇑ super userPassword ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fPassword<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>CLASS INIT</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit<br></span><span style="font: 10pt serif">"...initializes the constants in gJuniperConstants<br>(see [ivy] &lt;Juniper&gt;4.4&gt; CommonPineDefs.mesa).<br>Do the following to initialize:<br>Smalltalk declare: ↪gJuniperConstants as: (SymbolTable new init: 256).<br>JuniperInterface classInit."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tIndex tConstant<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ tConstant from: (self juniperConstants) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tConstant is: Integer ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ tIndex &larr; tConstant. ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">gJuniperConstants declare: tConstant as: tIndex.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">tIndex &larr; tIndex+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">juniperConstants<br></span><span style="font: 10pt serif">"...returns the set of constants used to specify requests to and to  interpret results from the Juniper file system."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">↪(<br>0250  "PineMsgType (Pup types)"<br>sRequest sResult sUnsolicited sCustodian sSync sPineAck sNoop<br><br>5  "DataRequest"<br>sReadPage sWritePage sSetLength sReadLength sCloseFile sDestroyAnonymousFile sReadData sWriteData sReadAttribute sWriteAttribute sSetWriteLock sSetReadLock sReleaseReadLock<br><br>32  "TransactionRequest"<br>sChangePassword sRoom sOpenFile sCreateAnonymousFile sFindFile sLockQuery sTransCompletionQuery<br><br>42  "ActivityRequest"<br>sLogout sCloseTransaction sAbortTransaction sLoginRequest<br><br>60  "DirectoryRequest"<br>sLookupFile sCreateFile sDestroyFile sRenameFile sNextFile sNextFewFiles<br><br>1  "ResultCode"<br>sCommandNak sCommandAck sHeresData sHeresEntry sHeresFileList sHeresLFH sHeresFile sHeresLength sLoginResponse sLogoutResponse sTransactionClosed sTransCompletionInfo sResourceData sHeresRoom<br><br>0  "Unsolicited Code"<br>sTransactionAborted sReadLockBroken<br><br>8  "CustodianCode"<br>sLogin sAddServer sResourceLocation<br><br>42  "PineErrorCode"<br><br>"TransTroubleCode"<br>sUnimplementedFeature sIllegalLoginAttempt sSoftwareVersionMismatch sNoSuchUser sPasswordMismatch sBytesPerPageUnacceptable sServerTooBusy sOutOfSpace sNoFilesHere sNoDirectoryHere sIllegalFileName sFileNotFound sFileAlreadyExists sTransactionAborting sNoSuchOpenFile sBigFilesNotImplemented sIllegalAttribute sReadAttributeProtectionError sUserAskedForIt sWriteAttributeProtectionError sPackNotOnDrive sTooManyOpenFiles sProtectionViolation sFileNotOnPack sPackFull sFileRefOutOfBounds sFileSizeExcessive sByteRangeExcessive sPackNotOnMachine sNoSuchTransaction sBrokenLock sInconvenientUnwind<br><br>"Retryable"<br>sSequenceNumberGap sRecoveryUnderWay sTransactionClosing sCongestion<br><br>120 "UserDetected"<br>sBlockTooLarge sNoRouteToServer sServerUnknown sBadBytesPerPage sInvalidRequest sPupGlitch sUnableToDecrypt sNoResponseToRequest sNewServerUnwilling sTransactionInUnknownState sBadTimeForRequests<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">  )<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>TEST / DIAGNOSTIC</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">test<br></span><span style="font: 10pt serif">["<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj &larr; JuniperInterface new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj release.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj open.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dpj close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| f  [ dpj open.  f &larr; dpj file: &rsquo;test.test&rsquo;.<br>until⦂ [ f end ] do⦂ [ user show: (f next) inString. ]. f close. dpj close. ]<br><br>JuniperSocket howMany 2 1 2 2 2  11 Timer howMany  33  NameUser howMany 1 1 1<br>"] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperInterface under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">JuniperInterface classInit&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperPageBuffer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperPageBuffer&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: EtherFilePage<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fLength<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fPageNumber<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fSerialNumber<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER PAGE BUFFER</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">implementationNotes<br></span><span style="font: 10pt serif">[<br>"<br>FIELDS<br></span><span style="font: bold 10pt serif">fLength</span><span style="font: 10pt serif"> : an Integer specifiying the number of bytes in the page buffer.<br></span><span style="font: bold 10pt serif">fPageNumber</span><span style="font: 10pt serif"> : an Integer specifying the number of the page buffer.<br></span><span style="font: bold 10pt serif">fSerialNumber</span><span style="font: 10pt serif"> : an Integer specifying the serial number of the page buffer. <br>"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FILE PAGE OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length<br></span><span style="font: 10pt serif">"...returns the number of bytes in the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fLength<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length: pLength<br></span><span style="font: 10pt serif">"...sets the number of bytes in the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fLength &larr; pLength.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super length: pLength.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageNumber<br></span><span style="font: 10pt serif">"...returns the page number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fPageNumber<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pageNumber: pPageNumber<br></span><span style="font: 10pt serif">"...sets the page number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPageNumber &larr; pPageNumber.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber<br></span><span style="font: 10pt serif">"...returns the serial number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fSerialNumber<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">serialNumber: pSerialNumber<br></span><span style="font: 10pt serif">"...sets the serial number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fSerialNumber &larr; pSerialNumber.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperPageBuffer under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fPacket<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fDataBlockPosition<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">implementationNotes<br></span><span style="font: 10pt serif">[<br>"<br>FIELDS<br></span><span style="font: bold 10pt serif">fPacket</span><span style="font: 10pt serif"> : a Pacbuf for sending request commands and parameters to the Juniper file server.<br></span><span style="font: bold 10pt serif">fDataBlockPosition</span><span style="font: 10pt serif"> : an Integer specifying the current position in the data block of fPacket.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataBlockAdvance: pIncrement<br></span><span style="font: 10pt serif">"...advances the data block position by pIncrement (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fDataBlockPosition &larr; fDataBlockPosition + pIncrement.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataBlockGet<br></span><span style="font: 10pt serif">"...returns the current data block as a Stream."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ( (Stream new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">of: (fPacket pupString)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">from: fDataBlockPosition<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">to: ( 4 + (fPacket pupLength) - 2 )<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataBlockLength<br></span><span style="font: 10pt serif">"...returns the number of bytes (an Integer) in the data block."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ((fPacket pupLength) - 42)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dataBlockLength &larr; pLength<br></span><span style="font: 10pt serif">"...sets the number of bytes in the data block to pLength (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket pupLength &larr; pLength + 42.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leader: pIndex<br></span><span style="font: 10pt serif">"...returns the leader word (an Integer) specified by pIndex (an Integer) from the packet."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (fPacket word: (12 + pIndex))<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leader: pIndex &larr; pValue<br></span><span style="font: 10pt serif">"...sets pValue (an Integer) in the packet at the leader word specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket word: (12 + pIndex) &larr; pValue.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">packet<br></span><span style="font: 10pt serif">"...returns the packet (a Pacbuf)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ fPacket<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">packet &larr; pPacket<br></span><span style="font: 10pt serif">"...sets the packet to pPacket (a Pacbuf) and resets the data block position."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket &larr; pPacket.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fDataBlockPosition &larr; 45.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pupType<br></span><span style="font: 10pt serif">"...returns the pup type (an Integer) of the packet."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (fPacket pupType)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pupType &larr; pPupType<br></span><span style="font: 10pt serif">"...sets the pup type of the packet to pPupType (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket pupType &larr; pPupType.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperParameterBlock under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperRequestParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperRequestParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: JuniperParameterBlock<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER REQUEST PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">longInteger: pPosition &larr; pValue<br></span><span style="font: 10pt serif">"...sets pValue (4 bytes of long integer) in the packet at the parameter position specified by pPosition (an Integer)."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tString tPosition<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tString &larr; fPacket pupString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPosition &larr; (pPosition + 16)*2 - 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">( (Stream new) of: tString from: tPosition to: (tPosition+3)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">) nextNumber: 4 &larr; pValue.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tString<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">swap: tPosition with: tPosition+2;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">swap: tPosition+1 with: tPosition+3.<br>]<br>"<br>1. the two words of a Juniper long integers are stored in reverse order from those in Smalltalk.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextDataBlockString &larr; pString<br></span><span style="font: 10pt serif">"...sets pString (a String) in the data block at the current position and advances the position."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tDataBlock tString tLength tMaxLength<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket pupLength &larr; 554.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tDataBlock &larr; self dataBlockGet.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tLength &larr; pString length.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tMaxLength &larr; (tLength+1) land: 0177776.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tDataBlock<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; tLength;  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; tMaxLength;  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">append: pString;  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next: (tMaxLength - tLength) &larr; 0.  "8"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self dataBlockAdvance: (4 + tMaxLength).  "9"<br>]<br>"<br>1. Set the length of the packet to the maximum size.  The length of each string in the data block is specified in the data block itself.<br>2. Get the data block (as a Stream) from the current position to the end.<br>3. Get the length of pString.<br>4. Determine the length of pString including padding needed to make its length even.<br>5. Set the length of pString in the data block (2 bytes).<br>6. Set the length of pString with padding in the data block (2 bytes).<br>7. Set pString in the data block.<br>8. Add padding in the data block.<br>9. Advance the current data block position past length, maximum length, and pString.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">opcode &larr; pOpcode<br></span><span style="font: 10pt serif">"...sets the request opcode field in the packet to pOpcode (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket word: 16 &larr; pOpcode.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">parameter: pIndex &larr; pValue<br></span><span style="font: 10pt serif">"...sets pValue (an Integer) in the packet at the request parameter field specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket word: (16+pIndex) &larr; pValue.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">shortFileHandle &larr; pShortFileHandle<br></span><span style="font: 10pt serif">"...sets the request short file handle field in the packet to pShortFileHandle (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fPacket word: 15 &larr; pShortFileHandle.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperRequestParameterBlock under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperResultParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperResultParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: JuniperParameterBlock<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>JUNIPER RESULT PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">longInteger: pPosition<br></span><span style="font: 10pt serif">"...returns the 4 bytes of long integer in the packet at the parameter position specified by pPosition (an Integer)."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tArray tPosition<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tPosition &larr; (pPosition + 15)*2 - 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tArray &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">( (Stream new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">of: (fPacket pupString) from: tPosition to: (tPosition+3)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">) next: 4.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tArray<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">swap: 1 with: 3;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">swap: 2 with: 4.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ ((tArray asStream) nextNumber: 4)<br>]<br>"<br>1. Juniper long integers are stored in reverse order from those in Smalltalk.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextDataBlockString<br></span><span style="font: 10pt serif">"...returns the string in the data block at the current position and advances the position."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| tDataBlock tString tLength tMaxLength<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tDataBlock &larr; self dataBlockGet.  "1"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tLength &larr; tDataBlock nextword.  "2"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tMaxLength &larr; tDataBlock nextword.  "3"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">tString &larr; tDataBlock next: tLength.  "4"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self dataBlockAdvance: (4 + tMaxLength).  "5"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ tString  "6"<br>]<br>"<br>1. Get the data block (as a Stream) from the current position to the end.<br>2. Get the length of the next string.<br>3. Get the length of the string including possible padding.<br>4. Get the next string from the data block.<br>5. Position the data block past the length, maximum length, string, and padding.<br>6. Return the string.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">parameter: pIndex<br></span><span style="font: 10pt serif">"...returns from the packet the result parameter (an Integer) specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (fPacket word: (15+pIndex))<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">resultCode<br></span><span style="font: 10pt serif">"...returns the result code (an Integer) from the result packet."<br>[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ (fPacket word: 15)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperResultParameterBlock under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"JuniperSocket"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;JuniperSocket&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: RetransmitSocket<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;seqNum outPac loginPending notWaiting result outAck&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A Socket for communicating with the Juniper File Server. <br>Derived from the class WSocket, jfs, 2/79.<br>see Classes WoodstockFile, WoodstockFilePage, and WoodstockFileDirectory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization/Termination</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">net: pNet host: pHost <br></span><span style="font: 10pt serif">"start with the well known Juniper listener, leave filterInput false"</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">super net: pNet host: pHost soc: 0100 asInt32.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self retransmit: 3 every: 500.  "8 sec"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outAck &larr; self freePacket.  "for the outgoing pineAck"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outAck pupType &larr; 0255.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outAck pupID1 &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outAck dataString &larr; &rsquo;&rsquo;.  "also sets length; need to set addresses later"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Socket</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sendLogin: outPac <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">Special routine to send login, wait for ack, retransmit.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Need to reset seqNum, and get new Juniper socket number.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Will return the Juniper response packet, or else a false.</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frnSocNum high: 0 low: 0100.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setOutAddBlock.  filterInput &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outPac pupID0 &larr; 0. outPac pupID1 &larr; seqNum &larr; 0.  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">loginPending &larr; true.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setAddressesAndComplete: outPac.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [notWaiting] do⦂ [ ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"all done"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑result.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sendRequest: outPac <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">General routine to send request packets, wait for ack, retransmit.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Will return the Juniper response packet, or else a false.</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">outPac pupID0 &larr; (seqNum &larr; seqNum + 1).  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setAddressesAndComplete: outPac.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [notWaiting] do⦂ [ ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"all done"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑result.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">socProcess: Ipac | temp<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">Juniper has responded, we&rsquo;re running at a high level"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">loginPending ⇒ "handle this special case"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">["watch out, src has not been checked"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">((frnNet ≠ Ipac sourceNet) or⦂ (frnHost ≠ Ipac sourceHost)) or⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">((0251 ≠ Ipac pupType) or⦂ (0 ≠ Ipac pupID0)) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">["discard it"  "Ipac &larr; self freePacket: Ipac"]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"this must be it!"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">frnSocNum high: Ipac sourceSoc0 low: Ipac sourceSoc1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setOutAddBlock. self setAddresses: outAck.  "for later use"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"generate an ack" outAck pupID0 &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self completePup: outAck.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">loginPending&larr;false.  notWaiting &larr; filterInput &larr; true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">result &larr; Ipac.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"src. and dest. should have been checked ??)"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">Ipac pupType = 0251⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"might be a retransmission of a previous Juniper response or what we want.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">acknowledge in either case then see whether we want to keep the result"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">outAck pupID0 &larr; Ipac pupID0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self completePup: outAck.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting or⦂ seqNum ≠ Ipac pupID0⇒ ["Ipac &larr; self freePacket: Ipac"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting&larr;true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">result &larr; Ipac]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Ipac pupType = 0255 ⇒ [Ipac&larr;self freePacket: Ipac]" "discard pineack"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting≡false and⦂ ((Ipac pupType = 4) and⦂ (Ipac word: 23) = 2) ⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"no socket at Juniper"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self timerOff.  notWaiting&larr;true.   result&larr;Ipac. ].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Ipac &larr; self freePacket: Ipac."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">timerFired  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">This piece of code only runs when a timer fires!<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Thus, there is mutual exclusion between this and other timer code.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Runs below the ethernet input.   Don&rsquo;t do an active return<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Timer sometimes fires even though its been disabled!</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting⇒ [] <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self timerOn⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">go ahead and retransmit.....</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self completePup: outPac<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">notWaiting &larr; true. result &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&#771;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪JuniperSocket under: &rsquo;Juniper&rsquo;.&#771;</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
