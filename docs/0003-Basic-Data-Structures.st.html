<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Basic-Data-Structures.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 5 February 2037 at 10:43:43 pm.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"Array"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Array&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Array is an abstract class in the sense that it has no state, and instantiation is consequently not meaningful.  However it defines the default message set inherited by its subclasses, notably String, Vector, and UniqueString.  Notice that subscripting is not done here, except to handle the exceptional cases such as subscripting by other types as in a◦(1 to: 3).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑x subscripts: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑x subscripts: self &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; v </span><span style="font: italic 10pt serif">"for sorting vectors by first element"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self◦1)&lt;(v◦1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= arg </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[arg isArray⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length ≠ arg length⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ x to: self length do⦂ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self◦x) = (arg◦x)⇒ [] ⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑true]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; v </span><span style="font: italic 10pt serif">"for sorting vectors by first element"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self◦1)&gt;(v◦1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">all &larr; val </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦i &larr; val]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">last<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self◦self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">last &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self◦self length &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length  </span><span style="font: 10pt serif">[user notify: &rsquo;message not understood.&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">+ arg </span><span style="font: 10pt serif">[⇑self concat: arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">concat: arg </span><span style="font: 10pt serif">| x s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self species new: self length + arg length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copyto: (s &larr; x asStream).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">arg copyto: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self copy: 1 to: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: a to: b<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self copy: a to: b to: (self species new: b-a+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: a to: b to: t </span><span style="font: 10pt serif">| i s me<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; t asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">me &larr; Stream new of: self from: a to: b.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: a to: b do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"general code wont stop at false"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s next &larr; me next]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyto: t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self copy: 1 to: self length to: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: obj </span><span style="font: 10pt serif">| s each<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ each from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[obj=each⇒[] s next&larr; each]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">grow </span><span style="font: 10pt serif">[⇑self growto: (4 max: self length*2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growby: n </span><span style="font: 10pt serif">[⇑self growto: self length + n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: n </span><span style="font: 10pt serif">[⇑self "copyto:" copy: 1 to: self length to: (self species new: n)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertNonDescending: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"self is assumed to be sorted"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self insertSorted: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertSorted: x </span><span style="font: 10pt serif">| a c i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"self is assumed to be sorted"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &larr; self findSorted: x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; (a &larr; self species new: self length+1) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦(1 to: i) copyto: c. c next &larr; x. self◦(i+1 to: self length) copyto: c.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notNil </span><span style="font: 10pt serif">| t i  </span><span style="font: italic 10pt serif">"copy self (which contains no falses) removing all nils"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; (self species new: (self length-(self count: nil))) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: self do⦂ [i≡nil ⇒[] t next&larr; i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑t asArray]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: a to: b by: s </span><span style="font: 10pt serif">| x xs<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; self species new: self length+s length -(1+b-a).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">xs &larr; x asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copy: 1 to: a-1 to: xs.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s copy: 1 to: s length to: xs.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copy: b+1 to: self length to: xs.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">without: index </span><span style="font: 10pt serif">| s me i  </span><span style="font: italic 10pt serif">"if index in range, return self without ◦index"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[index cansubscript: self⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (self species new: self length-1) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">me &larr; self asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂ [i=index⇒ [me next] s next &larr; me next].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s asArray]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">all⦂ variable suchThat⦂ expr </span><span style="font: 10pt serif">| s i x  </span><span style="font: italic 10pt serif">"a copy of some of me"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x &larr; self◦i. variable value &larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">expr eval⇒ [s next &larr; x]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">count: x </span><span style="font: 10pt serif">| i n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n&larr;0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x=(self◦i)⇒ [n&larr;n+1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">find⦂ x suchThat⦂ predicate </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x value &larr; self◦i. predicate eval⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">find: x </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦i=x⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findnon: x </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦i≠x⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findSorted: x </span><span style="font: 10pt serif">| lo mid hi</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" returns index of largest element ≤ x "<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[hi &larr; self length+1.  lo &larr; 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ lo &lt; hi do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"binary search; self must be sorted"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦(mid&larr;lo+hi/2) &gt; x⇒[hi &larr; mid]  lo &larr; mid+1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑hi-1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">" 0≤result≤length "</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">first⦂ x suchThat⦂ predicate </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x value &larr; self◦i. predicate eval⇒ [⇑self◦i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">has: x </span><span style="font: 10pt serif">[⇑(self find: x)≠0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Permutation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">permutationToSort<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return a Vector, permutation, such that self◦permutation is sorted nondescending.  Do not alter self."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑((self◦((1 to: self length) copy)) sort: 1 to: self length) map.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">promote: t </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n &larr; self find: t. n=0⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦(n to: 2 by: ¬1) &larr; self◦(n-1 to: 1 by: ¬1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦1 &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reverse</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Substring new data: self map: (self length to: 1 by: ¬1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sort<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Permute my elements so they are sorted nondescending.  Note: if I am a substring, only my map will be permuted.  In certain situations, this may not be what you expect."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self sort: 1 to: self length.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sort: i to: j </span><span style="font: 10pt serif">| di dij dj tt ij k l n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Sort elements i through j of self to be nondescending."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"The prefix d means the data at."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(n&larr;j+1-i)≤1⇒ [</span><span style="font: italic 10pt serif">"Nothing to sort."</span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Sort di,dj."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">di &larr; self◦i. dj &larr; self◦j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[di&gt;dj⇒ [self swap: i with: j. tt&larr;di. di&larr;dj. dj&larr;tt]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=2⇒ [</span><span style="font: italic 10pt serif">"They are the only two elements."</span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ij &larr; (i+j) lshift: ¬1. </span><span style="font: italic 10pt serif">"ij is the midpoint of i and j."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Sort di,dij,dj.  Make dij be their median."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dij &larr; self◦ij.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[di&gt;dij⇒ [self swap: i with: ij. dij&larr;di] dj&lt;dij⇒ [self swap: j with: ij. dij&larr;dj]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=3⇒ [</span><span style="font: italic 10pt serif">"They are the only three elements."</span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Find k&gt;i and l&lt;j such that dk,dij,dl are in reverse order.  Swap k and l.  Repeat this procedure until j and k pass each other."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">k &larr; i. l &larr; j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ self◦(l&larr;l-1) &gt; dij do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ self◦(k&larr;k+1) &lt; dij do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">k≤l<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self swap: k with: l].<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Now l&lt;k (either 1 or 2 less), and di through dl are all less than dk through dj.  Sort those two segments."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self sort: i to: l.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self sort: k to: j.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap: i with: j </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; self◦i. self◦i &larr; self◦j. self◦j &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSet </span><span style="font: 10pt serif">[⇑Set new of: self to: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Stream new of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frequencies </span><span style="font: 10pt serif">| d x  </span><span style="font: italic 10pt serif">"return a sorted vector ((freq item) (freq item) ...)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[d &larr; Dictionary new init: 64.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[d tally: x].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑d asInvertedVector sort]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sum </span><span style="font: 10pt serif">[⇑self sumTo: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sumTo: subTotal </span><span style="font: 10pt serif">| x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"add all my elements to this subTotal (usually 0 or 0.0)"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[subTotal&larr; subTotal+x].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑subTotal]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">transform⦂ each to⦂ expr </span><span style="font: 10pt serif">| s i  </span><span style="font: italic 10pt serif">"a copy of me with each element transformed"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[each value &larr; self◦i. s next &larr; expr eval].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s asArray]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">viewer </span><span style="font: 10pt serif">[⇑SetReader new of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Mapping</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cansubscript: a </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i from: self do⦂ [i cansubscript: a⇒ [] ⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"subarrays"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Substring new data: x map: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subscripts: x &larr; val</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"subrange replacement"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length≠val length⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;lengths not commensurate&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val copyto: (Substring new data: x map: self).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isArray</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isIntervalBy1<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Vector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Comparing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: italic 10pt serif">"make sure = arrays hash =ly"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length=0⇒[⇑17171]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self◦1) hash + (self◦self length) hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Array under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FieldReference"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FieldReference&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;object offset&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I reference a field of an instance</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">object: object offset: offset</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Indirection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eval <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑object instfield: offset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">value </span><span style="font: 10pt serif">[⇑object instfield: offset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">value &larr; value<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[object instfield: offset &larr; value. ⇑value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FieldReference under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Interval"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Interval&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;start stop step length&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am an arithmetic progression from start in steps of step, not exceeding stop</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">from: start to: stop by: step<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[length &larr; 1+(stop-start/step).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">step&lt;0⇒[start&lt;stop⇒[length&larr; 0]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">stop&lt;start⇒[length&larr; 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x is: Integer⇒[x&lt;1⇒ [⇑nil]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x&gt;length⇒ [⇑nil]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑start+(step*(x-1))]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Intervals are not for writing into&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">start </span><span style="font: 10pt serif">[⇑start]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">stop </span><span style="font: 10pt serif">[⇑stop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= int </span><span style="font: 10pt serif">[⇑start = int start and⦂ (stop = int stop and⦂ length = int length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cansubscript: a<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑length≤0 or⦂ ((start cansubscript: a) and⦂ (length-1*step+start cansubscript: a))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[⇑(((start lshift: 2) lxor: stop) lshift: 1) lxor: length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isIntervalBy1<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑step=1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Random Numbers</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">random</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"See Lehmers linear congruential method, Knuth Vol. 1:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">modulus m=2&uarr;16<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">a=27181 odd, and 5 = a mod 8<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">c=13849 odd, and c/m around 0.21132"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[step&larr; (13849 + (27181*step)) asSmall.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(start + ((length asFloat*(32768.0+step))/65536.0)) asSmall]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">randomInit </span><span style="font: 10pt serif">[self randomInit: mem◦0430]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">randomInit: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Call with const to get repeatable sequence"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[step&larr; x.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"step holds the current state"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">start is: Float⇒[length&larr;stop-start]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"for Float intervals"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Interval under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"ObjectReference"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ObjectReference&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;object&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am an indirect reference</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">object: object</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Indirection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eval <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">value </span><span style="font: 10pt serif">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">value &larr; object<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: &rsquo;-&gt;&rsquo;; print: object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪ObjectReference under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"RunVector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;RunVector&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo; min max starts values offset&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>RunVectors compactly store data which tends to be constant over much<br>of its domain.  They may have any range of subscript, but must be stored<br>into consecutively.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i | index</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[index&larr; starts findSorted: i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">offset&larr; i-(starts◦index).</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"distance into run"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑values◦index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i&larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[offset&larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">min≡nil⇒[min&larr; max&larr; i. starts&larr; i inVector. values&larr; val inVector]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i-1≠max⇒[user notify: &rsquo;RunVectors must be loaded sequentially&rsquo;. ⇑val]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">max&larr; i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val=values last⇒[offset&larr; i-starts last. ⇑val]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">starts&larr; starts , i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">values&larr; values , val. ⇑val]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[max≡nil⇒[⇑0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑max-min+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">max </span><span style="font: 10pt serif">[⇑max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">min </span><span style="font: 10pt serif">[⇑min]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪RunVector under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Stream"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Stream&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;array position limit&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Streams provide fast sequential access to arrays (implemented in microcode for Strings and Vectors).  A subclass can handle end conditions if desired (disk files do this).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">close<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[limit&larr; position. position&larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self of: (String new: 16)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position &larr; 0. limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array from: pos to: lim </span><span style="font: 10pt serif">| len</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[limit &larr; [lim &gt; (len &larr; array length)⇒ [len] lim].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; [pos≤1⇒ [0] pos-1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">release </span><span style="font: 10pt serif">[array &larr; nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Sequential reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">∢ x </span><span style="font: 10pt serif">| y<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[y&larr; self next⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"peek for matching element"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x=y⇒ [⇑y]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"gobble it if found"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-1. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">append: x </span><span style="font: 10pt serif">| i</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Array arg"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i from: x do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next &larr; i].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dequeue</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"use it as a FIFO"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self dequeue: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dequeue: n </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position&lt;n⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; (array◦(1 to: n)) copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">array◦(1 to: position-n) &larr; array◦(n+1 to: position).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-n. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">integerScan </span><span style="font: 10pt serif">| sign base maxdigit c val [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"get the next Integer or LargeInteger (Float?) from a Stream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">copied from String asInteger"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sign&larr; [self∢025⇒[¬1] 1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">base&larr; [self∢060⇒[8] 10].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">maxdigit&larr; 060+base.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; 0.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((c &larr; self next) and⦂ (c ≥ 060 and⦂ c &lt; maxdigit)) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; val*base+(c-060)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c⇒ [self skip: ¬1]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"Some special maneuvering to keep 01ddddd and ¬32768 (and nothing else)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">from overflowing."<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">base=8 and⦂ (val&gt;077777 and⦂ (sign=1 and⦂ val&lt;65536))⇒[⇑val asSmall]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(val*sign) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">into: x </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"generate an error if the Stream is exhausted before x is filled"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self into: x endError: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span style="font: bold 10pt serif">into: x endError: err </span><span style="font: 10pt serif">| i t len [</span><span style="font: italic 10pt serif">"Array result"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; x length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"read until count or stream is exhausted"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (i &lt; len and⦂ (t &larr; self next)) do⦂ [x◦(i&larr;i+1) &larr;t].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">err⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t⇒ [⇑x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;only read first &rsquo; + i asString]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"return number that were read"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"simple result"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self myend⇒ [⇑self pastend]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑array◦(position &larr; position+1)] primitive: 17</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next: n </span><span style="font: 10pt serif">[⇑self into: (array species new: n) endError: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next: n from: strm </span><span style="font: 10pt serif">[for⦂ n to: n do⦂ [self next &larr; strm next]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next: n &larr; v </span><span style="font: 10pt serif">[for⦂ n to: n do⦂ [self next &larr; v]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextNumber: n </span><span style="font: 10pt serif">| i s t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return next n characters s as a positive Integer or LargeInteger</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">scan for first non-zero byte, then collect rest appropriately</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: n do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; self next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s⇒ ["</span><span style="font: italic 10pt serif">more LargeInteger: reverse order of significance</span><span style="font: 10pt serif">" s◦(n+1-i) &larr; t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i=n⇒ [⇑t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=0⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i ≤ (n-2) or⦂ "i=n-1" (t land: 0200) ≠ 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">LargeInteger of 2 or more bytes</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; Natural new: n+1-i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s last &larr; t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">positive Integer</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(t lshift: 8) + self next].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑LargeInteger new bytes: s neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextNumber: n &larr; v </span><span style="font: 10pt serif">| vlen [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">write a positive Integer or LargeInteger as n characters</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; v bytes.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vlen &larr; v length.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n &lt; vlen⇒ [user notify: &rsquo;number too big&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt; vlen⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">pad beginning with 0&rsquo;s</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next: n - vlen &larr; 0]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vlen = 1⇒ [self next &larr; v]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">vlen = 2 and⦂ (v is: Integer)⇒ [self nextword &larr; v]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">LargeInteger (assume pos, no negative convention)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self append: v reverse]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextPoint </span><span style="font: 10pt serif">| x [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self nextword.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Point new x: x y: self nextword]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextPoint&larr;p </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self nextword &larr; p x;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextword &larr; p y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextString </span><span style="font: 10pt serif">| len [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self into: (String new: [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(len &larr; self next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&lt;192⇒[len]</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"up to 191 chars (BCPL compat)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len-192*256 + self next]) endError: true]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"up to 16383 chars"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextString&larr; s </span><span style="font: 10pt serif">| len [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(len &larr; s length) &lt; 192⇒[self next&larr; len]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next&larr; len/256+192; next&larr; len\256].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self append: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextword </span><span style="font: 10pt serif">| hi lo<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[hi &larr; self next⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[lo &larr; self next⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(hi lshift: 8)+lo]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nextword&larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; val lshift: ¬8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next&larr; val land: 0377. ⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next &larr; x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"simple arg"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self myend⇒ [⇑self pastend &larr; x]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑array◦(position &larr; position+1) &larr; x] primitive: 18</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">padNext </span><span style="font: 10pt serif">["make position even (on word boundary), returning padding character if any"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position even⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">padNext&larr; c </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position even⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next&larr; c]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">peek </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x&larr; self next⇒ [position &larr; position-1.  ⇑x]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"peek at next element"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pop</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"use it as a LIFO"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position&lt;1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-1. ⇑array◦(position+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pop: n </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position&lt;n⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; self last: n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-n. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">upto: x </span><span style="font: 10pt serif">| y s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; (String new: 250) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ y from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[y=x⇒[⇑s contents]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s next &larr; y].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Test and alter position</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">empty</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"for"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position=0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">end<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position≥limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">limit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">loc</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"synonym for compiler"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">myend<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position≥limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend &larr; x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array &larr; array grow. limit &larr; array length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position&larr; position</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">settoend </span><span style="font: 10pt serif">[position&larr; limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skip: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position &larr; position+x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipTo: x </span><span style="font: 10pt serif">| y [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ y from: self do⦂ [y=x⇒[⇑true]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skipwords: w </span><span style="font: 10pt serif">[self skip: 2*w]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">wordposition </span><span style="font: 10pt serif">[⇑self position/2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">wordposition&larr; w </span><span style="font: 10pt serif">[self position&larr; w*2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Static reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑array◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑array◦x &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">[⇑array copy: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">first<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position ≠ 0 ⇒ [⇑array◦1] ⇑nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: x </span><span style="font: 10pt serif">| i  </span><span style="font: italic 10pt serif">"treat as LIFO queue, insert in front"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">grow array if necessary</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [position=limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array&larr;array grow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">limit&larr;array length]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦(position-i+2) &larr; array◦(position-i+1)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">array◦1 &larr; x.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position&larr;position+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">last<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position≠ 0 ⇒ [⇑array◦position] ⇑nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">last: n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(array◦(position-n+1 to: position)) copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rest </span><span style="font: 10pt serif">[⇑array copy: position+1 to: limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Character printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cr<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next &larr; 015]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">crtab: n </span><span style="font: 10pt serif">| i</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr;13.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: n do⦂ [self next&larr;9]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">print: obj<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[obj printon: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">semicrtab<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self append: &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next &larr; 040]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next &larr; 011]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Coercions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asArray<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑array]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asReadStream </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"an alternative to Set/SetReader.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">create another Stream which reads the contents of this one"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Stream new of: array from: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asVector </span><span style="font: italic 10pt serif">"Convert a string to a vector of tokens"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(Reader new of: self) read]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">viewer </span><span style="font: 10pt serif">[⇑SetReader new of: array from: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compiler object code</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitLong: jmpOrBfp by: dist<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[dist&lt;0⇒ [dist&larr;dist+1024]; &gt;1023⇒ [dist&larr;¬1] jmpOrBfp&larr;jmpOrBfp+4].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dist&lt;0⇒ [user notify: &rsquo;A block compiles more than 1K bytes of code&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next &larr; dist/256 + jmpOrBfp. self next &larr; dist\256]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Stream under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"PQueue"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;PQueue&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;readposition&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A PQueue is a First In First Out list of objects implemented as an array and a read pointer and write pointer. PQueue is a subclass of Stream and uses Streamⓢstandard method for inserting a new item (next&larr;, i.e. Streamⓢposition is the write pointer). A PQueue also has a read pointer which it uses for accessing objects with the messages next or dequeue (which are identical). All messages to a PQueue that change its state are declared as critical sections to avoid race conditions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dequeue: num </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position-readposition &lt; num ⇒ [n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; (array◦(readposition+1 to: readposition + num)) copy.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> readposition &larr; readposition + num].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">| l<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [l &larr; position-readposition]. ⇑l]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">myend </span><span style="font: 10pt serif">[⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition≥position⇒ [readposition&larr;position&larr;0. n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; array◦(readposition &larr; readposition+1)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n] primitive: 98</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend &larr; x</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"> </span><span style="font: 10pt serif">| n i</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"simple arg"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position≥limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition=0⇒[super pastend &larr; x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; position-readposition.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i to: n do⦂ [array◦i &larr; array◦(readposition+i)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> readposition &larr; 0. position &larr; n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self next &larr; x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> array◦(position &larr; position+1) &larr; x].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">peek </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition≥position⇒ [readposition&larr;position&larr;0. n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; array◦(readposition + 1)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skip: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [readposition &larr; readposition+x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>LIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">push: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"treat as LIFO queue"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition &gt; 0 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦readposition &larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> readposition &larr; readposition - 1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"readpositon &gt; 0, just jam it in"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> self insert: x]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"otherwise insert on front"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Stream protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [n &larr; (array◦(readposition+1 to: position)) copy]. ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">empty </span><span style="font: 10pt serif">| l<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [l &larr; readposition≥position]. ⇑l] primitive: 99</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">end </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [n &larr; readposition≥position]. ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [position &larr; 0. readposition &larr; 0. limit &larr; array length]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array from: position to: limit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;of:from:to: is not appropriate for PQueues&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [readposition &larr; position &larr; 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪PQueue under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Queue"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Queue&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;readposition&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>A Queue is a First In First Out list of objects implemented as an array and a read pointer and write pointer. Queue is a subclass of Stream and uses Streamⓢstandard method for inserting a new item (next&larr;, i.e. Streamⓢposition is the write pointer). A Queue also has a read pointer which it uses for accessing objects with the messages next or dequeue (which are identical)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>FIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">deQ1 </span><span style="font: 10pt serif">| n</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"A noninterruptable dequeue"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [n &larr; self dequeue].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dequeue<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑array◦(readposition &larr; readposition+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dequeue: num </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position-readposition &lt; num ⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; (array◦(readposition+1 to: readposition + num)) copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> readposition &larr; readposition + num.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">enQ1: n</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"A noninterruptable enqueue"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[Top critical⦂ [super next&larr; n].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑position-readposition]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑array◦(readposition &larr; readposition+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">peek<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑array◦(readposition + 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">skip: x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition &larr; readposition+x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>LIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">push: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"treat as LIFO queue"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition &gt; 0 ⇒<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦readposition &larr; x.  readposition &larr; readposition - 1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"readpositon &gt; 0, just jam it in"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self insert: x]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"otherwise insert on front"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Stream protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(array◦(readposition+1 to: position)) copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">empty<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑readposition≥position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">end<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑readposition≥position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position &larr; 0. readposition &larr; 0. limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array from: position to: limit<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;of:from:to: is not appropriate for Queues&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend &larr; x </span><span style="font: 10pt serif">| n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition=0⇒[⇑super pastend &larr; x]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> n &larr; position-readposition.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> array◦(1 to: n) &larr; array◦(readposition+1 to: position).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> readposition &larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> position &larr; n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">reset<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[readposition &larr; position &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Queue under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Set"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Set&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;views&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>For storing/collecting, read by a SetReader.<br>Use no messages from Stream except of:, empty, next&larr;, contents, space, nextword&larr;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default </span><span style="font: 10pt serif">[self vector: 8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array to: position </span><span style="font: 10pt serif">[limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">string: limit </span><span style="font: 10pt serif">[self of: (String new: limit)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">vector: limit </span><span style="font: 10pt serif">[self of: (Vector new: limit)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Index operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i </span><span style="font: 10pt serif">[⇑array◦("self checkIndex:" i)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦i &larr; val </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position+1 = i⇒ [self next &larr; val]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑array◦("self checkIndex:" i) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">deleteI: i </span><span style="font: 10pt serif">| v j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; self◦i.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ j from: i to: position-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦j &larr; array◦(j+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">array◦position &larr; nil.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">deleteI: i to: j</span><span style="font: 10pt serif">| n k<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; j-i+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ k from: i to: position-n do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦k &larr; array◦(k+n)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ k from: position-n+1 to: position do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦k &larr; nil<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-n.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insertI: i value: v </span><span style="font: 10pt serif">| old j <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i &gt; position ⇒ [ self next &larr; v ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">old&larr;array.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[position = limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[limit&larr; limit+(10 max: limit/4).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">array &larr; array species new: limit.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ j to: i-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦j &larr; old◦j<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ j from: position  to: i by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[array◦(j+1) &larr; old◦j<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">array◦i &larr; v.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position  &larr; position +1<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Value operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">add: x  </span><span style="font: 10pt serif">[self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">append: x  </span><span style="font: 10pt serif">[for⦂ x from: x do⦂ [self next &larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">delete: x </span><span style="font: 10pt serif">| i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">array◦i ≡ x⇒ [⇑self deleteI: i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">find: v </span><span style="font: 10pt serif">| i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂ [array◦i = v⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">has: x </span><span style="font: 10pt serif">[⇑(self find: x) &gt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">insert: x </span><span style="font: 10pt serif">[(self find: x) = 0⇒ [self next&larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Viewing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSet</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">[⇑self viewer]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[⇑self viewer copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">initView: v </span><span style="font: 10pt serif">[⇑v of: array to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notViewed: v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">views delete: v;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">empty⇒ [views &larr; nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;a Set: &rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">array is: String⇒ [strm append: self]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ t from: self do⦂ [strm space; print: t]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species </span><span style="font: 10pt serif">[⇑array species]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">viewer </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑SetReader new of: array from: 1 to: position<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self viewRange: 1 to: position"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">viewer: v </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[views≡nil⇒ [views &larr; Set default]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">views next &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">viewRange: i to: j </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑"self viewer:" (<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">SetReader new of: array from: (i "max: 1") to: (j "min: position"))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checkIndex: i </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i ≥ 1 and⦂ i ≤ position⇒ [⇑i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑user notify: &rsquo;illegal index&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">grow </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self grown and reset. returns another Set with old contents"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self growby: (10 max: limit/4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growby: n | old </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"grow and reset self. return old Set for copying"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">old &larr; Set new of: array to: position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self of: (array species new: limit+n) to: 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑old]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next </span><span style="font: 10pt serif">[user notify: &rsquo;no direct reading of a Set&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pastend &larr; x </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[self append: self grow; next &larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Arithmetic operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dotproduct: s </span><span style="font: 10pt serif">| i dotproduct<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["dot product of two sets ... sets must be of equal length"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dotproduct &larr; 0.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length = s length ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂ [dotproduct &larr; dotproduct + ((s◦i)*(self◦i))].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ dotproduct  <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;dot product undefined...sets are not of equal length&rsquo;. <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">product: s </span><span style="font: 10pt serif">| product i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["product of two sets ... sets must be of equal length"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">product &larr; Set new default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self length = s length ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂ [product add: (s◦i)*(self◦i)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ product<br>  <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;product undefined...sets are not of equal length&rsquo;. <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">summation</span><span style="font: 10pt serif">| i summation<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["sum of the values in the set"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">summation &larr; 0.0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: position do⦂ [summation &larr; summation + (self◦i)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ summation<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Set under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"SetReader"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;SetReader&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Read a Set; no edits occur to set. (see Steve for ISetReader (interruptible))<br>Inherit of:from:to:, next, next:, end, pastend, skip:, ∢, asStream, viewer</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: array from: position for: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; position-1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">limit &larr; position+n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asSet </span><span style="font: 10pt serif">[⇑self copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">"yield contents all at once as a Set" [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑[Set new of: (array species new: limit-position); append: self]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"how much left"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑limit-position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪SetReader under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"String"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;String&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;StringBlter &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">bytesize: 8;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am an array of bytes, integers between 0 and 255 usually representing ascii characters</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">all&larr; val </span><span style="font: 10pt serif">[self fill: 1 to: self length with: val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fill: a to: b with: val </span><span style="font: 10pt serif">| i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"eventually use BitBlt?"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: a to: b do⦂ [self◦i &larr; val]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑self length </span><span style="font: italic 10pt serif">"In case this is reached by perform:"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"read word in String"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self◦(x+x) + (self◦(x+x-1) lshift: 8)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">word: x &larr; y</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"write word in String"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦(x+x-1) &larr; y lshift: ¬8.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦(x+x) &larr; y land: 0377. ⇑y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">concat: s </span><span style="font: 10pt serif">| len [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(len &larr; self length) + s length &gt; 20 and⦂ (s Is: String)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"this concatenates more quickly if BitBlt is used"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self replace: len+1 to: len by: s from: 1 to: s length]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super concat: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: a to: b </span><span style="font: 10pt serif">[⇑(self species new: 1+b-a) copy: 1 to: 1+b-a with: self from: a to: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: a to: b with: s from: c to: d </span><span style="font: 10pt serif">| i [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">like replace, except in place. self◦(a to: b) &larr; s◦(c to: d).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">use BitBlt unless size too small, StringBlter≡false, or index/sizes too large</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(b-a &gt; 12 and⦂ StringBlter) and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt new stringCopy: self from: a to: b with: s from: c to: d)⇒ []<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ≡ s and⦂ (c &lt; a and⦂ d ≥ a)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">overlap of second range with below first in same string.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">copy in reverse order: self◦(b to: a by: ¬1) &larr; self◦(d to: c by: ¬1)</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: b-a to: 0 by: ¬1 do⦂ [self◦(a+i) &larr; self◦(c+i)]]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s copy: c to: d to: (Stream new of: self from: a to: b)]</span><span class="tab" val="79"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findString: str startingAt: start </span><span style="font: 10pt serif">| i t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[str length=0⇒[⇑0] t&larr; str◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: start to: self length-str length+1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦i=t⇒[self◦(i to: i+str length-1)=str⇒[⇑i]]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">growto: n </span><span style="font: 10pt serif">| len [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(len &larr; self length) ≤ n⇒ [] len &larr; n].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self species new: n) copy: 1 to: len with: self from: 1 to: len]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: a to: b by: s <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s Is: String ⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self replace: a to: b by: s from: 1 to: s length]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self replace: a to: b by: s asArray from: 1 to: s position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: a to: b by: r from: c to: d </span><span style="font: 10pt serif">| s t [</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; self species new: self length + (d-c) - (b-a).<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">use BitBlt unless StringBlter≡false or index/sizes too large</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">StringBlter and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">BitBlt new stringReplace: s with: self from: a to: b and: r from: c to: d)⇒ [⇑s]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">see Array concat:</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; Stream new of: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copy: 1 to: a-1 to: t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">r copy: c to: d to: t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self copy: b+1 to: self length to: t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subst: repl for: key </span><span style="font: 10pt serif">| key1 i nskip result<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nskip &larr; 0. key1 &larr; key◦1. result &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" the Boyer Slow string replacement "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nskip&gt;0⇒ [nskip &larr; nskip-1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self◦i = key1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self◦(i to: (self length min: i+key length-1)) = key⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[result append: repl. nskip &larr; key length-1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">result next&larr; self◦i]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">result next&larr; self◦i]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑result contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Comparison</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">- s </span><span style="font: 10pt serif">| i c ldiff</span><span class="tab" val="79"></span><span style="font: 10pt serif"> [<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Return a negative, zero, or positive integer as I compare &lt; = or &gt; s"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"The collation sequence is ascii with case differences ignored."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(ldiff &larr; self length-s length) &lt; 0⇒ [self length] s length] do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(c&larr; UpperCase◦(self◦i + 1) -(UpperCase◦(s◦i + 1)))<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">≠0⇒ [⇑c]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑ldiff]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&lt; s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return true iff I collate before s.  The collation sequence is ascii with case differences ignored."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self compare: s) = 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">&gt; s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return true iff I collate after s.  The collation sequence is ascii with case differences ignored."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(self compare: s) = 3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">compare: s </span><span style="font: 10pt serif">| i len lcomp u1 u2 [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lcomp &larr; [self length &lt; (len &larr; s length)⇒ [len &larr; self length. 1]; =len⇒ [2] 3].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: len do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(u1 &larr; UpperCase◦(self◦i + 1)) = (u2 &larr; UpperCase◦(s◦i + 1))⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">u1 &lt; u2⇒ [⇑1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑3]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑lcomp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">| l m<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(l&larr; m&larr; self length)≤2⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[l=2⇒[m&larr;3]; =1⇒[⇑((self◦1) land: 0177)*0152] ⇑052525]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑(self◦1)*060+(self◦(m-1)+l)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">match: text </span><span style="font: 10pt serif">| star pound pattern scanning p t back [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">star &larr; 052 "*".  pound &larr; 043 "#".<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pattern &larr; self asStream.  text &larr; text asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">scanning &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ true do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(p &larr; pattern next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=star⇒ [pattern end⇒ [⇑true] scanning &larr; pattern position]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; text next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">≡false⇒ [⇑t≡p]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">p≡false⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">scanning⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">back &larr; scanning - pattern position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pattern skip: back. text skip: back]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">UpperCase◦(t+1) = (UpperCase◦(p+1)) or⦂ p=pound⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">scanning⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">back &larr; scanning - pattern position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pattern skip: back. text skip: back+1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">systemRehash </span><span style="font: 10pt serif">| dicts d left loop<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["change the meaning of hash for Strings"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">String understands:</span><span style="font: bold 10pt serif"><br></span><span style="font: 10pt serif">&rsquo;</span><span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">| l m<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[(l&larr; m&larr; self length)≤2⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[l=2⇒[m&larr;3]; =1⇒[⇑((self◦1) land: 0177)*0152] ⇑052525]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑(self◦1)*060+(self◦(m-1)+l)]&rsquo;.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"rehash the atom table"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ↪a rehash.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"rehash all dictionaries which have strings in them"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> dicts &larr; HashSet allInstances+Dictionary allInstances<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">+SymbolTable allInstances.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ d from: dicts do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[left &larr; d objects asStream. loop &larr; left next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> while⦂ loop do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[loop is: String⇒[d rehash. loop &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> loop &larr; left next]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asBytes </span><span style="font: 10pt serif">| s c<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s append: c base8; space]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asDecimalDigits </span><span style="font: italic 10pt serif">"Not asInteger, because the result may be a Float if it&rsquo;s too big"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| strm sign c val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sign&larr; strm∢025.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; [self length&gt;4⇒[0.0]0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: strm do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c&lt;060 or: c&gt;071⇒[user notify: self + &rsquo; isn&rsquo;&rsquo;t a valid integer&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; val*10+(c-060)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sign⇒[⇑val*¬1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFileName </span><span style="font: 10pt serif">[⇑dp0 checkName: self fixing: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asFloat </span><span style="font: 10pt serif">| strm int frac exp<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">int&larr; strm upto: 056.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frac&larr; strm upto: 0145.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp&larr; strm rest asInteger - frac length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">int&larr; (int concat: frac) asDecimalDigits asFloat.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">exp=0⇒[⇑int];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;0⇒[⇑int*(10.0 ipow: exp)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑int/(10.0 ipow: 0-exp)<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asInteger </span><span style="font: 10pt serif">| strm sign base maxdigit c val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sign&larr; [strm∢025⇒[¬1]1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">base&larr; [strm∢060⇒[8]10]. maxdigit&larr; 060+base.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: strm do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c&lt;060 or: c≥maxdigit⇒[user notify: self + &rsquo; isn&rsquo;&rsquo;t a valid Integer&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&larr; val*base+(c-060)]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Some special maneuvering to keep 01ddddd and ¬32768 (and nothing else) from overflowing."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[val&gt;077777⇒[base=8⇒[sign=1⇒[val&lt;65536⇒[⇑val asSmall]]]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(val*sign) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asLarge </span><span style="font: 10pt serif">"convert to a LargeInteger"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">| neg i large large10<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[self◦1=025⇒[neg&larr;true] neg&larr;false].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> large &larr; 0 asLarge. large10 &larr; 10 asLarge.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i from: [neg⇒[2]1] to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[large &larr; (large*large10)+(self◦i-060)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> neg⇒[⇑large negated] ⇑large]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraph<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Paragraph new text: self alignment: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asUppercase </span><span style="font: 10pt serif">| s c<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ c from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s next &larr; UpperCase◦(c+1)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asVector<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self asStream asVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">base8: i  </span><span style="font: italic 10pt serif">"word: i  in base 8 as a String"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self word: i) base8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hasBeenUniqued<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑↪a hasInterned: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| x</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"print inside string quotes"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm next&larr; 047.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm next&larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x=047⇒[strm next&larr; x]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"imbedded quotes get doubled"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm next&larr; 047]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unique </span><span style="font: 10pt serif">| u</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"copy and intern"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑↪a intern: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑String]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>System primitives</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lock </span><span style="font: 10pt serif">[] primitive: 31</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unlock </span><span style="font: 10pt serif">[] primitive: 32</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪String under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Substring"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Substring&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;data map&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am an array that consists of a set of elements (specified by map) of an array (data)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">data: data map: map</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑data◦(map◦x)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦ x &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑data◦(map◦x) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑map length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">map<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return my map."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑map]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">swap: i with: j </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"By permuting my map (a writable Array), swap elements i and j."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; map◦i. map◦i &larr; map◦j. map◦j &larr; t.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[map isIntervalBy1⇒</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"direct stream for simple substrings"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑Stream new of: data from: map start to: map stop]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Stream new of: self from: 1 to: map length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatability</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑data species]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Substring under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"UniqueString"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;UniqueString&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: String<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">bytesize: 8;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am a string that is unequal to every other instance of my subclass</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">| i a v</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"make up table of 1-char atoms"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; Vector new: 128. a &larr; String new: 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 128 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a◦1 &larr; i-1. v◦i &larr; a unique]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">UST1 &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hasInterned: s </span><span style="font: 10pt serif">| h i v n<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"⇑false if String s hasnt been interned, else ⇑s unique"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[s length=1⇒[s◦1&lt;128⇒[⇑UST1◦(s◦1+1)]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h&larr; s hash.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; USTable◦(h\USTable length+1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr; h\v length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ n to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v◦i≡nil⇒</span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s length=(v◦i) length⇒ [s=(v◦i)⇒[⇑v◦i]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr; [i=v length⇒[1] i+1]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;USTable is jammed&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">intern: s </span><span style="font: 10pt serif">| h i j v n</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span class="tab" val="79"></span><span style="font: 10pt serif">[s length=1⇒[s◦1&lt;128⇒[⇑UST1◦(s◦1+1)]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">h&larr; [s is: String⇒[s hash] s stringhash].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; USTable◦(h\USTable length+1).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr; h\v length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ n to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v◦i≡nil⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"empty slot"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n&larr; ¬4.  for⦂ j from: v do⦂ [j≡nil⇒ [n &larr; n+4]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &lt; v length⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"grow bucket if &gt; 3/4 full"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[USTable◦(h\USTable length+1) &larr; Vector new: 2*v length.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ n from: v do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"rehash all its contents"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n≡nil⇒ [] self intern: n]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self intern: s]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑v◦i &larr; [s is: UniqueString⇒[s]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"install new entry"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(UniqueString new: s length) str: s]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s length=(v◦i) length⇒ [s=(v◦i)⇒[⇑v◦i]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr; [i=v length⇒[1] i+1]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user notify: &rsquo;USTable is jammed&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rehash </span><span style="font: 10pt serif">| oldTable v i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldTable &larr; USTable.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> USTable &larr; Vector new: oldTable length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ i to: USTable length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[USTable◦i &larr; Vector new: 4].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> for⦂ v from: oldTable do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ i from: v do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i≡nil⇒[] self intern: i]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">str: s </span><span style="font: 10pt serif">| j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ j to: s length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[super◦j &larr; s◦j]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unique</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦x &larr; val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;UniqueStrings are not for writing into&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Selectors</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isarrow</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"> </span><span style="font: italic 10pt serif">"ends with &larr;"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length≤1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self◦self length=95]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isinfix </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length≠1⇒ [⇑false]  ⇑(self◦1) isletter≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">iskeyword </span><span style="font: 10pt serif">| x</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"ends with colon"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self length≤1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; self◦self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">x=072⇒[⇑true] ⇑x=03]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">isuneval </span><span style="font: 10pt serif">| x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"ends with open colon"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self◦self length=03]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">keywords  </span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">return a vector of the keywords that compose me</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| result strm i l char colon ocolon<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[&rsquo;◦&larr;&rsquo;=self⇒[⇑↪(&rsquo;◦&rsquo; &rsquo;&larr;&rsquo;)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">result&larr;(Vector new: 10) asStream.  strm&larr;Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">colon&larr;&rsquo;:&rsquo;◦1.  ocolon&larr;&rsquo;⦂&rsquo;◦1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr;1.  l&larr;self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ i≤l do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char&larr;self◦i.  strm append: char.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> [(char=colon or⦂ char=ocolon) or⦂ i=l⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[result next&larr; strm contents.  strm reset]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i&larr;i+1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑result contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mustTake: nargs </span><span style="font: italic 10pt serif">"fatal error if I am not a selector that takes nargs arguments"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self numArgs≠nargs⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: self + &rsquo; does not take &rsquo; + nargs asString + &rsquo; arguments&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">numArgs  </span><span style="font: 10pt serif">| len n i </span><span style="font: italic 10pt serif">"the number of arguments I take when I am a selector"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[len &larr; self length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len=1⇒ [⇑[(self◦1) isletter⇒ [0] 1]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; 0. </span><span style="font: italic 10pt serif">"count colons, dots, and arrows"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: len do⦂ [self◦i=072⇒ [n&larr;n+1]; =03⇒ [n&larr;n+1]; =0137⇒[n&larr;n+1]; =07⇒[n&larr;n+1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Comparison</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">= x </span><span style="font: 10pt serif">[⇑self≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hash </span><span style="font: 10pt serif">[] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">stringhash<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑super hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">recopy </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">species<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑String]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asString<br></span><span style="font: 10pt serif">[⇑super copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪UniqueString under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">UniqueString classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Vector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">VariableLengthClass new title: &rsquo;Vector&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Vector is a VariableLengthClass.  The length of a Vector may not be less than 0,<br>nor may it be greater than 8196.  <br>A field of a Vector may contain any other object.<br>A new Vector contains nil in every field.  <br>To create a new Vector of length 8, say:<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">Vector new: 8<br><br>Microcode Primitives<br>◦ x   "subscript"<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">[0 &gt; x or: x &gt; self length ⇒[user notify: &rsquo;Subscript out of bounds&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">x class ≡ Integer ⇒[Return the xth element of the Vector]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">⇑ super ◦ x]<br>◦ x &larr; val  "assign value to element"<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">[0 &gt; x or: x &gt; self length ⇒[user notify: &rsquo;Subscript out of bounds&rsquo;]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">x class ≡ Integer ⇒[Store the value val as the xth element. ⇑val]<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">⇑ super ◦ x &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: italic 10pt serif">"This is actually done in microcode"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self length </span><span style="font: italic 10pt serif">"perform: needs this"</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">, x </span><span style="font: 10pt serif">| v<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[v &larr; self growby: 1.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"use a stream if youre in a hurry"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">v last &larr; x. ⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">max</span><span style="font: 10pt serif">| biggest i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[biggest &larr; self◦1.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return largest value in a vector"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(self◦i) &gt; biggest ⇒[biggest &larr; self◦i]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> ⇑biggest]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asVector</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">printon: strm </span><span style="font: 10pt serif">| i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm append: &rsquo;(&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[strm print: self◦i; space]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm append: &rsquo;)&rsquo; ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>System primitives</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nail </span><span style="font: 10pt serif">[user croak] primitive: 31</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Nail me in core and return my core address"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unNail </span><span style="font: 10pt serif">[user croak] primitive: 32</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Release me from being nailed"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Compiler argument list</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">argsOff: stack<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[stack pop: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">emitForValue: code on: stack  </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ x from: self do⦂ [x emitForValue: code on: stack]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">firstPush<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑(self◦1) firstPush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">remote: generator  </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[for⦂ x from: self do⦂ [x remote: generator]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">sizeForValue  </span><span style="font: 10pt serif">| size x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[size &larr; 0. for⦂ x from: self do⦂ [size &larr; size+ x sizeForValue]. ⇑size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Vector under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
