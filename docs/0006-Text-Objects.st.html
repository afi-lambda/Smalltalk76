<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Text-Objects.st</title>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">"Dispframe"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Dispframe&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Stream<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;text&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;prompt doit &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am a dialog window</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[prompt &larr; &rsquo;&#64257;&rsquo;◦1. doit &larr; &rsquo;&rsquo;◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame &larr; r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[text para: nil frame: r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">init<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[text &larr; Textframe new.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self of: (String new: 16)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rect: r<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self init; frame &larr; r; clear]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Scheduler</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">eachtime </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[text window has: user mp⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user kbck⇒[t&larr; self kbd⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ [t≡nil⇒[] self space; print: nilⓢ t].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self prompt]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> user bluebug⇒ [⇑false]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user anybug⇒[⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">firsttime<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[text window has: user mp⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self outline; prompt]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lasttime<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ [self last=prompt⇒[self skip: ¬2; show]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑user bluebug≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leave</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Dialog</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ev </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ [self cr. t &larr; self request: &rsquo;&rsquo;] do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self space; print: nil ⓢt]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbd </span><span style="font: 10pt serif">| n t</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"false if user pauses, nil if ctrl-d, all input since prompt if "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂ user kbck do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; user kbd.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=132⇒ [self append: &rsquo;done.&rsquo;; show. ⇑nil]; </span><span style="font: italic 10pt serif">"ctl-d for done"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=8⇒ [self last=prompt⇒[] self skip: ¬1]; </span><span style="font: italic 10pt serif">"backspace"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=30⇒ [n &larr; array◦(position to: 1 by:¬1) find: prompt.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">n=0⇒[self append: &rsquo;lost beginning&rsquo;; prompt]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t&larr; self last: n-1. self next&larr; doit; show. ⇑t];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> </span><span style="font: italic 10pt serif">"do-it (LF)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=145⇒ [self last=prompt⇒[] self skip: ¬1.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"ctl-w for backspace word"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (position&gt;0 and: self last tokenish) do⦂ [self skip: ¬1]];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=151⇒[self reset; prompt] </span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"ctl-x clears frame"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self next &larr; t]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self show. ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">prompt </span><span style="font: 10pt serif">[self cr; next&larr; prompt; show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read </span><span style="font: 10pt serif">| t</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"false if ctrl-d, all input since prompt if "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; prompt; show.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [user kbck⇒[t&larr; self kbd] false] do⦂ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t≡nil⇒[⇑false] ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">request: s</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"false if ctrl-d, all input since prompt if "</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self append: s. ⇑self read]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Image</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">clear<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self reset. self show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">moveto: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(text window inset: ¬2⌾¬2) dragto: pt-(¬2⌾¬2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">outline<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[text window outline: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show </span><span style="font: 10pt serif">| t [</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text show: self contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ text lastshown≥ position do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &lt; (t &larr; text scrolln: 1)⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; array copy: t+1 to: position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">text show: t.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">position &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self append: t.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self dequeue: (text scrolln: 1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">text show: self contents"]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access to Parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑text frame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">text<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑text]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Dispframe under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Dispframe classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Paragraph"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Paragraph&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Array<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;text runs alignment&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Paragraphs implement pretty text.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">text is a String of the ascii characters.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">alignment specifies how the paragraph should be justified.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">runs is a String of run-coded format information.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">odd byte is run length (≤255)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">following byte is 16*format number +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">1*bold 2*italic 4*underline 8*strikeout<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">longer runs are made from several of length 255.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization of parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[⇑self class new text: text runs: runs alignment: alignment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">text: text<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[alignment &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">text: text alignment: alignment</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">text: text runs: runs alignment: alignment</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Normal access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">◦x </span><span style="font: 10pt serif">[⇑text◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraph </span><span style="font: 10pt serif">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asStream </span><span style="font: 10pt serif">[⇑text asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asVector </span><span style="font: 10pt serif">[⇑text asVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy: a to: b</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">Return a copied subrange of this paragraph</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self class new<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">text: (text copy: a to: b)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs: (self run: a to: b)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">alignment: alignment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findString: str startingAt: start<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑text findString: str startingAt: start]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">length </span><span style="font: 10pt serif">[⇑text length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: a to: b by: c   </span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"alters self - doesnt copy"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[runs≡nil and⦂ (c isnt: self class)⇒[]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs &larr; self runcat: (self run: 1 to: a-1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">and: [c is: self class⇒ [c runs]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self makerun: c length val: [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs empty⇒[0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs◦((self runfind: b)◦1+1)]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">and: (self run: b+1 to: text length)].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text &larr; text replace: a to: b by: [c is: self class⇒[c text] c]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">subst: x for: y </span><span style="font: italic 10pt serif">"runs are not supported yet here"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑text subst: x for: y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">text </span><span style="font: 10pt serif">[⇑text]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">textStyle </span><span style="font: 10pt serif">[⇑DefaultTextStyle]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Text alignment</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">alignment </span><span style="font: 10pt serif">[⇑alignment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">alignment &larr; alignment</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">center </span><span style="font: 10pt serif">[alignment &larr; 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">flushleft </span><span style="font: 10pt serif">[alignment &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">flushright </span><span style="font: 10pt serif">[alignment &larr; 4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">justify </span><span style="font: 10pt serif">[alignment &larr; 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Manipulation of format runs</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allBold </span><span style="font: 10pt serif">[self maskrunsunder: 1 to: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allFont: n </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n is: String⇒ [n &larr; (self textStyle fontnames find: n) - 1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self maskrunsunder: 0360 to: n*16]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">allItalic </span><span style="font: 10pt serif">[self maskrunsunder: 2 to: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">makeBoldPattern </span><span style="font: 10pt serif">| s i c<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s &larr; text asStream.  i&larr; 0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ [c&larr; s next⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">" scan to bracket, bar or comment "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c=91⇒[true]; =124⇒[true]; =34⇒[true]; =25⇒[true] false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">true]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"end"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [i&larr; i+1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self maskrun: 1 to: i under: 1 to: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">makerun: len val: val</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Make up a solid run of value val"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| str i<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[len=0⇒[⇑nullString]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">str &larr; String new: len-1/255+1*2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: 1 to: str length by: 2 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">str◦i &larr; [len&gt;255⇒[255] len].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">str◦(i+1) &larr; val.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; len-255].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑str]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maskrun: i to: j under: m to: val </span><span style="font: italic 10pt serif">"Alter my runs so that the bits selected by m become val."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| r k</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Maybe merge this with mergestyle"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r &larr; self run: i to: j.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ k from: 2 to: r length by: 2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r◦k &larr; (r◦k land: 0377-m) + val].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs &larr; self runcat: (self run: 1 to: i-1) and: r and: (self run: j+1 to: text length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maskrunsunder: m to: val<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self maskrun: 1 to: text length under: m to: val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">run: a to: b </span><span style="font: 10pt serif">| c</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"subrange of run"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[a&gt;b⇒[⇑nullString]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs≡nil⇒[⇑self makerun: 1+b-a val: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a &larr; self runfind: a.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">b &larr; self runfind: b.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; runs copy: a◦1 to: b◦1+1.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"copy the sub-run"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(a◦1)=(b◦1)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c◦1 &larr; 1+ (b◦2)-(a◦2)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c◦1 &larr; 1+(runs◦(a◦1))- (a◦2).</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"trim the end lengths"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c◦(c length-1) &larr; b◦2].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑c]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">runcat: r1 and: r2 and: r3 </span><span style="font: 10pt serif">| i r olen len oc c nr [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">concatenate and compact 3 runs</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nr &larr; Stream new of: (String new: 30).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">oc &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i to: 3 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; [i=1⇒ [r1]; =2⇒ [r2] r3].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r length=0⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; r asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (len &larr; r next) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c &larr; r next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len = 0⇒ ["</span><span style="font: italic 10pt serif">ignore empty runs (shouldn&rsquo;t be any)</span><span style="font: 10pt serif">"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">oc = c⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(olen &larr; olen+len) ≤ 255⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nr next &larr; 255; next &larr; oc.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">olen &larr; olen-255]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oc⇒ [nr next &larr; olen; next &larr; oc] "</span><span style="font: italic 10pt serif">first time thru</span><span style="font: 10pt serif">"].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">olen &larr; len. oc &larr; c]].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oc⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">leftovers</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nr next &larr; olen; next &larr; oc]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑nr contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">runcat: x to: y </span><span style="font: 10pt serif">[⇑self runcat: x and: y and: &rsquo;&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">runfind: index </span><span style="font: 10pt serif">| run</span><span class="tab" val="79"></span><span style="font: 10pt serif">t</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"index into run"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[run&larr;1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (t &larr; index - (runs◦run)) &gt; 0 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[index &larr; t. run &larr; run+2].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑run,index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">runs</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"return runs or default if none"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[runs≡nil⇒[⇑self makerun: text length val: 0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑runs]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Bravo conversions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">applyBravo: s at: i to: j</span><span class="tab" val="79"></span><span style="font: 10pt serif">| v ch t bslash cr [<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Alter runs of characters i through j according to trailer.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">see Ibis&lt;Bravo&gt;Trailer.Memo for further info.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">some functions may not be implemented, thus parsed and ignored</span><span style="font: 10pt serif">.<br><br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">paragraph looks.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">implemented: justification (j), centering (c).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">ignored: left margin (l), first line left margin (d), right margin (z),<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">line leading (x), paragraph leading (e), vertical tab (y), keep (k), profile (q),<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">tab tables ( () )</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; s asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">cr &larr; 015.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bslash &larr; &rsquo;\&rsquo;◦1.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (ch &larr; s next) = bslash do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">ch ≡ false or⦂ ch = cr⇒ ["</span><span style="font: italic 10pt serif">no more</span><span style="font: 10pt serif">" ⇑self]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; &rsquo;jcq&rsquo; find: ch) &gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=1⇒ [self justify]; =2⇒ [self center]]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; &rsquo;(ldzxeyk&rsquo; find: ch) &gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=1⇒ [s skipTo: &rsquo;)&rsquo;◦1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s integerScan]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">character looks.<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">implemented: font (f), bold (bB), italic (iI), underline (uU).<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">ignored: graphic (g), visible (v), overstrike (s), superscript (o), tabcolor (t)"<br></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ ((ch &larr; s next) and⦂ ch ≠ cr) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">run length</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ch ≥ 060 and⦂ ch ≤ 071 "isdigit"⇒ [s skip: ¬1] ch = 040]⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">i &larr; i + s integerScan]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; &rsquo;bBiIuU&rsquo; find: ch) &gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self maskrun: i to: j under: ↪(1 1 2 2 4 4)◦t to: ↪(1 0 2 0 4 0)◦t]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(t &larr; &rsquo;fot&rsquo; find: ch) &gt; 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">new value follows</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">v &larr; s integerScan.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=1⇒ [self maskrun: i to: j under: 0360 to: (v lshift: 4)]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">bravoRuns: s </span><span style="font: italic 10pt serif">"Encode the runs in a Bravo paragraph trailer onto a Stream"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| i old len dif new bit bits<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["assume Ctrl-Z is already there"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s append: [alignment=1⇒[&rsquo;j\g&rsquo;]; =2⇒[&rsquo;c\g&rsquo;] &rsquo;\g&rsquo;].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[runs≡nil ⇒ []<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; 0. old &larr; 0400.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bits &larr; ↪(1 2 4).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: 1 to: runs length by: 2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dif &larr; old lxor: (new &larr; runs◦(i+1)).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dif land: 0367)=0 ⇒ </span><span style="font: italic 10pt serif">"No changes"</span><span style="font: 10pt serif"> [len &larr; len+(runs◦i)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[i=1⇒[] len printon: s].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ bit to: 3 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(dif land: bits◦bit)=0 ⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s next &larr; ([(new land: bits◦bit)≠0 ⇒ [&rsquo;biu&rsquo;] &rsquo;BIU&rsquo;])◦bit].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(dif land: 0360)≠0 ⇒ </span><span style="font: italic 10pt serif">"Font change"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s append: &rsquo;f&rsquo;; print: (new lshift: ¬4); space]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">old &larr; new.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; runs◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s cr]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromBravo </span><span style="font: italic 10pt serif">"Find Bravo trailers and return a copy of self with them applied"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">| newpara newtext loc i j<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[newpara &larr; self copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">loc &larr; 1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (i &larr; (newtext &larr; newpara text) find: 032)≠0 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[j &larr; newtext◦(i+1 to: newtext length) find: 015.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">newpara applyBravo: newtext◦(i+1 to: i+j) at: loc to: i-1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">newpara replace: i to: [i+j=newtext length⇒[i+j] i+j-1] by: &rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">loc &larr; i+1]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑newpara]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">toBravo </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; (String new: text length*2) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s append: text; next &larr; 032.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self bravoRuns: s.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Press printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromPress: press value: s </span><span style="font: 10pt serif">| len x [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s next=0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">text is in DL</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; s nextword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">amount to skip from where we are now to end of text</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x &larr; [s limit &gt; 255⇒ ["</span><span style="font: italic 10pt serif">control info came from DL</span><span style="font: 10pt serif">" s limit] "</span><span style="font: italic 10pt serif">from EL</span><span style="font: 10pt serif">" 0].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press data skip: 0-x-len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">text &larr;  press data next: len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press data skip: x]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text &larr; s nextString].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs &larr; s nextString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">alignment &larr; s next.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs empty⇒ [runs &larr; nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hideData: complete </span><span style="font: 10pt serif">| s [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; Stream new of: (String new: 150).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s next &larr; complete.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[complete=0⇒ [s nextword &larr; text length] s nextString &larr; text].<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s nextString&larr; [runs≡nil⇒ [nullString] runs];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">next&larr; alignment.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hidePress: press complete: c </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">not called by Form-Path-Image, but probably by Class printout</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">press skipcode: self pressCode data: (self hideData: c)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">pressCode </span><span style="font: 10pt serif">[⇑99]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">presson: press in: r </span><span style="font: 10pt serif">[⇑self presson: press in: r style: self textStyle]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">presson: press in: r style: style </span><span style="font: 10pt serif">| char pos s3 y chop [<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Output paragraph inside rectangle (page coordinates)"</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"probably ParagraphScanner should handle this"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text length &gt; 0 and⦂ text◦1 = 014⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"formfeed --&gt; page break"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self copy: 2 to: text length]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">y &larr; r corner y.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"We change corner y later"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s3 &larr; ParagraphScanner new of: self to: press style: style.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s3 init in: r.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pos &larr; s3 position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">chop &larr; [alignment=1⇒ [0] alignment].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (y and⦂ (char &larr; s3 scan)) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char = 011 ⇒ [s3 tab]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char = 040 or⦂ char = 015 ⇒</span><span class="tab" val="79"></span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"carriage return or exceeded max width and backed up to blank"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">y &larr; s3 printfrom: pos aligned: [char=040⇒[alignment] chop] skip: 1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r corner y &larr; y. s3 init in: r. pos &larr; s3 position]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char ≡ true ⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"exceeded max width with no blanks in line"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">s3 backup.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">y &larr; s3 printfrom: pos aligned: 0 skip: 0⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[r corner y &larr; y. s3 init in: r. pos &larr; s3 position]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"user notify: &rsquo;unimplemented control char&rsquo;"</span><span style="font: 10pt serif">].<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Put out trailing text if any"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">y and⦂ ((pos=s3 position) or⦂ (y &larr; s3 printfrom: pos aligned: chop skip: 0))⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">press append: text.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑y]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">press append: text◦(1 to: pos).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self copy: pos + 1 to: text length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Filing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readFrom: file </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">text &larr; file nextString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs &larr; file nextString.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">alignment &larr; file next.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">runs empty⇒ [runs &larr; nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">storeOn: file </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file nextString &larr; text.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[runs≡nil⇒ [file next &larr; 0] file nextString &larr; runs].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file next &larr; alignment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Paragraph under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Reader"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Reader&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;source collector token nextchar typetbl &rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;typetable &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Converts a string to tokens.  The collector defines what to do for each kind of token: see TokenCollector and Compressor for examples.  (P. Deutsch)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">| strm type first last i </span><span style="font: italic 10pt serif">"Initialize the type and mask tables"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[typetable&larr; String new: 256.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">strm&larr; Stream new of: ↪(<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">5 0 0377  </span><span style="font: italic 10pt serif">"(initialize)"</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">1 0101 0132  1 0141 0172  </span><span style="font: italic 10pt serif">"upper and lower case letters"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">2 060 071  </span><span style="font: italic 10pt serif">"digits"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">3 072 072  3 03 03  </span><span style="font: italic 10pt serif">"colon, open colon"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">4 011 012  4 014 015  4 040 040  </span><span style="font: italic 10pt serif">"TAB, LF, FF, CR, blank"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"5 is one-char tokens"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">6 042 042  6 031 031  </span><span style="font: italic 10pt serif">"comment quote and ➲"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">7 047 047  </span><span style="font: italic 10pt serif">"string quote"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">8 025 025  </span><span style="font: italic 10pt serif">"high-minus"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">9 032 032  </span><span style="font: italic 10pt serif">"&uarr;Z (format trailer)"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">10 036 036  </span><span style="font: italic 10pt serif">"DOIT"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">11 050 051  </span><span style="font: italic 10pt serif">"open and close paren"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (type&larr; strm next) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[first&larr; strm next. last&larr; strm next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ i from: (first+1 to: last+1) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[typetable◦i&larr; type]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">of: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[typetbl&larr; typetable.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">token&larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">source&larr; s asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self step]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Main reader</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">read<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self readInto: TokenCollector default]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readatom: ncolons </span><span style="font: 10pt serif">| type s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[token reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [token next&larr; nextchar.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(nextchar&larr; source next)⇒[(type&larr; typetbl◦(nextchar+1))≤3]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[type=3⇒[ncolons&larr; ncolons+1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s&larr; token contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">ncolons=0⇒[collector identifier: s];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">&gt;1⇒[collector otheratom: s].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s length=1⇒[collector otheratom: s] </span><span style="font: italic 10pt serif">": or ⦂ alone"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s◦s length=072⇒[collector keyword: s];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=03⇒[collector keyword: s].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">collector otheratom: s. </span><span style="font: italic 10pt serif">"Colon wasn&rsquo;t last character"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readInto: collector </span><span style="font: 10pt serif">| x <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[while⦂  nextchar  do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x&larr; typetbl◦(nextchar+1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"See classInit for the meanings of the type codes"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">x=4⇒ [collector separator: nextchar. nextchar&larr; source next];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=1⇒ [self readatom: 0];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=5⇒ [collector onechar: nextchar. nextchar&larr; source next];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=6⇒ [self upto: nextchar⇒[collector notify: &rsquo;Unmatched comment quote&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">collector comment: token contents];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=2⇒ [self readnum];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=11⇒ [[nextchar=050⇒[collector leftparen] collector rightparen].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextchar&larr; source next];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=7⇒ [self upto: nextchar⇒[collector notify: &rsquo;Unmatched string quote&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">collector string: token contents];</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=8⇒ [self readnum];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=9⇒ [self upto: 015⇒[collector notify: &rsquo;&uarr;Z without CR&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">collector trailer: token contents];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=10⇒ [⇑collector contents];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=3⇒ [self readatom: 1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑collector contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">readnum </span><span style="font: 10pt serif">| val d e<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[val&larr; self rdint: 025.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextchar=056⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"check for decimal point"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self step.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextchar≡false or⦂ nextchar isdigit≡false⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[collector integer: val.  collector onechar: 056]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"was &lt;Integer&gt; .  "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">d&larr; self rdint: ¬1.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"fraction part"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nextchar=0145⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"check for e&lt;exponent&gt; "</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self step.  e&larr; self rdint: 025]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">e&larr; &rsquo;&rsquo;].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">collector float: val fraction: d exp: e]<br> </span><span class="tab" val="79"></span><span style="font: 10pt serif">collector integer: val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Internal readers</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rdint: char </span><span style="font: italic 10pt serif">"Read an integer, allow char as first char"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[token reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nextchar=char⇒[token next&larr; char. self step]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ nextchar do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nextchar&lt;060⇒[⇑token contents]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">nextchar&gt;071⇒[⇑token contents]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">token next&larr; nextchar. nextchar&larr; source next].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑token contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">step<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[nextchar&larr; source next]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">upto: char </span><span style="font: 10pt serif">| start </span><span style="font: italic 10pt serif">"Knows about doubled &rsquo; in strings"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[start&larr; source position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">token reset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (nextchar&larr; source next) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[[nextchar=char⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self step. char≠047⇒[⇑false] nextchar≠047⇒[⇑false]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">token next&larr; nextchar].<br></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Ran off end, back up."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">source skip: start - 1 - source position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Reader under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">Reader classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"RemoteParagraph"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;RemoteParagraph&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;file hipos lowpos&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>These instances refer to text stored on a file, typically residing on a remote<br>machine and accessed via the ether.  The representation has been chosen for<br>compactness, and the bias of ¬1000 keeps the two parts of the position in the<br>range of small integers (¬1024 to 1022) to reduce allocation and paging of objects.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asParagraph </span><span style="font: 10pt serif">[</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">file position &larr; self position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑Paragraph new readFrom: file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asString </span><span style="font: 10pt serif">[⇑self asParagraph text]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromParagraph: p </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">write me (only once!) on file</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self position &larr; file position.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">p storeOn: file]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fromString: s </span><span style="font: 10pt serif">[self fromParagraph: s asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">on: file</span><span class="tab" val="79"></span><span style="font: 10pt serif">"Refer me to a specific file"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position </span><span style="font: 10pt serif">[⇑(hipos+1000)*2000 + (lowpos+1000)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">position&larr; p<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[p &larr; p intdiv: 2000.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">hipos&larr; (p◦1) asInteger -1000.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lowpos&larr; (p◦2) asInteger -1000]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪RemoteParagraph under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"Textframe"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;Textframe&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;frame para style reply1 reply2 window&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I display a paragraph on the screen in a frame clipped by a window</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">para: para frame: frame<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[window&larr;frame.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">reply1&larr;reply2&larr;0.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">style&larr;DefaultTextStyle]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">para: para frame: frame style: style<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[window&larr;frame.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">reply1&larr;reply2&larr;0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">style: style</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Scheduling</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">aboutToFrame<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"My frame is about to change.  I dont care."</span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">takeCursor<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Move the cursor to the center of my window."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user cursorloc &larr; window center]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Image</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">asForm: pt </span><span style="font: 10pt serif">| char ul ur f<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"put bits of character into a form -- when Form package in system"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char &larr; self charofpt: pt. ul &larr; reply1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ptofchar: char + 1. ur &larr; reply1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f &larr; Form new size: ur x - ul x by: reply2 y - reply1 y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">f translate: ul; scale: 1. ⇑f ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">comp<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[window comp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copyto: path effect: effect </span><span style="font: 10pt serif">| i oldmode</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"show clipped inside rect"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">path is: Point ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldmode &larr; style mode. style mode: effect. window translateto: path. self show. style mode: oldmode.]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">path is: Path ⇒ [for⦂ i to: path length do⦂ [ self copyto: path◦i effect: effect] ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">corner </span><span style="font: 10pt serif">[⇑frame corner]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">displayat: path effect: effect clippedBy: cliprect</span><span style="font: 10pt serif">| i oldmode </span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"show clipped inside rect"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[  <br></span><span class="tab" val="79"></span><span style="font: 10pt serif">path is: Point ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldmode &larr; style mode. style mode: effect. frame translateto: path. window &larr; cliprect. self show. style mode: oldmode.  ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">path is: Path ⇒ [for⦂ i to: path length do⦂ [ self displayat: path◦i effect: effect] ]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">erase<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[(window inset: (¬2⌾¬2)) clear]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">extent </span><span style="font: 10pt serif">[⇑frame extent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame </span><span style="font: 10pt serif">[⇑frame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame &larr; frame<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Change my frame and window."</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; frame.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">height </span><span style="font: 10pt serif">[⇑frame height]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">origin </span><span style="font: 10pt serif">[⇑frame origin]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">outline<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[window border: 2 color: black]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">para </span><span style="font: 10pt serif">[⇑para]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showin: rect </span><span style="font: 10pt serif">| old</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"show clipped inside rect"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[old &larr; window. window &larr; rect. self show. window &larr; old]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">size </span><span style="font: 10pt serif">[⇑frame extent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">style </span><span style="font: 10pt serif">[⇑style]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">width </span><span style="font: 10pt serif">[⇑frame width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">window </span><span style="font: 10pt serif">[⇑window]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Text</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">charnearpt: pt </span><span style="font: 10pt serif">[user croak] primitive: 58</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">charofpt: pt </span><span style="font: 10pt serif">[user croak] primitive: 58</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">dopressjst: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"For building justified lines in Press Format files<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">[reply1 x &larr; trailingbits.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">reply1 y &larr; internalspaces.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">reply2 y &larr; heightofline.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">[reply2 x &lt; 0 ⇒[linenotjustified]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">⇑lastcharinline]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">user will have to back up in string to find last printing character<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">(at least non-space, cr, or tab)"</span><span style="font: 10pt serif"><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user croak] primitive: 64</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">findmaxx: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char is: Integer⇒[user croak]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self findmaxx: char asInteger] primitive: 63</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lastshown<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑reply1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lineheight<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑style lineheight]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxx: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self findmaxx: char. ⇑ reply1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">measuretext: startx to: stopx string: string from: first to: last font: font<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["Returns character index of character immediately following character<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">causing exception condition.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Reply1</span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">Exception code.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">1</span><span class="tab" val="79"></span><span style="font: 10pt serif">Encountered space, cr, tab, or ascii 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">2</span><span class="tab" val="79"></span><span style="font: 10pt serif">Crossed stopx.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">3</span><span class="tab" val="79"></span><span style="font: 10pt serif">Both 1 and 2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">4</span><span class="tab" val="79"></span><span style="font: 10pt serif">Encountered last before hitting stopx or special character.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Reply2</span><span class="tab" val="79"></span><span style="font: 10pt serif">=</span><span class="tab" val="79"></span><span style="font: 10pt serif">Leftx of character causing exception condition."<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user croak] primitive: 103</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ptofchar: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self selectchar: char. ⇑reply1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">ptofpt: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self charnearpt: pt. ⇑reply1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">put: para at: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self put: para at: pt centered: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">put: para at: pt centered: center<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para &larr; para asParagraph.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; frame &larr; pt rect: 1000⌾1000.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self ptofchar: para length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window growto: reply2 + (4⌾0).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[center⇒ [window moveby: pt-window center]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; window inset: ¬3⌾¬2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window clear: white. self show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">put: para at: pt maxextent: maxextent<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para &larr; para asParagraph.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; frame &larr; Rectangle new origin: pt extent: maxextent.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self findmaxx: para length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window growto: reply2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; window inset: ¬3⌾¬2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window clear: white. self show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">put: para centered: pt<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self put: para at: pt centered: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rectofchar: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self selectchar: char. ⇑reply1 rect: reply2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scrolln: n<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑self charofpt: frame corner x ⌾ (frame origin y+(n*style lineheight))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectchar: char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char is: Integer⇒[user croak]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self selectchar: char asInteger] primitive: 59</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show </span><span style="font: 10pt serif">[user croak] primitive: 57</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show: para<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para &larr; para asParagraph. self show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">showline: first to: last lastx: lastx spaces: spaces trailingspaces: trailingspaces startrun: startrun firstrunlength: firstrunlength<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">["For use in conjunction with </span><span style="font: bold 10pt serif">measuretext</span><span style="font: 10pt serif"> primitive.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Characters </span><span style="font: bold 10pt serif">first</span><span style="font: 10pt serif"> through </span><span style="font: bold 10pt serif">last</span><span style="font: 10pt serif"> will be displayed, clipped by the </span><span style="font: bold 10pt serif">frame</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">and </span><span style="font: bold 10pt serif">window</span><span style="font: 10pt serif">.  The </span><span style="font: bold 10pt serif">lastx</span><span style="font: 10pt serif"> should be the lastx of </span><span style="font: bold 10pt serif">last</span><span style="font: 10pt serif">.  If justification<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">is on in </span><span style="font: bold 10pt serif">para</span><span style="font: 10pt serif"> and </span><span style="font: bold 10pt serif">spaces</span><span style="font: 10pt serif"> is &gt; 0, the line will be justified.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">Passing </span><span style="font: bold 10pt serif">spaces</span><span style="font: 10pt serif"> as 0 causes suppression of justificaton even if<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">justification is turned on in </span><span style="font: bold 10pt serif">para</span><span style="font: 10pt serif">; space characters will be displayed<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">normally even when </span><span style="font: bold 10pt serif">spaces</span><span style="font: 10pt serif"> is 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">Trailingspaces</span><span style="font: 10pt serif"> is needed for justification.  </span><span style="font: bold 10pt serif">Startrun</span><span style="font: 10pt serif"> is an integer index<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">into the runs, indicating which run to start on.  </span><span style="font: bold 10pt serif">Firstrunlength</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">is the number of characters remaining in run </span><span style="font: bold 10pt serif">startrun</span><span style="font: 10pt serif">.  Note that<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while runs in a paragraph are allocated as a string, </span><span style="font: bold 10pt serif">startrun</span><span style="font: 10pt serif"> will<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">be considered a word index.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 10pt serif">maxascent</span><span style="font: 10pt serif"> and </span><span style="font: bold 10pt serif">maxdescent</span><span style="font: 10pt serif"> in </span><span style="font: bold 10pt serif">style</span><span style="font: 10pt serif"> must be nonnil to avoid a croak."<br><br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user croak] primitive: 104</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">makeParagraph </span><span style="font: 10pt serif">["</span><span style="font: italic 10pt serif">simulate ListPane for hardcopy</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">para≡nil⇒ [para &larr; &rsquo;NIL !&rsquo; asParagraph]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hardcopy </span><span style="font: 10pt serif">| pf [user displayoffwhile⦂ [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pf &larr; dp0 pressfile: &rsquo;frame.press&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window hardcopy: pf.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self hardcopy: pf.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">pf close; toPrinter]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">hardcopy: pf </span><span style="font: 10pt serif">| r first last lasty len parag left right top bottom [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[para≡nil⇒ [self makeParagraph]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parag &larr; para asParagraph.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame=window⇒ [parag presson: pf in: (pf transrect: window) style: style]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">left &larr; frame minX max: window minX.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">right &larr; window maxX min: frame maxX.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">bottom &larr; window maxY min: frame maxY.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">top &larr; window minY max: frame minY.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">lasty &larr; top + 4. "slop for char finding and making print rect larger"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">first &larr; self charofpt: left+1 ⌾ lasty.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">len &larr; parag length.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame minX ≥ left and⦂ frame maxX ≤ right⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"paragraph is inset and may be scrolled"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(parag copy: first to: len) presson: pf in: (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">pf transrect: (left ⌾ top rect: right ⌾ (bottom+4))) style: style]<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">yuk, frame extends left or right so do it a line at a time for clipping</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (first &lt; len and⦂ lasty &lt; bottom) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">last &larr; (self charofpt: right-1 ⌾ lasty) min: len.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">r &larr; self rectofchar: last.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">lasty &larr; lasty + r height.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(parag copy: first to: last) presson: pf in:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(pf transrect: (left ⌾ (r minY) rect: right ⌾ lasty)) style: style.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">first &larr; last+1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪Textframe under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"ParagraphEditor"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;ParagraphEditor&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: TextImage<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;oldEntity sel&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;on off &rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>This version of ParagraphEditor (for use in CodePanes) is based on TextImage</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Scheduling</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">enter </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">begintypein &larr; false.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self show; select]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leave </span><span style="font: 10pt serif">[self complement: off]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Editing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">again  </span><span style="font: 10pt serif">| many<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[many&larr; user leftShiftKey.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self fintype⇒ [Scrap &larr; Scrap text. self select]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">many⇒[while⦂ self againOnce do⦂ []]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self againOnce⇒[] frame flash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">againOnce  </span><span style="font: 10pt serif">| t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t &larr; para findString: Deletion startingAt: c2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=0⇒ [⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self unselect.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2 &larr; c1 + Deletion length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self replace: Scrap; selectAndScroll]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">copy </span><span style="font: 10pt serif">[Scrap &larr; self selection]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">cut </span><span style="font: 10pt serif">[self fintype; replace: nullString; complement. Scrap &larr; Deletion]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">paste </span><span style="font: 10pt serif">[self fintype; replace: Scrap; selectAndScroll]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">realign </span><span style="font: 10pt serif">[self align. sel &larr; on]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">undo </span><span style="font: 10pt serif">[self fintype; replace: Deletion; complement]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Public Messages</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: 10pt serif">[⇑para]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Deletion &larr; s </span><span style="font: 10pt serif">[Deletion &larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fixframe: f </span><span style="font: 10pt serif">| dy  [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dy &larr; [frame≡nil⇒ [0] self frameoffset].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; f copy.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame &larr; Rectangle new origin: window origin + (2⌾dy)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif"> extent: window width-4 ⌾ 9999.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑window]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">formerly </span><span style="font: 10pt serif">[⇑oldEntity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">formerly: oldEntity</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frame&larr; f </span><span style="font: 10pt serif">[self fixframe: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">kbd </span><span style="font: 10pt serif">| more char "key struck on the keyboard"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c1&lt;c2 and⦂ self checklooks⇒[⇑self show complement]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">more &larr; Set new string: 16.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[begintypein⇒[] Deletion &larr; self selection. begintypein &larr; c1].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (char &larr; user kbdnext) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">char<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=bs⇒ ["</span><span style="font: italic 10pt serif">backspace</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">more empty⇒ [begintypein &larr; begintypein min: (c1 &larr; 1 max: c1-1)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">more skip: ¬1];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=cut⇒ [self fintype. [c1=c2⇒[c2&larr; c1+1 min: para length+1]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self replace: nullString; complement. Scrap &larr; Deletion. ⇑self];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=paste⇒ [⇑self paste];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=ctlw⇒ ["</span><span style="font: italic 10pt serif">ctl-w for backspace word</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[more empty⇒ [] self replace: more. more reset. c1 &larr; c2].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; 1 max: c1-1.</span><span class="tab" val="79"></span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [c1&gt;1 and⦂ (para◦(c1-1)) tokenish] do⦂ [c1 &larr; c1-1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">begintypein &larr; begintypein min: c1];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">=esc⇒ ["</span><span style="font: italic 10pt serif">select previous type-in</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[more empty⇒[self unselect]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self replace: more. c1 &larr; c2].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">self fintype.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; c2-Scrap length.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑self complement]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">just a normal character</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">more next&larr; char].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self replace: more.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; c2.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self selectAndScroll]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">keyset</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">Scrap &larr; s </span><span style="font: 10pt serif">[Scrap &larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scrollby: n </span><span style="font: 10pt serif">| oldw [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n &larr; (n * self lineheight) max: self frameoffset.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">frame moveby: 0⌾(0-n).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">n abs ≥ window height⇒ [self show; select]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">need only to reshow part of window</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">oldw &larr; window.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; [n &lt; 0⇒ [window inset: 0⌾0 and: 0⌾(0-n)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">window inset: 0⌾n and: 0⌾0].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window blt: window origin - (0⌾n) mode: storing.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[n&lt;0⇒ [window corner y &larr; window origin y - n]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window origin y &larr; window corner y - n].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self show; select.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">window &larr; oldw]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scrollPos </span><span style="font: 10pt serif">| t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; self height - self lineheight.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=0⇒ [⇑0.0]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑0.0 - self frameoffset / t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scrollTo: f </span><span style="font: 10pt serif">[self scrollUp: self frameoffset + (f* self height) - 4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">scrollUp: n </span><span style="font: 10pt serif">[self scrollby: n/self lineheight]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">select: t </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self complement: off.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; c2 &larr; t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self selectAndScroll]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectAndScroll </span><span style="font: 10pt serif">| l dy c1y [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">l &larr; self lineheight.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self select.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1y &larr; (self ptofchar: c1) y.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dy &larr; c1y - window minY.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dy ≥ 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dy &larr; c1y + l - 1 - window maxY max: 0]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dy≠ 0⇒ [self scrollby: (dy abs+l-1) / l * dy sign]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selecting </span><span style="font: 10pt serif">| pt t [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; self charofpt: (pt &larr; user mp).<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self complement: off; fintype.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t=c1 and⦂ c1=c2⇒ [  "bugged hairline - maybe double-bug"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [user redbug and⦂ t=(self charofpt: user mp)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">do⦂ [].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"wait for unclick or drawing selection"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">user redbug≡false⇒[self selectword; select. ⇑true]]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel &larr; on.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑super select: pt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selection </span><span style="font: 10pt serif">[para text empty⇒ [⇑para copy] ⇑para copy: c1 to: c2-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectionAsStream </span><span style="font: 10pt serif">[⇑Stream new of: para text from: c1 to: c2-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">show </span><span style="font: 10pt serif">[self primshow. sel &larr; off]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">typing </span><span style="font: 10pt serif">[self kbd]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">unselect </span><span style="font: 10pt serif">[self complement: off]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">checklooks </span><span style="font: 10pt serif">| t val mask [<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t &larr; ↪(166 150 137 151   230 214 201 215<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">135 159 144 143 128 127 129 131 180 149<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">199 223 208 207 192 191 240 226) find: user kbck.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=0⇒[⇑false]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">user kbd.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldEntity⇒[] oldEntity &larr; para. para &larr; para copy].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">t=25⇒[para &larr; para toBravo]; "ctl-T" <br></span><span class="tab" val="79"></span><span style="font: 10pt serif"> =26⇒[para &larr; para fromBravo]. "ctl-F" <br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">val &larr; ↪(1 2 4 256   ¬1 ¬2 ¬4 256  "ctl-b i - x   B I ¬ X"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">0 16 32 48 64 80 96 112 128 144  "ctl-0 1 ... 9"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">160 176 192 208 224 240)◦t.  "ctl-shift-0 1 ... 5"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[val=256⇒[mask&larr; 0377.  val&larr; 0]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"reset all"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&lt;0⇒[mask&larr; 0-val.  val&larr; 0]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"reset emphasis"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">val&gt;0 and⦂ val&lt;16⇒[mask&larr; val]</span><span class="tab" val="79"></span><span style="font: 10pt serif">"set emphasis"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">mask&larr; 0360].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"set font"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">para maskrun: c1 to: c2-1 under: mask to: val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">classInit </span><span style="font: 10pt serif">[on &larr; 1. off &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">complement </span><span style="font: 10pt serif">[self complement: on]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">complement: nsel </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nsel = sel⇒ ["already that way"]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">nsel = on and⦂ (user rawkbck or⦂ user redbug)⇒ ["slippage"]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel &larr; nsel.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self reversefrom: c1 to: c2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">frameoffset </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"a useful number"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑frame minY - window minY]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">height </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self selectchar: para length+1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑reply2 y - frame minY]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">primshow </span><span style="font: 10pt serif">[user croak] primitive: 57</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">replace: t </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[oldEntity⇒ [] oldEntity &larr; para. para &larr; para copy].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[begintypein⇒ [] Deletion &larr; self selection].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">para replace: c1 to: c2-1 by: t.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2 &larr; c1 + t length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self show]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">select </span><span style="font: 10pt serif">[self selectIn: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectIn: w </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sel &larr; off.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c1≡nil⇒ [c1 &larr; c2 &larr; 1]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self complement: on]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectRange </span><span style="font: 10pt serif">[⇑c1 to: c2-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectRange: r </span><span style="font: 10pt serif">[<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self complement: off"<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1 &larr; r start.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">c2 &larr; r stop<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">"self complement: on"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">selectword </span><span style="font: 10pt serif">| a b dir t level open close s slen<br>[<br>"</span><span style="font: italic 10pt serif">Select bracketed or word range, as a result of double-bug.</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">a&larr; b&larr; dir&larr; ¬1.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; para text.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">slen &larr; s length.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">level &larr; 1.<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">open &larr; &rsquo;([{&lt;&rsquo;&rsquo;"<br>&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">close &larr; &rsquo;)]}&gt;&rsquo;&rsquo;"<br>&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[c1≤1⇒[dir&larr;1. t&larr;c1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">c1&gt; slen⇒[t&larr;c1-1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t&larr;open find: (a&larr; para◦(c1-1)). t&gt;0⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">delim on left</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dir&larr;1. b&larr;close◦t. t&larr;c1-1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">match to the right</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">t&larr;close find: (a&larr; para◦c1). t&gt;0⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">delim on right</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[dir&larr;¬1. b&larr;open◦t. t&larr;c1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">match to the left</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a&larr; ¬1. t&larr;c1].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">no delims - select a token</span><span style="font: 10pt serif">"<br><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">until⦂ (level=0 or⦂ [dir=1⇒[t≥slen] t≤1]) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[s◦(t&larr; t+dir) = b⇒ [level&larr; level-1];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">leaving nest</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">= a⇒ [level&larr; level+1].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">entering nest</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">a=¬1⇒[(s◦t) tokenish⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">token check goes left </span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[t=1⇒[c1&larr; dir&larr; 1. t&larr; c2]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir=¬1⇒[c1 &larr; t+1. dir&larr;1. t&larr;c2-1]</span><span class="tab" val="79"></span><span style="font: 10pt serif">"</span><span style="font: italic 10pt serif">then right</span><span style="font: 10pt serif">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">level&larr; 0]]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[level≠0⇒[t&larr; t+dir]].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">dir=1⇒[c2&larr; t min: slen+1] c1&larr; t+1<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪ParagraphEditor under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">ParagraphEditor classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"TextStyle"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;TextStyle&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;fonts "&lt;Vector of Strings or Integers&gt; which are the fonts.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">An integer entry has a vertical offset in the high 8 bits, a 1 in<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">the 200-bit for descent, and another font number (zero-relative)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">in the bottom 4 bits"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">tabandspace "&lt;Integer&gt; =256*tabwidth + spacewidth"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">maxascent "&lt;Integer&gt; max ascent for this fontset"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">maxdescent "&lt;Integer&gt; max descent for this fontset"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">mode "&lt;Integer&gt; =0 for normal, =4 for white-on-black"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fontnames "&lt;Vector of Strings&gt; corresponding to the fonts"&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>I am a specification of how to display a paragraph.  I include a font set, a tab spacing, a space size, etc.  If I do not specify ascent and descent from the baseline, then each line displayed will adjust to its tallest characters.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tabandspace &larr; mode &larr; 0. self mode: 0; tab: 20; space: 5.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fonts &larr; Vector new: 16. fontnames &larr; Vector new: 16.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setfont: 0 name: &rsquo;CREAM10&rsquo;.</span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Put default font in font 0"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mode<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ mode]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">mode: mode</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ (tabandspace land: 0377)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">space: t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tabandspace &larr; (tabandspace land: 0177400) + (t land: 0377)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ ((tabandspace land: 0177400) lshift: ¬8)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">tab: t<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[tabandspace &larr; (tabandspace land: 0377) + (t lshift: 8)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Fonts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fontfamily: n </span><span style="font: 10pt serif">| s char<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"return the family name taken out of fontnames"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">s &larr; Stream default.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">for⦂ char from: fontnames ◦ n do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[char isletter⇒ [s next &larr; char]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑s contents]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fontnames </span><span style="font: 10pt serif">[⇑fontnames]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fonts </span><span style="font: 10pt serif">[⇑fonts]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">fontsize: n </span><span style="font: 10pt serif">| s c size<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"return size from fontname"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">size &larr; 0. s &larr; (fontnames ◦ n) asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ (c &larr; s next) isletter do⦂ [].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">while⦂ [size &larr; size*10 + (c - 060). c &larr; s next] do⦂ [].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setfont: n fromfile: name<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self setfont: n name: name fromstring: (dp0 oldFile: name + &rsquo;.strike.&rsquo;) contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setfont: n name: name </span><span style="font: 10pt serif">| ucn</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[FontDict has: (ucn&larr; name asUppercase)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self setfont: n name: ucn fromstring: FontDict◦ucn]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">self setfont: n fromfile: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setfont: n name: name fromstring: string<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: italic 10pt serif">"Should update maxascent, maxdescent"</span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[fontnames◦(n+1) &larr; name asUppercase.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">fonts◦(n+1) &larr; string.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">FontDict insert: fontnames◦(n+1) with: string]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">setoffsetfont: n from: m by: d<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[fonts◦n &larr; m + [d&lt;0⇒ [0200] 0] + (d lshift: 8)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeset: styleindex<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self writeset: styleindex as: fontnames◦(styleindex+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">writeset: styleindex as: name</span><span class="tab" val="79"></span><span style="font: bold 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"write out a formset on name with strike extention"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">name &larr; name + &rsquo;.strike.&rsquo;.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">(dp0 file: name) append: fonts◦ (styleindex+1) ; close.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">heightofset: styleindex<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return height of formset in style"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(fonts◦(styleindex+1) word: 6) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">(fonts◦(styleindex+1) word: 7)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">lineheight<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[((maxascent ≡ nil) or: (maxdescent ≡ nil)) ⇒<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑((fonts◦1) word: 6) + ((fonts◦1) word: 7)]<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑maxascent+maxdescent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxascent<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[⇑ maxascent ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxascent: maxascent</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxdescent<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[ ⇑ maxdescent ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxdescent: maxdescent</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">maxwidthofset: styleindex<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return maximum width of formset in style"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(fonts◦(styleindex+1) word: 4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">nameofset: styleindex<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return name of formset in style"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(fontnames◦(styleindex+1))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">strikeofset: styleindex<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[</span><span style="font: italic 10pt serif">"Return strike of formset in style"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑(fonts◦(styleindex+1))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪TextStyle under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"TokenCollector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;TokenCollector&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: Object<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;sink parenstack&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>Provides standard token-collecting behavior for Reader .<br>See Reader-readInto: for more insight.  (P. Deutsch)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">default<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self to: (Vector new: 20)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">to: v </span><span style="font: italic 10pt serif">"Initialize"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[sink&larr; v asStream.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parenstack&larr; (Vector new: 5) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Finalization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">contents </span><span style="font: italic 10pt serif">"Close all parentheses first"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[until⦂ parenstack empty do⦂ [self rightparen].<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">⇑sink contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next&larr; obj </span><span style="font: 10pt serif">[sink next&larr; obj]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span style="font: 10pt serif">"subclasses can override easily"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">notify: errorString<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: errorString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Constructors</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">comment: s</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">float: i fraction: f exp: e<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; (i+&rsquo;.&rsquo;+f+&rsquo;e&rsquo;+e) asFloat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">identifier: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; s unique]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">integer: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; s asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">keyword: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; s unique]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leftparen<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[parenstack next&larr; sink.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sink&larr; (Vector new: 10) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">onechar: c </span><span style="font: 10pt serif">| x<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[x&larr; String new: 1. x◦1&larr; c. self next&larr; x unique]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">otheratom: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; s unique]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rightparen<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[parenstack empty⇒[] </span><span style="font: italic 10pt serif">"Error will be caught elsewhere"</span><span style="font: 10pt serif"><br></span><span class="tab" val="79"></span><span style="font: 10pt serif">parenstack last next&larr; sink contents.<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">sink&larr; parenstack pop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">separator: c</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">string: s<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[self next&larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">trailer: s</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪TokenCollector under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>"FieldNameCollector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif">Class new title: &rsquo;FieldNameCollector&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">subclassof: TokenCollector<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span style="font: bold 12pt serif">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: italic 10pt serif"><br>This class collects identifiers as Strings (not UniqueStrings)<br>for scanning of class field names (Class.instvars)<br>by the compiler(Generator) and debugger(VariablePane)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Valid fields</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">identifier: s </span><span style="font: 10pt serif">[sink next&larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 12pt serif"><br>Invalid fields</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">leftparen </span><span style="font: 10pt serif">[self next&larr; &rsquo;(&rsquo;] "just for error message"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">next&larr; value<br></span><span class="tab" val="79"></span><span style="font: 10pt serif">[user notify: &rsquo;Invalid field name: &rsquo;+value asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: bold 10pt serif">rightparen </span><span style="font: 10pt serif">[self next&larr; &rsquo;)&rsquo;] "just for error message"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span style="font: 10pt serif">SystemOrganization classify: ↪FieldNameCollector under: &rsquo;Text Objects&rsquo;.</span></div>
<script>function do_tabs() { // unit = px
  var tabs = document.getElementsByClassName("tab");
  for (var i = 0; i < tabs.length; ++i) {
    var span = tabs[i];
    var val = span.getAttribute("val");
    if (val == null) console.log("Couldn't get val");
    var rect = span.getBoundingClientRect();
    var tabstop;
    if (val > 0) tabstop = Math.ceil(rect.left / val) * val;
    else tabstop = -val;
    console.log("do_tabs", val, tabstop)
    if (tabstop > 0) {
      var width = tabstop - rect.left;
      span.style.display = "inline-block";
      span.style.width = width + "px";
    }
  }
}
do_tabs();
</script>
  </body>
</html>
